<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    Stress's bolg
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="miccall" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">Stress</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Algorithm/">Algorithm</a></li><li><a class="category-link" href="/categories/%E9%85%8D%E7%BD%AE/">配置</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/miccall" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="500px" href="http://500px.com" target="_blank" rel="noopener">
                            <i class="icon fa fa-500px"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url();background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >新年快乐</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h1 id="Core-Technologies"><a href="#Core-Technologies" class="headerlink" title="Core Technologies"></a>Core Technologies</h1><p>This part of the reference documentation covers all the technologies that are absolutely integral to the Spring Framework.</p>
<p>Foremost amongst these is the Spring Framework’s Inversion of Control (IoC) container. A thorough treatment of the Spring Framework’s IoC container is closely followed by comprehensive coverage of Spring’s Aspect-Oriented Programming (AOP) technologies. The Spring Framework has its own AOP framework, which is conceptually easy to understand and which successfully addresses the 80% sweet spot of AOP requirements in Java enterprise programming.</p>
<p>Coverage of Spring’s integration with AspectJ (currently the richest — in terms of features — and certainly most mature AOP implementation in the Java enterprise space) is also provided.</p>
<h2 id="1-The-IoC-Container"><a href="#1-The-IoC-Container" class="headerlink" title="1. The IoC Container"></a>1. The IoC Container</h2><p>This chapter covers Spring’s Inversion of Control (IoC) container.</p>
<h3 id="1-1-Introduction-to-the-Spring-IoC-Container-and-Beans"><a href="#1-1-Introduction-to-the-Spring-IoC-Container-and-Beans" class="headerlink" title="1.1. Introduction to the Spring IoC Container and Beans"></a>1.1. Introduction to the Spring IoC Container and Beans</h3><p>This chapter covers the Spring Framework implementation of the Inversion of Control (IoC) principle. IoC is also known as dependency injection (DI). It is a process whereby objects define their dependencies (that is, the other objects they work with) only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method. The container then injects those dependencies when it creates the bean. This process is fundamentally the inverse (hence the name, Inversion of Control) of the bean itself controlling the instantiation or location of its dependencies by using direct construction of classes or a mechanism such as the Service Locator pattern.</p>
<p>org.springframework.beans 和 org.springframework.context 包是 Spring Framework 的 IoC 容器的基础。 BeanFactory 接口提供了一种高级配置机制，能够管理任何类型的对象。 ApplicationContext 是 BeanFactory 的子接口. It adds:</p>
<ul>
<li>Easier integration with Spring’s AOP features</li>
<li>Message resource handling (for use in internationalization)</li>
<li>Event publication</li>
<li>Application-layer specific contexts such as the <code>WebApplicationContext</code> for use in web applications.</li>
</ul>
<p>简而言之，BeanFactory 提供了配置框架和基本功能，ApplicationContext 增加了更多的企业特定功能。 ApplicationContext 是 BeanFactory 的完整超集，在本章中专门用于描述 Spring 的 IoC 容器。 有关使用 BeanFactory 而不是 ApplicationContext 的更多信息，请参阅涵盖 BeanFactory API 的部分。</p>
<p>在 Spring 中，构成应用程序主干并由 Spring IoC 容器管理的对象称为 bean。 bean 是由 Spring IoC 容器实例化、组装和管理的对象。 否则，bean 只是应用程序中的众多对象之一。 Bean 以及它们之间的依赖关系反映在容器使用的配置元数据中。</p>
<h3 id="1-2-Container-Overview"><a href="#1-2-Container-Overview" class="headerlink" title="1.2. Container Overview"></a>1.2. Container Overview</h3><p>org.springframework.context.ApplicationContext 接口代表 Spring IoC 容器，负责实例化、配置和组装 bean。 容器通过读取配置元数据来获取关于要实例化、配置和组装哪些对象的指令。 配置元数据以 XML、Java 注释或 Java 代码表示。 它允许您表达组成应用程序的对象以及这些对象之间丰富的相互依赖关系。</p>
<p>Spring 提供了 ApplicationContext 接口的几个实现。 在独立应用程序中，通常会创建 ClassPathXmlApplicationContext 或 FileSystemXmlApplicationContext 的实例。 虽然 XML 一直是定义配置元数据的传统格式，但您可以通过提供少量 XML 配置来以声明方式启用对这些附加元数据格式的支持，从而指示容器使用 Java 注释或代码作为元数据格式。</p>
<p>In most application scenarios, explicit user code is not required to instantiate one or more instances of a Spring IoC container. For example, in a web application scenario, a simple eight (or so) lines of boilerplate web descriptor XML in the <code>web.xml</code> file of the application typically suffices (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-create">Convenient ApplicationContext Instantiation for Web Applications</a>). If you use the <a target="_blank" rel="noopener" href="https://spring.io/tools">Spring Tools for Eclipse</a> (an Eclipse-powered development environment), you can easily create this boilerplate configuration with a few mouse clicks or keystrokes.</p>
<p>The following diagram shows a high-level view of how Spring works. Your application classes are combined with configuration metadata so that, after the <code>ApplicationContext</code> is created and initialized, you have a fully configured and executable system or application.</p>
<p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/container-magic.png" alt="container magic"></p>
<p>Figure 1. The Spring IoC container</p>
<h4 id="1-2-1-Configuration-Metadata"><a href="#1-2-1-Configuration-Metadata" class="headerlink" title="1.2.1. Configuration Metadata"></a>1.2.1. Configuration Metadata</h4><p>如上图所示，Spring IoC 容器使用一种形式的配置元数据。 此配置元数据表示您作为应用程序开发人员如何告诉 Spring 容器实例化、配置和组装应用程序中的对象。</p>
<p>配置元数据传统上以简单直观的 XML 格式提供，本章大部分内容都使用这种格式来传达 Spring IoC 容器的关键概念和特性。</p>
<table>
<thead>
<tr>
<th></th>
<th>XML-based metadata is not the only allowed form of configuration metadata. The Spring IoC container itself is totally decoupled from the format in which this configuration metadata is actually written. These days, many developers choose <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java">Java-based configuration</a> for their Spring applications.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>For information about using other forms of metadata with the Spring container, see:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config">基于注释的配置</a>：Spring 2.5 引入了对基于注释的配置元数据的支持。</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java">基于Java的配置</a>：从Spring 3.0开始，Spring JavaConfig项目提供的许多功能成为Spring框架核心的一部分。因此，您可以使用 Java 而不是 XML 文件来定义应用程序类外部的 Bean。要使用这些新功能，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html"><code>@Configuration</code></a>、<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html"><code>@Bean</code></a>、<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Import.html"><code>@Import</code></a>和<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/DependsOn.html"><code>@DependsOn</code></a>注释。</li>
</ul>
<p>Spring configuration consists of at least one and typically more than one bean definition that the container must manage. XML-based configuration metadata configures these beans as <code>&lt;bean/&gt;</code> elements inside a top-level <code>&lt;beans/&gt;</code> element. Java configuration typically uses <code>@Bean</code>-annotated methods within a <code>@Configuration</code> class.</p>
<p>These bean definitions correspond to the actual objects that make up your application. Typically, you define service layer objects, data access objects (DAOs), presentation objects such as Struts <code>Action</code> instances, infrastructure objects such as Hibernate <code>SessionFactories</code>, JMS <code>Queues</code>, and so forth. Typically, one does not configure fine-grained domain objects in the container, because it is usually the responsibility of DAOs and business logic to create and load domain objects. However, you can use Spring’s integration with AspectJ to configure objects that have been created outside the control of an IoC container. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-atconfigurable">Using AspectJ to dependency-inject domain objects with Spring</a>.</p>
<p>The following example shows the basic structure of XML-based configuration metadata:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions go here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>id</code> attribute is a string that identifies the individual bean definition.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>The <code>class</code> attribute defines the type of the bean and uses the fully qualified classname.</td>
</tr>
</tbody></table>
<p>The value of the <code>id</code> attribute refers to collaborating objects. The XML for referring to collaborating objects is not shown in this example. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-dependencies">Dependencies</a> for more information.</p>
<h4 id="1-2-2-Instantiating-a-Container"><a href="#1-2-2-Instantiating-a-Container" class="headerlink" title="1.2.2. Instantiating a Container"></a>1.2.2. Instantiating a Container</h4><p>提供给 ApplicationContext 构造函数的一个或多个位置路径是资源字符串，允许容器从各种外部资源（例如本地文件系统、Java CLASSPATH 等）加载配置元数据。</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;services.xml&quot;</span>, <span class="string">&quot;daos.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>After you learn about Spring’s IoC container, you may want to know more about Spring’s <code>Resource</code> abstraction (as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources">Resources</a>), which provides a convenient mechanism for reading an InputStream from locations defined in a URI syntax. In particular, <code>Resource</code> paths are used to construct applications contexts, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-app-ctx">Application Contexts and Resource Paths</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following example shows the service layer objects <code>(services.xml)</code> configuration file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- services --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;petStore&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.samples.jpetstore.services.PetStoreServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;itemDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;itemDao&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions for services go here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows the data access objects <code>daos.xml</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;itemDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.samples.jpetstore.dao.jpa.JpaItemDao&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions for data access objects go here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In the preceding example, the service layer consists of the <code>PetStoreServiceImpl</code> class and two data access objects of the types <code>JpaAccountDao</code> and <code>JpaItemDao</code> (based on the JPA Object-Relational Mapping standard). The <code>property name</code> element refers to the name of the JavaBean property, and the <code>ref</code> element refers to the name of another bean definition. This linkage between <code>id</code> and <code>ref</code> elements expresses the dependency between collaborating objects. For details of configuring an object’s dependencies, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-dependencies">Dependencies</a>.</p>
<h5 id="Composing-XML-based-Configuration-Metadata"><a href="#Composing-XML-based-Configuration-Metadata" class="headerlink" title="Composing XML-based Configuration Metadata"></a>Composing XML-based Configuration Metadata</h5><p>It can be useful to have bean definitions span multiple XML files. Often, each individual XML configuration file represents a logical layer or module in your architecture.</p>
<p>You can use the application context constructor to load bean definitions from all these XML fragments. This constructor takes multiple <code>Resource</code> locations, as was shown in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-instantiation">previous section</a>. Alternatively, use one or more occurrences of the <code>&lt;import/&gt;</code> element to load bean definitions from another file or files. The following example shows how to do so:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;services.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;resources/messageSource.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;/resources/themeSource.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bean1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bean2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在前面的示例中，外部 bean 定义从三个文件加载：services.xml、messageSource.xml 和 themeSource.xml。 所有位置路径都相对于执行导入的定义文件，因此 services.xml 必须与执行导入的文件位于同一目录或类路径位置，而 messageSource.xml 和 themeSource.xml 必须位于该位置下方的资源位置 的导入文件。 如您所见，前导斜杠被忽略。 但是，鉴于这些路径是相对的，最好不要使用斜线。 根据 Spring Schema，被导入文件的内容，包括顶级 <beans/> 元素，必须是有效的 XML bean 定义。</p>
<table>
<thead>
<tr>
<th></th>
<th>It is possible, but not recommended, to reference files in parent directories using a relative “..&#x2F;“ path. Doing so creates a dependency on a file that is outside the current application. In particular, this reference is not recommended for <code>classpath:</code> URLs (for example, <code>classpath:../services.xml</code>), where the runtime resolution process chooses the “nearest” classpath root and then looks into its parent directory. Classpath configuration changes may lead to the choice of a different, incorrect directory.You can always use fully qualified resource locations instead of relative paths: for example, <code>file:C:/config/services.xml</code> or <code>classpath:/config/services.xml</code>. However, be aware that you are coupling your application’s configuration to specific absolute locations. It is generally preferable to keep an indirection for such absolute locations — for example, through “${…}” placeholders that are resolved against JVM system properties at runtime.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The namespace itself provides the import directive feature. Further configuration features beyond plain bean definitions are available in a selection of XML namespaces provided by Spring — for example, the <code>context</code> and <code>util</code> namespaces.</p>
<h5 id="The-Groovy-Bean-Definition-DSL"><a href="#The-Groovy-Bean-Definition-DSL" class="headerlink" title="The Groovy Bean Definition DSL"></a>The Groovy Bean Definition DSL</h5><p>As a further example for externalized configuration metadata, bean definitions can also be expressed in Spring’s Groovy Bean Definition DSL, as known from the Grails framework. Typically, such configuration live in a “.groovy” file with the structure shown in the following example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">beans &#123;</span><br><span class="line">    dataSource(BasicDataSource) &#123;</span><br><span class="line">        driverClassName = <span class="string">&quot;org.hsqldb.jdbcDriver&quot;</span></span><br><span class="line">        url = <span class="string">&quot;jdbc:hsqldb:mem:grailsDB&quot;</span></span><br><span class="line">        username = <span class="string">&quot;sa&quot;</span></span><br><span class="line">        password = <span class="string">&quot;&quot;</span></span><br><span class="line">        settings = [<span class="attr">mynew:</span><span class="string">&quot;setting&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    sessionFactory(SessionFactory) &#123;</span><br><span class="line">        dataSource = dataSource</span><br><span class="line">    &#125;</span><br><span class="line">    myService(MyService) &#123;</span><br><span class="line">        nestedBean = &#123; AnotherBean bean -&gt;</span><br><span class="line">            dataSource = dataSource</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This configuration style is largely equivalent to XML bean definitions and even supports Spring’s XML configuration namespaces. It also allows for importing XML bean definition files through an <code>importBeans</code> directive.</p>
<h4 id="1-2-3-Using-the-Container"><a href="#1-2-3-Using-the-Container" class="headerlink" title="1.2.3. Using the Container"></a>1.2.3. Using the Container</h4><p><code>ApplicationContext</code> 是高级工厂的接口，能够维护不同 bean 及其依赖项的注册表。 通过使用方法 <code>T getBean(String name, Class&lt;T&gt; requiredType)</code>，您可以检索 bean 的实例。</p>
<p>The <code>ApplicationContext</code> lets you read bean definitions and access them, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create and configure beans</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;services.xml&quot;</span>, <span class="string">&quot;daos.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve configured instance</span></span><br><span class="line"><span class="type">PetStoreService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;petStore&quot;</span>, PetStoreService.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use configured instance</span></span><br><span class="line">List&lt;String&gt; userList = service.getUsernameList();</span><br></pre></td></tr></table></figure>

<p>使用 Groovy 配置，引导看起来非常相似。 它有一个不同的上下文实现类，它支持 Groovy（但也理解 XML bean 定义）。 以下示例显示了 Groovy 配置：</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericGroovyApplicationContext</span>(<span class="string">&quot;services.groovy&quot;</span>, <span class="string">&quot;daos.groovy&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>The most flexible variant is <code>GenericApplicationContext</code> in combination with reader delegates — for example, with <code>XmlBeanDefinitionReader</code> for XML files, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(context).loadBeanDefinitions(<span class="string">&quot;services.xml&quot;</span>, <span class="string">&quot;daos.xml&quot;</span>);</span><br><span class="line">context.refresh();</span><br></pre></td></tr></table></figure>

<p>You can also use the <code>GroovyBeanDefinitionReader</code> for Groovy files, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">GroovyBeanDefinitionReader</span>(context).loadBeanDefinitions(<span class="string">&quot;services.groovy&quot;</span>, <span class="string">&quot;daos.groovy&quot;</span>);</span><br><span class="line">context.refresh();</span><br></pre></td></tr></table></figure>

<p>You can mix and match such reader delegates on the same <code>ApplicationContext</code>, reading bean definitions from diverse configuration sources.</p>
<p>You can then use <code>getBean</code> to retrieve instances of your beans. The <code>ApplicationContext</code> interface has a few other methods for retrieving beans, but, ideally, your application code should never use them. Indeed, your application code should have no calls to the <code>getBean()</code> method at all and thus have no dependency on Spring APIs at all. For example, Spring’s integration with web frameworks provides dependency injection for various web framework components such as controllers and JSF-managed beans, letting you declare a dependency on a specific bean through metadata (such as an autowiring annotation).</p>
<h3 id="1-3-Bean-Overview"><a href="#1-3-Bean-Overview" class="headerlink" title="1.3. Bean Overview"></a>1.3. Bean Overview</h3><p>A Spring IoC container manages one or more beans. These beans are created with the configuration metadata that you supply to the container (for example, in the form of XML <code>&lt;bean/&gt;</code> definitions).</p>
<p>Within the container itself, these bean definitions are represented as <code>BeanDefinition</code> objects, which contain (among other information) the following metadata:</p>
<ul>
<li>A package-qualified class name: typically, the actual implementation class of the bean being defined.</li>
<li>Bean behavioral configuration elements, which state how the bean should behave in the container (scope, lifecycle callbacks, and so forth).</li>
<li>References to other beans that are needed for the bean to do its work. These references are also called collaborators or dependencies.</li>
<li>Other configuration settings to set in the newly created object — for example, the size limit of the pool or the number of connections to use in a bean that manages a connection pool.</li>
</ul>
<p>This metadata translates to a set of properties that make up each bean definition. The following table describes these properties:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Explained in…</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Class</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-class">Instantiating Beans</a></td>
</tr>
<tr>
<td align="left">Name</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beanname">Naming Beans</a></td>
</tr>
<tr>
<td align="left">Scope</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes">Bean Scopes</a></td>
</tr>
<tr>
<td align="left">Constructor arguments</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-collaborators">Dependency Injection</a></td>
</tr>
<tr>
<td align="left">Properties</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-collaborators">Dependency Injection</a></td>
</tr>
<tr>
<td align="left">Autowiring mode</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire">Autowiring Collaborators</a></td>
</tr>
<tr>
<td align="left">Lazy initialization mode</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lazy-init">Lazy-initialized Beans</a></td>
</tr>
<tr>
<td align="left">Initialization method</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-initializingbean">Initialization Callbacks</a></td>
</tr>
<tr>
<td align="left">Destruction method</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-disposablebean">Destruction Callbacks</a></td>
</tr>
</tbody></table>
<p>In addition to bean definitions that contain information on how to create a specific bean, the <code>ApplicationContext</code> implementations also permit the registration of existing objects that are created outside the container (by users). This is done by accessing the ApplicationContext’s <code>BeanFactory</code> through the <code>getBeanFactory()</code> method, which returns the <code>DefaultListableBeanFactory</code> implementation. <code>DefaultListableBeanFactory</code> supports this registration through the <code>registerSingleton(..)</code> and <code>registerBeanDefinition(..)</code> methods. However, typical applications work solely with beans defined through regular bean definition metadata.</p>
<table>
<thead>
<tr>
<th></th>
<th>Bean metadata and manually supplied singleton instances need to be registered as early as possible, in order for the container to properly reason about them during autowiring and other introspection steps. While overriding existing metadata and existing singleton instances is supported to some degree, the registration of new beans at runtime (concurrently with live access to the factory) is not officially supported and may lead to concurrent access exceptions, inconsistent state in the bean container, or both.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-3-1-Naming-Beans"><a href="#1-3-1-Naming-Beans" class="headerlink" title="1.3.1. Naming Beans"></a>1.3.1. Naming Beans</h4><p>Every bean has one or more identifiers. These identifiers must be unique within the container that hosts the bean. A bean usually has only one identifier. However, if it requires more than one, the extra ones can be considered aliases.</p>
<p>In XML-based configuration metadata, you use the <code>id</code> attribute, the <code>name</code> attribute, or both to specify the bean identifiers. The <code>id</code> attribute lets you specify exactly one id. Conventionally, these names are alphanumeric (‘myBean’, ‘someService’, etc.), but they can contain special characters as well. If you want to introduce other aliases for the bean, you can also specify them in the <code>name</code> attribute, separated by a comma (<code>,</code>), semicolon (<code>;</code>), or white space. As a historical note, in versions prior to Spring 3.1, the <code>id</code> attribute was defined as an <code>xsd:ID</code> type, which constrained possible characters. As of 3.1, it is defined as an <code>xsd:string</code> type. Note that bean <code>id</code> uniqueness is still enforced by the container, though no longer by XML parsers.</p>
<p>You are not required to supply a <code>name</code> or an <code>id</code> for a bean. If you do not supply a <code>name</code> or <code>id</code> explicitly, the container generates a unique name for that bean. However, if you want to refer to that bean by name, through the use of the <code>ref</code> element or a Service Locator style lookup, you must provide a name. Motivations for not supplying a name are related to using <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-inner-beans">inner beans</a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire">autowiring collaborators</a>.</p>
<p>Bean Naming Conventions</p>
<p>The convention is to use the standard Java convention for instance field names when naming beans. That is, bean names start with a lowercase letter and are camel-cased from there. Examples of such names include <code>accountManager</code>, <code>accountService</code>, <code>userDao</code>, <code>loginController</code>, and so forth.</p>
<p>Naming beans consistently makes your configuration easier to read and understand. Also, if you use Spring AOP, it helps a lot when applying advice to a set of beans related by name.</p>
<table>
<thead>
<tr>
<th></th>
<th>With component scanning in the classpath, Spring generates bean names for unnamed components, following the rules described earlier: essentially, taking the simple class name and turning its initial character to lower-case. However, in the (unusual) special case when there is more than one character and both the first and second characters are upper case, the original casing gets preserved. These are the same rules as defined by <code>java.beans.Introspector.decapitalize</code> (which Spring uses here).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Aliasing-a-Bean-outside-the-Bean-Definition"><a href="#Aliasing-a-Bean-outside-the-Bean-Definition" class="headerlink" title="Aliasing a Bean outside the Bean Definition"></a>Aliasing a Bean outside the Bean Definition</h5><p>In a bean definition itself, you can supply more than one name for the bean, by using a combination of up to one name specified by the <code>id</code> attribute and any number of other names in the <code>name</code> attribute. These names can be equivalent aliases to the same bean and are useful for some situations, such as letting each component in an application refer to a common dependency by using a bean name that is specific to that component itself.</p>
<p>Specifying all aliases where the bean is actually defined is not always adequate, however. It is sometimes desirable to introduce an alias for a bean that is defined elsewhere. This is commonly the case in large systems where configuration is split amongst each subsystem, with each subsystem having its own set of object definitions. In XML-based configuration metadata, you can use the <code>&lt;alias/&gt;</code> element to accomplish this. The following example shows how to do so:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;fromName&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;toName&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>In this case, a bean (in the same container) named <code>fromName</code> may also, after the use of this alias definition, be referred to as <code>toName</code>.</p>
<p>For example, the configuration metadata for subsystem A may refer to a DataSource by the name of <code>subsystemA-dataSource</code>. The configuration metadata for subsystem B may refer to a DataSource by the name of <code>subsystemB-dataSource</code>. When composing the main application that uses both these subsystems, the main application refers to the DataSource by the name of <code>myApp-dataSource</code>. To have all three names refer to the same object, you can add the following alias definitions to the configuration metadata:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;myApp-dataSource&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;subsystemA-dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;myApp-dataSource&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;subsystemB-dataSource&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now each component and the main application can refer to the dataSource through a name that is unique and guaranteed not to clash with any other definition (effectively creating a namespace), yet they refer to the same bean.</p>
<p>Java-configuration</p>
<p>If you use Javaconfiguration, the <code>@Bean</code> annotation can be used to provide aliases. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-bean-annotation">Using the <code>@Bean</code> Annotation</a> for details.</p>
<h4 id="1-3-2-Instantiating-Beans"><a href="#1-3-2-Instantiating-Beans" class="headerlink" title="1.3.2. Instantiating Beans"></a>1.3.2. Instantiating Beans</h4><p>bean 定义本质上是创建一个或多个对象的方法。当被询问时，容器会查看命名 bean 的配方，并使用该 bean 定义封装的配置元数据来创建（或获取）实际对象。</p>
<p>如果使用基于 XML 的配置元数据，则在 <code>&lt;bean/&gt;</code> 元素的 <code>class</code> 属性中指定要实例化的对象的类型（或类）。这个 <code>class</code> 属性（在内部是 <code>BeanDefinition</code> 实例上的 <code>Class</code> 属性）通常是强制性的。 （例外情况见【使用实例工厂方法实例化】（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-class-instance-factory">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-class-instance-factory</a> -method) 和 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-child-bean-definitions">Bean 定义继承</a>。）您可以使用<code>Class</code> 属性的两种方式之一：</p>
<ul>
<li>通常，在容器本身通过反射调用其构造函数直接创建 bean 的情况下指定要构造的 bean 类，这在某种程度上等同于带有 <code>new</code> 运算符的 Java 代码。</li>
<li>指定包含调用以创建对象的“静态”工厂方法的实际类，在不太常见的情况下，容器调用类上的“静态”工厂方法来创建 bean。从调用<code>static</code>工厂方法返回的对象类型可能是同一个类或完全是另一个类。</li>
</ul>
<p>嵌套类名</p>
<p>如果要为嵌套类配置 bean 定义，可以使用嵌套类的二进制名称或源名称。</p>
<p>例如，如果你在 <code>com.example</code> 包中有一个名为 <code>SomeThing</code> 的类，而这个 <code>SomeThing</code> 类有一个名为 <code>OtherThing</code> 的 <code>static</code> 嵌套类，它们可以用美元符号 (<code>$ </code>) 或点 (<code>.</code>)。 因此 bean 定义中的 <code>class</code> 属性的值将是 <code>com.example.SomeThing$OtherThing</code> 或 <code>com.example.SomeThing.OtherThing</code>。</p>
<h5 id="Instantiation-with-a-Constructor"><a href="#Instantiation-with-a-Constructor" class="headerlink" title="Instantiation with a Constructor"></a>Instantiation with a Constructor</h5><p>当您通过构造方法创建 bean 时，所有普通类都可以被 Spring 使用并兼容。也就是说，正在开发的类不需要实现任何特定的接口或以特定的方式进行编码。只需指定 bean 类就足够了。但是，根据您用于该特定 bean 的 IoC 类型，您可能需要一个默认（空）构造函数。</p>
<p>Spring IoC 容器几乎可以管理您希望它管理的任何类。它不仅限于管理真正的 JavaBean。大多数 Spring 用户更喜欢只有一个默认（无参数）构造函数以及根据容器中的属性建模的适当的 setter 和 getter 的实际 JavaBeans。您还可以在容器中拥有更多奇特的非 bean 样式类。例如，如果您需要使用绝对不符合 JavaBean 规范的遗留连接池，那么 Spring 也可以管理它。</p>
<p>使用基于 XML 的配置元数据，您可以指定 bean 类，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;anotherExample&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBeanTwo&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>有关在构造对象后向构造函数提供参数（如果需要）和设置对象实例属性的机制的详细信息，请参阅[注入依赖项]（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/">https://docs.spring.io/spring-framework/docs/current/</a> 参考&#x2F;html&#x2F;core.html#beans-factory-collaborators）。</p>
<h5 id="Instantiation-with-a-Static-Factory-Method"><a href="#Instantiation-with-a-Static-Factory-Method" class="headerlink" title="Instantiation with a Static Factory Method"></a>Instantiation with a Static Factory Method</h5><p>在定义使用静态工厂方法创建的 bean 时，使用 <code>class</code> 属性来指定包含 <code>static</code> 工厂方法的类，并使用名为 <code>factory-method</code> 的属性来指定工厂方法本身的名称。 您应该能够调用此方法（使用可选参数，如后所述）并返回一个活动对象，该对象随后被视为是通过构造函数创建的。 这种 bean 定义的一种用途是在遗留代码中调用“静态”工厂。</p>
<p>以下 bean 定义指定将通过调用工厂方法创建 bean。 定义没有指定返回对象的类型（类），而是包含工厂方法的类。 在这个例子中，<code>createInstance()</code> 方法必须是 <code>static</code> 方法。 以下示例显示了如何指定工厂方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;examples.ClientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面的例子展示了一个可以与前面的 bean 定义一起工作的类：</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ClientService</span> <span class="variable">clientService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientService</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ClientService</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ClientService <span class="title function_">createInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于在工厂返回对象后为工厂方法提供（可选）参数和设置对象实例属性的机制的详细信息，请参阅【依赖关系和配置详解】（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-">https://docs.spring.io/spring-</a> framework&#x2F;docs&#x2F;current&#x2F;reference&#x2F;html&#x2F;core.html#beans-factory-properties-detailed）。</p>
<h5 id=""><a href="#" class="headerlink" title=""></a></h5><h5 id="Instantiation-by-Using-an-Instance-Factory-Method"><a href="#Instantiation-by-Using-an-Instance-Factory-Method" class="headerlink" title="Instantiation by Using an Instance Factory Method"></a>Instantiation by Using an Instance Factory Method</h5><p>类似于通过[静态工厂方法]（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-class-static-factory-method%EF%BC%89%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%8C">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-class-static-factory-method）实例化，</a> 使用实例工厂方法的实例化从容器中调用现有 bean 的非静态方法来创建新 bean。 要使用此机制，请将 <code>class</code> 属性留空，并在 <code>factory-bean</code> 属性中指定当前（或父级或祖先）容器中包含要调用的实例方法的 bean 的名称 创建对象。 使用 <code>factory-method</code> 属性设置工厂方法本身的名称。 以下示例显示了如何配置这样的 bean：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;serviceLocator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- the bean to be created via the factory bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createClientServiceInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows the corresponding class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultServiceLocator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ClientService</span> <span class="variable">clientService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ClientService <span class="title function_">createClientServiceInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One factory class can also hold more than one factory method, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;serviceLocator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createClientServiceInstance&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createAccountServiceInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows the corresponding class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultServiceLocator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ClientService</span> <span class="variable">clientService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ClientService <span class="title function_">createClientServiceInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AccountService <span class="title function_">createAccountServiceInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This approach shows that the factory bean itself can be managed and configured through dependency injection (DI). See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-properties-detailed">Dependencies and Configuration in Detail</a>.</p>
<table>
<thead>
<tr>
<th></th>
<th>在 Spring 文档中，“工厂 bean”是指在 Spring 容器中配置并通过 [instance] (<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html">https://docs.spring.io/spring-framework/docs/current/reference/html</a>) 创建对象的 bean &#x2F;core.html#beans-factory-class-instance-factory-method）或[静态]（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-</a> factory-class-static-factory-method) 工厂方法。 相比之下，<code>FactoryBean</code>（注意大写）指的是特定于 Spring 的 [<code>FactoryBean</code>](<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans</a> -factory-extension-factorybean) 实现类。</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Determining-a-Bean’s-Runtime-Type"><a href="#Determining-a-Bean’s-Runtime-Type" class="headerlink" title="Determining a Bean’s Runtime Type"></a>Determining a Bean’s Runtime Type</h5><p>确定特定 bean 的运行时类型并非易事。 bean 元数据定义中的指定类只是一个初始类引用，可能与声明的工厂方法或作为“FactoryBean”类组合，这可能会导致 bean 的不同运行时类型，或者根本没有设置，以防万一 实例级工厂方法（通过指定的 <code>factory-bean</code> 名称解析）。 此外，AOP 代理可以用基于接口的代理包装一个 bean 实例，并限制目标 bean 的实际类型（仅其实现的接口）的暴露。</p>
<p>查找特定 bean 的实际运行时类型的推荐方法是对指定 bean 名称的 <code>BeanFactory.getType</code> 调用。 这将所有上述情况都考虑在内，并返回 <code>BeanFactory.getBean</code> 调用将为相同的 bean 名称返回的对象类型。</p>
<h3 id="1-4-Dependencies"><a href="#1-4-Dependencies" class="headerlink" title="1.4. Dependencies"></a>1.4. Dependencies</h3><p>A typical enterprise application does not consist of a single object (or bean in the Spring parlance). Even the simplest application has a few objects that work together to present what the end-user sees as a coherent application. This next section explains how you go from defining a number of bean definitions that stand alone to a fully realized application where objects collaborate to achieve a goal.</p>
<h4 id="1-4-1-Dependency-Injection"><a href="#1-4-1-Dependency-Injection" class="headerlink" title="1.4.1. Dependency Injection"></a>1.4.1. Dependency Injection</h4><p>依赖注入 (DI) 是一个过程，其中对象仅通过构造函数参数、工厂方法的参数或对象实例在构造或从工厂方法返回。然后容器在创建 bean 时注入这些依赖项。这个过程基本上是 bean 本身的逆过程（因此得名，控制反转），它通过使用类的直接构造或服务定位器模式自行控制其依赖项的实例化或位置。</p>
<p>使用 DI 原则，代码更干净，当对象具有依赖关系时，解耦更有效。对象不查找其依赖项，也不知道依赖项的位置或类别。结果，您的类变得更容易测试，特别是当依赖关系在接口或抽象基类上时，它们允许在单元测试中使用存根或模拟实现。</p>
<p>DI 存在两种主要变体：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-constructor-injection">基于构造函数的依赖注入</a>和<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-setter-injection">Setter基于依赖注入</a>。</p>
<h5 id="Constructor-based-Dependency-Injection"><a href="#Constructor-based-Dependency-Injection" class="headerlink" title="Constructor-based Dependency Injection"></a>Constructor-based Dependency Injection</h5><p>基于构造函数的 DI 是通过容器调用具有多个参数的构造函数来完成的，每个参数代表一个依赖项。 调用带有特定参数的“静态”工厂方法来构造 bean 几乎是等价的，本讨论将类似地对待构造函数和“静态”工厂方法的参数。 以下示例显示了一个只能通过构造函数注入进行依赖注入的类：</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the SimpleMovieLister has a dependency on a MovieFinder</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a constructor so that the Spring container can inject a MovieFinder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleMovieLister</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，这个类没有什么特别之处。 它是一个 POJO，不依赖于容器特定的接口、基类或注释。</p>
<h6 id="Constructor-Argument-Resolution"><a href="#Constructor-Argument-Resolution" class="headerlink" title="Constructor Argument Resolution"></a>Constructor Argument Resolution</h6><p>构造函数参数解析匹配通过使用参数的类型进行。 如果 bean 定义的构造函数参数中不存在潜在的歧义，则在 bean 定义中定义构造函数参数的顺序是在实例化 bean 时将这些参数提供给适当构造函数的顺序。 考虑以下类：</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThingOne</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThingOne</span><span class="params">(ThingTwo thingTwo, ThingThree thingThree)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设 <code>ThingTwo</code> 和 <code>ThingThree</code> 类没有继承关系，不存在潜在的歧义。 因此，以下配置工作正常，您无需在 <code>&lt;constructor-arg/&gt;</code> 元素中显式指定构造函数参数索引或类型。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;beanTwo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;beanThree&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingTwo&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanThree&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingThree&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当引用另一个 bean 时，类型是已知的，并且可以发生匹配（就像前面的示例一样）。 当使用简单类型时，例如<code>&lt;value&gt;true&lt;/value&gt;</code>，Spring无法确定值的类型，因此无法在没有帮助的情况下按类型匹配。 考虑以下类：</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> examples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Number of years to calculate the Ultimate Answer</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> years;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Answer to Life, the Universe, and Everything</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ultimateAnswer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleBean</span><span class="params">(<span class="type">int</span> years, String ultimateAnswer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.years = years;</span><br><span class="line">        <span class="built_in">this</span>.ultimateAnswer = ultimateAnswer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造函数参数类型匹配</p>
<p>在上述场景中，如果您使用 <code>type</code> 属性显式指定构造函数参数的类型，则容器可以使用简单类型的类型匹配，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造函数参数索引</p>
<p>您可以使用 <code>index</code> 属性显式指定构造函数参数的索引，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>除了解决多个简单值的歧义之外，指定索引还可以解决构造函数具有两个相同类型参数的歧义。</p>
<table>
<thead>
<tr>
<th></th>
<th>The index is 0-based.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>构造函数参数名称</p>
<p>您还可以使用构造函数参数名称进行值消歧，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;years&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ultimateAnswer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>请记住，要使这项工作开箱即用，您的代码必须在启用调试标志的情况下编译，以便 Spring 可以从构造函数中查找参数名称。 如果您不能或不想使用调试标志编译代码，可以使用 <a target="_blank" rel="noopener" href="https://download.oracle.com/javase/8/docs/api/java/beans/ConstructorProperties.html">@ConstructorProperties</a> JDK 注释来显式命名您的构造函数参数。 示例类必须如下所示：</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> examples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fields omitted</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;years&quot;, &quot;ultimateAnswer&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleBean</span><span class="params">(<span class="type">int</span> years, String ultimateAnswer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.years = years;</span><br><span class="line">        <span class="built_in">this</span>.ultimateAnswer = ultimateAnswer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Setter-based-Dependency-Injection"><a href="#Setter-based-Dependency-Injection" class="headerlink" title="Setter-based Dependency Injection"></a>Setter-based Dependency Injection</h5><p>基于 Setter 的 DI 是通过容器在调用无参数构造函数或无参数“静态”工厂方法来实例化 bean 后调用 bean 上的 setter 方法来完成的。</p>
<p>以下示例显示了一个只能通过使用纯 setter 注入进行依赖注入的类。 这个类是传统的Java。 它是一个 POJO，不依赖于容器特定的接口、基类或注释。</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the SimpleMovieLister has a dependency on the MovieFinder</span></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a setter method so that the Spring container can inject a MovieFinder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ApplicationContext</code> 支持它管理的 bean 的基于构造函数和基于 setter 的 DI。在已经通过构造方法注入了一些依赖项之后，它还支持基于 setter 的 DI。您以 <code>BeanDefinition</code> 的形式配置依赖项，您可以将其与 <code>PropertyEditor</code> 实例结合使用，以将属性从一种格式转换为另一种格式。然而，大多数 Spring 用户不直接使用这些类（即以编程方式），而是使用 XML <code>bean</code> 定义、注释组件（即，使用 <code>@Component</code>、<code>@Controller</code> 等注释的类） , 或基于 Java 的 <code>@Configuration</code> 类中的 <code>@Bean</code> 方法。然后这些源在内部被转换为 <code>BeanDefinition</code> 的实例，并用于加载整个 Spring IoC 容器实例。</p>
<p>基于构造函数还是基于 setter 的 DI？</p>
<p>由于您可以混合使用基于构造函数和基于 setter 的 DI，因此将构造函数用于强制依赖项并将 setter 方法或配置方法用于可选依赖项是一个很好的经验法则。请注意，可以在 setter 方法上使用 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-required-annotation">@Required</a> 注释使该属性成为必需的依赖项；然而，带有参数的编程验证的构造函数注入是更可取的。</p>
<p>Spring 团队通常提倡构造函数注入，因为它允许您将应用程序组件实现为不可变对象，并确保所需的依赖项不是“空”。此外，构造函数注入的组件总是以完全初始化的状态返回给客户端（调用）代码。附带说明一下，大量的构造函数参数是一种不好的代码气味，这意味着该类可能有太多的职责，应该重构以更好地解决适当的关注点分离问题。</p>
<p>Setter 注入应该主要只用于可以在类中分配合理默认值的可选依赖项。否则，必须在代码使用依赖项的任何地方执行非空检查。 setter 注入的一个好处是 setter 方法使该类的对象可以在以后重新配置或重新注入。因此，通过 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#jmx">JMX MBeans</a> 进行管理是 setter 注入的一个引人注目的用例。</p>
<p>使用对特定类最有意义的 DI 样式。有时，在处理您没有源代码的第三方类时，会为您做出选择。例如，如果第三方类没有公开任何 setter 方法，那么构造函数注入可能是 DI 的唯一可用形式。</p>
<h5 id="Dependency-Resolution-Process"><a href="#Dependency-Resolution-Process" class="headerlink" title="Dependency Resolution Process"></a>Dependency Resolution Process</h5><p>The container performs bean dependency resolution as follows:</p>
<ul>
<li><code>ApplicationContext</code> 使用描述所有 bean 的配置元数据创建和初始化。 配置元数据可以由 XML、Java 代码或注释指定。</li>
<li>对于每个 bean，其依赖关系以属性、构造函数参数或静态工厂方法的参数的形式表示（如果您使用它而不是普通的构造函数）。 这些依赖项在实际创建 bean 时提供给 bean。</li>
<li>每个属性或构造函数参数都是要设置的值的实际定义，或者是对容器中另一个 bean 的引用。</li>
<li>作为值的每个属性或构造函数参数都从其指定格式转换为该属性或构造函数参数的实际类型。 默认情况下，Spring 可以将以字符串格式提供的值转换为所有内置类型，例如 <code>int</code>、<code>long</code>、<code>String</code>、<code>boolean</code> 等。</li>
</ul>
<p>Spring 容器在创建容器时验证每个 bean 的配置。但是，在实际创建 bean 之前，不会设置 bean 属性本身。在创建容器时会创建单例范围并设置为预实例化（默认）的 Bean。范围在 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes">Bean Scopes</a> 中定义。否则，只有在请求时才会创建 bean。创建 bean 可能会导致创建 bean 图，因为 bean 的依赖项及其依赖项的依赖项（等等）被创建和分配。请注意，这些依赖项之间的解析不匹配可能会延迟出现 — 也就是说，在第一次创建受影响的 bean 时。</p>
<p>循环依赖</p>
<p>如果您主要使用构造函数注入，则可能会创建无法解决的循环依赖场景。</p>
<p>例如：A类通过构造函数注入需要B类的实例，B类通过构造函数注入需要A类的实例。如果你为类 A 和 B 配置 bean 以相互注入，Spring IoC 容器会在运行时检测到这个循环引用，并抛出一个 <code>BeanCurrentlyInCreationException</code>。</p>
<p>一种可能的解决方案是编辑某些类的源代码以由设置器而不是构造器配置。或者，避免构造函数注入并仅使用 setter 注入。也就是说，虽然不推荐，但是可以通过setter注入来配置循环依赖。</p>
<p>与典型情况（没有循环依赖关系）不同，bean A 和 bean B 之间的循环依赖关系强制其中一个 bean 在完全初始化之前注入另一个 bean（典型的先有鸡还是先有蛋的场景）。</p>
<p>您通常可以相信 Spring 会做正确的事情。它在容器加载时检测配置问题，例如对不存在的 bean 和循环依赖项的引用。在实际创建 bean 时，Spring 会尽可能晚地设置属性并解析依赖关系。这意味着，如果在创建该对象或其依赖项之一时出现问题，则正确加载的 Spring 容器稍后可以在您请求对象时生成异常 — 例如，bean 由于丢失或无效而引发异常财产。某些配置问题的这种潜在延迟可见性是为什么 <code>ApplicationContext</code> 实现默认预实例化单例 bean。以在实际需要之前创建这些 bean 的一些前期时间和内存为代价，您会在创建 ApplicationContext 时发现配置问题，而不是稍后。您仍然可以覆盖此默认行为，以便单例 bean 延迟初始化，而不是急切地预先实例化。</p>
<p>如果不存在循环依赖关系，则当一个或多个协作 bean 被注入到依赖 bean 中时，每个协作 bean 在被注入依赖 bean 之前完全配置。这意味着，如果 bean A 依赖于 bean B，则 Spring IoC 容器在调用 bean A 上的 setter 方法之前完全配置 bean B。换句话说，bean 被实例化（如果它不是预先实例化的单例） )，其依赖项已设置，以及相关的生命周期方法（例如[配置的 init 方法](<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-</a> factory-lifecycle-initializingbean) 或 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-initializingbean">InitializingBean 回调方法</a>) 是调用。</p>
<h5 id="Examples-of-Dependency-Injection"><a href="#Examples-of-Dependency-Injection" class="headerlink" title="Examples of Dependency Injection"></a>Examples of Dependency Injection</h5><p>以下示例将基于 XML 的配置元数据用于基于 setter 的 DI。 Spring XML 配置文件的一小部分指定了一些 bean 定义，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- setter injection using the nested ref element --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;beanOne&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;anotherExampleBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- setter injection using the neater ref attribute --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;beanTwo&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;yetAnotherBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;integerProperty&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;anotherExampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.AnotherBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;yetAnotherBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.YetAnotherBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows the corresponding <code>ExampleBean</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AnotherBean beanOne;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> YetAnotherBean beanTwo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanOne</span><span class="params">(AnotherBean beanOne)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.beanOne = beanOne;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanTwo</span><span class="params">(YetAnotherBean beanTwo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.beanTwo = beanTwo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIntegerProperty</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.i = i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，setter 被声明为与 XML 文件中指定的属性相匹配。 以下示例使用基于构造函数的 DI：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- constructor injection using the nested ref element --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;anotherExampleBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- constructor injection using the neater ref attribute --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;yetAnotherBean&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;anotherExampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.AnotherBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;yetAnotherBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.YetAnotherBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows the corresponding <code>ExampleBean</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AnotherBean beanOne;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> YetAnotherBean beanTwo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleBean</span><span class="params">(</span></span><br><span class="line"><span class="params">        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.beanOne = anotherBean;</span><br><span class="line">        <span class="built_in">this</span>.beanTwo = yetAnotherBean;</span><br><span class="line">        <span class="built_in">this</span>.i = i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bean 定义中指定的构造函数参数用作“ExampleBean”构造函数的参数。</p>
<p>现在考虑这个例子的一个变体，其中，Spring 被告知调用“静态”工厂方法来返回对象的实例，而不是使用构造函数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;createInstance&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;anotherExampleBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;yetAnotherBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;anotherExampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.AnotherBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;yetAnotherBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.YetAnotherBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows the corresponding <code>ExampleBean</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a private constructor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ExampleBean</span><span class="params">(...)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a static factory method; the arguments to this method can be</span></span><br><span class="line">    <span class="comment">// considered the dependencies of the bean that is returned,</span></span><br><span class="line">    <span class="comment">// regardless of how those arguments are actually used.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExampleBean <span class="title function_">createInstance</span> <span class="params">(</span></span><br><span class="line"><span class="params">        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="type">int</span> i)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ExampleBean</span> <span class="variable">eb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExampleBean</span> (...);</span><br><span class="line">        <span class="comment">// some other operations...</span></span><br><span class="line">        <span class="keyword">return</span> eb;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>static</code>工厂方法的参数由<code>&lt;constructor-arg/&gt;</code>元素提供，与实际使用构造函数完全相同。 工厂方法返回的类的类型不必与包含“静态”工厂方法的类的类型相同（尽管在本例中是这样）。 实例（非静态）工厂方法可以以基本相同的方式使用（除了使用 <code>factory-bean</code> 属性而不是 <code>class</code> 属性），因此我们不在这里讨论这些细节。</p>
<h4 id="1-4-2-详细的依赖关系和配置"><a href="#1-4-2-详细的依赖关系和配置" class="headerlink" title="1.4.2. 详细的依赖关系和配置"></a>1.4.2. 详细的依赖关系和配置</h4><p>如<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-collaborators">上一节</a>中所述，您可以定义bean属性和构造函数参数 作为对其他托管 bean（协作者）的引用或作为内联定义的值。 为此，Spring 基于 XML 的配置元数据支持其 <code>&lt;property/&gt;</code> 和 <code>&lt;constructor-arg/&gt;</code> 元素中的子元素类型。</p>
<h5 id="直值（基元、字符串等）"><a href="#直值（基元、字符串等）" class="headerlink" title="直值（基元、字符串等）"></a>直值（基元、字符串等）</h5><p><code>&lt;property/&gt;</code> 元素的 <code>value</code> 属性将属性或构造函数参数指定为人类可读的字符串表示形式。 Spring 的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#core-convert-ConversionService-API">转换服务</a> 用于将这些值从 <code>String </code> 到属性或参数的实际类型。 以下示例显示了正在设置的各种值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;misterkaoli&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example uses the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-p-namespace">p-namespace</a> for even more succinct XML configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:driverClassName</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:url</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:username</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:password</span>=<span class="string">&quot;misterkaoli&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>前面的 XML 更简洁。 但是，拼写错误是在运行时而不是设计时发现的，除非您使用 IDE（例如 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> 或 [Spring Tools for Eclipse](https:&#x2F;&#x2F; &#x2F;spring.io&#x2F;tools)) 在创建 bean 定义时支持自动属性完成。 强烈推荐这种 IDE 帮助。</p>
<p>You can also configure a <code>java.util.Properties</code> instance, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mappings&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.PropertySourcesPlaceholderConfigurer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- typed as a java.util.Properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            jdbc.driver.className=com.mysql.jdbc.Driver</span><br><span class="line">            jdbc.url=jdbc:mysql://localhost:3306/mydb</span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring 容器通过使用 JavaBeans 的 <code>PropertyEditor</code> 机制将 <code>&lt;value/&gt;</code> 元素内的文本转换为 <code>java.util.Properties</code> 实例。 这是一个不错的捷径，也是 Spring 团队支持使用嵌套的 <code>&lt;value/&gt;</code> 元素而不是 <code>value</code> 属性样式的少数几个地方之一。</p>
<h6 id="idref-元素"><a href="#idref-元素" class="headerlink" title="idref 元素"></a><code>idref</code> 元素</h6><p><code>idref</code> 元素只是将容器中另一个 bean 的 <code>id</code>（字符串值 - 不是引用）传递给 <code>&lt;constructor-arg/&gt;</code> 或 <code>&lt;property/&gt;</code> 的一种防错方法 元素。 以下示例显示了如何使用它：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;theTargetBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;theClientBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetName&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">idref</span> <span class="attr">bean</span>=<span class="string">&quot;theTargetBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding bean definition snippet is exactly equivalent (at runtime) to the following snippet:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;theTargetBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;client&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;theTargetBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The first form is preferable to the second, because using the <code>idref</code> tag lets the container validate at deployment time that the referenced, named bean actually exists. In the second variation, no validation is performed on the value that is passed to the <code>targetName</code> property of the <code>client</code> bean. Typos are only discovered (with most likely fatal results) when the <code>client</code> bean is actually instantiated. If the <code>client</code> bean is a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes">prototype</a> bean, this typo and the resulting exception may only be discovered long after the container is deployed.</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>local</code> attribute on the <code>idref</code> element is no longer supported in the 4.0 beans XSD, since it does not provide value over a regular <code>bean</code> reference any more. Change your existing <code>idref local</code> references to <code>idref bean</code> when upgrading to the 4.0 schema.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>&lt;idref/&gt;</code> 元素带来价值的常见地方（至少在 Spring 2.0 之前的版本中）是在 [AOP 拦截器] 的配置中（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/">https://docs.spring.io/spring-framework/docs/</a> current&#x2F;reference&#x2F;html&#x2F;core.html#aop-pfb-1) 在 <code>ProxyFactoryBean</code> bean 定义中。在指定拦截器名称时使用 <code>&lt;idref/&gt;</code> 元素可防止您拼错拦截器 ID。</p>
<h5 id="对其他-Bean-的引用（协作者）"><a href="#对其他-Bean-的引用（协作者）" class="headerlink" title="对其他 Bean 的引用（协作者）"></a>对其他 Bean 的引用（协作者）</h5><p><code>ref</code> 元素是 <code>&lt;constructor-arg/&gt;</code> 或 <code>&lt;property/&gt;</code> 定义元素中的最后一个元素。在这里，您将 bean 的指定属性的值设置为对容器管理的另一个 bean（协作者）的引用。引用的bean是要设置属性的bean的依赖，在设置属性前根据需要进行初始化。 （如果协作者是单例 bean，它可能已经被容器初始化。）所有引用最终都是对另一个对象的引用。范围和验证取决于您是否通过 <code>bean</code> 或 <code>parent</code> 属性指定其他对象的 ID 或名称。</p>
<p>通过 <code>&lt;ref/&gt;</code> 标签的 <code>bean</code> 属性指定目标 bean 是最通用的形式，它允许创建对同一容器或父容器中的任何 bean 的引用，无论它是否在同一个 XML 中文件。 <code>bean</code> 属性的值可以与目标 bean 的 <code>id</code> 属性相同，也可以与目标 bean 的 <code>name</code> 属性中的值之一相同。以下示例显示了如何使用 <code>ref</code> 元素：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;someBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Specifying the target bean through the <code>parent</code> attribute creates a reference to a bean that is in a parent container of the current container. The value of the <code>parent</code> attribute may be the same as either the <code>id</code> attribute of the target bean or one of the values in the <code>name</code> attribute of the target bean. The target bean must be in a parent container of the current one. You should use this bean reference variant mainly when you have a hierarchy of containers and you want to wrap an existing bean in a parent container with a proxy that has the same name as the parent bean. The following pair of listings shows how to use the <code>parent</code> attribute:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- in the parent context --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.SimpleAccountService&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- insert dependencies as required here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- in the child (descendant) context --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> &lt;!<span class="attr">--</span> <span class="attr">bean</span> <span class="attr">name</span> <span class="attr">is</span> <span class="attr">the</span> <span class="attr">same</span> <span class="attr">as</span> <span class="attr">the</span> <span class="attr">parent</span> <span class="attr">bean</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">    class=&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">parent</span>=<span class="string">&quot;accountService&quot;</span>/&gt;</span> <span class="comment">&lt;!-- notice how we refer to the parent bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- insert other configuration and dependencies as required here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>local</code> attribute on the <code>ref</code> element is no longer supported in the 4.0 beans XSD, since it does not provide value over a regular <code>bean</code> reference any more. Change your existing <code>ref local</code> references to <code>ref bean</code> when upgrading to the 4.0 schema.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Inner-Beans"><a href="#Inner-Beans" class="headerlink" title="Inner Beans"></a>Inner Beans</h5><p>A <code>&lt;bean/&gt;</code> element inside the <code>&lt;property/&gt;</code> or <code>&lt;constructor-arg/&gt;</code> elements defines an inner bean, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;outer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- instead of using a reference to a target bean, simply define the target bean inline --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span>&gt;</span> <span class="comment">&lt;!-- this is the inner bean --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Fiona Apple&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>An inner bean definition does not require a defined ID or name. If specified, the container does not use such a value as an identifier. The container also ignores the <code>scope</code> flag on creation, because inner beans are always anonymous and are always created with the outer bean. It is not possible to access inner beans independently or to inject them into collaborating beans other than into the enclosing bean.</p>
<p>As a corner case, it is possible to receive destruction callbacks from a custom scope — for example, for a request-scoped inner bean contained within a singleton bean. The creation of the inner bean instance is tied to its containing bean, but destruction callbacks let it participate in the request scope’s lifecycle. This is not a common scenario. Inner beans typically simply share their containing bean’s scope.</p>
<h5 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h5><p>The <code>&lt;list/&gt;</code>, <code>&lt;set/&gt;</code>, <code>&lt;map/&gt;</code>, and <code>&lt;props/&gt;</code> elements set the properties and arguments of the Java <code>Collection</code> types <code>List</code>, <code>Set</code>, <code>Map</code>, and <code>Properties</code>, respectively. The following example shows how to use them:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;moreComplexObject&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.ComplexObject&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setAdminEmails(java.util.Properties) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;adminEmails&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;administrator&quot;</span>&gt;</span>administrator@example.org<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;support&quot;</span>&gt;</span>support@example.org<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;development&quot;</span>&gt;</span>development@example.org<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setSomeList(java.util.List) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;someList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>a list element followed by a reference<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myDataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setSomeMap(java.util.Map) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;someMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;an entry&quot;</span> <span class="attr">value</span>=<span class="string">&quot;just some string&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;a ref&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;myDataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setSomeSet(java.util.Set) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;someSet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>just some string<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myDataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The value of a map key or value, or a set value, can also be any of the following elements:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean | ref | idref | list | set | map | props | value | null</span><br></pre></td></tr></table></figure>

<h6 id="Collection-Merging"><a href="#Collection-Merging" class="headerlink" title="Collection Merging"></a>Collection Merging</h6><p>The Spring container also supports merging collections. An application developer can define a parent <list/>, <map/>, <set/> or <props/> element and have child <list/>, <map/>, <set/> or <props/> elements inherit and override values from the parent collection. That is, the child collection’s values are the result of merging the elements of the parent and child collections, with the child’s collection elements overriding values specified in the parent collection.</p>
<p>This section on merging discusses the parent-child bean mechanism. Readers unfamiliar with parent and child bean definitions may wish to read the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-child-bean-definitions">relevant section</a> before continuing.</p>
<p>The following example demonstrates collection merging:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;parent&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.ComplexObject&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;adminEmails&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;administrator&quot;</span>&gt;</span>administrator@example.com<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;support&quot;</span>&gt;</span>support@example.com<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;child&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;adminEmails&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- the merge is specified on the child collection definition --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span> <span class="attr">merge</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;sales&quot;</span>&gt;</span>sales@example.com<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;support&quot;</span>&gt;</span>support@example.co.uk<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Notice the use of the <code>merge=true</code> attribute on the <code>&lt;props/&gt;</code> element of the <code>adminEmails</code> property of the <code>child</code> bean definition. When the <code>child</code> bean is resolved and instantiated by the container, the resulting instance has an <code>adminEmails</code> <code>Properties</code> collection that contains the result of merging the child’s <code>adminEmails</code> collection with the parent’s <code>adminEmails</code> collection. The following listing shows the result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">administrator=administrator@example.com</span><br><span class="line">sales=sales@example.com</span><br><span class="line">support=support@example.co.uk</span><br></pre></td></tr></table></figure>

<p>The child <code>Properties</code> collection’s value set inherits all property elements from the parent <code>&lt;props/&gt;</code>, and the child’s value for the <code>support</code> value overrides the value in the parent collection.</p>
<p>This merging behavior applies similarly to the <code>&lt;list/&gt;</code>, <code>&lt;map/&gt;</code>, and <code>&lt;set/&gt;</code> collection types. In the specific case of the <code>&lt;list/&gt;</code> element, the semantics associated with the <code>List</code> collection type (that is, the notion of an <code>ordered</code> collection of values) is maintained. The parent’s values precede all of the child list’s values. In the case of the <code>Map</code>, <code>Set</code>, and <code>Properties</code> collection types, no ordering exists. Hence, no ordering semantics are in effect for the collection types that underlie the associated <code>Map</code>, <code>Set</code>, and <code>Properties</code> implementation types that the container uses internally.</p>
<h6 id="Limitations-of-Collection-Merging"><a href="#Limitations-of-Collection-Merging" class="headerlink" title="Limitations of Collection Merging"></a>Limitations of Collection Merging</h6><p>You cannot merge different collection types (such as a <code>Map</code> and a <code>List</code>). If you do attempt to do so, an appropriate <code>Exception</code> is thrown. The <code>merge</code> attribute must be specified on the lower, inherited, child definition. Specifying the <code>merge</code> attribute on a parent collection definition is redundant and does not result in the desired merging.</p>
<h6 id="Strongly-typed-collection"><a href="#Strongly-typed-collection" class="headerlink" title="Strongly-typed collection"></a>Strongly-typed collection</h6><p>Thanks to Java’s support for generic types, you can use strongly typed collections. That is, it is possible to declare a <code>Collection</code> type such that it can only contain (for example) <code>String</code> elements. If you use Spring to dependency-inject a strongly-typed <code>Collection</code> into a bean, you can take advantage of Spring’s type-conversion support such that the elements of your strongly-typed <code>Collection</code> instances are converted to the appropriate type prior to being added to the <code>Collection</code>. The following Java class and bean definition show how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeClass</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Float&gt; accounts;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccounts</span><span class="params">(Map&lt;String, Float&gt; accounts)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accounts = accounts;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;something&quot;</span> class=<span class="string">&quot;x.y.SomeClass&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;accounts&quot;</span>&gt;</span><br><span class="line">            &lt;map&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;one&quot;</span> value=<span class="string">&quot;9.99&quot;</span>/&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;two&quot;</span> value=<span class="string">&quot;2.75&quot;</span>/&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;six&quot;</span> value=<span class="string">&quot;3.99&quot;</span>/&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>When the <code>accounts</code> property of the <code>something</code> bean is prepared for injection, the generics information about the element type of the strongly-typed <code>Map&lt;String, Float&gt;</code> is available by reflection. Thus, Spring’s type conversion infrastructure recognizes the various value elements as being of type <code>Float</code>, and the string values (<code>9.99</code>, <code>2.75</code>, and <code>3.99</code>) are converted into an actual <code>Float</code> type.</p>
<h5 id="Null-and-Empty-String-Values"><a href="#Null-and-Empty-String-Values" class="headerlink" title="Null and Empty String Values"></a>Null and Empty String Values</h5><p>Spring treats empty arguments for properties and the like as empty <code>Strings</code>. The following XML-based configuration metadata snippet sets the <code>email</code> property to the empty <code>String</code> value (“”).</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding example is equivalent to the following Java code:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exampleBean.setEmail(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>The <code>&lt;null/&gt;</code> element handles <code>null</code> values. The following listing shows an example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration is equivalent to the following Java code:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exampleBean.setEmail(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h5 id="XML-Shortcut-with-the-p-namespace"><a href="#XML-Shortcut-with-the-p-namespace" class="headerlink" title="XML Shortcut with the p-namespace"></a>XML Shortcut with the p-namespace</h5><p>The p-namespace lets you use the <code>bean</code> element’s attributes (instead of nested <code>&lt;property/&gt;</code> elements) to describe your property values collaborating beans, or both.</p>
<p>Spring supports extensible configuration formats <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas">with namespaces</a>, which are based on an XML Schema definition. The <code>beans</code> configuration format discussed in this chapter is defined in an XML Schema document. However, the p-namespace is not defined in an XSD file and exists only in the core of Spring.</p>
<p>The following example shows two XML snippets (the first uses standard XML format and the second uses the p-namespace) that resolve to the same result:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;classic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;someone@somewhere.com&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;p-namespace&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ExampleBean&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:email</span>=<span class="string">&quot;someone@somewhere.com&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The example shows an attribute in the p-namespace called <code>email</code> in the bean definition. This tells Spring to include a property declaration. As previously mentioned, the p-namespace does not have a schema definition, so you can set the name of the attribute to the property name.</p>
<p>This next example includes two more bean definitions that both have a reference to another bean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;john-classic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;John Doe&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spouse&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jane&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;john-modern&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:name</span>=<span class="string">&quot;John Doe&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:spouse-ref</span>=<span class="string">&quot;jane&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;jane&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Jane Doe&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This example includes not only a property value using the p-namespace but also uses a special format to declare property references. Whereas the first bean definition uses <code>&lt;property name=&quot;spouse&quot; ref=&quot;jane&quot;/&gt;</code> to create a reference from bean <code>john</code> to bean <code>jane</code>, the second bean definition uses <code>p:spouse-ref=&quot;jane&quot;</code> as an attribute to do the exact same thing. In this case, <code>spouse</code> is the property name, whereas the <code>-ref</code> part indicates that this is not a straight value but rather a reference to another bean.</p>
<table>
<thead>
<tr>
<th></th>
<th>The p-namespace is not as flexible as the standard XML format. For example, the format for declaring property references clashes with properties that end in <code>Ref</code>, whereas the standard XML format does not. We recommend that you choose your approach carefully and communicate this to your team members to avoid producing XML documents that use all three approaches at the same time.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="XML-Shortcut-with-the-c-namespace"><a href="#XML-Shortcut-with-the-c-namespace" class="headerlink" title="XML Shortcut with the c-namespace"></a>XML Shortcut with the c-namespace</h5><p>Similar to the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-p-namespace">XML Shortcut with the p-namespace</a>, the c-namespace, introduced in Spring 3.1, allows inlined attributes for configuring the constructor arguments rather then nested <code>constructor-arg</code> elements.</p>
<p>The following example uses the <code>c:</code> namespace to do the same thing as the from <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-constructor-injection">Constructor-based Dependency Injection</a>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingTwo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanThree&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingThree&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- traditional declaration with optional argument names --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;thingTwo&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;beanTwo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;thingThree&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;beanThree&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;something@somewhere.com&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- c-namespace declaration with argument names --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span> <span class="attr">c:thingTwo-ref</span>=<span class="string">&quot;beanTwo&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">c:thingThree-ref</span>=<span class="string">&quot;beanThree&quot;</span> <span class="attr">c:email</span>=<span class="string">&quot;something@somewhere.com&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>c:</code> namespace uses the same conventions as the <code>p:</code> one (a trailing <code>-ref</code> for bean references) for setting the constructor arguments by their names. Similarly, it needs to be declared in the XML file even though it is not defined in an XSD schema (it exists inside the Spring core).</p>
<p>For the rare cases where the constructor argument names are not available (usually if the bytecode was compiled without debugging information), you can use fallback to the argument indexes, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- c-namespace index declaration --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span> <span class="attr">c:_0-ref</span>=<span class="string">&quot;beanTwo&quot;</span> <span class="attr">c:_1-ref</span>=<span class="string">&quot;beanThree&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">c:_2</span>=<span class="string">&quot;something@somewhere.com&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Due to the XML grammar, the index notation requires the presence of the leading <code>_</code>, as XML attribute names cannot start with a number (even though some IDEs allow it). A corresponding index notation is also available for <code>&lt;constructor-arg&gt;</code> elements but not commonly used since the plain order of declaration is usually sufficient there.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In practice, the constructor resolution <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-ctor-arguments-resolution">mechanism</a> is quite efficient in matching arguments, so unless you really need to, we recommend using the name notation throughout your configuration.</p>
<h5 id="Compound-Property-Names"><a href="#Compound-Property-Names" class="headerlink" title="Compound Property Names"></a>Compound Property Names</h5><p>You can use compound or nested property names when you set bean properties, as long as all components of the path except the final property name are not <code>null</code>. Consider the following bean definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;something&quot;</span> <span class="attr">class</span>=<span class="string">&quot;things.ThingOne&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fred.bob.sammy&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>something</code> bean has a <code>fred</code> property, which has a <code>bob</code> property, which has a <code>sammy</code> property, and that final <code>sammy</code> property is being set to a value of <code>123</code>. In order for this to work, the <code>fred</code> property of <code>something</code> and the <code>bob</code> property of <code>fred</code> must not be <code>null</code> after the bean is constructed. Otherwise, a <code>NullPointerException</code> is thrown.</p>
<h4 id="1-4-3-Using-depends-on"><a href="#1-4-3-Using-depends-on" class="headerlink" title="1.4.3. Using depends-on"></a>1.4.3. Using <code>depends-on</code></h4><p>If a bean is a dependency of another bean, that usually means that one bean is set as a property of another. Typically you accomplish this with the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-ref-element">&#96;&#96; element</a> in XML-based configuration metadata. However, sometimes dependencies between beans are less direct. An example is when a static initializer in a class needs to be triggered, such as for database driver registration. The <code>depends-on</code> attribute can explicitly force one or more beans to be initialized before the bean using this element is initialized. The following example uses the <code>depends-on</code> attribute to express a dependency on a single bean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ExampleBean&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;manager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;manager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ManagerBean&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>To express a dependency on multiple beans, supply a list of bean names as the value of the <code>depends-on</code> attribute (commas, whitespace, and semicolons are valid delimiters):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ExampleBean&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;manager,accountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;manager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;manager&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;manager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ManagerBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.jdbc.JdbcAccountDao&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>depends-on</code> attribute can specify both an initialization-time dependency and, in the case of <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton">singleton</a> beans only, a corresponding destruction-time dependency. Dependent beans that define a <code>depends-on</code> relationship with a given bean are destroyed first, prior to the given bean itself being destroyed. Thus, <code>depends-on</code> can also control shutdown order.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-4-4-Lazy-initialized-Beans"><a href="#1-4-4-Lazy-initialized-Beans" class="headerlink" title="1.4.4. Lazy-initialized Beans"></a>1.4.4. Lazy-initialized Beans</h4><p>By default, <code>ApplicationContext</code> implementations eagerly create and configure all <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton">singleton</a> beans as part of the initialization process. Generally, this pre-instantiation is desirable, because errors in the configuration or surrounding environment are discovered immediately, as opposed to hours or even days later. When this behavior is not desirable, you can prevent pre-instantiation of a singleton bean by marking the bean definition as being lazy-initialized. A lazy-initialized bean tells the IoC container to create a bean instance when it is first requested, rather than at startup.</p>
<p>In XML, this behavior is controlled by the <code>lazy-init</code> attribute on the <code>&lt;bean/&gt;</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lazy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.ExpensiveToCreateBean&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;not.lazy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.AnotherBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>When the preceding configuration is consumed by an <code>ApplicationContext</code>, the <code>lazy</code> bean is not eagerly pre-instantiated when the <code>ApplicationContext</code> starts, whereas the <code>not.lazy</code> bean is eagerly pre-instantiated.</p>
<p>However, when a lazy-initialized bean is a dependency of a singleton bean that is not lazy-initialized, the <code>ApplicationContext</code> creates the lazy-initialized bean at startup, because it must satisfy the singleton’s dependencies. The lazy-initialized bean is injected into a singleton bean elsewhere that is not lazy-initialized.</p>
<p>You can also control lazy-initialization at the container level by using the <code>default-lazy-init</code> attribute on the <code>&lt;beans/&gt;</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-lazy-init</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- no beans will be pre-instantiated... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-5-Autowiring-Collaborators"><a href="#1-4-5-Autowiring-Collaborators" class="headerlink" title="1.4.5. Autowiring Collaborators"></a>1.4.5. Autowiring Collaborators</h4><p>The Spring container can autowire relationships between collaborating beans. You can let Spring resolve collaborators (other beans) automatically for your bean by inspecting the contents of the <code>ApplicationContext</code>. Autowiring has the following advantages:</p>
<ul>
<li>Autowiring can significantly reduce the need to specify properties or constructor arguments. (Other mechanisms such as a bean template <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-child-bean-definitions">discussed elsewhere in this chapter</a> are also valuable in this regard.)</li>
<li>Autowiring can update a configuration as your objects evolve. For example, if you need to add a dependency to a class, that dependency can be satisfied automatically without you needing to modify the configuration. Thus autowiring can be especially useful during development, without negating the option of switching to explicit wiring when the code base becomes more stable.</li>
</ul>
<p>When using XML-based configuration metadata (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-collaborators">Dependency Injection</a>), you can specify the autowire mode for a bean definition with the <code>autowire</code> attribute of the <code>&lt;bean/&gt;</code> element. The autowiring functionality has four modes. You specify autowiring per bean and can thus choose which ones to autowire. The following table describes the four autowiring modes:</p>
<table>
<thead>
<tr>
<th align="left">Mode</th>
<th align="left">Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>no</code></td>
<td align="left">(Default) No autowiring. Bean references must be defined by <code>ref</code> elements. Changing the default setting is not recommended for larger deployments, because specifying collaborators explicitly gives greater control and clarity. To some extent, it documents the structure of a system.</td>
</tr>
<tr>
<td align="left"><code>byName</code></td>
<td align="left">Autowiring by property name. Spring looks for a bean with the same name as the property that needs to be autowired. For example, if a bean definition is set to autowire by name and it contains a <code>master</code> property (that is, it has a <code>setMaster(..)</code> method), Spring looks for a bean definition named <code>master</code> and uses it to set the property.</td>
</tr>
<tr>
<td align="left"><code>byType</code></td>
<td align="left">Lets a property be autowired if exactly one bean of the property type exists in the container. If more than one exists, a fatal exception is thrown, which indicates that you may not use <code>byType</code> autowiring for that bean. If there are no matching beans, nothing happens (the property is not set).</td>
</tr>
<tr>
<td align="left"><code>constructor</code></td>
<td align="left">Analogous to <code>byType</code> but applies to constructor arguments. If there is not exactly one bean of the constructor argument type in the container, a fatal error is raised.</td>
</tr>
</tbody></table>
<p>With <code>byType</code> or <code>constructor</code> autowiring mode, you can wire arrays and typed collections. In such cases, all autowire candidates within the container that match the expected type are provided to satisfy the dependency. You can autowire strongly-typed <code>Map</code> instances if the expected key type is <code>String</code>. An autowired <code>Map</code> instance’s values consist of all bean instances that match the expected type, and the <code>Map</code> instance’s keys contain the corresponding bean names.</p>
<h5 id="Limitations-and-Disadvantages-of-Autowiring"><a href="#Limitations-and-Disadvantages-of-Autowiring" class="headerlink" title="Limitations and Disadvantages of Autowiring"></a>Limitations and Disadvantages of Autowiring</h5><p>Autowiring works best when it is used consistently across a project. If autowiring is not used in general, it might be confusing to developers to use it to wire only one or two bean definitions.</p>
<p>Consider the limitations and disadvantages of autowiring:</p>
<ul>
<li>Explicit dependencies in <code>property</code> and <code>constructor-arg</code> settings always override autowiring. You cannot autowire simple properties such as primitives, <code>Strings</code>, and <code>Classes</code> (and arrays of such simple properties). This limitation is by-design.</li>
<li>Autowiring is less exact than explicit wiring. Although, as noted in the earlier table, Spring is careful to avoid guessing in case of ambiguity that might have unexpected results. The relationships between your Spring-managed objects are no longer documented explicitly.</li>
<li>Wiring information may not be available to tools that may generate documentation from a Spring container.</li>
<li>Multiple bean definitions within the container may match the type specified by the setter method or constructor argument to be autowired. For arrays, collections, or <code>Map</code> instances, this is not necessarily a problem. However, for dependencies that expect a single value, this ambiguity is not arbitrarily resolved. If no unique bean definition is available, an exception is thrown.</li>
</ul>
<p>In the latter scenario, you have several options:</p>
<ul>
<li>Abandon autowiring in favor of explicit wiring.</li>
<li>Avoid autowiring for a bean definition by setting its <code>autowire-candidate</code> attributes to <code>false</code>, as described in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire-candidate">next section</a>.</li>
<li>Designate a single bean definition as the primary candidate by setting the <code>primary</code> attribute of its <code>&lt;bean/&gt;</code> element to <code>true</code>.</li>
<li>Implement the more fine-grained control available with annotation-based configuration, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config">Annotation-based Container Configuration</a>.</li>
</ul>
<h5 id="Excluding-a-Bean-from-Autowiring"><a href="#Excluding-a-Bean-from-Autowiring" class="headerlink" title="Excluding a Bean from Autowiring"></a>Excluding a Bean from Autowiring</h5><p>On a per-bean basis, you can exclude a bean from autowiring. In Spring’s XML format, set the <code>autowire-candidate</code> attribute of the <code>&lt;bean/&gt;</code> element to <code>false</code>. The container makes that specific bean definition unavailable to the autowiring infrastructure (including annotation style configurations such as <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation"><code>@Autowired</code></a>).</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>autowire-candidate</code> attribute is designed to only affect type-based autowiring. It does not affect explicit references by name, which get resolved even if the specified bean is not marked as an autowire candidate. As a consequence, autowiring by name nevertheless injects a bean if the name matches.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can also limit autowire candidates based on pattern-matching against bean names. The top-level <code>&lt;beans/&gt;</code> element accepts one or more patterns within its <code>default-autowire-candidates</code> attribute. For example, to limit autowire candidate status to any bean whose name ends with <code>Repository</code>, provide a value of <code>*Repository</code>. To provide multiple patterns, define them in a comma-separated list. An explicit value of <code>true</code> or <code>false</code> for a bean definition’s <code>autowire-candidate</code> attribute always takes precedence. For such beans, the pattern matching rules do not apply.</p>
<p>These techniques are useful for beans that you never want to be injected into other beans by autowiring. It does not mean that an excluded bean cannot itself be configured by using autowiring. Rather, the bean itself is not a candidate for autowiring other beans.</p>
<h4 id="1-4-6-Method-Injection"><a href="#1-4-6-Method-Injection" class="headerlink" title="1.4.6. Method Injection"></a>1.4.6. Method Injection</h4><p>In most application scenarios, most beans in the container are <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton">singletons</a>. When a singleton bean needs to collaborate with another singleton bean or a non-singleton bean needs to collaborate with another non-singleton bean, you typically handle the dependency by defining one bean as a property of the other. A problem arises when the bean lifecycles are different. Suppose singleton bean A needs to use non-singleton (prototype) bean B, perhaps on each method invocation on A. The container creates the singleton bean A only once, and thus only gets one opportunity to set the properties. The container cannot provide bean A with a new instance of bean B every time one is needed.</p>
<p>A solution is to forego some inversion of control. You can <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware">make bean A aware of the container</a> by implementing the <code>ApplicationContextAware</code> interface, and by <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-client">making a <code>getBean(&quot;B&quot;)</code> call to the container</a> ask for (a typically new) bean B instance every time bean A needs it. The following example shows this approach:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a class that uses a stateful Command-style class to perform some processing</span></span><br><span class="line"><span class="keyword">package</span> fiona.apple;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spring-API imports</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandManager</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(Map commandState)</span> &#123;</span><br><span class="line">        <span class="comment">// grab a new instance of the appropriate Command</span></span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> createCommand();</span><br><span class="line">        <span class="comment">// set the state on the (hopefully brand new) Command instance</span></span><br><span class="line">        command.setState(commandState);</span><br><span class="line">        <span class="keyword">return</span> command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Command <span class="title function_">createCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// notice the Spring API dependency!</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.applicationContext.getBean(<span class="string">&quot;command&quot;</span>, Command.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(</span></span><br><span class="line"><span class="params">            ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding is not desirable, because the business code is aware of and coupled to the Spring Framework. Method Injection, a somewhat advanced feature of the Spring IoC container, lets you handle this use case cleanly.</p>
<p>You can read more about the motivation for Method Injection in <a target="_blank" rel="noopener" href="https://spring.io/blog/2004/08/06/method-injection/">this blog entry</a>.</p>
<h5 id="Lookup-Method-Injection"><a href="#Lookup-Method-Injection" class="headerlink" title="Lookup Method Injection"></a>Lookup Method Injection</h5><p>Lookup method injection is the ability of the container to override methods on container-managed beans and return the lookup result for another named bean in the container. The lookup typically involves a prototype bean, as in the scenario described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-method-injection">the preceding section</a>. The Spring Framework implements this method injection by using bytecode generation from the CGLIB library to dynamically generate a subclass that overrides the method.</p>
<table>
<thead>
<tr>
<th></th>
<th>For this dynamic subclassing to work, the class that the Spring bean container subclasses cannot be <code>final</code>, and the method to be overridden cannot be <code>final</code>, either.Unit-testing a class that has an <code>abstract</code> method requires you to subclass the class yourself and to supply a stub implementation of the <code>abstract</code> method.Concrete methods are also necessary for component scanning, which requires concrete classes to pick up.A further key limitation is that lookup methods do not work with factory methods and in particular not with <code>@Bean</code> methods in configuration classes, since, in that case, the container is not in charge of creating the instance and therefore cannot create a runtime-generated subclass on the fly.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In the case of the <code>CommandManager</code> class in the previous code snippet, the Spring container dynamically overrides the implementation of the <code>createCommand()</code> method. The <code>CommandManager</code> class does not have any Spring dependencies, as the reworked example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fiona.apple;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no more Spring imports!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CommandManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(Object commandState)</span> &#123;</span><br><span class="line">        <span class="comment">// grab a new instance of the appropriate Command interface</span></span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> createCommand();</span><br><span class="line">        <span class="comment">// set the state on the (hopefully brand new) Command instance</span></span><br><span class="line">        command.setState(commandState);</span><br><span class="line">        <span class="keyword">return</span> command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// okay... but where is the implementation of this method?</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Command <span class="title function_">createCommand</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the client class that contains the method to be injected (the <code>CommandManager</code> in this case), the method to be injected requires a signature of the following form:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;public|protected&gt; [abstract] <span class="tag">&lt;<span class="name">return-type</span>&gt;</span> theMethodName(no-arguments);</span><br></pre></td></tr></table></figure>

<p>If the method is <code>abstract</code>, the dynamically-generated subclass implements the method. Otherwise, the dynamically-generated subclass overrides the concrete method defined in the original class. Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- a stateful bean deployed as a prototype (non-singleton) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myCommand&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fiona.apple.AsyncCommand&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- inject dependencies here as required --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- commandProcessor uses statefulCommandHelper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;commandManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fiona.apple.CommandManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lookup-method</span> <span class="attr">name</span>=<span class="string">&quot;createCommand&quot;</span> <span class="attr">bean</span>=<span class="string">&quot;myCommand&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The bean identified as <code>commandManager</code> calls its own <code>createCommand()</code> method whenever it needs a new instance of the <code>myCommand</code> bean. You must be careful to deploy the <code>myCommand</code> bean as a prototype if that is actually what is needed. If it is a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton">singleton</a>, the same instance of the <code>myCommand</code> bean is returned each time.</p>
<p>Alternatively, within the annotation-based component model, you can declare a lookup method through the <code>@Lookup</code> annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CommandManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(Object commandState)</span> &#123;</span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> createCommand();</span><br><span class="line">        command.setState(commandState);</span><br><span class="line">        <span class="keyword">return</span> command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Lookup(&quot;myCommand&quot;)</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Command <span class="title function_">createCommand</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Or, more idiomatically, you can rely on the target bean getting resolved against the declared return type of the lookup method:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CommandManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(Object commandState)</span> &#123;</span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> createCommand();</span><br><span class="line">        command.setState(commandState);</span><br><span class="line">        <span class="keyword">return</span> command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Lookup</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Command <span class="title function_">createCommand</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that you should typically declare such annotated lookup methods with a concrete stub implementation, in order for them to be compatible with Spring’s component scanning rules where abstract classes get ignored by default. This limitation does not apply to explicitly registered or explicitly imported bean classes.</p>
<table>
<thead>
<tr>
<th></th>
<th>Another way of accessing differently scoped target beans is an <code>ObjectFactory</code>&#x2F; <code>Provider</code> injection point. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-other-injection">Scoped Beans as Dependencies</a>.You may also find the <code>ServiceLocatorFactoryBean</code> (in the <code>org.springframework.beans.factory.config</code> package) to be useful.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Arbitrary-Method-Replacement"><a href="#Arbitrary-Method-Replacement" class="headerlink" title="Arbitrary Method Replacement"></a>Arbitrary Method Replacement</h5><p>A less useful form of method injection than lookup method injection is the ability to replace arbitrary methods in a managed bean with another method implementation. You can safely skip the rest of this section until you actually need this functionality.</p>
<p>With XML-based configuration metadata, you can use the <code>replaced-method</code> element to replace an existing method implementation with another, for a deployed bean. Consider the following class, which has a method called <code>computeValue</code> that we want to override:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyValueCalculator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">computeValue</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="comment">// some real code...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// some other methods...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A class that implements the <code>org.springframework.beans.factory.support.MethodReplacer</code> interface provides the new method definition, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * meant to be used to override the existing computeValue(String)</span></span><br><span class="line"><span class="comment"> * implementation in MyValueCalculator</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplacementComputeValue</span> <span class="keyword">implements</span> <span class="title class_">MethodReplacer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">reimplement</span><span class="params">(Object o, Method m, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// get the input value, work with it, and return a computed result</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> (String) args[<span class="number">0</span>];</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ...;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The bean definition to deploy the original class and specify the method override would resemble the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myValueCalculator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.z.MyValueCalculator&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- arbitrary method replacement --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">replaced-method</span> <span class="attr">name</span>=<span class="string">&quot;computeValue&quot;</span> <span class="attr">replacer</span>=<span class="string">&quot;replacementComputeValue&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg-type</span>&gt;</span>String<span class="tag">&lt;/<span class="name">arg-type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">replaced-method</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;replacementComputeValue&quot;</span> <span class="attr">class</span>=<span class="string">&quot;a.b.c.ReplacementComputeValue&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can use one or more <code>&lt;arg-type/&gt;</code> elements within the <code>&lt;replaced-method/&gt;</code> element to indicate the method signature of the method being overridden. The signature for the arguments is necessary only if the method is overloaded and multiple variants exist within the class. For convenience, the type string for an argument may be a substring of the fully qualified type name. For example, the following all match <code>java.lang.String</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.lang.String</span><br><span class="line">String</span><br><span class="line">Str</span><br></pre></td></tr></table></figure>

<p>Because the number of arguments is often enough to distinguish between each possible choice, this shortcut can save a lot of typing, by letting you type only the shortest string that matches an argument type.</p>
<h3 id="1-5-Bean-Scopes"><a href="#1-5-Bean-Scopes" class="headerlink" title="1.5. Bean Scopes"></a>1.5. Bean Scopes</h3><p>When you create a bean definition, you create a recipe for creating actual instances of the class defined by that bean definition. The idea that a bean definition is a recipe is important, because it means that, as with a class, you can create many object instances from a single recipe.</p>
<p>You can control not only the various dependencies and configuration values that are to be plugged into an object that is created from a particular bean definition but also control the scope of the objects created from a particular bean definition. This approach is powerful and flexible, because you can choose the scope of the objects you create through configuration instead of having to bake in the scope of an object at the Java class level. Beans can be defined to be deployed in one of a number of scopes. The Spring Framework supports six scopes, four of which are available only if you use a web-aware <code>ApplicationContext</code>. You can also create <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-custom">a custom scope.</a></p>
<p>The following table describes the supported scopes:</p>
<table>
<thead>
<tr>
<th align="left">Scope</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton">singleton</a></td>
<td align="left">(Default) Scopes a single bean definition to a single object instance for each Spring IoC container.</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-prototype">prototype</a></td>
<td align="left">Scopes a single bean definition to any number of object instances.</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-request">request</a></td>
<td align="left">Scopes a single bean definition to the lifecycle of a single HTTP request. That is, each HTTP request has its own instance of a bean created off the back of a single bean definition. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-session">session</a></td>
<td align="left">Scopes a single bean definition to the lifecycle of an HTTP <code>Session</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-application">application</a></td>
<td align="left">Scopes a single bean definition to the lifecycle of a <code>ServletContext</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket-stomp-websocket-scope">websocket</a></td>
<td align="left">Scopes a single bean definition to the lifecycle of a <code>WebSocket</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>As of Spring 3.0, a thread scope is available but is not registered by default. For more information, see the documentation for <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/support/SimpleThreadScope.html"><code>SimpleThreadScope</code></a>. For instructions on how to register this or any other custom scope, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-custom-using">Using a Custom Scope</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-5-1-The-Singleton-Scope"><a href="#1-5-1-The-Singleton-Scope" class="headerlink" title="1.5.1. The Singleton Scope"></a>1.5.1. The Singleton Scope</h4><p>Only one shared instance of a singleton bean is managed, and all requests for beans with an ID or IDs that match that bean definition result in that one specific bean instance being returned by the Spring container.</p>
<p>To put it another way, when you define a bean definition and it is scoped as a singleton, the Spring IoC container creates exactly one instance of the object defined by that bean definition. This single instance is stored in a cache of such singleton beans, and all subsequent requests and references for that named bean return the cached object. The following image shows how the singleton scope works:</p>
<p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/singleton.png" alt="singleton"></p>
<p>Spring’s concept of a singleton bean differs from the singleton pattern as defined in the Gang of Four (GoF) patterns book. The GoF singleton hard-codes the scope of an object such that one and only one instance of a particular class is created per ClassLoader. The scope of the Spring singleton is best described as being per-container and per-bean. This means that, if you define one bean for a particular class in a single Spring container, the Spring container creates one and only one instance of the class defined by that bean definition. The singleton scope is the default scope in Spring. To define a bean as a singleton in XML, you can define a bean as shown in the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.DefaultAccountService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.DefaultAccountService&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-5-2-The-Prototype-Scope"><a href="#1-5-2-The-Prototype-Scope" class="headerlink" title="1.5.2. The Prototype Scope"></a>1.5.2. The Prototype Scope</h4><p>The non-singleton prototype scope of bean deployment results in the creation of a new bean instance every time a request for that specific bean is made. That is, the bean is injected into another bean or you request it through a <code>getBean()</code> method call on the container. As a rule, you should use the prototype scope for all stateful beans and the singleton scope for stateless beans.</p>
<p>The following diagram illustrates the Spring prototype scope:</p>
<p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/prototype.png" alt="prototype"></p>
<p>(A data access object (DAO) is not typically configured as a prototype, because a typical DAO does not hold any conversational state. It was easier for us to reuse the core of the singleton diagram.)</p>
<p>The following example defines a bean as a prototype in XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.DefaultAccountService&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>In contrast to the other scopes, Spring does not manage the complete lifecycle of a prototype bean. The container instantiates, configures, and otherwise assembles a prototype object and hands it to the client, with no further record of that prototype instance. Thus, although initialization lifecycle callback methods are called on all objects regardless of scope, in the case of prototypes, configured destruction lifecycle callbacks are not called. The client code must clean up prototype-scoped objects and release expensive resources that the prototype beans hold. To get the Spring container to release resources held by prototype-scoped beans, try using a custom <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-extension-bpp">bean post-processor</a>, which holds a reference to beans that need to be cleaned up.</p>
<p>In some respects, the Spring container’s role in regard to a prototype-scoped bean is a replacement for the Java <code>new</code> operator. All lifecycle management past that point must be handled by the client. (For details on the lifecycle of a bean in the Spring container, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle">Lifecycle Callbacks</a>.)</p>
<h4 id="1-5-3-Singleton-Beans-with-Prototype-bean-Dependencies"><a href="#1-5-3-Singleton-Beans-with-Prototype-bean-Dependencies" class="headerlink" title="1.5.3. Singleton Beans with Prototype-bean Dependencies"></a>1.5.3. Singleton Beans with Prototype-bean Dependencies</h4><p>When you use singleton-scoped beans with dependencies on prototype beans, be aware that dependencies are resolved at instantiation time. Thus, if you dependency-inject a prototype-scoped bean into a singleton-scoped bean, a new prototype bean is instantiated and then dependency-injected into the singleton bean. The prototype instance is the sole instance that is ever supplied to the singleton-scoped bean.</p>
<p>However, suppose you want the singleton-scoped bean to acquire a new instance of the prototype-scoped bean repeatedly at runtime. You cannot dependency-inject a prototype-scoped bean into your singleton bean, because that injection occurs only once, when the Spring container instantiates the singleton bean and resolves and injects its dependencies. If you need a new instance of a prototype bean at runtime more than once, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-method-injection">Method Injection</a>.</p>
<h4 id="1-5-4-Request-Session-Application-and-WebSocket-Scopes"><a href="#1-5-4-Request-Session-Application-and-WebSocket-Scopes" class="headerlink" title="1.5.4. Request, Session, Application, and WebSocket Scopes"></a>1.5.4. Request, Session, Application, and WebSocket Scopes</h4><p>The <code>request</code>, <code>session</code>, <code>application</code>, and <code>websocket</code> scopes are available only if you use a web-aware Spring <code>ApplicationContext</code> implementation (such as <code>XmlWebApplicationContext</code>). If you use these scopes with regular Spring IoC containers, such as the <code>ClassPathXmlApplicationContext</code>, an <code>IllegalStateException</code> that complains about an unknown bean scope is thrown.</p>
<h5 id="Initial-Web-Configuration"><a href="#Initial-Web-Configuration" class="headerlink" title="Initial Web Configuration"></a>Initial Web Configuration</h5><p>To support the scoping of beans at the <code>request</code>, <code>session</code>, <code>application</code>, and <code>websocket</code> levels (web-scoped beans), some minor initial configuration is required before you define your beans. (This initial setup is not required for the standard scopes: <code>singleton</code> and <code>prototype</code>.)</p>
<p>How you accomplish this initial setup depends on your particular Servlet environment.</p>
<p>If you access scoped beans within Spring Web MVC, in effect, within a request that is processed by the Spring <code>DispatcherServlet</code>, no special setup is necessary. <code>DispatcherServlet</code> already exposes all relevant state.</p>
<p>If you use a Servlet 2.5 web container, with requests processed outside of Spring’s <code>DispatcherServlet</code> (for example, when using JSF or Struts), you need to register the <code>org.springframework.web.context.request.RequestContextListener</code> <code>ServletRequestListener</code>. For Servlet 3.0+, this can be done programmatically by using the <code>WebApplicationInitializer</code> interface. Alternatively, or for older containers, add the following declaration to your web application’s <code>web.xml</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">            org.springframework.web.context.request.RequestContextListener</span><br><span class="line">        <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Alternatively, if there are issues with your listener setup, consider using Spring’s <code>RequestContextFilter</code>. The filter mapping depends on the surrounding web application configuration, so you have to change it as appropriate. The following listing shows the filter part of a web application:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>requestContextFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.RequestContextFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>requestContextFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>DispatcherServlet</code>, <code>RequestContextListener</code>, and <code>RequestContextFilter</code> all do exactly the same thing, namely bind the HTTP request object to the <code>Thread</code> that is servicing that request. This makes beans that are request- and session-scoped available further down the call chain.</p>
<h5 id="Request-scope"><a href="#Request-scope" class="headerlink" title="Request scope"></a>Request scope</h5><p>Consider the following XML configuration for a bean definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;loginAction&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.LoginAction&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;request&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The Spring container creates a new instance of the <code>LoginAction</code> bean by using the <code>loginAction</code> bean definition for each and every HTTP request. That is, the <code>loginAction</code> bean is scoped at the HTTP request level. You can change the internal state of the instance that is created as much as you want, because other instances created from the same <code>loginAction</code> bean definition do not see these changes in state. They are particular to an individual request. When the request completes processing, the bean that is scoped to the request is discarded.</p>
<p>When using annotation-driven components or Java configuration, the <code>@RequestScope</code> annotation can be used to assign a component to the <code>request</code> scope. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestScope</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginAction</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Session-Scope"><a href="#Session-Scope" class="headerlink" title="Session Scope"></a>Session Scope</h5><p>Consider the following XML configuration for a bean definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The Spring container creates a new instance of the <code>UserPreferences</code> bean by using the <code>userPreferences</code> bean definition for the lifetime of a single HTTP <code>Session</code>. In other words, the <code>userPreferences</code> bean is effectively scoped at the HTTP <code>Session</code> level. As with request-scoped beans, you can change the internal state of the instance that is created as much as you want, knowing that other HTTP <code>Session</code> instances that are also using instances created from the same <code>userPreferences</code> bean definition do not see these changes in state, because they are particular to an individual HTTP <code>Session</code>. When the HTTP <code>Session</code> is eventually discarded, the bean that is scoped to that particular HTTP <code>Session</code> is also discarded.</p>
<p>When using annotation-driven components or Java configuration, you can use the <code>@SessionScope</code> annotation to assign a component to the <code>session</code> scope.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SessionScope</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserPreferences</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Application-Scope"><a href="#Application-Scope" class="headerlink" title="Application Scope"></a>Application Scope</h5><p>Consider the following XML configuration for a bean definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;appPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.AppPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;application&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The Spring container creates a new instance of the <code>AppPreferences</code> bean by using the <code>appPreferences</code> bean definition once for the entire web application. That is, the <code>appPreferences</code> bean is scoped at the <code>ServletContext</code> level and stored as a regular <code>ServletContext</code> attribute. This is somewhat similar to a Spring singleton bean but differs in two important ways: It is a singleton per <code>ServletContext</code>, not per Spring <code>ApplicationContext</code> (for which there may be several in any given web application), and it is actually exposed and therefore visible as a <code>ServletContext</code> attribute.</p>
<p>When using annotation-driven components or Java configuration, you can use the <code>@ApplicationScope</code> annotation to assign a component to the <code>application</code> scope. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApplicationScope</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppPreferences</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="WebSocket-Scope"><a href="#WebSocket-Scope" class="headerlink" title="WebSocket Scope"></a>WebSocket Scope</h5><p>WebSocket scope is associated with the lifecycle of a WebSocket session and applies to STOMP over WebSocket applications, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket-stomp-websocket-scope">WebSocket scope</a> for more details.</p>
<h5 id="Scoped-Beans-as-Dependencies"><a href="#Scoped-Beans-as-Dependencies" class="headerlink" title="Scoped Beans as Dependencies"></a>Scoped Beans as Dependencies</h5><p>The Spring IoC container manages not only the instantiation of your objects (beans), but also the wiring up of collaborators (or dependencies). If you want to inject (for example) an HTTP request-scoped bean into another bean of a longer-lived scope, you may choose to inject an AOP proxy in place of the scoped bean. That is, you need to inject a proxy object that exposes the same public interface as the scoped object but that can also retrieve the real target object from the relevant scope (such as an HTTP request) and delegate method calls onto the real object.</p>
<table>
<thead>
<tr>
<th></th>
<th>You may also use <code>&lt;aop:scoped-proxy/&gt;</code> between beans that are scoped as <code>singleton</code>, with the reference then going through an intermediate proxy that is serializable and therefore able to re-obtain the target singleton bean on deserialization.When declaring <code>&lt;aop:scoped-proxy/&gt;</code> against a bean of scope <code>prototype</code>, every method call on the shared proxy leads to the creation of a new target instance to which the call is then being forwarded.Also, scoped proxies are not the only way to access beans from shorter scopes in a lifecycle-safe fashion. You may also declare your injection point (that is, the constructor or setter argument or autowired field) as <code>ObjectFactory&lt;MyTargetBean&gt;</code>, allowing for a <code>getObject()</code> call to retrieve the current instance on demand every time it is needed — without holding on to the instance or storing it separately.As an extended variant, you may declare <code>ObjectProvider&lt;MyTargetBean&gt;</code> which delivers several additional access variants, including <code>getIfAvailable</code> and <code>getIfUnique</code>.The JSR-330 variant of this is called <code>Provider</code> and is used with a <code>Provider&lt;MyTargetBean&gt;</code> declaration and a corresponding <code>get()</code> call for every retrieval attempt. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-standard-annotations">here</a> for more details on JSR-330 overall.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The configuration in the following example is only one line, but it is important to understand the “why” as well as the “how” behind it:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.SimpleUserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userPreferences&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The line that defines the proxy.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>To create such a proxy, you insert a child <code>&lt;aop:scoped-proxy/&gt;</code> element into a scoped bean definition (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-other-injection-proxies">Choosing the Type of Proxy to Create</a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas">XML Schema-based configuration</a>). Why do definitions of beans scoped at the <code>request</code>, <code>session</code> and custom-scope levels require the <code>&lt;aop:scoped-proxy/&gt;</code> element? Consider the following singleton bean definition and contrast it with what you need to define for the aforementioned scopes (note that the following <code>userPreferences</code> bean definition as it stands is incomplete):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userPreferences&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In the preceding example, the singleton bean (<code>userManager</code>) is injected with a reference to the HTTP <code>Session</code>-scoped bean (<code>userPreferences</code>). The salient point here is that the <code>userManager</code> bean is a singleton: it is instantiated exactly once per container, and its dependencies (in this case only one, the <code>userPreferences</code> bean) are also injected only once. This means that the <code>userManager</code> bean operates only on the exact same <code>userPreferences</code> object (that is, the one with which it was originally injected).</p>
<p>This is not the behavior you want when injecting a shorter-lived scoped bean into a longer-lived scoped bean (for example, injecting an HTTP <code>Session</code>-scoped collaborating bean as a dependency into singleton bean). Rather, you need a single <code>userManager</code> object, and, for the lifetime of an HTTP <code>Session</code>, you need a <code>userPreferences</code> object that is specific to the HTTP <code>Session</code>. Thus, the container creates an object that exposes the exact same public interface as the <code>UserPreferences</code> class (ideally an object that is a <code>UserPreferences</code> instance), which can fetch the real <code>UserPreferences</code> object from the scoping mechanism (HTTP request, <code>Session</code>, and so forth). The container injects this proxy object into the <code>userManager</code> bean, which is unaware that this <code>UserPreferences</code> reference is a proxy. In this example, when a <code>UserManager</code> instance invokes a method on the dependency-injected <code>UserPreferences</code> object, it is actually invoking a method on the proxy. The proxy then fetches the real <code>UserPreferences</code> object from (in this case) the HTTP <code>Session</code> and delegates the method invocation onto the retrieved real <code>UserPreferences</code> object.</p>
<p>Thus, you need the following (correct and complete) configuration when injecting <code>request-</code> and <code>session-scoped</code> beans into collaborating objects, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userPreferences&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="Choosing-the-Type-of-Proxy-to-Create"><a href="#Choosing-the-Type-of-Proxy-to-Create" class="headerlink" title="Choosing the Type of Proxy to Create"></a>Choosing the Type of Proxy to Create</h6><p>By default, when the Spring container creates a proxy for a bean that is marked up with the <code>&lt;aop:scoped-proxy/&gt;</code> element, a CGLIB-based class proxy is created.</p>
<table>
<thead>
<tr>
<th></th>
<th>CGLIB proxies intercept only public method calls! Do not call non-public methods on such a proxy. They are not delegated to the actual scoped target object.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Alternatively, you can configure the Spring container to create standard JDK interface-based proxies for such scoped beans, by specifying <code>false</code> for the value of the <code>proxy-target-class</code> attribute of the <code>&lt;aop:scoped-proxy/&gt;</code> element. Using JDK interface-based proxies means that you do not need additional libraries in your application classpath to affect such proxying. However, it also means that the class of the scoped bean must implement at least one interface and that all collaborators into which the scoped bean is injected must reference the bean through one of its interfaces. The following example shows a proxy based on an interface:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- DefaultUserPreferences implements the UserPreferences interface --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.stuff.DefaultUserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:scoped-proxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.stuff.UserManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userPreferences&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>For more detailed information about choosing class-based or interface-based proxying, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-proxying">Proxying Mechanisms</a>.</p>
<h4 id="1-5-5-Custom-Scopes"><a href="#1-5-5-Custom-Scopes" class="headerlink" title="1.5.5. Custom Scopes"></a>1.5.5. Custom Scopes</h4><p>The bean scoping mechanism is extensible. You can define your own scopes or even redefine existing scopes, although the latter is considered bad practice and you cannot override the built-in <code>singleton</code> and <code>prototype</code> scopes.</p>
<h5 id="Creating-a-Custom-Scope"><a href="#Creating-a-Custom-Scope" class="headerlink" title="Creating a Custom Scope"></a>Creating a Custom Scope</h5><p>To integrate your custom scopes into the Spring container, you need to implement the <code>org.springframework.beans.factory.config.Scope</code> interface, which is described in this section. For an idea of how to implement your own scopes, see the <code>Scope</code> implementations that are supplied with the Spring Framework itself and the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/Scope.html"><code>Scope</code></a> javadoc, which explains the methods you need to implement in more detail.</p>
<p>The <code>Scope</code> interface has four methods to get objects from the scope, remove them from the scope, and let them be destroyed.</p>
<p>The session scope implementation, for example, returns the session-scoped bean (if it does not exist, the method returns a new instance of the bean, after having bound it to the session for future reference). The following method returns the object from the underlying scope:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">get</span><span class="params">(String name, ObjectFactory&lt;?&gt; objectFactory)</span></span><br></pre></td></tr></table></figure>

<p>The session scope implementation, for example, removes the session-scoped bean from the underlying session. The object should be returned, but you can return <code>null</code> if the object with the specified name is not found. The following method removes the object from the underlying scope:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">remove</span><span class="params">(String name)</span></span><br></pre></td></tr></table></figure>

<p>The following method registers a callback that the scope should invoke when it is destroyed or when the specified object in the scope is destroyed:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">registerDestructionCallback</span><span class="params">(String name, Runnable destructionCallback)</span></span><br></pre></td></tr></table></figure>

<p>See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/Scope.html#registerDestructionCallback">javadoc</a> or a Spring scope implementation for more information on destruction callbacks.</p>
<p>The following method obtains the conversation identifier for the underlying scope:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getConversationId</span><span class="params">()</span></span><br></pre></td></tr></table></figure>

<p>This identifier is different for each scope. For a session scoped implementation, this identifier can be the session identifier.</p>
<h5 id="Using-a-Custom-Scope"><a href="#Using-a-Custom-Scope" class="headerlink" title="Using a Custom Scope"></a>Using a Custom Scope</h5><p>After you write and test one or more custom <code>Scope</code> implementations, you need to make the Spring container aware of your new scopes. The following method is the central method to register a new <code>Scope</code> with the Spring container:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">registerScope</span><span class="params">(String scopeName, Scope scope)</span>;</span><br></pre></td></tr></table></figure>

<p>This method is declared on the <code>ConfigurableBeanFactory</code> interface, which is available through the <code>BeanFactory</code> property on most of the concrete <code>ApplicationContext</code> implementations that ship with Spring.</p>
<p>The first argument to the <code>registerScope(..)</code> method is the unique name associated with a scope. Examples of such names in the Spring container itself are <code>singleton</code> and <code>prototype</code>. The second argument to the <code>registerScope(..)</code> method is an actual instance of the custom <code>Scope</code> implementation that you wish to register and use.</p>
<p>Suppose that you write your custom <code>Scope</code> implementation, and then register it as shown in the next example.</p>
<table>
<thead>
<tr>
<th></th>
<th>The next example uses <code>SimpleThreadScope</code>, which is included with Spring but is not registered by default. The instructions would be the same for your own custom <code>Scope</code> implementations.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scope</span> <span class="variable">threadScope</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleThreadScope</span>();</span><br><span class="line">beanFactory.registerScope(<span class="string">&quot;thread&quot;</span>, threadScope);</span><br></pre></td></tr></table></figure>

<p>You can then create bean definitions that adhere to the scoping rules of your custom <code>Scope</code>, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;thread&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>With a custom <code>Scope</code> implementation, you are not limited to programmatic registration of the scope. You can also do the <code>Scope</code> registration declaratively, by using the <code>CustomScopeConfigurer</code> class, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;scopes&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;thread&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.SimpleThreadScope&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thing2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.Thing2&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;thread&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Rick&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thing1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.Thing1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;thing2&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;thing2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>When you place <code>&lt;aop:scoped-proxy/&gt;</code> within a <code>&lt;bean&gt;</code> declaration for a <code>FactoryBean</code> implementation, it is the factory bean itself that is scoped, not the object returned from <code>getObject()</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-6-Customizing-the-Nature-of-a-Bean"><a href="#1-6-Customizing-the-Nature-of-a-Bean" class="headerlink" title="1.6. Customizing the Nature of a Bean"></a>1.6. Customizing the Nature of a Bean</h3><p>The Spring Framework provides a number of interfaces you can use to customize the nature of a bean. This section groups them as follows:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle">Lifecycle Callbacks</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aware-list">Other <code>Aware</code> Interfaces</a></li>
</ul>
<h4 id="1-6-1-Lifecycle-Callbacks"><a href="#1-6-1-Lifecycle-Callbacks" class="headerlink" title="1.6.1. Lifecycle Callbacks"></a>1.6.1. Lifecycle Callbacks</h4><p>To interact with the container’s management of the bean lifecycle, you can implement the Spring <code>InitializingBean</code> and <code>DisposableBean</code> interfaces. The container calls <code>afterPropertiesSet()</code> for the former and <code>destroy()</code> for the latter to let the bean perform certain actions upon initialization and destruction of your beans.</p>
<table>
<thead>
<tr>
<th></th>
<th>The JSR-250 <code>@PostConstruct</code> and <code>@PreDestroy</code> annotations are generally considered best practice for receiving lifecycle callbacks in a modern Spring application. Using these annotations means that your beans are not coupled to Spring-specific interfaces. For details, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-postconstruct-and-predestroy-annotations">Using <code>@PostConstruct</code> and <code>@PreDestroy</code></a>.If you do not want to use the JSR-250 annotations but you still want to remove coupling, consider <code>init-method</code> and <code>destroy-method</code> bean definition metadata.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Internally, the Spring Framework uses <code>BeanPostProcessor</code> implementations to process any callback interfaces it can find and call the appropriate methods. If you need custom features or other lifecycle behavior Spring does not by default offer, you can implement a <code>BeanPostProcessor</code> yourself. For more information, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-extension">Container Extension Points</a>.</p>
<p>In addition to the initialization and destruction callbacks, Spring-managed objects may also implement the <code>Lifecycle</code> interface so that those objects can participate in the startup and shutdown process, as driven by the container’s own lifecycle.</p>
<p>The lifecycle callback interfaces are described in this section.</p>
<h5 id="Initialization-Callbacks"><a href="#Initialization-Callbacks" class="headerlink" title="Initialization Callbacks"></a>Initialization Callbacks</h5><p>The <code>org.springframework.beans.factory.InitializingBean</code> interface lets a bean perform initialization work after the container has set all necessary properties on the bean. The <code>InitializingBean</code> interface specifies a single method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>

<p>We recommend that you do not use the <code>InitializingBean</code> interface, because it unnecessarily couples the code to Spring. Alternatively, we suggest using the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-postconstruct-and-predestroy-annotations"><code>@PostConstruct</code></a> annotation or specifying a POJO initialization method. In the case of XML-based configuration metadata, you can use the <code>init-method</code> attribute to specify the name of the method that has a void no-argument signature. With Java configuration, you can use the <code>initMethod</code> attribute of <code>@Bean</code>. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-lifecycle-callbacks">Receiving Lifecycle Callbacks</a>. Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleInitBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// do some initialization work</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding example has almost exactly the same effect as the following example (which consists of two listings):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleInitBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.AnotherExampleBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnotherExampleBean</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// do some initialization work</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, the first of the two preceding examples does not couple the code to Spring.</p>
<h5 id="Destruction-Callbacks"><a href="#Destruction-Callbacks" class="headerlink" title="Destruction Callbacks"></a>Destruction Callbacks</h5><p>Implementing the <code>org.springframework.beans.factory.DisposableBean</code> interface lets a bean get a callback when the container that contains it is destroyed. The <code>DisposableBean</code> interface specifies a single method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>

<p>We recommend that you do not use the <code>DisposableBean</code> callback interface, because it unnecessarily couples the code to Spring. Alternatively, we suggest using the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-postconstruct-and-predestroy-annotations"><code>@PreDestroy</code></a> annotation or specifying a generic method that is supported by bean definitions. With XML-based configuration metadata, you can use the <code>destroy-method</code> attribute on the <code>&lt;bean/&gt;</code>. With Java configuration, you can use the <code>destroyMethod</code> attribute of <code>@Bean</code>. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-lifecycle-callbacks">Receiving Lifecycle Callbacks</a>. Consider the following definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleInitBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;cleanup&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// do some destruction work (like releasing pooled connections)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding definition has almost exactly the same effect as the following definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleInitBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.AnotherExampleBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnotherExampleBean</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// do some destruction work (like releasing pooled connections)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, the first of the two preceding definitions does not couple the code to Spring.</p>
<table>
<thead>
<tr>
<th></th>
<th>You can assign the <code>destroy-method</code> attribute of a <code>&lt;bean&gt;</code> element a special <code>(inferred)</code> value, which instructs Spring to automatically detect a public <code>close</code> or <code>shutdown</code> method on the specific bean class. (Any class that implements <code>java.lang.AutoCloseable</code> or <code>java.io.Closeable</code> would therefore match.) You can also set this special <code>(inferred)</code> value on the <code>default-destroy-method</code> attribute of a <code>&lt;beans&gt;</code> element to apply this behavior to an entire set of beans (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-default-init-destroy-methods">Default Initialization and Destroy Methods</a>). Note that this is the default behavior with Java configuration.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Default-Initialization-and-Destroy-Methods"><a href="#Default-Initialization-and-Destroy-Methods" class="headerlink" title="Default Initialization and Destroy Methods"></a>Default Initialization and Destroy Methods</h5><p>When you write initialization and destroy method callbacks that do not use the Spring-specific <code>InitializingBean</code> and <code>DisposableBean</code> callback interfaces, you typically write methods with names such as <code>init()</code>, <code>initialize()</code>, <code>dispose()</code>, and so on. Ideally, the names of such lifecycle callback methods are standardized across a project so that all developers use the same method names and ensure consistency.</p>
<p>You can configure the Spring container to “look” for named initialization and destroy callback method names on every bean. This means that you, as an application developer, can write your application classes and use an initialization callback called <code>init()</code>, without having to configure an <code>init-method=&quot;init&quot;</code> attribute with each bean definition. The Spring IoC container calls that method when the bean is created (and in accordance with the standard lifecycle callback contract <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle">described previously</a>). This feature also enforces a consistent naming convention for initialization and destroy method callbacks.</p>
<p>Suppose that your initialization callback methods are named <code>init()</code> and your destroy callback methods are named <code>destroy()</code>. Your class then resembles the class in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultBlogService</span> <span class="keyword">implements</span> <span class="title class_">BlogService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BlogDao blogDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBlogDao</span><span class="params">(BlogDao blogDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.blogDao = blogDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// this is (unsurprisingly) the initialization callback method</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.blogDao == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;The [blogDao] property must be set.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You could then use that class in a bean resembling the following:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-init-method</span>=<span class="string">&quot;init&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;blogService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.DefaultBlogService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;blogDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;blogDao&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The presence of the <code>default-init-method</code> attribute on the top-level <code>&lt;beans/&gt;</code> element attribute causes the Spring IoC container to recognize a method called <code>init</code> on the bean class as the initialization method callback. When a bean is created and assembled, if the bean class has such a method, it is invoked at the appropriate time.</p>
<p>You can configure destroy method callbacks similarly (in XML, that is) by using the <code>default-destroy-method</code> attribute on the top-level <code>&lt;beans/&gt;</code> element.</p>
<p>Where existing bean classes already have callback methods that are named at variance with the convention, you can override the default by specifying (in XML, that is) the method name by using the <code>init-method</code> and <code>destroy-method</code> attributes of the <code>&lt;bean/&gt;</code> itself.</p>
<p>The Spring container guarantees that a configured initialization callback is called immediately after a bean is supplied with all dependencies. Thus, the initialization callback is called on the raw bean reference, which means that AOP interceptors and so forth are not yet applied to the bean. A target bean is fully created first and then an AOP proxy (for example) with its interceptor chain is applied. If the target bean and the proxy are defined separately, your code can even interact with the raw target bean, bypassing the proxy. Hence, it would be inconsistent to apply the interceptors to the <code>init</code> method, because doing so would couple the lifecycle of the target bean to its proxy or interceptors and leave strange semantics when your code interacts directly with the raw target bean.</p>
<h5 id="Combining-Lifecycle-Mechanisms"><a href="#Combining-Lifecycle-Mechanisms" class="headerlink" title="Combining Lifecycle Mechanisms"></a>Combining Lifecycle Mechanisms</h5><p>As of Spring 2.5, you have three options for controlling bean lifecycle behavior:</p>
<ul>
<li>The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-initializingbean"><code>InitializingBean</code></a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-disposablebean"><code>DisposableBean</code></a> callback interfaces</li>
<li>Custom <code>init()</code> and <code>destroy()</code> methods</li>
<li>The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-postconstruct-and-predestroy-annotations"><code>@PostConstruct</code> and <code>@PreDestroy</code> annotations</a>. You can combine these mechanisms to control a given bean.</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>If multiple lifecycle mechanisms are configured for a bean and each mechanism is configured with a different method name, then each configured method is run in the order listed after this note. However, if the same method name is configured — for example, <code>init()</code> for an initialization method — for more than one of these lifecycle mechanisms, that method is run once, as explained in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-default-init-destroy-methods">preceding section</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Multiple lifecycle mechanisms configured for the same bean, with different initialization methods, are called as follows:</p>
<ol>
<li>Methods annotated with <code>@PostConstruct</code></li>
<li><code>afterPropertiesSet()</code> as defined by the <code>InitializingBean</code> callback interface</li>
<li>A custom configured <code>init()</code> method</li>
</ol>
<p>Destroy methods are called in the same order:</p>
<ol>
<li>Methods annotated with <code>@PreDestroy</code></li>
<li><code>destroy()</code> as defined by the <code>DisposableBean</code> callback interface</li>
<li>A custom configured <code>destroy()</code> method</li>
</ol>
<h5 id="Startup-and-Shutdown-Callbacks"><a href="#Startup-and-Shutdown-Callbacks" class="headerlink" title="Startup and Shutdown Callbacks"></a>Startup and Shutdown Callbacks</h5><p>The <code>Lifecycle</code> interface defines the essential methods for any object that has its own lifecycle requirements (such as starting and stopping some background process):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Lifecycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isRunning</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Any Spring-managed object may implement the <code>Lifecycle</code> interface. Then, when the <code>ApplicationContext</code> itself receives start and stop signals (for example, for a stop&#x2F;restart scenario at runtime), it cascades those calls to all <code>Lifecycle</code> implementations defined within that context. It does this by delegating to a <code>LifecycleProcessor</code>, shown in the following listing:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LifecycleProcessor</span> <span class="keyword">extends</span> <span class="title class_">Lifecycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that the <code>LifecycleProcessor</code> is itself an extension of the <code>Lifecycle</code> interface. It also adds two other methods for reacting to the context being refreshed and closed.</p>
<table>
<thead>
<tr>
<th></th>
<th>Note that the regular <code>org.springframework.context.Lifecycle</code> interface is a plain contract for explicit start and stop notifications and does not imply auto-startup at context refresh time. For fine-grained control over auto-startup of a specific bean (including startup phases), consider implementing <code>org.springframework.context.SmartLifecycle</code> instead.Also, please note that stop notifications are not guaranteed to come before destruction. On regular shutdown, all <code>Lifecycle</code> beans first receive a stop notification before the general destruction callbacks are being propagated. However, on hot refresh during a context’s lifetime or on stopped refresh attempts, only destroy methods are called.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The order of startup and shutdown invocations can be important. If a “depends-on” relationship exists between any two objects, the dependent side starts after its dependency, and it stops before its dependency. However, at times, the direct dependencies are unknown. You may only know that objects of a certain type should start prior to objects of another type. In those cases, the <code>SmartLifecycle</code> interface defines another option, namely the <code>getPhase()</code> method as defined on its super-interface, <code>Phased</code>. The following listing shows the definition of the <code>Phased</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Phased</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getPhase</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following listing shows the definition of the <code>SmartLifecycle</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmartLifecycle</span> <span class="keyword">extends</span> <span class="title class_">Lifecycle</span>, Phased &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAutoStartup</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">(Runnable callback)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When starting, the objects with the lowest phase start first. When stopping, the reverse order is followed. Therefore, an object that implements <code>SmartLifecycle</code> and whose <code>getPhase()</code> method returns <code>Integer.MIN_VALUE</code> would be among the first to start and the last to stop. At the other end of the spectrum, a phase value of <code>Integer.MAX_VALUE</code> would indicate that the object should be started last and stopped first (likely because it depends on other processes to be running). When considering the phase value, it is also important to know that the default phase for any “normal” <code>Lifecycle</code> object that does not implement <code>SmartLifecycle</code> is <code>0</code>. Therefore, any negative phase value indicates that an object should start before those standard components (and stop after them). The reverse is true for any positive phase value.</p>
<p>The stop method defined by <code>SmartLifecycle</code> accepts a callback. Any implementation must invoke that callback’s <code>run()</code> method after that implementation’s shutdown process is complete. That enables asynchronous shutdown where necessary, since the default implementation of the <code>LifecycleProcessor</code> interface, <code>DefaultLifecycleProcessor</code>, waits up to its timeout value for the group of objects within each phase to invoke that callback. The default per-phase timeout is 30 seconds. You can override the default lifecycle processor instance by defining a bean named <code>lifecycleProcessor</code> within the context. If you want only to modify the timeout, defining the following would suffice:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lifecycleProcessor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.DefaultLifecycleProcessor&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- timeout value in milliseconds --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeoutPerShutdownPhase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>As mentioned earlier, the <code>LifecycleProcessor</code> interface defines callback methods for the refreshing and closing of the context as well. The latter drives the shutdown process as if <code>stop()</code> had been called explicitly, but it happens when the context is closing. The ‘refresh’ callback, on the other hand, enables another feature of <code>SmartLifecycle</code> beans. When the context is refreshed (after all objects have been instantiated and initialized), that callback is invoked. At that point, the default lifecycle processor checks the boolean value returned by each <code>SmartLifecycle</code> object’s <code>isAutoStartup()</code> method. If <code>true</code>, that object is started at that point rather than waiting for an explicit invocation of the context’s or its own <code>start()</code> method (unlike the context refresh, the context start does not happen automatically for a standard context implementation). The <code>phase</code> value and any “depends-on” relationships determine the startup order as described earlier.</p>
<h5 id="Shutting-Down-the-Spring-IoC-Container-Gracefully-in-Non-Web-Applications"><a href="#Shutting-Down-the-Spring-IoC-Container-Gracefully-in-Non-Web-Applications" class="headerlink" title="Shutting Down the Spring IoC Container Gracefully in Non-Web Applications"></a>Shutting Down the Spring IoC Container Gracefully in Non-Web Applications</h5><table>
<thead>
<tr>
<th></th>
<th>This section applies only to non-web applications. Spring’s web-based <code>ApplicationContext</code> implementations already have code in place to gracefully shut down the Spring IoC container when the relevant web application is shut down.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>If you use Spring’s IoC container in a non-web application environment (for example, in a rich client desktop environment), register a shutdown hook with the JVM. Doing so ensures a graceful shutdown and calls the relevant destroy methods on your singleton beans so that all resources are released. You must still configure and implement these destroy callbacks correctly.</p>
<p>To register a shutdown hook, call the <code>registerShutdownHook()</code> method that is declared on the <code>ConfigurableApplicationContext</code> interface, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Boot</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add a shutdown hook for the above context...</span></span><br><span class="line">        ctx.registerShutdownHook();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// app runs here...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// main method exits, hook is called prior to the app shutting down...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-6-2-ApplicationContextAware-and-BeanNameAware"><a href="#1-6-2-ApplicationContextAware-and-BeanNameAware" class="headerlink" title="1.6.2. ApplicationContextAware and BeanNameAware"></a>1.6.2. <code>ApplicationContextAware</code> and <code>BeanNameAware</code></h4><p>When an <code>ApplicationContext</code> creates an object instance that implements the <code>org.springframework.context.ApplicationContextAware</code> interface, the instance is provided with a reference to that <code>ApplicationContext</code>. The following listing shows the definition of the <code>ApplicationContextAware</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Thus, beans can programmatically manipulate the <code>ApplicationContext</code> that created them, through the <code>ApplicationContext</code> interface or by casting the reference to a known subclass of this interface (such as <code>ConfigurableApplicationContext</code>, which exposes additional functionality). One use would be the programmatic retrieval of other beans. Sometimes this capability is useful. However, in general, you should avoid it, because it couples the code to Spring and does not follow the Inversion of Control style, where collaborators are provided to beans as properties. Other methods of the <code>ApplicationContext</code> provide access to file resources, publishing application events, and accessing a <code>MessageSource</code>. These additional features are described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-introduction">Additional Capabilities of the <code>ApplicationContext</code></a>.</p>
<p>Autowiring is another alternative to obtain a reference to the <code>ApplicationContext</code>. The <em>traditional</em> <code>constructor</code> and <code>byType</code> autowiring modes (as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire">Autowiring Collaborators</a>) can provide a dependency of type <code>ApplicationContext</code> for a constructor argument or a setter method parameter, respectively. For more flexibility, including the ability to autowire fields and multiple parameter methods, use the annotation-based autowiring features. If you do, the <code>ApplicationContext</code> is autowired into a field, constructor argument, or method parameter that expects the <code>ApplicationContext</code> type if the field, constructor, or method in question carries the <code>@Autowired</code> annotation. For more information, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation">Using <code>@Autowired</code></a>.</p>
<p>When an <code>ApplicationContext</code> creates a class that implements the <code>org.springframework.beans.factory.BeanNameAware</code> interface, the class is provided with a reference to the name defined in its associated object definition. The following listing shows the definition of the BeanNameAware interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanNameAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The callback is invoked after population of normal bean properties but before an initialization callback such as <code>InitializingBean.afterPropertiesSet()</code> or a custom init-method.</p>
<h4 id="1-6-3-Other-Aware-Interfaces"><a href="#1-6-3-Other-Aware-Interfaces" class="headerlink" title="1.6.3. Other Aware Interfaces"></a>1.6.3. Other <code>Aware</code> Interfaces</h4><p>Besides <code>ApplicationContextAware</code> and <code>BeanNameAware</code> (discussed <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware">earlier</a>), Spring offers a wide range of <code>Aware</code> callback interfaces that let beans indicate to the container that they require a certain infrastructure dependency. As a general rule, the name indicates the dependency type. The following table summarizes the most important <code>Aware</code> interfaces:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Injected Dependency</th>
<th align="left">Explained in…</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ApplicationContextAware</code></td>
<td align="left">Declaring <code>ApplicationContext</code>.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></td>
</tr>
<tr>
<td align="left"><code>ApplicationEventPublisherAware</code></td>
<td align="left">Event publisher of the enclosing <code>ApplicationContext</code>.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-introduction">Additional Capabilities of the <code>ApplicationContext</code></a></td>
</tr>
<tr>
<td align="left"><code>BeanClassLoaderAware</code></td>
<td align="left">Class loader used to load the bean classes.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-class">Instantiating Beans</a></td>
</tr>
<tr>
<td align="left"><code>BeanFactoryAware</code></td>
<td align="left">Declaring <code>BeanFactory</code>.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beanfactory">The <code>BeanFactory</code> API</a></td>
</tr>
<tr>
<td align="left"><code>BeanNameAware</code></td>
<td align="left">Name of the declaring bean.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></td>
</tr>
<tr>
<td align="left"><code>LoadTimeWeaverAware</code></td>
<td align="left">Defined weaver for processing class definition at load time.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw">Load-time Weaving with AspectJ in the Spring Framework</a></td>
</tr>
<tr>
<td align="left"><code>MessageSourceAware</code></td>
<td align="left">Configured strategy for resolving messages (with support for parametrization and internationalization).</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-introduction">Additional Capabilities of the <code>ApplicationContext</code></a></td>
</tr>
<tr>
<td align="left"><code>NotificationPublisherAware</code></td>
<td align="left">Spring JMX notification publisher.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#jmx-notifications">Notifications</a></td>
</tr>
<tr>
<td align="left"><code>ResourceLoaderAware</code></td>
<td align="left">Configured loader for low-level access to resources.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources">Resources</a></td>
</tr>
<tr>
<td align="left"><code>ServletConfigAware</code></td>
<td align="left">Current <code>ServletConfig</code> the container runs in. Valid only in a web-aware Spring <code>ApplicationContext</code>.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring MVC</a></td>
</tr>
<tr>
<td align="left"><code>ServletContextAware</code></td>
<td align="left">Current <code>ServletContext</code> the container runs in. Valid only in a web-aware Spring <code>ApplicationContext</code>.</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring MVC</a></td>
</tr>
</tbody></table>
<p>Note again that using these interfaces ties your code to the Spring API and does not follow the Inversion of Control style. As a result, we recommend them for infrastructure beans that require programmatic access to the container.</p>
<h3 id="1-7-Bean-Definition-Inheritance"><a href="#1-7-Bean-Definition-Inheritance" class="headerlink" title="1.7. Bean Definition Inheritance"></a>1.7. Bean Definition Inheritance</h3><p>A bean definition can contain a lot of configuration information, including constructor arguments, property values, and container-specific information, such as the initialization method, a static factory method name, and so on. A child bean definition inherits configuration data from a parent definition. The child definition can override some values or add others as needed. Using parent and child bean definitions can save a lot of typing. Effectively, this is a form of templating.</p>
<p>If you work with an <code>ApplicationContext</code> interface programmatically, child bean definitions are represented by the <code>ChildBeanDefinition</code> class. Most users do not work with them on this level. Instead, they configure bean definitions declaratively in a class such as the <code>ClassPathXmlApplicationContext</code>. When you use XML-based configuration metadata, you can indicate a child bean definition by using the <code>parent</code> attribute, specifying the parent bean as the value of this attribute. The following example shows how to do so:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inheritedTestBean&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inheritsWithDifferentClass&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.DerivedTestBean&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">parent</span>=<span class="string">&quot;inheritedTestBean&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;initialize&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;override&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- the age property value of 1 will be inherited from parent --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Note the <code>parent</code> attribute.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>A child bean definition uses the bean class from the parent definition if none is specified but can also override it. In the latter case, the child bean class must be compatible with the parent (that is, it must accept the parent’s property values).</p>
<p>A child bean definition inherits scope, constructor argument values, property values, and method overrides from the parent, with the option to add new values. Any scope, initialization method, destroy method, or <code>static</code> factory method settings that you specify override the corresponding parent settings.</p>
<p>The remaining settings are always taken from the child definition: depends on, autowire mode, dependency check, singleton, and lazy init.</p>
<p>The preceding example explicitly marks the parent bean definition as abstract by using the <code>abstract</code> attribute. If the parent definition does not specify a class, explicitly marking the parent bean definition as <code>abstract</code> is required, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inheritedTestBeanWithoutClass&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inheritsWithClass&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.DerivedTestBean&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">parent</span>=<span class="string">&quot;inheritedTestBeanWithoutClass&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;initialize&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;override&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- age will inherit the value of 1 from the parent bean definition--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The parent bean cannot be instantiated on its own because it is incomplete, and it is also explicitly marked as <code>abstract</code>. When a definition is <code>abstract</code>, it is usable only as a pure template bean definition that serves as a parent definition for child definitions. Trying to use such an <code>abstract</code> parent bean on its own, by referring to it as a ref property of another bean or doing an explicit <code>getBean()</code> call with the parent bean ID returns an error. Similarly, the container’s internal <code>preInstantiateSingletons()</code> method ignores bean definitions that are defined as abstract.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>ApplicationContext</code> pre-instantiates all singletons by default. Therefore, it is important (at least for singleton beans) that if you have a (parent) bean definition which you intend to use only as a template, and this definition specifies a class, you must make sure to set the <em>abstract</em> attribute to <em>true</em>, otherwise the application context will actually (attempt to) pre-instantiate the <code>abstract</code> bean.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-8-Container-Extension-Points"><a href="#1-8-Container-Extension-Points" class="headerlink" title="1.8. Container Extension Points"></a>1.8. Container Extension Points</h3><p>Typically, an application developer does not need to subclass <code>ApplicationContext</code> implementation classes. Instead, the Spring IoC container can be extended by plugging in implementations of special integration interfaces. The next few sections describe these integration interfaces.</p>
<h4 id="1-8-1-Customizing-Beans-by-Using-a-BeanPostProcessor"><a href="#1-8-1-Customizing-Beans-by-Using-a-BeanPostProcessor" class="headerlink" title="1.8.1. Customizing Beans by Using a BeanPostProcessor"></a>1.8.1. Customizing Beans by Using a <code>BeanPostProcessor</code></h4><p>The <code>BeanPostProcessor</code> interface defines callback methods that you can implement to provide your own (or override the container’s default) instantiation logic, dependency resolution logic, and so forth. If you want to implement some custom logic after the Spring container finishes instantiating, configuring, and initializing a bean, you can plug in one or more custom <code>BeanPostProcessor</code> implementations.</p>
<p>You can configure multiple <code>BeanPostProcessor</code> instances, and you can control the order in which these <code>BeanPostProcessor</code> instances run by setting the <code>order</code> property. You can set this property only if the <code>BeanPostProcessor</code> implements the <code>Ordered</code> interface. If you write your own <code>BeanPostProcessor</code>, you should consider implementing the <code>Ordered</code> interface, too. For further details, see the javadoc of the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html"><code>BeanPostProcessor</code></a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/Ordered.html"><code>Ordered</code></a> interfaces. See also the note on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-programmatically-registering-beanpostprocessors">programmatic registration of <code>BeanPostProcessor</code> instances</a>.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>BeanPostProcessor</code> instances operate on bean (or object) instances. That is, the Spring IoC container instantiates a bean instance and then <code>BeanPostProcessor</code> instances do their work.<code>BeanPostProcessor</code> instances are scoped per-container. This is relevant only if you use container hierarchies. If you define a <code>BeanPostProcessor</code> in one container, it post-processes only the beans in that container. In other words, beans that are defined in one container are not post-processed by a <code>BeanPostProcessor</code> defined in another container, even if both containers are part of the same hierarchy.To change the actual bean definition (that is, the blueprint that defines the bean), you instead need to use a <code>BeanFactoryPostProcessor</code>, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-extension-factory-postprocessors">Customizing Configuration Metadata with a <code>BeanFactoryPostProcessor</code></a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The <code>org.springframework.beans.factory.config.BeanPostProcessor</code> interface consists of exactly two callback methods. When such a class is registered as a post-processor with the container, for each bean instance that is created by the container, the post-processor gets a callback from the container both before container initialization methods (such as <code>InitializingBean.afterPropertiesSet()</code> or any declared <code>init</code> method) are called, and after any bean initialization callbacks. The post-processor can take any action with the bean instance, including ignoring the callback completely. A bean post-processor typically checks for callback interfaces, or it may wrap a bean with a proxy. Some Spring AOP infrastructure classes are implemented as bean post-processors in order to provide proxy-wrapping logic.</p>
<p>An <code>ApplicationContext</code> automatically detects any beans that are defined in the configuration metadata that implement the <code>BeanPostProcessor</code> interface. The <code>ApplicationContext</code> registers these beans as post-processors so that they can be called later, upon bean creation. Bean post-processors can be deployed in the container in the same fashion as any other beans.</p>
<p>Note that, when declaring a <code>BeanPostProcessor</code> by using an <code>@Bean</code> factory method on a configuration class, the return type of the factory method should be the implementation class itself or at least the <code>org.springframework.beans.factory.config.BeanPostProcessor</code> interface, clearly indicating the post-processor nature of that bean. Otherwise, the <code>ApplicationContext</code> cannot autodetect it by type before fully creating it. Since a <code>BeanPostProcessor</code> needs to be instantiated early in order to apply to the initialization of other beans in the context, this early type detection is critical.</p>
<table>
<thead>
<tr>
<th></th>
<th>Programmatically registering <code>BeanPostProcessor</code> instancesWhile the recommended approach for <code>BeanPostProcessor</code> registration is through <code>ApplicationContext</code> auto-detection (as described earlier), you can register them programmatically against a <code>ConfigurableBeanFactory</code> by using the <code>addBeanPostProcessor</code> method. This can be useful when you need to evaluate conditional logic before registration or even for copying bean post processors across contexts in a hierarchy. Note, however, that <code>BeanPostProcessor</code> instances added programmatically do not respect the <code>Ordered</code> interface. Here, it is the order of registration that dictates the order of execution. Note also that <code>BeanPostProcessor</code> instances registered programmatically are always processed before those registered through auto-detection, regardless of any explicit ordering.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th><code>BeanPostProcessor</code> instances and AOP auto-proxyingClasses that implement the <code>BeanPostProcessor</code> interface are special and are treated differently by the container. All <code>BeanPostProcessor</code> instances and beans that they directly reference are instantiated on startup, as part of the special startup phase of the <code>ApplicationContext</code>. Next, all <code>BeanPostProcessor</code> instances are registered in a sorted fashion and applied to all further beans in the container. Because AOP auto-proxying is implemented as a <code>BeanPostProcessor</code> itself, neither <code>BeanPostProcessor</code> instances nor the beans they directly reference are eligible for auto-proxying and, thus, do not have aspects woven into them.For any such bean, you should see an informational log message: <code>Bean someBean is not eligible for getting processed by all BeanPostProcessor interfaces (for example: not eligible for auto-proxying)</code>.If you have beans wired into your <code>BeanPostProcessor</code> by using autowiring or <code>@Resource</code> (which may fall back to autowiring), Spring might access unexpected beans when searching for type-matching dependency candidates and, therefore, make them ineligible for auto-proxying or other kinds of bean post-processing. For example, if you have a dependency annotated with <code>@Resource</code> where the field or setter name does not directly correspond to the declared name of a bean and no name attribute is used, Spring accesses other beans for matching them by type.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following examples show how to write, register, and use <code>BeanPostProcessor</code> instances in an <code>ApplicationContext</code>.</p>
<h5 id="Example-Hello-World-BeanPostProcessor-style"><a href="#Example-Hello-World-BeanPostProcessor-style" class="headerlink" title="Example: Hello World, BeanPostProcessor-style"></a>Example: Hello World, <code>BeanPostProcessor</code>-style</h5><p>This first example illustrates basic usage. The example shows a custom <code>BeanPostProcessor</code> implementation that invokes the <code>toString()</code> method of each bean as it is created by the container and prints the resulting string to the system console.</p>
<p>The following listing shows the custom <code>BeanPostProcessor</code> implementation class definition:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> scripting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstantiationTracingBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// simply return the instantiated bean as-is</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bean; <span class="comment">// we could potentially return any object reference here...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; created : &quot;</span> + bean.toString());</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following <code>beans</code> element uses the <code>InstantiationTracingBeanPostProcessor</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:lang</span>=<span class="string">&quot;http://www.springframework.org/schema/lang&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/lang</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/lang/spring-lang.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">lang:groovy</span> <span class="attr">id</span>=<span class="string">&quot;messenger&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">script-source</span>=<span class="string">&quot;classpath:org/springframework/scripting/groovy/Messenger.groovy&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lang:property</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Fiona Apple Is Just So Dreamy.&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">lang:groovy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    when the above bean (messenger) is instantiated, this custom</span></span><br><span class="line"><span class="comment">    BeanPostProcessor implementation will output the fact to the system console</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;scripting.InstantiationTracingBeanPostProcessor&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Notice how the <code>InstantiationTracingBeanPostProcessor</code> is merely defined. It does not even have a name, and, because it is a bean, it can be dependency-injected as you would any other bean. (The preceding configuration also defines a bean that is backed by a Groovy script. The Spring dynamic language support is detailed in the chapter entitled <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language">Dynamic Language Support</a>.)</p>
<p>The following Java application runs the preceding code and configuration:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scripting.Messenger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Boot</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;scripting/beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Messenger</span> <span class="variable">messenger</span> <span class="operator">=</span> ctx.getBean(<span class="string">&quot;messenger&quot;</span>, Messenger.class);</span><br><span class="line">        System.out.println(messenger);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The output of the preceding application resembles the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bean &#x27;messenger&#x27; created : org.springframework.scripting.groovy.GroovyMessenger@272961</span><br><span class="line">org.springframework.scripting.groovy.GroovyMessenger@272961</span><br></pre></td></tr></table></figure>

<h5 id="Example-The-AutowiredAnnotationBeanPostProcessor"><a href="#Example-The-AutowiredAnnotationBeanPostProcessor" class="headerlink" title="Example: The AutowiredAnnotationBeanPostProcessor"></a>Example: The <code>AutowiredAnnotationBeanPostProcessor</code></h5><p>Using callback interfaces or annotations in conjunction with a custom <code>BeanPostProcessor</code> implementation is a common means of extending the Spring IoC container. An example is Spring’s <code>AutowiredAnnotationBeanPostProcessor</code> — a <code>BeanPostProcessor</code> implementation that ships with the Spring distribution and autowires annotated fields, setter methods, and arbitrary config methods.</p>
<h4 id="1-8-2-Customizing-Configuration-Metadata-with-a-BeanFactoryPostProcessor"><a href="#1-8-2-Customizing-Configuration-Metadata-with-a-BeanFactoryPostProcessor" class="headerlink" title="1.8.2. Customizing Configuration Metadata with a BeanFactoryPostProcessor"></a>1.8.2. Customizing Configuration Metadata with a <code>BeanFactoryPostProcessor</code></h4><p>The next extension point that we look at is the <code>org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>. The semantics of this interface are similar to those of the <code>BeanPostProcessor</code>, with one major difference: <code>BeanFactoryPostProcessor</code> operates on the bean configuration metadata. That is, the Spring IoC container lets a <code>BeanFactoryPostProcessor</code> read the configuration metadata and potentially change it <em>before</em> the container instantiates any beans other than <code>BeanFactoryPostProcessor</code> instances.</p>
<p>You can configure multiple <code>BeanFactoryPostProcessor</code> instances, and you can control the order in which these <code>BeanFactoryPostProcessor</code> instances run by setting the <code>order</code> property. However, you can only set this property if the <code>BeanFactoryPostProcessor</code> implements the <code>Ordered</code> interface. If you write your own <code>BeanFactoryPostProcessor</code>, you should consider implementing the <code>Ordered</code> interface, too. See the javadoc of the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/BeanFactoryPostProcessor.html"><code>BeanFactoryPostProcessor</code></a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/Ordered.html"><code>Ordered</code></a> interfaces for more details.</p>
<table>
<thead>
<tr>
<th></th>
<th>If you want to change the actual bean instances (that is, the objects that are created from the configuration metadata), then you instead need to use a <code>BeanPostProcessor</code> (described earlier in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-extension-bpp">Customizing Beans by Using a <code>BeanPostProcessor</code></a>). While it is technically possible to work with bean instances within a <code>BeanFactoryPostProcessor</code> (for example, by using <code>BeanFactory.getBean()</code>), doing so causes premature bean instantiation, violating the standard container lifecycle. This may cause negative side effects, such as bypassing bean post processing.Also, <code>BeanFactoryPostProcessor</code> instances are scoped per-container. This is only relevant if you use container hierarchies. If you define a <code>BeanFactoryPostProcessor</code> in one container, it is applied only to the bean definitions in that container. Bean definitions in one container are not post-processed by <code>BeanFactoryPostProcessor</code> instances in another container, even if both containers are part of the same hierarchy.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>A bean factory post-processor is automatically run when it is declared inside an <code>ApplicationContext</code>, in order to apply changes to the configuration metadata that define the container. Spring includes a number of predefined bean factory post-processors, such as <code>PropertyOverrideConfigurer</code> and <code>PropertySourcesPlaceholderConfigurer</code>. You can also use a custom <code>BeanFactoryPostProcessor</code> — for example, to register custom property editors.</p>
<p>An <code>ApplicationContext</code> automatically detects any beans that are deployed into it that implement the <code>BeanFactoryPostProcessor</code> interface. It uses these beans as bean factory post-processors, at the appropriate time. You can deploy these post-processor beans as you would any other bean.</p>
<table>
<thead>
<tr>
<th></th>
<th>As with <code>BeanPostProcessor</code>s , you typically do not want to configure <code>BeanFactoryPostProcessor</code>s for lazy initialization. If no other bean references a <code>Bean(Factory)PostProcessor</code>, that post-processor will not get instantiated at all. Thus, marking it for lazy initialization will be ignored, and the <code>Bean(Factory)PostProcessor</code> will be instantiated eagerly even if you set the <code>default-lazy-init</code> attribute to <code>true</code> on the declaration of your <code>&lt;beans /&gt;</code> element.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Example-The-Class-Name-Substitution-PropertySourcesPlaceholderConfigurer"><a href="#Example-The-Class-Name-Substitution-PropertySourcesPlaceholderConfigurer" class="headerlink" title="Example: The Class Name Substitution PropertySourcesPlaceholderConfigurer"></a>Example: The Class Name Substitution <code>PropertySourcesPlaceholderConfigurer</code></h5><p>You can use the <code>PropertySourcesPlaceholderConfigurer</code> to externalize property values from a bean definition in a separate file by using the standard Java <code>Properties</code> format. Doing so enables the person deploying an application to customize environment-specific properties, such as database URLs and passwords, without the complexity or risk of modifying the main XML definition file or files for the container.</p>
<p>Consider the following XML-based configuration metadata fragment, where a <code>DataSource</code> with placeholder values is defined:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.PropertySourcesPlaceholderConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;locations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/something/jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The example shows properties configured from an external <code>Properties</code> file. At runtime, a <code>PropertySourcesPlaceholderConfigurer</code> is applied to the metadata that replaces some properties of the DataSource. The values to replace are specified as placeholders of the form <code>$&#123;property-name&#125;</code>, which follows the Ant and log4j and JSP EL style.</p>
<p>The actual values come from another file in the standard Java <code>Properties</code> format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverClassName=org.hsqldb.jdbcDriver</span><br><span class="line">jdbc.url=jdbc:hsqldb:hsql://production:9002</span><br><span class="line">jdbc.username=sa</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure>

<p>Therefore, the <code>$&#123;jdbc.username&#125;</code> string is replaced at runtime with the value, ‘sa’, and the same applies for other placeholder values that match keys in the properties file. The <code>PropertySourcesPlaceholderConfigurer</code> checks for placeholders in most properties and attributes of a bean definition. Furthermore, you can customize the placeholder prefix and suffix.</p>
<p>With the <code>context</code> namespace introduced in Spring 2.5, you can configure property placeholders with a dedicated configuration element. You can provide one or more locations as a comma-separated list in the <code>location</code> attribute, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/something/jdbc.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>PropertySourcesPlaceholderConfigurer</code> not only looks for properties in the <code>Properties</code> file you specify. By default, if it cannot find a property in the specified properties files, it checks against Spring <code>Environment</code> properties and regular Java <code>System</code> properties.</p>
<table>
<thead>
<tr>
<th></th>
<th>You can use the <code>PropertySourcesPlaceholderConfigurer</code> to substitute class names, which is sometimes useful when you have to pick a particular implementation class at runtime. The following example shows how to do so:<code>&lt;bean class=&quot;org.springframework.beans.factory.config.PropertySourcesPlaceholderConfigurer&quot;&gt;    &lt;property name=&quot;locations&quot;&gt;        &lt;value&gt;classpath:com/something/strategy.properties&lt;/value&gt;    &lt;/property&gt;    &lt;property name=&quot;properties&quot;&gt;        &lt;value&gt;custom.strategy.class=com.something.DefaultStrategy&lt;/value&gt;    &lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;serviceStrategy&quot; class=&quot;$&#123;custom.strategy.class&#125;&quot;/&gt;</code>If the class cannot be resolved at runtime to a valid class, resolution of the bean fails when it is about to be created, which is during the <code>preInstantiateSingletons()</code> phase of an <code>ApplicationContext</code> for a non-lazy-init bean.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Example-The-PropertyOverrideConfigurer"><a href="#Example-The-PropertyOverrideConfigurer" class="headerlink" title="Example: The PropertyOverrideConfigurer"></a>Example: The <code>PropertyOverrideConfigurer</code></h5><p>The <code>PropertyOverrideConfigurer</code>, another bean factory post-processor, resembles the <code>PropertySourcesPlaceholderConfigurer</code>, but unlike the latter, the original definitions can have default values or no values at all for bean properties. If an overriding <code>Properties</code> file does not have an entry for a certain bean property, the default context definition is used.</p>
<p>Note that the bean definition is not aware of being overridden, so it is not immediately obvious from the XML definition file that the override configurer is being used. In case of multiple <code>PropertyOverrideConfigurer</code> instances that define different values for the same bean property, the last one wins, due to the overriding mechanism.</p>
<p>Properties file configuration lines take the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beanName.property=value</span><br></pre></td></tr></table></figure>

<p>The following listing shows an example of the format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataSource.driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">dataSource.url=jdbc:mysql:mydb</span><br></pre></td></tr></table></figure>

<p>This example file can be used with a container definition that contains a bean called <code>dataSource</code> that has <code>driver</code> and <code>url</code> properties.</p>
<p>Compound property names are also supported, as long as every component of the path except the final property being overridden is already non-null (presumably initialized by the constructors). In the following example, the <code>sammy</code> property of the <code>bob</code> property of the <code>fred</code> property of the <code>tom</code> bean is set to the scalar value <code>123</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tom.fred.bob.sammy=123</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Specified override values are always literal values. They are not translated into bean references. This convention also applies when the original value in the XML bean definition specifies a bean reference.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>With the <code>context</code> namespace introduced in Spring 2.5, it is possible to configure property overriding with a dedicated configuration element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-override</span> <span class="attr">location</span>=<span class="string">&quot;classpath:override.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-8-3-Customizing-Instantiation-Logic-with-a-FactoryBean"><a href="#1-8-3-Customizing-Instantiation-Logic-with-a-FactoryBean" class="headerlink" title="1.8.3. Customizing Instantiation Logic with a FactoryBean"></a>1.8.3. Customizing Instantiation Logic with a <code>FactoryBean</code></h4><p>You can implement the <code>org.springframework.beans.factory.FactoryBean</code> interface for objects that are themselves factories.</p>
<p>The <code>FactoryBean</code> interface is a point of pluggability into the Spring IoC container’s instantiation logic. If you have complex initialization code that is better expressed in Java as opposed to a (potentially) verbose amount of XML, you can create your own <code>FactoryBean</code>, write the complex initialization inside that class, and then plug your custom <code>FactoryBean</code> into the container.</p>
<p>The <code>FactoryBean&lt;T&gt;</code> interface provides three methods:</p>
<ul>
<li><code>T getObject()</code>: Returns an instance of the object this factory creates. The instance can possibly be shared, depending on whether this factory returns singletons or prototypes.</li>
<li><code>boolean isSingleton()</code>: Returns <code>true</code> if this <code>FactoryBean</code> returns singletons or <code>false</code> otherwise. The default implementation of this method returns <code>true</code>.</li>
<li><code>Class&lt;?&gt; getObjectType()</code>: Returns the object type returned by the <code>getObject()</code> method or <code>null</code> if the type is not known in advance.</li>
</ul>
<p>The <code>FactoryBean</code> concept and interface are used in a number of places within the Spring Framework. More than 50 implementations of the <code>FactoryBean</code> interface ship with Spring itself.</p>
<p>When you need to ask a container for an actual <code>FactoryBean</code> instance itself instead of the bean it produces, prefix the bean’s <code>id</code> with the ampersand symbol (<code>&amp;</code>) when calling the <code>getBean()</code> method of the <code>ApplicationContext</code>. So, for a given <code>FactoryBean</code> with an <code>id</code> of <code>myBean</code>, invoking <code>getBean(&quot;myBean&quot;)</code> on the container returns the product of the <code>FactoryBean</code>, whereas invoking <code>getBean(&quot;&amp;myBean&quot;)</code> returns the <code>FactoryBean</code> instance itself.</p>
<h3 id="1-9-Annotation-based-Container-Configuration"><a href="#1-9-Annotation-based-Container-Configuration" class="headerlink" title="1.9. Annotation-based Container Configuration"></a>1.9. Annotation-based Container Configuration</h3><p>Are annotations better than XML for configuring Spring?</p>
<p>The introduction of annotation-based configuration raised the question of whether this approach is “better” than XML. The short answer is “it depends.” The long answer is that each approach has its pros and cons, and, usually, it is up to the developer to decide which strategy suits them better. Due to the way they are defined, annotations provide a lot of context in their declaration, leading to shorter and more concise configuration. However, XML excels at wiring up components without touching their source code or recompiling them. Some developers prefer having the wiring close to the source while others argue that annotated classes are no longer POJOs and, furthermore, that the configuration becomes decentralized and harder to control.</p>
<p>No matter the choice, Spring can accommodate both styles and even mix them together. It is worth pointing out that through its <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java">JavaConfig</a> option, Spring lets annotations be used in a non-invasive way, without touching the target components source code and that, in terms of tooling, all configuration styles are supported by the <a target="_blank" rel="noopener" href="https://spring.io/tools">Spring Tools for Eclipse</a>.</p>
<p>An alternative to XML setup is provided by annotation-based configuration, which relies on the bytecode metadata for wiring up components instead of angle-bracket declarations. Instead of using XML to describe a bean wiring, the developer moves the configuration into the component class itself by using annotations on the relevant class, method, or field declaration. As mentioned in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-extension-bpp-examples-aabpp">Example: The <code>AutowiredAnnotationBeanPostProcessor</code></a>, using a <code>BeanPostProcessor</code> in conjunction with annotations is a common means of extending the Spring IoC container. For example, Spring 2.0 introduced the possibility of enforcing required properties with the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-required-annotation"><code>@Required</code></a> annotation. Spring 2.5 made it possible to follow that same general approach to drive Spring’s dependency injection. Essentially, the <code>@Autowired</code> annotation provides the same capabilities as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire">Autowiring Collaborators</a> but with more fine-grained control and wider applicability. Spring 2.5 also added support for JSR-250 annotations, such as <code>@PostConstruct</code> and <code>@PreDestroy</code>. Spring 3.0 added support for JSR-330 (Dependency Injection for Java) annotations contained in the <code>javax.inject</code> package such as <code>@Inject</code> and <code>@Named</code>. Details about those annotations can be found in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-standard-annotations">relevant section</a>.</p>
<table>
<thead>
<tr>
<th></th>
<th>Annotation injection is performed before XML injection. Thus, the XML configuration overrides the annotations for properties wired through both approaches.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>As always, you can register the post-processors as individual bean definitions, but they can also be implicitly registered by including the following tag in an XML-based Spring configuration (notice the inclusion of the <code>context</code> namespace):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>&lt;context:annotation-config/&gt;</code> element implicitly registers the following post-processors:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/ConfigurationClassPostProcessor.html"><code>ConfigurationClassPostProcessor</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html"><code>AutowiredAnnotationBeanPostProcessor</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html"><code>CommonAnnotationBeanPostProcessor</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html"><code>PersistenceAnnotationBeanPostProcessor</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/event/EventListenerMethodProcessor.html"><code>EventListenerMethodProcessor</code></a></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th><code>&lt;context:annotation-config/&gt;</code> only looks for annotations on beans in the same application context in which it is defined. This means that, if you put <code>&lt;context:annotation-config/&gt;</code> in a <code>WebApplicationContext</code> for a <code>DispatcherServlet</code>, it only checks for <code>@Autowired</code> beans in your controllers, and not your services. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-servlet">The DispatcherServlet</a> for more information.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-9-1-Required"><a href="#1-9-1-Required" class="headerlink" title="1.9.1. @Required"></a>1.9.1. @Required</h4><p>The <code>@Required</code> annotation applies to bean property setter methods, as in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Required</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This annotation indicates that the affected bean property must be populated at configuration time, through an explicit property value in a bean definition or through autowiring. The container throws an exception if the affected bean property has not been populated. This allows for eager and explicit failure, avoiding <code>NullPointerException</code> instances or the like later on. We still recommend that you put assertions into the bean class itself (for example, into an init method). Doing so enforces those required references and values even when you use the class outside of a container.</p>
<table>
<thead>
<tr>
<th></th>
<th>The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html"><code>RequiredAnnotationBeanPostProcessor</code></a> must be registered as a bean to enable support for the <code>@Required</code> annotation.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>The <code>@Required</code> annotation and <code>RequiredAnnotationBeanPostProcessor</code> are formally deprecated as of Spring Framework 5.1, in favor of using constructor injection for required settings (or a custom implementation of <code>InitializingBean.afterPropertiesSet()</code> or a custom <code>@PostConstruct</code> method along with bean property setter methods).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-9-2-Using-Autowired"><a href="#1-9-2-Using-Autowired" class="headerlink" title="1.9.2. Using @Autowired"></a>1.9.2. Using <code>@Autowired</code></h4><table>
<thead>
<tr>
<th></th>
<th>JSR 330’s <code>@Inject</code> annotation can be used in place of Spring’s <code>@Autowired</code> annotation in the examples included in this section. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-standard-annotations">here</a> for more details.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can apply the <code>@Autowired</code> annotation to constructors, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>As of Spring Framework 4.3, an <code>@Autowired</code> annotation on such a constructor is no longer necessary if the target bean defines only one constructor to begin with. However, if several constructors are available and there is no primary&#x2F;default constructor, at least one of the constructors must be annotated with <code>@Autowired</code> in order to instruct the container which one to use. See the discussion on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation-constructor-resolution">constructor resolution</a> for details.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can also apply the <code>@Autowired</code> annotation to <em>traditional</em> setter methods, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also apply the annotation to methods with arbitrary names and multiple arguments, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepare</span><span class="params">(MovieCatalog movieCatalog,</span></span><br><span class="line"><span class="params">            CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieCatalog = movieCatalog;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can apply <code>@Autowired</code> to fields as well and even mix it with constructors, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Make sure that your target components (for example, <code>MovieCatalog</code> or <code>CustomerPreferenceDao</code>) are consistently declared by the type that you use for your <code>@Autowired</code>-annotated injection points. Otherwise, injection may fail due to a “no type match found” error at runtime.For XML-defined beans or component classes found via classpath scanning, the container usually knows the concrete type up front. However, for <code>@Bean</code> factory methods, you need to make sure that the declared return type is sufficiently expressive. For components that implement several interfaces or for components potentially referred to by their implementation type, consider declaring the most specific return type on your factory method (at least as specific as required by the injection points referring to your bean).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can also instruct Spring to provide all beans of a particular type from the <code>ApplicationContext</code> by adding the <code>@Autowired</code> annotation to a field or method that expects an array of that type, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog[] movieCatalogs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The same applies for typed collections, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;MovieCatalog&gt; movieCatalogs;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieCatalogs</span><span class="params">(Set&lt;MovieCatalog&gt; movieCatalogs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieCatalogs = movieCatalogs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Your target beans can implement the <code>org.springframework.core.Ordered</code> interface or use the <code>@Order</code> or standard <code>@Priority</code> annotation if you want items in the array or list to be sorted in a specific order. Otherwise, their order follows the registration order of the corresponding target bean definitions in the container.You can declare the <code>@Order</code> annotation at the target class level and on <code>@Bean</code> methods, potentially for individual bean definitions (in case of multiple definitions that use the same bean class). <code>@Order</code> values may influence priorities at injection points, but be aware that they do not influence singleton startup order, which is an orthogonal concern determined by dependency relationships and <code>@DependsOn</code> declarations.Note that the standard <code>javax.annotation.Priority</code> annotation is not available at the <code>@Bean</code> level, since it cannot be declared on methods. Its semantics can be modeled through <code>@Order</code> values in combination with <code>@Primary</code> on a single bean for each type.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Even typed <code>Map</code> instances can be autowired as long as the expected key type is <code>String</code>. The map values contain all beans of the expected type, and the keys contain the corresponding bean names, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, MovieCatalog&gt; movieCatalogs;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieCatalogs</span><span class="params">(Map&lt;String, MovieCatalog&gt; movieCatalogs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieCatalogs = movieCatalogs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By default, autowiring fails when no matching candidate beans are available for a given injection point. In the case of a declared array, collection, or map, at least one matching element is expected.</p>
<p>The default behavior is to treat annotated methods and fields as indicating required dependencies. You can change this behavior as demonstrated in the following example, enabling the framework to skip a non-satisfiable injection point through marking it as non-required (i.e., by setting the <code>required</code> attribute in <code>@Autowired</code> to <code>false</code>):</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A non-required method will not be called at all if its dependency (or one of its dependencies, in case of multiple arguments) is not available. A non-required field will not get populated at all in such cases, leaving its default value in place.</p>
<p>Injected constructor and factory method arguments are a special case since the <code>required</code> attribute in <code>@Autowired</code> has a somewhat different meaning due to Spring’s constructor resolution algorithm that may potentially deal with multiple constructors. Constructor and factory method arguments are effectively required by default but with a few special rules in a single-constructor scenario, such as multi-element injection points (arrays, collections, maps) resolving to empty instances if no matching beans are available. This allows for a common implementation pattern where all dependencies can be declared in a unique multi-argument constructor — for example, declared as a single public constructor without an <code>@Autowired</code> annotation.</p>
<table>
<thead>
<tr>
<th></th>
<th>Only one constructor of any given bean class may declare <code>@Autowired</code> with the <code>required</code> attribute set to <code>true</code>, indicating <em>the</em> constructor to autowire when used as a Spring bean. As a consequence, if the <code>required</code> attribute is left at its default value <code>true</code>, only a single constructor may be annotated with <code>@Autowired</code>. If multiple constructors declare the annotation, they will all have to declare <code>required=false</code> in order to be considered as candidates for autowiring (analogous to <code>autowire=constructor</code> in XML). The constructor with the greatest number of dependencies that can be satisfied by matching beans in the Spring container will be chosen. If none of the candidates can be satisfied, then a primary&#x2F;default constructor (if present) will be used. Similarly, if a class declares multiple constructors but none of them is annotated with <code>@Autowired</code>, then a primary&#x2F;default constructor (if present) will be used. If a class only declares a single constructor to begin with, it will always be used, even if not annotated. Note that an annotated constructor does not have to be public.The <code>required</code> attribute of <code>@Autowired</code> is recommended over the deprecated <code>@Required</code> annotation on setter methods. Setting the <code>required</code> attribute to <code>false</code> indicates that the property is not required for autowiring purposes, and the property is ignored if it cannot be autowired. <code>@Required</code>, on the other hand, is stronger in that it enforces the property to be set by any means supported by the container, and if no value is defined, a corresponding exception is raised.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Alternatively, you can express the non-required nature of a particular dependency through Java 8’s <code>java.util.Optional</code>, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(Optional&lt;MovieFinder&gt; movieFinder)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As of Spring Framework 5.0, you can also use a <code>@Nullable</code> annotation (of any kind in any package — for example, <code>javax.annotation.Nullable</code> from JSR-305) or just leverage Kotlin builtin null-safety support:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(<span class="meta">@Nullable</span> MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also use <code>@Autowired</code> for interfaces that are well-known resolvable dependencies: <code>BeanFactory</code>, <code>ApplicationContext</code>, <code>Environment</code>, <code>ResourceLoader</code>, <code>ApplicationEventPublisher</code>, and <code>MessageSource</code>. These interfaces and their extended interfaces, such as <code>ConfigurableApplicationContext</code> or <code>ResourcePatternResolver</code>, are automatically resolved, with no special setup necessary. The following example autowires an <code>ApplicationContext</code> object:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>@Autowired</code>, <code>@Inject</code>, <code>@Value</code>, and <code>@Resource</code> annotations are handled by Spring <code>BeanPostProcessor</code> implementations. This means that you cannot apply these annotations within your own <code>BeanPostProcessor</code> or <code>BeanFactoryPostProcessor</code> types (if any). These types must be ‘wired up’ explicitly by using XML or a Spring <code>@Bean</code> method.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-9-3-Fine-tuning-Annotation-based-Autowiring-with-Primary"><a href="#1-9-3-Fine-tuning-Annotation-based-Autowiring-with-Primary" class="headerlink" title="1.9.3. Fine-tuning Annotation-based Autowiring with @Primary"></a>1.9.3. Fine-tuning Annotation-based Autowiring with <code>@Primary</code></h4><p>Because autowiring by type may lead to multiple candidates, it is often necessary to have more control over the selection process. One way to accomplish this is with Spring’s <code>@Primary</code> annotation. <code>@Primary</code> indicates that a particular bean should be given preference when multiple beans are candidates to be autowired to a single-valued dependency. If exactly one primary bean exists among the candidates, it becomes the autowired value.</p>
<p>Consider the following configuration that defines <code>firstMovieCatalog</code> as the primary <code>MovieCatalog</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> MovieCatalog <span class="title function_">firstMovieCatalog</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MovieCatalog <span class="title function_">secondMovieCatalog</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With the preceding configuration, the following <code>MovieRecommender</code> is autowired with the <code>firstMovieCatalog</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The corresponding bean definitions follow:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span> <span class="attr">primary</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;movieRecommender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.MovieRecommender&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-9-4-Fine-tuning-Annotation-based-Autowiring-with-Qualifiers"><a href="#1-9-4-Fine-tuning-Annotation-based-Autowiring-with-Qualifiers" class="headerlink" title="1.9.4. Fine-tuning Annotation-based Autowiring with Qualifiers"></a>1.9.4. Fine-tuning Annotation-based Autowiring with Qualifiers</h4><p><code>@Primary</code> is an effective way to use autowiring by type with several instances when one primary candidate can be determined. When you need more control over the selection process, you can use Spring’s <code>@Qualifier</code> annotation. You can associate qualifier values with specific arguments, narrowing the set of type matches so that a specific bean is chosen for each argument. In the simplest case, this can be a plain descriptive value, as shown in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;main&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also specify the <code>@Qualifier</code> annotation on individual constructor arguments or method parameters, as shown in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepare</span><span class="params">(<span class="meta">@Qualifier(&quot;main&quot;)</span> MovieCatalog movieCatalog,</span></span><br><span class="line"><span class="params">            CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieCatalog = movieCatalog;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following example shows corresponding bean definitions.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">value</span>=<span class="string">&quot;main&quot;</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">value</span>=<span class="string">&quot;action&quot;</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;movieRecommender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.MovieRecommender&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The bean with the <code>main</code> qualifier value is wired with the constructor argument that is qualified with the same value.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>The bean with the <code>action</code> qualifier value is wired with the constructor argument that is qualified with the same value.</td>
</tr>
</tbody></table>
<p>For a fallback match, the bean name is considered a default qualifier value. Thus, you can define the bean with an <code>id</code> of <code>main</code> instead of the nested qualifier element, leading to the same matching result. However, although you can use this convention to refer to specific beans by name, <code>@Autowired</code> is fundamentally about type-driven injection with optional semantic qualifiers. This means that qualifier values, even with the bean name fallback, always have narrowing semantics within the set of type matches. They do not semantically express a reference to a unique bean <code>id</code>. Good qualifier values are <code>main</code> or <code>EMEA</code> or <code>persistent</code>, expressing characteristics of a specific component that are independent from the bean <code>id</code>, which may be auto-generated in case of an anonymous bean definition such as the one in the preceding example.</p>
<p>Qualifiers also apply to typed collections, as discussed earlier — for example, to <code>Set&lt;MovieCatalog&gt;</code>. In this case, all matching beans, according to the declared qualifiers, are injected as a collection. This implies that qualifiers do not have to be unique. Rather, they constitute filtering criteria. For example, you can define multiple <code>MovieCatalog</code> beans with the same qualifier value “action”, all of which are injected into a <code>Set&lt;MovieCatalog&gt;</code> annotated with <code>@Qualifier(&quot;action&quot;)</code>.</p>
<table>
<thead>
<tr>
<th></th>
<th>Letting qualifier values select against target bean names, within the type-matching candidates, does not require a <code>@Qualifier</code> annotation at the injection point. If there is no other resolution indicator (such as a qualifier or a primary marker), for a non-unique dependency situation, Spring matches the injection point name (that is, the field name or parameter name) against the target bean names and chooses the same-named candidate, if any.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>That said, if you intend to express annotation-driven injection by name, do not primarily use <code>@Autowired</code>, even if it is capable of selecting by bean name among type-matching candidates. Instead, use the JSR-250 <code>@Resource</code> annotation, which is semantically defined to identify a specific target component by its unique name, with the declared type being irrelevant for the matching process. <code>@Autowired</code> has rather different semantics: After selecting candidate beans by type, the specified <code>String</code> qualifier value is considered within those type-selected candidates only (for example, matching an <code>account</code> qualifier against beans marked with the same qualifier label).</p>
<p>For beans that are themselves defined as a collection, <code>Map</code>, or array type, <code>@Resource</code> is a fine solution, referring to the specific collection or array bean by unique name. That said, as of 4.3, you can match collection, <code>Map</code>, and array types through Spring’s <code>@Autowired</code> type matching algorithm as well, as long as the element type information is preserved in <code>@Bean</code> return type signatures or collection inheritance hierarchies. In this case, you can use qualifier values to select among same-typed collections, as outlined in the previous paragraph.</p>
<p>As of 4.3, <code>@Autowired</code> also considers self references for injection (that is, references back to the bean that is currently injected). Note that self injection is a fallback. Regular dependencies on other components always have precedence. In that sense, self references do not participate in regular candidate selection and are therefore in particular never primary. On the contrary, they always end up as lowest precedence. In practice, you should use self references as a last resort only (for example, for calling other methods on the same instance through the bean’s transactional proxy). Consider factoring out the affected methods to a separate delegate bean in such a scenario. Alternatively, you can use <code>@Resource</code>, which may obtain a proxy back to the current bean by its unique name.</p>
<table>
<thead>
<tr>
<th></th>
<th>Trying to inject the results from <code>@Bean</code> methods on the same configuration class is effectively a self-reference scenario as well. Either lazily resolve such references in the method signature where it is actually needed (as opposed to an autowired field in the configuration class) or declare the affected <code>@Bean</code> methods as <code>static</code>, decoupling them from the containing configuration class instance and its lifecycle. Otherwise, such beans are only considered in the fallback phase, with matching beans on other configuration classes selected as primary candidates instead (if available).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>@Autowired</code> applies to fields, constructors, and multi-argument methods, allowing for narrowing through qualifier annotations at the parameter level. In contrast, <code>@Resource</code> is supported only for fields and bean property setter methods with a single argument. As a consequence, you should stick with qualifiers if your injection target is a constructor or a multi-argument method.</p>
<p>You can create your own custom qualifier annotations. To do so, define an annotation and provide the <code>@Qualifier</code> annotation within your definition, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Genre &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then you can provide the custom qualifier on autowired fields and parameters, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Genre(&quot;Action&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog actionCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog comedyCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setComedyCatalog</span><span class="params">(<span class="meta">@Genre(&quot;Comedy&quot;)</span> MovieCatalog comedyCatalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.comedyCatalog = comedyCatalog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, you can provide the information for the candidate bean definitions. You can add <code>&lt;qualifier/&gt;</code> tags as sub-elements of the <code>&lt;bean/&gt;</code> tag and then specify the <code>type</code> and <code>value</code> to match your custom qualifier annotations. The type is matched against the fully-qualified class name of the annotation. Alternately, as a convenience if no risk of conflicting names exists, you can use the short class name. The following example demonstrates both approaches:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">type</span>=<span class="string">&quot;Genre&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Action&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">type</span>=<span class="string">&quot;example.Genre&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Comedy&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;movieRecommender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.MovieRecommender&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-classpath-scanning">Classpath Scanning and Managed Components</a>, you can see an annotation-based alternative to providing the qualifier metadata in XML. Specifically, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-scanning-qualifiers">Providing Qualifier Metadata with Annotations</a>.</p>
<p>In some cases, using an annotation without a value may suffice. This can be useful when the annotation serves a more generic purpose and can be applied across several different types of dependencies. For example, you may provide an offline catalog that can be searched when no Internet connection is available. First, define the simple annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Offline &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then add the annotation to the field or property to be autowired, as shown in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Offline</span> </span><br><span class="line">    <span class="keyword">private</span> MovieCatalog offlineCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This line adds the <code>@Offline</code> annotation.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Now the bean definition only needs a qualifier <code>type</code>, as shown in the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">type</span>=<span class="string">&quot;Offline&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This element specifies the qualifier.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can also define custom qualifier annotations that accept named attributes in addition to or instead of the simple <code>value</code> attribute. If multiple attribute values are then specified on a field or parameter to be autowired, a bean definition must match all such attribute values to be considered an autowire candidate. As an example, consider the following annotation definition:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MovieQualifier &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">genre</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Format <span class="title function_">format</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this case <code>Format</code> is an enum, defined as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Format</span> &#123;</span><br><span class="line">    VHS, DVD, BLURAY</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The fields to be autowired are annotated with the custom qualifier and include values for both attributes: <code>genre</code> and <code>format</code>, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@MovieQualifier(format=Format.VHS, genre=&quot;Action&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog actionVhsCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@MovieQualifier(format=Format.VHS, genre=&quot;Comedy&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog comedyVhsCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@MovieQualifier(format=Format.DVD, genre=&quot;Action&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog actionDvdCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@MovieQualifier(format=Format.BLURAY, genre=&quot;Comedy&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog comedyBluRayCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the bean definitions should contain matching qualifier values. This example also demonstrates that you can use bean meta attributes instead of the <code>&lt;qualifier/&gt;</code> elements. If available, the <code>&lt;qualifier/&gt;</code> element and its attributes take precedence, but the autowiring mechanism falls back on the values provided within the <code>&lt;meta/&gt;</code> tags if no such qualifier is present, as in the last two bean definitions in the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">type</span>=<span class="string">&quot;MovieQualifier&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">key</span>=<span class="string">&quot;format&quot;</span> <span class="attr">value</span>=<span class="string">&quot;VHS&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">key</span>=<span class="string">&quot;genre&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Action&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">qualifier</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">type</span>=<span class="string">&quot;MovieQualifier&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">key</span>=<span class="string">&quot;format&quot;</span> <span class="attr">value</span>=<span class="string">&quot;VHS&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">key</span>=<span class="string">&quot;genre&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Comedy&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">qualifier</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">&quot;format&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DVD&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">&quot;genre&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Action&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">&quot;format&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BLURAY&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">&quot;genre&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Comedy&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-9-5-Using-Generics-as-Autowiring-Qualifiers"><a href="#1-9-5-Using-Generics-as-Autowiring-Qualifiers" class="headerlink" title="1.9.5. Using Generics as Autowiring Qualifiers"></a>1.9.5. Using Generics as Autowiring Qualifiers</h4><p>In addition to the <code>@Qualifier</code> annotation, you can use Java generic types as an implicit form of qualification. For example, suppose you have the following configuration:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> StringStore <span class="title function_">stringStore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringStore</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IntegerStore <span class="title function_">integerStore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IntegerStore</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assuming that the preceding beans implement a generic interface, (that is, <code>Store&lt;String&gt;</code> and <code>Store&lt;Integer&gt;</code>), you can <code>@Autowire</code> the <code>Store</code> interface and the generic is used as a qualifier, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Store&lt;String&gt; s1; <span class="comment">// &lt;String&gt; qualifier, injects the stringStore bean</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Store&lt;Integer&gt; s2; <span class="comment">// &lt;Integer&gt; qualifier, injects the integerStore bean</span></span><br></pre></td></tr></table></figure>

<p>Generic qualifiers also apply when autowiring lists, <code>Map</code> instances and arrays. The following example autowires a generic <code>List</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span></span><br><span class="line"><span class="comment">// Store&lt;String&gt; beans will not appear in this list</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Store&lt;Integer&gt;&gt; s;</span><br></pre></td></tr></table></figure>

<h4 id="1-9-6-Using-CustomAutowireConfigurer"><a href="#1-9-6-Using-CustomAutowireConfigurer" class="headerlink" title="1.9.6. Using CustomAutowireConfigurer"></a>1.9.6. Using <code>CustomAutowireConfigurer</code></h4><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html"><code>CustomAutowireConfigurer</code></a> is a <code>BeanFactoryPostProcessor</code> that lets you register your own custom qualifier annotation types, even if they are not annotated with Spring’s <code>@Qualifier</code> annotation. The following example shows how to use <code>CustomAutowireConfigurer</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;customAutowireConfigurer&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.annotation.CustomAutowireConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;customQualifierTypes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>example.CustomQualifier<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>AutowireCandidateResolver</code> determines autowire candidates by:</p>
<ul>
<li>The <code>autowire-candidate</code> value of each bean definition</li>
<li>Any <code>default-autowire-candidates</code> patterns available on the <code>&lt;beans/&gt;</code> element</li>
<li>The presence of <code>@Qualifier</code> annotations and any custom annotations registered with the <code>CustomAutowireConfigurer</code></li>
</ul>
<p>When multiple beans qualify as autowire candidates, the determination of a “primary” is as follows: If exactly one bean definition among the candidates has a <code>primary</code> attribute set to <code>true</code>, it is selected.</p>
<h4 id="1-9-7-Injection-with-Resource"><a href="#1-9-7-Injection-with-Resource" class="headerlink" title="1.9.7. Injection with @Resource"></a>1.9.7. Injection with <code>@Resource</code></h4><p>Spring also supports injection by using the JSR-250 <code>@Resource</code> annotation (<code>javax.annotation.Resource</code>) on fields or bean property setter methods. This is a common pattern in Java EE: for example, in JSF-managed beans and JAX-WS endpoints. Spring supports this pattern for Spring-managed objects as well.</p>
<p><code>@Resource</code> takes a name attribute. By default, Spring interprets that value as the bean name to be injected. In other words, it follows by-name semantics, as demonstrated in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name=&quot;myMovieFinder&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This line injects a <code>@Resource</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>If no name is explicitly specified, the default name is derived from the field name or setter method. In case of a field, it takes the field name. In case of a setter method, it takes the bean property name. The following example is going to have the bean named <code>movieFinder</code> injected into its setter method:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The name provided with the annotation is resolved as a bean name by the <code>ApplicationContext</code> of which the <code>CommonAnnotationBeanPostProcessor</code> is aware. The names can be resolved through JNDI if you configure Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/jndi/support/SimpleJndiBeanFactory.html"><code>SimpleJndiBeanFactory</code></a> explicitly. However, we recommend that you rely on the default behavior and use Spring’s JNDI lookup capabilities to preserve the level of indirection.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In the exclusive case of <code>@Resource</code> usage with no explicit name specified, and similar to <code>@Autowired</code>, <code>@Resource</code> finds a primary type match instead of a specific named bean and resolves well known resolvable dependencies: the <code>BeanFactory</code>, <code>ApplicationContext</code>, <code>ResourceLoader</code>, <code>ApplicationEventPublisher</code>, and <code>MessageSource</code> interfaces.</p>
<p>Thus, in the following example, the <code>customerPreferenceDao</code> field first looks for a bean named “customerPreferenceDao” and then falls back to a primary type match for the type <code>CustomerPreferenceDao</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>context</code> field is injected based on the known resolvable dependency type: <code>ApplicationContext</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-9-8-Using-Value"><a href="#1-9-8-Using-Value" class="headerlink" title="1.9.8. Using @Value"></a>1.9.8. Using <code>@Value</code></h4><p><code>@Value</code> is typically used to inject externalized properties:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(<span class="meta">@Value(&quot;$&#123;catalog.name&#125;&quot;)</span> String catalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With the following configuration:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>And the following <code>application.properties</code> file:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catalog.name=MovieCatalog</span><br></pre></td></tr></table></figure>

<p>In that case, the <code>catalog</code> parameter and field will be equal to the <code>MovieCatalog</code> value.</p>
<p>A default lenient embedded value resolver is provided by Spring. It will try to resolve the property value and if it cannot be resolved, the property name (for example <code>$&#123;catalog.name&#125;</code>) will be injected as the value. If you want to maintain strict control over nonexistent values, you should declare a <code>PropertySourcesPlaceholderConfigurer</code> bean, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title function_">propertyPlaceholderConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertySourcesPlaceholderConfigurer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>When configuring a <code>PropertySourcesPlaceholderConfigurer</code> using JavaConfig, the <code>@Bean</code> method must be <code>static</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Using the above configuration ensures Spring initialization failure if any <code>$&#123;&#125;</code> placeholder could not be resolved. It is also possible to use methods like <code>setPlaceholderPrefix</code>, <code>setPlaceholderSuffix</code>, or <code>setValueSeparator</code> to customize placeholders.</p>
<table>
<thead>
<tr>
<th></th>
<th>Spring Boot configures by default a <code>PropertySourcesPlaceholderConfigurer</code> bean that will get properties from <code>application.properties</code> and <code>application.yml</code> files.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Built-in converter support provided by Spring allows simple type conversion (to <code>Integer</code> or <code>int</code> for example) to be automatically handled. Multiple comma-separated values can be automatically converted to <code>String</code> array without extra effort.</p>
<p>It is possible to provide a default value as following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(<span class="meta">@Value(&quot;$&#123;catalog.name:defaultCatalog&#125;&quot;)</span> String catalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A Spring <code>BeanPostProcessor</code> uses a <code>ConversionService</code> behind the scenes to handle the process for converting the <code>String</code> value in <code>@Value</code> to the target type. If you want to provide conversion support for your own custom type, you can provide your own <code>ConversionService</code> bean instance as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConversionService <span class="title function_">conversionService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultFormattingConversionService</span> <span class="variable">conversionService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFormattingConversionService</span>();</span><br><span class="line">        conversionService.addConverter(<span class="keyword">new</span> <span class="title class_">MyCustomConverter</span>());</span><br><span class="line">        <span class="keyword">return</span> conversionService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When <code>@Value</code> contains a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions"><code>SpEL</code> expression</a> the value will be dynamically computed at runtime as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(<span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;user.catalog&#x27;] + &#x27;Catalog&#x27; &#125;&quot;)</span> String catalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpEL also enables the use of more complex data structures:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Integer&gt; countOfMoviesPerCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;#&#123;&#123;&#x27;Thriller&#x27;: 100, &#x27;Comedy&#x27;: 300&#125;&#125;&quot;)</span> Map&lt;String, Integer&gt; countOfMoviesPerCatalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.countOfMoviesPerCatalog = countOfMoviesPerCatalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-9-9-Using-PostConstruct-and-PreDestroy"><a href="#1-9-9-Using-PostConstruct-and-PreDestroy" class="headerlink" title="1.9.9. Using @PostConstruct and @PreDestroy"></a>1.9.9. Using <code>@PostConstruct</code> and <code>@PreDestroy</code></h4><p>The <code>CommonAnnotationBeanPostProcessor</code> not only recognizes the <code>@Resource</code> annotation but also the JSR-250 lifecycle annotations: <code>javax.annotation.PostConstruct</code> and <code>javax.annotation.PreDestroy</code>. Introduced in Spring 2.5, the support for these annotations offers an alternative to the lifecycle callback mechanism described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-initializingbean">initialization callbacks</a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-disposablebean">destruction callbacks</a>. Provided that the <code>CommonAnnotationBeanPostProcessor</code> is registered within the Spring <code>ApplicationContext</code>, a method carrying one of these annotations is invoked at the same point in the lifecycle as the corresponding Spring lifecycle interface method or explicitly declared callback method. In the following example, the cache is pre-populated upon initialization and cleared upon destruction:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachingMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">populateMovieCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// populates the movie cache upon initialization...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearMovieCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// clears the movie cache upon destruction...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For details about the effects of combining various lifecycle mechanisms, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-combined-effects">Combining Lifecycle Mechanisms</a>.</p>
<table>
<thead>
<tr>
<th></th>
<th>Like <code>@Resource</code>, the <code>@PostConstruct</code> and <code>@PreDestroy</code> annotation types were a part of the standard Java libraries from JDK 6 to 8. However, the entire <code>javax.annotation</code> package got separated from the core Java modules in JDK 9 and eventually removed in JDK 11. If needed, the <code>javax.annotation-api</code> artifact needs to be obtained via Maven Central now, simply to be added to the application’s classpath like any other library.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-10-Classpath-Scanning-and-Managed-Components"><a href="#1-10-Classpath-Scanning-and-Managed-Components" class="headerlink" title="1.10. Classpath Scanning and Managed Components"></a>1.10. Classpath Scanning and Managed Components</h3><p>Most examples in this chapter use XML to specify the configuration metadata that produces each <code>BeanDefinition</code> within the Spring container. The previous section (<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config">Annotation-based Container Configuration</a>) demonstrates how to provide a lot of the configuration metadata through source-level annotations. Even in those examples, however, the “base” bean definitions are explicitly defined in the XML file, while the annotations drive only the dependency injection. This section describes an option for implicitly detecting the candidate components by scanning the classpath. Candidate components are classes that match against a filter criteria and have a corresponding bean definition registered with the container. This removes the need to use XML to perform bean registration. Instead, you can use annotations (for example, <code>@Component</code>), AspectJ type expressions, or your own custom filter criteria to select which classes have bean definitions registered with the container.</p>
<table>
<thead>
<tr>
<th></th>
<th>Starting with Spring 3.0, many features provided by the Spring JavaConfig project are part of the core Spring Framework. This allows you to define beans using Java rather than using the traditional XML files. Take a look at the <code>@Configuration</code>, <code>@Bean</code>, <code>@Import</code>, and <code>@DependsOn</code> annotations for examples of how to use these new features.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-10-1-Component-and-Further-Stereotype-Annotations"><a href="#1-10-1-Component-and-Further-Stereotype-Annotations" class="headerlink" title="1.10.1. @Component and Further Stereotype Annotations"></a>1.10.1. <code>@Component</code> and Further Stereotype Annotations</h4><p>The <code>@Repository</code> annotation is a marker for any class that fulfills the role or stereotype of a repository (also known as Data Access Object or DAO). Among the uses of this marker is the automatic translation of exceptions, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#orm-exception-translation">Exception Translation</a>.</p>
<p>Spring provides further stereotype annotations: <code>@Component</code>, <code>@Service</code>, and <code>@Controller</code>. <code>@Component</code> is a generic stereotype for any Spring-managed component. <code>@Repository</code>, <code>@Service</code>, and <code>@Controller</code> are specializations of <code>@Component</code> for more specific use cases (in the persistence, service, and presentation layers, respectively). Therefore, you can annotate your component classes with <code>@Component</code>, but, by annotating them with <code>@Repository</code>, <code>@Service</code>, or <code>@Controller</code> instead, your classes are more properly suited for processing by tools or associating with aspects. For example, these stereotype annotations make ideal targets for pointcuts. <code>@Repository</code>, <code>@Service</code>, and <code>@Controller</code> can also carry additional semantics in future releases of the Spring Framework. Thus, if you are choosing between using <code>@Component</code> or <code>@Service</code> for your service layer, <code>@Service</code> is clearly the better choice. Similarly, as stated earlier, <code>@Repository</code> is already supported as a marker for automatic exception translation in your persistence layer.</p>
<h4 id="1-10-2-Using-Meta-annotations-and-Composed-Annotations"><a href="#1-10-2-Using-Meta-annotations-and-Composed-Annotations" class="headerlink" title="1.10.2. Using Meta-annotations and Composed Annotations"></a>1.10.2. Using Meta-annotations and Composed Annotations</h4><p>Many of the annotations provided by Spring can be used as meta-annotations in your own code. A meta-annotation is an annotation that can be applied to another annotation. For example, the <code>@Service</code> annotation mentioned <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-stereotype-annotations">earlier</a> is meta-annotated with <code>@Component</code>, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Service &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>@Component</code> causes <code>@Service</code> to be treated in the same way as <code>@Component</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can also combine meta-annotations to create “composed annotations”. For example, the <code>@RestController</code> annotation from Spring MVC is composed of <code>@Controller</code> and <code>@ResponseBody</code>.</p>
<p>In addition, composed annotations can optionally redeclare attributes from meta-annotations to allow customization. This can be particularly useful when you want to only expose a subset of the meta-annotation’s attributes. For example, Spring’s <code>@SessionScope</code> annotation hardcodes the scope name to <code>session</code> but still allows customization of the <code>proxyMode</code>. The following listing shows the definition of the <code>SessionScope</code> annotation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Scope(WebApplicationContext.SCOPE_SESSION)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SessionScope &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Alias for &#123;<span class="doctag">@link</span> Scope#proxyMode&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Defaults to &#123;<span class="doctag">@link</span> ScopedProxyMode#TARGET_CLASS&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AliasFor(annotation = Scope.class)</span></span><br><span class="line">    ScopedProxyMode <span class="title function_">proxyMode</span><span class="params">()</span> <span class="keyword">default</span> ScopedProxyMode.TARGET_CLASS;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can then use <code>@SessionScope</code> without declaring the <code>proxyMode</code> as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@SessionScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionScopedService</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also override the value for the <code>proxyMode</code>, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@SessionScope(proxyMode = ScopedProxyMode.INTERFACES)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionScopedUserService</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For further details, see the <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/wiki/Spring-Annotation-Programming-Model">Spring Annotation Programming Model</a> wiki page.</p>
<h4 id="1-10-3-Automatically-Detecting-Classes-and-Registering-Bean-Definitions"><a href="#1-10-3-Automatically-Detecting-Classes-and-Registering-Bean-Definitions" class="headerlink" title="1.10.3. Automatically Detecting Classes and Registering Bean Definitions"></a>1.10.3. Automatically Detecting Classes and Registering Bean Definitions</h4><p>Spring can automatically detect stereotyped classes and register corresponding <code>BeanDefinition</code> instances with the <code>ApplicationContext</code>. For example, the following two classes are eligible for such autodetection:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleMovieLister</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaMovieFinder</span> <span class="keyword">implements</span> <span class="title class_">MovieFinder</span> &#123;</span><br><span class="line">    <span class="comment">// implementation elided for clarity</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To autodetect these classes and register the corresponding beans, you need to add <code>@ComponentScan</code> to your <code>@Configuration</code> class, where the <code>basePackages</code> attribute is a common parent package for the two classes. (Alternatively, you can specify a comma- or semicolon- or space-separated list that includes the parent package of each class.)</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span>  &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>For brevity, the preceding example could have used the <code>value</code> attribute of the annotation (that is, <code>@ComponentScan(&quot;org.example&quot;)</code>).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following alternative uses XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The use of <code>&lt;context:component-scan&gt;</code> implicitly enables the functionality of <code>&lt;context:annotation-config&gt;</code>. There is usually no need to include the <code>&lt;context:annotation-config&gt;</code> element when using <code>&lt;context:component-scan&gt;</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>The scanning of classpath packages requires the presence of corresponding directory entries in the classpath. When you build JARs with Ant, make sure that you do not activate the files-only switch of the JAR task. Also, classpath directories may not be exposed based on security policies in some environments — for example, standalone apps on JDK 1.7.0_45 and higher (which requires ‘Trusted-Library’ setup in your manifests — see <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources).On">https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources).On</a> JDK 9’s module path (Jigsaw), Spring’s classpath scanning generally works as expected. However, make sure that your component classes are exported in your <code>module-info</code> descriptors. If you expect Spring to invoke non-public members of your classes, make sure that they are ‘opened’ (that is, that they use an <code>opens</code> declaration instead of an <code>exports</code> declaration in your <code>module-info</code> descriptor).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Furthermore, the <code>AutowiredAnnotationBeanPostProcessor</code> and <code>CommonAnnotationBeanPostProcessor</code> are both implicitly included when you use the component-scan element. That means that the two components are autodetected and wired together — all without any bean configuration metadata provided in XML.</p>
<table>
<thead>
<tr>
<th></th>
<th>You can disable the registration of <code>AutowiredAnnotationBeanPostProcessor</code> and <code>CommonAnnotationBeanPostProcessor</code> by including the <code>annotation-config</code> attribute with a value of <code>false</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-10-4-Using-Filters-to-Customize-Scanning"><a href="#1-10-4-Using-Filters-to-Customize-Scanning" class="headerlink" title="1.10.4. Using Filters to Customize Scanning"></a>1.10.4. Using Filters to Customize Scanning</h4><p>By default, classes annotated with <code>@Component</code>, <code>@Repository</code>, <code>@Service</code>, <code>@Controller</code>, <code>@Configuration</code>, or a custom annotation that itself is annotated with <code>@Component</code> are the only detected candidate components. However, you can modify and extend this behavior by applying custom filters. Add them as <code>includeFilters</code> or <code>excludeFilters</code> attributes of the <code>@ComponentScan</code> annotation (or as <code>&lt;context:include-filter /&gt;</code> or <code>&lt;context:exclude-filter /&gt;</code> child elements of the <code>&lt;context:component-scan&gt;</code> element in XML configuration). Each filter element requires the <code>type</code> and <code>expression</code> attributes. The following table describes the filtering options:</p>
<table>
<thead>
<tr>
<th align="left">Filter Type</th>
<th align="left">Example Expression</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">annotation (default)</td>
<td align="left"><code>org.example.SomeAnnotation</code></td>
<td align="left">An annotation to be <em>present</em> or <em>meta-present</em> at the type level in target components.</td>
</tr>
<tr>
<td align="left">assignable</td>
<td align="left"><code>org.example.SomeClass</code></td>
<td align="left">A class (or interface) that the target components are assignable to (extend or implement).</td>
</tr>
<tr>
<td align="left">aspectj</td>
<td align="left"><code>org.example..*Service+</code></td>
<td align="left">An AspectJ type expression to be matched by the target components.</td>
</tr>
<tr>
<td align="left">regex</td>
<td align="left"><code>org\.example\.Default.*</code></td>
<td align="left">A regex expression to be matched by the target components’ class names.</td>
</tr>
<tr>
<td align="left">custom</td>
<td align="left"><code>org.example.MyTypeFilter</code></td>
<td align="left">A custom implementation of the <code>org.springframework.core.type.TypeFilter</code> interface.</td>
</tr>
</tbody></table>
<p>The following example shows the configuration ignoring all <code>@Repository</code> annotations and using “stub” repositories instead:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;,</span></span><br><span class="line"><span class="meta">        includeFilters = @Filter(type = FilterType.REGEX, pattern = &quot;.*Stub.*Repository&quot;),</span></span><br><span class="line"><span class="meta">        excludeFilters = @Filter(Repository.class))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following listing shows the equivalent XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;regex&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">expression</span>=<span class="string">&quot;.*Stub.*Repository&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can also disable the default filters by setting <code>useDefaultFilters=false</code> on the annotation or by providing <code>use-default-filters=&quot;false&quot;</code> as an attribute of the <code>&lt;component-scan/&gt;</code> element. This effectively disables automatic detection of classes annotated or meta-annotated with <code>@Component</code>, <code>@Repository</code>, <code>@Service</code>, <code>@Controller</code>, <code>@RestController</code>, or <code>@Configuration</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-10-5-Defining-Bean-Metadata-within-Components"><a href="#1-10-5-Defining-Bean-Metadata-within-Components" class="headerlink" title="1.10.5. Defining Bean Metadata within Components"></a>1.10.5. Defining Bean Metadata within Components</h4><p>Spring components can also contribute bean definition metadata to the container. You can do this with the same <code>@Bean</code> annotation used to define bean metadata within <code>@Configuration</code> annotated classes. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryMethodComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;public&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TestBean <span class="title function_">publicInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>(<span class="string">&quot;publicInstance&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doWork</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Component method implementation omitted</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding class is a Spring component that has application-specific code in its <code>doWork()</code> method. However, it also contributes a bean definition that has a factory method referring to the method <code>publicInstance()</code>. The <code>@Bean</code> annotation identifies the factory method and other bean definition properties, such as a qualifier value through the <code>@Qualifier</code> annotation. Other method-level annotations that can be specified are <code>@Scope</code>, <code>@Lazy</code>, and custom qualifier annotations.</p>
<table>
<thead>
<tr>
<th></th>
<th>In addition to its role for component initialization, you can also place the <code>@Lazy</code> annotation on injection points marked with <code>@Autowired</code> or <code>@Inject</code>. In this context, it leads to the injection of a lazy-resolution proxy. However, such a proxy approach is rather limited. For sophisticated lazy interactions, in particular in combination with optional dependencies, we recommend <code>ObjectProvider&lt;MyTargetBean&gt;</code> instead.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Autowired fields and methods are supported, as previously discussed, with additional support for autowiring of <code>@Bean</code> methods. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryMethodComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;public&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TestBean <span class="title function_">publicInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>(<span class="string">&quot;publicInstance&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use of a custom qualifier and autowiring of method parameters</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">protected</span> TestBean <span class="title function_">protectedInstance</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;public&quot;)</span> TestBean spouse,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;#&#123;privateInstance.age&#125;&quot;)</span> String country)</span> &#123;</span><br><span class="line">        <span class="type">TestBean</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>(<span class="string">&quot;protectedInstance&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        tb.setSpouse(spouse);</span><br><span class="line">        tb.setCountry(country);</span><br><span class="line">        <span class="keyword">return</span> tb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">private</span> TestBean <span class="title function_">privateInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>(<span class="string">&quot;privateInstance&quot;</span>, i++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@RequestScope</span></span><br><span class="line">    <span class="keyword">public</span> TestBean <span class="title function_">requestScopedInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>(<span class="string">&quot;requestScopedInstance&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The example autowires the <code>String</code> method parameter <code>country</code> to the value of the <code>age</code> property on another bean named <code>privateInstance</code>. A Spring Expression Language element defines the value of the property through the notation <code>#&#123; &lt;expression&gt; &#125;</code>. For <code>@Value</code> annotations, an expression resolver is preconfigured to look for bean names when resolving expression text.</p>
<p>As of Spring Framework 4.3, you may also declare a factory method parameter of type <code>InjectionPoint</code> (or its more specific subclass: <code>DependencyDescriptor</code>) to access the requesting injection point that triggers the creation of the current bean. Note that this applies only to the actual creation of bean instances, not to the injection of existing instances. As a consequence, this feature makes most sense for beans of prototype scope. For other scopes, the factory method only ever sees the injection point that triggered the creation of a new bean instance in the given scope (for example, the dependency that triggered the creation of a lazy singleton bean). You can use the provided injection point metadata with semantic care in such scenarios. The following example shows how to use <code>InjectionPoint</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryMethodComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TestBean <span class="title function_">prototypeInstance</span><span class="params">(InjectionPoint injectionPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>(<span class="string">&quot;prototypeInstance for &quot;</span> + injectionPoint.getMember());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>@Bean</code> methods in a regular Spring component are processed differently than their counterparts inside a Spring <code>@Configuration</code> class. The difference is that <code>@Component</code> classes are not enhanced with CGLIB to intercept the invocation of methods and fields. CGLIB proxying is the means by which invoking methods or fields within <code>@Bean</code> methods in <code>@Configuration</code> classes creates bean metadata references to collaborating objects. Such methods are not invoked with normal Java semantics but rather go through the container in order to provide the usual lifecycle management and proxying of Spring beans, even when referring to other beans through programmatic calls to <code>@Bean</code> methods. In contrast, invoking a method or field in a <code>@Bean</code> method within a plain <code>@Component</code> class has standard Java semantics, with no special CGLIB processing or other constraints applying.</p>
<table>
<thead>
<tr>
<th></th>
<th>You may declare <code>@Bean</code> methods as <code>static</code>, allowing for them to be called without creating their containing configuration class as an instance. This makes particular sense when defining post-processor beans (for example, of type <code>BeanFactoryPostProcessor</code> or <code>BeanPostProcessor</code>), since such beans get initialized early in the container lifecycle and should avoid triggering other parts of the configuration at that point.Calls to static <code>@Bean</code> methods never get intercepted by the container, not even within <code>@Configuration</code> classes (as described earlier in this section), due to technical limitations: CGLIB subclassing can override only non-static methods. As a consequence, a direct call to another <code>@Bean</code> method has standard Java semantics, resulting in an independent instance being returned straight from the factory method itself.The Java language visibility of <code>@Bean</code> methods does not have an immediate impact on the resulting bean definition in Spring’s container. You can freely declare your factory methods as you see fit in non-<code>@Configuration</code> classes and also for static methods anywhere. However, regular <code>@Bean</code> methods in <code>@Configuration</code> classes need to be overridable — that is, they must not be declared as <code>private</code> or <code>final</code>.<code>@Bean</code> methods are also discovered on base classes of a given component or configuration class, as well as on Java 8 default methods declared in interfaces implemented by the component or configuration class. This allows for a lot of flexibility in composing complex configuration arrangements, with even multiple inheritance being possible through Java 8 default methods as of Spring 4.2.Finally, a single class may hold multiple <code>@Bean</code> methods for the same bean, as an arrangement of multiple factory methods to use depending on available dependencies at runtime. This is the same algorithm as for choosing the “greediest” constructor or factory method in other configuration scenarios: The variant with the largest number of satisfiable dependencies is picked at construction time, analogous to how the container selects between multiple <code>@Autowired</code> constructors.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-10-6-Naming-Autodetected-Components"><a href="#1-10-6-Naming-Autodetected-Components" class="headerlink" title="1.10.6. Naming Autodetected Components"></a>1.10.6. Naming Autodetected Components</h4><p>When a component is autodetected as part of the scanning process, its bean name is generated by the <code>BeanNameGenerator</code> strategy known to that scanner. By default, any Spring stereotype annotation (<code>@Component</code>, <code>@Repository</code>, <code>@Service</code>, and <code>@Controller</code>) that contains a name <code>value</code> thereby provides that name to the corresponding bean definition.</p>
<p>If such an annotation contains no name <code>value</code> or for any other detected component (such as those discovered by custom filters), the default bean name generator returns the uncapitalized non-qualified class name. For example, if the following component classes were detected, the names would be <code>myMovieLister</code> and <code>movieFinderImpl</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;myMovieLister&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieFinderImpl</span> <span class="keyword">implements</span> <span class="title class_">MovieFinder</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you do not want to rely on the default bean-naming strategy, you can provide a custom bean-naming strategy. First, implement the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/support/BeanNameGenerator.html"><code>BeanNameGenerator</code></a> interface, and be sure to include a default no-arg constructor. Then, provide the fully qualified class name when configuring the scanner, as the following example annotation and bean definition show.</p>
<table>
<thead>
<tr>
<th></th>
<th>If you run into naming conflicts due to multiple autodetected components having the same non-qualified class name (i.e., classes with identical names but residing in different packages), you may need to configure a <code>BeanNameGenerator</code> that defaults to the fully qualified class name for the generated bean name. As of Spring Framework 5.2.3, the <code>FullyQualifiedAnnotationBeanNameGenerator</code> located in package <code>org.springframework.context.annotation</code> can be used for such purposes.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;, nameGenerator = MyNameGenerator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;org.example&quot;</span></span><br><span class="line">        name-generator=<span class="string">&quot;org.example.MyNameGenerator&quot;</span> /&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>As a general rule, consider specifying the name with the annotation whenever other components may be making explicit references to it. On the other hand, the auto-generated names are adequate whenever the container is responsible for wiring.</p>
<h4 id="1-10-7-Providing-a-Scope-for-Autodetected-Components"><a href="#1-10-7-Providing-a-Scope-for-Autodetected-Components" class="headerlink" title="1.10.7. Providing a Scope for Autodetected Components"></a>1.10.7. Providing a Scope for Autodetected Components</h4><p>As with Spring-managed components in general, the default and most common scope for autodetected components is <code>singleton</code>. However, sometimes you need a different scope that can be specified by the <code>@Scope</code> annotation. You can provide the name of the scope within the annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieFinderImpl</span> <span class="keyword">implements</span> <span class="title class_">MovieFinder</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>@Scope</code> annotations are only introspected on the concrete bean class (for annotated components) or the factory method (for <code>@Bean</code> methods). In contrast to XML bean definitions, there is no notion of bean definition inheritance, and inheritance hierarchies at the class level are irrelevant for metadata purposes.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>For details on web-specific scopes such as “request” or “session” in a Spring context, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-other">Request, Session, Application, and WebSocket Scopes</a>. As with the pre-built annotations for those scopes, you may also compose your own scoping annotations by using Spring’s meta-annotation approach: for example, a custom annotation meta-annotated with <code>@Scope(&quot;prototype&quot;)</code>, possibly also declaring a custom scoped-proxy mode.</p>
<table>
<thead>
<tr>
<th></th>
<th>To provide a custom strategy for scope resolution rather than relying on the annotation-based approach, you can implement the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/ScopeMetadataResolver.html"><code>ScopeMetadataResolver</code></a> interface. Be sure to include a default no-arg constructor. Then you can provide the fully qualified class name when configuring the scanner, as the following example of both an annotation and a bean definition shows:</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;, scopeResolver = MyScopeResolver.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;org.example&quot;</span> scope-resolver=<span class="string">&quot;org.example.MyScopeResolver&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>When using certain non-singleton scopes, it may be necessary to generate proxies for the scoped objects. The reasoning is described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-other-injection">Scoped Beans as Dependencies</a>. For this purpose, a scoped-proxy attribute is available on the component-scan element. The three possible values are: <code>no</code>, <code>interfaces</code>, and <code>targetClass</code>. For example, the following configuration results in standard JDK dynamic proxies:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;, scopedProxy = ScopedProxyMode.INTERFACES)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;org.example&quot;</span> scoped-proxy=<span class="string">&quot;interfaces&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-10-8-Providing-Qualifier-Metadata-with-Annotations"><a href="#1-10-8-Providing-Qualifier-Metadata-with-Annotations" class="headerlink" title="1.10.8. Providing Qualifier Metadata with Annotations"></a>1.10.8. Providing Qualifier Metadata with Annotations</h4><p>The <code>@Qualifier</code> annotation is discussed in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation-qualifiers">Fine-tuning Annotation-based Autowiring with Qualifiers</a>. The examples in that section demonstrate the use of the <code>@Qualifier</code> annotation and custom qualifier annotations to provide fine-grained control when you resolve autowire candidates. Because those examples were based on XML bean definitions, the qualifier metadata was provided on the candidate bean definitions by using the <code>qualifier</code> or <code>meta</code> child elements of the <code>bean</code> element in the XML. When relying upon classpath scanning for auto-detection of components, you can provide the qualifier metadata with type-level annotations on the candidate class. The following three examples demonstrate this technique:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;Action&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActionMovieCatalog</span> <span class="keyword">implements</span> <span class="title class_">MovieCatalog</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Genre(&quot;Action&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActionMovieCatalog</span> <span class="keyword">implements</span> <span class="title class_">MovieCatalog</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Offline</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachingMovieCatalog</span> <span class="keyword">implements</span> <span class="title class_">MovieCatalog</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>As with most annotation-based alternatives, keep in mind that the annotation metadata is bound to the class definition itself, while the use of XML allows for multiple beans of the same type to provide variations in their qualifier metadata, because that metadata is provided per-instance rather than per-class.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-10-9-Generating-an-Index-of-Candidate-Components"><a href="#1-10-9-Generating-an-Index-of-Candidate-Components" class="headerlink" title="1.10.9. Generating an Index of Candidate Components"></a>1.10.9. Generating an Index of Candidate Components</h4><p>While classpath scanning is very fast, it is possible to improve the startup performance of large applications by creating a static list of candidates at compilation time. In this mode, all modules that are targets of component scanning must use this mechanism.</p>
<table>
<thead>
<tr>
<th></th>
<th>Your existing <code>@ComponentScan</code> or <code>&lt;context:component-scan/&gt;</code> directives must remain unchanged to request the context to scan candidates in certain packages. When the <code>ApplicationContext</code> detects such an index, it automatically uses it rather than scanning the classpath.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>To generate the index, add an additional dependency to each module that contains components that are targets for component scan directives. The following example shows how to do so with Maven:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-indexer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>With Gradle 4.5 and earlier, the dependency should be declared in the <code>compileOnly</code> configuration, as shown in the following example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly <span class="string">&quot;org.springframework:spring-context-indexer:5.3.22&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With Gradle 4.6 and later, the dependency should be declared in the <code>annotationProcessor</code> configuration, as shown in the following example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    annotationProcessor <span class="string">&quot;org.springframework:spring-context-indexer:5.3.22&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>spring-context-indexer</code> artifact generates a <code>META-INF/spring.components</code> file that is included in the jar file.</p>
<table>
<thead>
<tr>
<th></th>
<th>When working with this mode in your IDE, the <code>spring-context-indexer</code> must be registered as an annotation processor to make sure the index is up-to-date when candidate components are updated.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>The index is enabled automatically when a <code>META-INF/spring.components</code> file is found on the classpath. If an index is partially available for some libraries (or use cases) but could not be built for the whole application, you can fall back to a regular classpath arrangement (as though no index were present at all) by setting <code>spring.index.ignore</code> to <code>true</code>, either as a JVM system property or via the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/appendix.html#appendix-spring-properties"><code>SpringProperties</code></a> mechanism.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-11-Using-JSR-330-Standard-Annotations"><a href="#1-11-Using-JSR-330-Standard-Annotations" class="headerlink" title="1.11. Using JSR 330 Standard Annotations"></a>1.11. Using JSR 330 Standard Annotations</h3><p>Starting with Spring 3.0, Spring offers support for JSR-330 standard annotations (Dependency Injection). Those annotations are scanned in the same way as the Spring annotations. To use them, you need to have the relevant jars in your classpath.</p>
<table>
<thead>
<tr>
<th></th>
<th>If you use Maven, the <code>javax.inject</code> artifact is available in the standard Maven repository ( <a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/javax/inject/javax.inject/1/">https://repo1.maven.org/maven2/javax/inject/javax.inject/1/</a>). You can add the following dependency to your file pom.xml:<code>&lt;dependency&gt;    &lt;groupId&gt;javax.inject&lt;/groupId&gt;    &lt;artifactId&gt;javax.inject&lt;/artifactId&gt;    &lt;version&gt;1&lt;/version&gt; &lt;/dependency&gt;</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-11-1-Dependency-Injection-with-Inject-and-Named"><a href="#1-11-1-Dependency-Injection-with-Inject-and-Named" class="headerlink" title="1.11.1. Dependency Injection with @Inject and @Named"></a>1.11.1. Dependency Injection with <code>@Inject</code> and <code>@Named</code></h4><p>Instead of <code>@Autowired</code>, you can use <code>@javax.inject.Inject</code> as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listMovies</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder.findMovies(...);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As with <code>@Autowired</code>, you can use <code>@Inject</code> at the field level, method level and constructor-argument level. Furthermore, you may declare your injection point as a <code>Provider</code>, allowing for on-demand access to beans of shorter scopes or lazy access to other beans through a <code>Provider.get()</code> call. The following example offers a variant of the preceding example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"><span class="keyword">import</span> javax.inject.Provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Provider&lt;MovieFinder&gt; movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(Provider&lt;MovieFinder&gt; movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listMovies</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder.get().findMovies(...);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you would like to use a qualified name for the dependency that should be injected, you should use the <code>@Named</code> annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"><span class="keyword">import</span> javax.inject.Named;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(<span class="meta">@Named(&quot;main&quot;)</span> MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As with <code>@Autowired</code>, <code>@Inject</code> can also be used with <code>java.util.Optional</code> or <code>@Nullable</code>. This is even more applicable here, since <code>@Inject</code> does not have a <code>required</code> attribute. The following pair of examples show how to use <code>@Inject</code> and <code>@Nullable</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(Optional&lt;MovieFinder&gt; movieFinder)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(<span class="meta">@Nullable</span> MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-11-2-Named-and-ManagedBean-Standard-Equivalents-to-the-Component-Annotation"><a href="#1-11-2-Named-and-ManagedBean-Standard-Equivalents-to-the-Component-Annotation" class="headerlink" title="1.11.2. @Named and @ManagedBean: Standard Equivalents to the @Component Annotation"></a>1.11.2. <code>@Named</code> and <code>@ManagedBean</code>: Standard Equivalents to the <code>@Component</code> Annotation</h4><p>Instead of <code>@Component</code>, you can use <code>@javax.inject.Named</code> or <code>javax.annotation.ManagedBean</code>, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"><span class="keyword">import</span> javax.inject.Named;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Named(&quot;movieListener&quot;)</span>  <span class="comment">// @ManagedBean(&quot;movieListener&quot;) could be used as well</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It is very common to use <code>@Component</code> without specifying a name for the component. <code>@Named</code> can be used in a similar fashion, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"><span class="keyword">import</span> javax.inject.Named;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Named</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When you use <code>@Named</code> or <code>@ManagedBean</code>, you can use component scanning in the exact same way as when you use Spring annotations, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span>  &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>In contrast to <code>@Component</code>, the JSR-330 <code>@Named</code> and the JSR-250 <code>@ManagedBean</code> annotations are not composable. You should use Spring’s stereotype model for building custom component annotations.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-11-3-Limitations-of-JSR-330-Standard-Annotations"><a href="#1-11-3-Limitations-of-JSR-330-Standard-Annotations" class="headerlink" title="1.11.3. Limitations of JSR-330 Standard Annotations"></a>1.11.3. Limitations of JSR-330 Standard Annotations</h4><p>When you work with standard annotations, you should know that some significant features are not available, as the following table shows:</p>
<table>
<thead>
<tr>
<th align="left">Spring</th>
<th align="left">javax.inject.*</th>
<th align="left">javax.inject restrictions &#x2F; comments</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Autowired</td>
<td align="left">@Inject</td>
<td align="left"><code>@Inject</code> has no ‘required’ attribute. Can be used with Java 8’s <code>Optional</code> instead.</td>
</tr>
<tr>
<td align="left">@Component</td>
<td align="left">@Named &#x2F; @ManagedBean</td>
<td align="left">JSR-330 does not provide a composable model, only a way to identify named components.</td>
</tr>
<tr>
<td align="left">@Scope(“singleton”)</td>
<td align="left">@Singleton</td>
<td align="left">The JSR-330 default scope is like Spring’s <code>prototype</code>. However, in order to keep it consistent with Spring’s general defaults, a JSR-330 bean declared in the Spring container is a <code>singleton</code> by default. In order to use a scope other than <code>singleton</code>, you should use Spring’s <code>@Scope</code> annotation. <code>javax.inject</code> also provides a <a target="_blank" rel="noopener" href="https://download.oracle.com/javaee/6/api/javax/inject/Scope.html">@Scope</a> annotation. Nevertheless, this one is only intended to be used for creating your own annotations.</td>
</tr>
<tr>
<td align="left">@Qualifier</td>
<td align="left">@Qualifier &#x2F; @Named</td>
<td align="left"><code>javax.inject.Qualifier</code> is just a meta-annotation for building custom qualifiers. Concrete <code>String</code> qualifiers (like Spring’s <code>@Qualifier</code> with a value) can be associated through <code>javax.inject.Named</code>.</td>
</tr>
<tr>
<td align="left">@Value</td>
<td align="left">-</td>
<td align="left">no equivalent</td>
</tr>
<tr>
<td align="left">@Required</td>
<td align="left">-</td>
<td align="left">no equivalent</td>
</tr>
<tr>
<td align="left">@Lazy</td>
<td align="left">-</td>
<td align="left">no equivalent</td>
</tr>
<tr>
<td align="left">ObjectFactory</td>
<td align="left">Provider</td>
<td align="left"><code>javax.inject.Provider</code> is a direct alternative to Spring’s <code>ObjectFactory</code>, only with a shorter <code>get()</code> method name. It can also be used in combination with Spring’s <code>@Autowired</code> or with non-annotated constructors and setter methods.</td>
</tr>
</tbody></table>
<h3 id="1-12-Java-based-Container-Configuration"><a href="#1-12-Java-based-Container-Configuration" class="headerlink" title="1.12. Java-based Container Configuration"></a>1.12. Java-based Container Configuration</h3><p>This section covers how to use annotations in your Java code to configure the Spring container. It includes the following topics:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-basic-concepts">Basic Concepts: <code>@Bean</code> and <code>@Configuration</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-instantiating-container">Instantiating the Spring Container by Using <code>AnnotationConfigApplicationContext</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-bean-annotation">Using the <code>@Bean</code> Annotation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-configuration-annotation">Using the <code>@Configuration</code> annotation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-composing-configuration-classes">Composing Java-based Configurations</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-definition-profiles">Bean Definition Profiles</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-property-source-abstraction"><code>PropertySource</code> Abstraction</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-using-propertysource">Using <code>@PropertySource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-placeholder-resolution-in-statements">Placeholder Resolution in Statements</a></li>
</ul>
<h4 id="1-12-1-Basic-Concepts-Bean-and-Configuration"><a href="#1-12-1-Basic-Concepts-Bean-and-Configuration" class="headerlink" title="1.12.1. Basic Concepts: @Bean and @Configuration"></a>1.12.1. Basic Concepts: <code>@Bean</code> and <code>@Configuration</code></h4><p>The central artifacts in Spring’s new Java-configuration support are <code>@Configuration</code>-annotated classes and <code>@Bean</code>-annotated methods.</p>
<p>The <code>@Bean</code> annotation is used to indicate that a method instantiates, configures, and initializes a new object to be managed by the Spring IoC container. For those familiar with Spring’s <code>&lt;beans/&gt;</code> XML configuration, the <code>@Bean</code> annotation plays the same role as the <code>&lt;bean/&gt;</code> element. You can use <code>@Bean</code>-annotated methods with any Spring <code>@Component</code>. However, they are most often used with <code>@Configuration</code> beans.</p>
<p>Annotating a class with <code>@Configuration</code> indicates that its primary purpose is as a source of bean definitions. Furthermore, <code>@Configuration</code> classes let inter-bean dependencies be defined by calling other <code>@Bean</code> methods in the same class. The simplest possible <code>@Configuration</code> class reads as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding <code>AppConfig</code> class is equivalent to the following Spring <code>&lt;beans/&gt;</code> XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.acme.services.MyServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Full @Configuration vs “lite” @Bean mode?</p>
<p>When <code>@Bean</code> methods are declared within classes that are not annotated with <code>@Configuration</code>, they are referred to as being processed in a “lite” mode. Bean methods declared in a <code>@Component</code> or even in a plain old class are considered to be “lite”, with a different primary purpose of the containing class and a <code>@Bean</code> method being a sort of bonus there. For example, service components may expose management views to the container through an additional <code>@Bean</code> method on each applicable component class. In such scenarios, <code>@Bean</code> methods are a general-purpose factory method mechanism.</p>
<p>Unlike full <code>@Configuration</code>, lite <code>@Bean</code> methods cannot declare inter-bean dependencies. Instead, they operate on their containing component’s internal state and, optionally, on arguments that they may declare. Such a <code>@Bean</code> method should therefore not invoke other <code>@Bean</code> methods. Each such method is literally only a factory method for a particular bean reference, without any special runtime semantics. The positive side-effect here is that no CGLIB subclassing has to be applied at runtime, so there are no limitations in terms of class design (that is, the containing class may be <code>final</code> and so forth).</p>
<p>In common scenarios, <code>@Bean</code> methods are to be declared within <code>@Configuration</code> classes, ensuring that “full” mode is always used and that cross-method references therefore get redirected to the container’s lifecycle management. This prevents the same <code>@Bean</code> method from accidentally being invoked through a regular Java call, which helps to reduce subtle bugs that can be hard to track down when operating in “lite” mode.</p>
<p>The <code>@Bean</code> and <code>@Configuration</code> annotations are discussed in depth in the following sections. First, however, we cover the various ways of creating a spring container by using Java-based configuration.</p>
<h4 id="1-12-2-Instantiating-the-Spring-Container-by-Using-AnnotationConfigApplicationContext"><a href="#1-12-2-Instantiating-the-Spring-Container-by-Using-AnnotationConfigApplicationContext" class="headerlink" title="1.12.2. Instantiating the Spring Container by Using AnnotationConfigApplicationContext"></a>1.12.2. Instantiating the Spring Container by Using <code>AnnotationConfigApplicationContext</code></h4><p>The following sections document Spring’s <code>AnnotationConfigApplicationContext</code>, introduced in Spring 3.0. This versatile <code>ApplicationContext</code> implementation is capable of accepting not only <code>@Configuration</code> classes as input but also plain <code>@Component</code> classes and classes annotated with JSR-330 metadata.</p>
<p>When <code>@Configuration</code> classes are provided as input, the <code>@Configuration</code> class itself is registered as a bean definition and all declared <code>@Bean</code> methods within the class are also registered as bean definitions.</p>
<p>When <code>@Component</code> and JSR-330 classes are provided, they are registered as bean definitions, and it is assumed that DI metadata such as <code>@Autowired</code> or <code>@Inject</code> are used within those classes where necessary.</p>
<h5 id="Simple-Construction"><a href="#Simple-Construction" class="headerlink" title="Simple Construction"></a>Simple Construction</h5><p>In much the same way that Spring XML files are used as input when instantiating a <code>ClassPathXmlApplicationContext</code>, you can use <code>@Configuration</code> classes as input when instantiating an <code>AnnotationConfigApplicationContext</code>. This allows for completely XML-free usage of the Spring container, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);</span><br><span class="line">    <span class="type">MyService</span> <span class="variable">myService</span> <span class="operator">=</span> ctx.getBean(MyService.class);</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As mentioned earlier, <code>AnnotationConfigApplicationContext</code> is not limited to working only with <code>@Configuration</code> classes. Any <code>@Component</code> or JSR-330 annotated class may be supplied as input to the constructor, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MyServiceImpl.class, Dependency1.class, Dependency2.class);</span><br><span class="line">    <span class="type">MyService</span> <span class="variable">myService</span> <span class="operator">=</span> ctx.getBean(MyService.class);</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding example assumes that <code>MyServiceImpl</code>, <code>Dependency1</code>, and <code>Dependency2</code> use Spring dependency injection annotations such as <code>@Autowired</code>.</p>
<h5 id="Building-the-Container-Programmatically-by-Using-register-Class…"><a href="#Building-the-Container-Programmatically-by-Using-register-Class…" class="headerlink" title="Building the Container Programmatically by Using register(Class&lt;?&gt;…)"></a>Building the Container Programmatically by Using <code>register(Class&lt;?&gt;…)</code></h5><p>You can instantiate an <code>AnnotationConfigApplicationContext</code> by using a no-arg constructor and then configure it by using the <code>register()</code> method. This approach is particularly useful when programmatically building an <code>AnnotationConfigApplicationContext</code>. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">    ctx.register(AppConfig.class, OtherConfig.class);</span><br><span class="line">    ctx.register(AdditionalConfig.class);</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    <span class="type">MyService</span> <span class="variable">myService</span> <span class="operator">=</span> ctx.getBean(MyService.class);</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Enabling-Component-Scanning-with-scan-String…"><a href="#Enabling-Component-Scanning-with-scan-String…" class="headerlink" title="Enabling Component Scanning with scan(String…)"></a>Enabling Component Scanning with <code>scan(String…)</code></h5><p>To enable component scanning, you can annotate your <code>@Configuration</code> class as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.acme&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span>  &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This annotation enables component scanning.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>Experienced Spring users may be familiar with the XML declaration equivalent from Spring’s <code>context:</code> namespace, shown in the following example:<code>&lt;beans&gt;    &lt;context:component-scan base-package=&quot;com.acme&quot;/&gt; &lt;/beans&gt;</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In the preceding example, the <code>com.acme</code> package is scanned to look for any <code>@Component</code>-annotated classes, and those classes are registered as Spring bean definitions within the container. <code>AnnotationConfigApplicationContext</code> exposes the <code>scan(String…)</code> method to allow for the same component-scanning functionality, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">    ctx.scan(<span class="string">&quot;com.acme&quot;</span>);</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    <span class="type">MyService</span> <span class="variable">myService</span> <span class="operator">=</span> ctx.getBean(MyService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Remember that <code>@Configuration</code> classes are <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-meta-annotations">meta-annotated</a> with <code>@Component</code>, so they are candidates for component-scanning. In the preceding example, assuming that <code>AppConfig</code> is declared within the <code>com.acme</code> package (or any package underneath), it is picked up during the call to <code>scan()</code>. Upon <code>refresh()</code>, all its <code>@Bean</code> methods are processed and registered as bean definitions within the container.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Support-for-Web-Applications-with-AnnotationConfigWebApplicationContext"><a href="#Support-for-Web-Applications-with-AnnotationConfigWebApplicationContext" class="headerlink" title="Support for Web Applications with AnnotationConfigWebApplicationContext"></a>Support for Web Applications with <code>AnnotationConfigWebApplicationContext</code></h5><p>A <code>WebApplicationContext</code> variant of <code>AnnotationConfigApplicationContext</code> is available with <code>AnnotationConfigWebApplicationContext</code>. You can use this implementation when configuring the Spring <code>ContextLoaderListener</code> servlet listener, Spring MVC <code>DispatcherServlet</code>, and so forth. The following <code>web.xml</code> snippet configures a typical Spring MVC web application (note the use of the <code>contextClass</code> context-param and init-param):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Configure ContextLoaderListener to use AnnotationConfigWebApplicationContext</span></span><br><span class="line"><span class="comment">        instead of the default XmlWebApplicationContext --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">            org.springframework.web.context.support.AnnotationConfigWebApplicationContext</span><br><span class="line">        <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Configuration locations must consist of one or more comma- or space-delimited</span></span><br><span class="line"><span class="comment">        fully-qualified @Configuration classes. Fully-qualified packages may also be</span></span><br><span class="line"><span class="comment">        specified for component-scanning --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.acme.AppConfig<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap the root application context as usual using ContextLoaderListener --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Declare a Spring MVC DispatcherServlet as usual --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Configure DispatcherServlet to use AnnotationConfigWebApplicationContext</span></span><br><span class="line"><span class="comment">            instead of the default XmlWebApplicationContext --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">                org.springframework.web.context.support.AnnotationConfigWebApplicationContext</span><br><span class="line">            <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Again, config locations must consist of one or more comma- or space-delimited</span></span><br><span class="line"><span class="comment">            and fully-qualified @Configuration classes --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.acme.web.MvcConfig<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- map all requests for /app/* to the dispatcher servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/app/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>For programmatic use cases, a <code>GenericWebApplicationContext</code> can be used as an alternative to <code>AnnotationConfigWebApplicationContext</code>. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/web/context/support/GenericWebApplicationContext.html"><code>GenericWebApplicationContext</code></a> javadoc for details.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-12-3-Using-the-Bean-Annotation"><a href="#1-12-3-Using-the-Bean-Annotation" class="headerlink" title="1.12.3. Using the @Bean Annotation"></a>1.12.3. Using the <code>@Bean</code> Annotation</h4><p><code>@Bean</code> is a method-level annotation and a direct analog of the XML <code>&lt;bean/&gt;</code> element. The annotation supports some of the attributes offered by <code>&lt;bean/&gt;</code>, such as:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-initializingbean">init-method</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-lifecycle-disposablebean">destroy-method</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire">autowiring</a></li>
<li><code>name</code>.</li>
</ul>
<p>You can use the <code>@Bean</code> annotation in a <code>@Configuration</code>-annotated or in a <code>@Component</code>-annotated class.</p>
<h5 id="Declaring-a-Bean"><a href="#Declaring-a-Bean" class="headerlink" title="Declaring a Bean"></a>Declaring a Bean</h5><p>To declare a bean, you can annotate a method with the <code>@Bean</code> annotation. You use this method to register a bean definition within an <code>ApplicationContext</code> of the type specified as the method’s return value. By default, the bean name is the same as the method name. The following example shows a <code>@Bean</code> method declaration:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferServiceImpl <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding configuration is exactly equivalent to the following Spring XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transferService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.acme.TransferServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Both declarations make a bean named <code>transferService</code> available in the <code>ApplicationContext</code>, bound to an object instance of type <code>TransferServiceImpl</code>, as the following text image shows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transferService -&gt; com.acme.TransferServiceImpl</span><br></pre></td></tr></table></figure>

<p>You can also use default methods to define beans. This allows composition of bean configurations by implementing interfaces with bean definitions on default methods.</p>
<p>Java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">default</span> TransferServiceImpl <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> <span class="keyword">implements</span> <span class="title class_">BaseConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also declare your <code>@Bean</code> method with an interface (or base class) return type, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, this limits the visibility for advance type prediction to the specified interface type (<code>TransferService</code>). Then, with the full type (<code>TransferServiceImpl</code>) known to the container only once the affected singleton bean has been instantiated. Non-lazy singleton beans get instantiated according to their declaration order, so you may see different type matching results depending on when another component tries to match by a non-declared type (such as <code>@Autowired TransferServiceImpl</code>, which resolves only once the <code>transferService</code> bean has been instantiated).</p>
<table>
<thead>
<tr>
<th></th>
<th>If you consistently refer to your types by a declared service interface, your <code>@Bean</code> return types may safely join that design decision. However, for components that implement several interfaces or for components potentially referred to by their implementation type, it is safer to declare the most specific return type possible (at least as specific as required by the injection points that refer to your bean).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Bean-Dependencies"><a href="#Bean-Dependencies" class="headerlink" title="Bean Dependencies"></a>Bean Dependencies</h5><p>A <code>@Bean</code>-annotated method can have an arbitrary number of parameters that describe the dependencies required to build that bean. For instance, if our <code>TransferService</code> requires an <code>AccountRepository</code>, we can materialize that dependency with a method parameter, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">(AccountRepository accountRepository)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>(accountRepository);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The resolution mechanism is pretty much identical to constructor-based dependency injection. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-constructor-injection">the relevant section</a> for more details.</p>
<h5 id="Receiving-Lifecycle-Callbacks"><a href="#Receiving-Lifecycle-Callbacks" class="headerlink" title="Receiving Lifecycle Callbacks"></a>Receiving Lifecycle Callbacks</h5><p>Any classes defined with the <code>@Bean</code> annotation support the regular lifecycle callbacks and can use the <code>@PostConstruct</code> and <code>@PreDestroy</code> annotations from JSR-250. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-postconstruct-and-predestroy-annotations">JSR-250 annotations</a> for further details.</p>
<p>The regular Spring <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-nature">lifecycle</a> callbacks are fully supported as well. If a bean implements <code>InitializingBean</code>, <code>DisposableBean</code>, or <code>Lifecycle</code>, their respective methods are called by the container.</p>
<p>The standard set of <code>*Aware</code> interfaces (such as <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beanfactory">BeanFactoryAware</a>, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware">BeanNameAware</a>, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-messagesource">MessageSourceAware</a>, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-aware">ApplicationContextAware</a>, and so on) are also fully supported.</p>
<p>The <code>@Bean</code> annotation supports specifying arbitrary initialization and destruction callback methods, much like Spring XML’s <code>init-method</code> and <code>destroy-method</code> attributes on the <code>bean</code> element, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanOne</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// initialization logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanTwo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// destruction logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(initMethod = &quot;init&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BeanOne <span class="title function_">beanOne</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanOne</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(destroyMethod = &quot;cleanup&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BeanTwo <span class="title function_">beanTwo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanTwo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>By default, beans defined with Java configuration that have a public <code>close</code> or <code>shutdown</code> method are automatically enlisted with a destruction callback. If you have a public <code>close</code> or <code>shutdown</code> method and you do not wish for it to be called when the container shuts down, you can add <code>@Bean(destroyMethod=&quot;&quot;)</code> to your bean definition to disable the default <code>(inferred)</code> mode.You may want to do that by default for a resource that you acquire with JNDI, as its lifecycle is managed outside the application. In particular, make sure to always do it for a <code>DataSource</code>, as it is known to be problematic on Java EE application servers.The following example shows how to prevent an automatic destruction callback for a <code>DataSource</code>:JavaKotlin<code>@Bean(destroyMethod=&quot;&quot;) public DataSource dataSource() throws NamingException &#123;    return (DataSource) jndiTemplate.lookup(&quot;MyDS&quot;); &#125;</code>Also, with <code>@Bean</code> methods, you typically use programmatic JNDI lookups, either by using Spring’s <code>JndiTemplate</code> or <code>JndiLocatorDelegate</code> helpers or straight JNDI <code>InitialContext</code> usage but not the <code>JndiObjectFactoryBean</code> variant (which would force you to declare the return type as the <code>FactoryBean</code> type instead of the actual target type, making it harder to use for cross-reference calls in other <code>@Bean</code> methods that intend to refer to the provided resource here).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In the case of <code>BeanOne</code> from the example above the preceding note, it would be equally valid to call the <code>init()</code> method directly during construction, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> BeanOne <span class="title function_">beanOne</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">BeanOne</span> <span class="variable">beanOne</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanOne</span>();</span><br><span class="line">        beanOne.init();</span><br><span class="line">        <span class="keyword">return</span> beanOne;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>When you work directly in Java, you can do anything you like with your objects and do not always need to rely on the container lifecycle.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Specifying-Bean-Scope"><a href="#Specifying-Bean-Scope" class="headerlink" title="Specifying Bean Scope"></a>Specifying Bean Scope</h5><p>Spring includes the <code>@Scope</code> annotation so that you can specify the scope of a bean.</p>
<h6 id="Using-the-Scope-Annotation"><a href="#Using-the-Scope-Annotation" class="headerlink" title="Using the @Scope Annotation"></a>Using the <code>@Scope</code> Annotation</h6><p>You can specify that your beans defined with the <code>@Bean</code> annotation should have a specific scope. You can use any of the standard scopes specified in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes">Bean Scopes</a> section.</p>
<p>The default scope is <code>singleton</code>, but you can override this with the <code>@Scope</code> annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Encryptor <span class="title function_">encryptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Scope-and-scoped-proxy"><a href="#Scope-and-scoped-proxy" class="headerlink" title="@Scope and scoped-proxy"></a><code>@Scope</code> and <code>scoped-proxy</code></h6><p>Spring offers a convenient way of working with scoped dependencies through <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-other-injection">scoped proxies</a>. The easiest way to create such a proxy when using the XML configuration is the <code>&lt;aop:scoped-proxy/&gt;</code> element. Configuring your beans in Java with a <code>@Scope</code> annotation offers equivalent support with the <code>proxyMode</code> attribute. The default is <code>ScopedProxyMode.DEFAULT</code>, which typically indicates that no scoped proxy should be created unless a different default has been configured at the component-scan instruction level. You can specify <code>ScopedProxyMode.TARGET_CLASS</code>, <code>ScopedProxyMode.INTERFACES</code> or <code>ScopedProxyMode.NO</code>.</p>
<p>If you port the scoped proxy example from the XML reference documentation (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-other-injection">scoped proxies</a>) to our <code>@Bean</code> using Java, it resembles the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// an HTTP Session-scoped bean exposed as a proxy</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@SessionScope</span></span><br><span class="line"><span class="keyword">public</span> UserPreferences <span class="title function_">userPreferences</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserPreferences</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Service <span class="title function_">userService</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleUserService</span>();</span><br><span class="line">    <span class="comment">// a reference to the proxied userPreferences bean</span></span><br><span class="line">    service.setUserPreferences(userPreferences());</span><br><span class="line">    <span class="keyword">return</span> service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Customizing-Bean-Naming"><a href="#Customizing-Bean-Naming" class="headerlink" title="Customizing Bean Naming"></a>Customizing Bean Naming</h5><p>By default, configuration classes use a <code>@Bean</code> method’s name as the name of the resulting bean. This functionality can be overridden, however, with the <code>name</code> attribute, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;myThing&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Thing <span class="title function_">thing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Thing</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Bean-Aliasing"><a href="#Bean-Aliasing" class="headerlink" title="Bean Aliasing"></a>Bean Aliasing</h5><p>As discussed in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beanname">Naming Beans</a>, it is sometimes desirable to give a single bean multiple names, otherwise known as bean aliasing. The <code>name</code> attribute of the <code>@Bean</code> annotation accepts a String array for this purpose. The following example shows how to set a number of aliases for a bean:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&#123;&quot;dataSource&quot;, &quot;subsystemA-dataSource&quot;, &quot;subsystemB-dataSource&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// instantiate, configure and return DataSource bean...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Bean-Description"><a href="#Bean-Description" class="headerlink" title="Bean Description"></a>Bean Description</h5><p>Sometimes, it is helpful to provide a more detailed textual description of a bean. This can be particularly useful when beans are exposed (perhaps through JMX) for monitoring purposes.</p>
<p>To add a description to a <code>@Bean</code>, you can use the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/Description.html"><code>@Description</code></a> annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Description(&quot;Provides a basic example of a bean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Thing <span class="title function_">thing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Thing</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-12-4-Using-the-Configuration-annotation"><a href="#1-12-4-Using-the-Configuration-annotation" class="headerlink" title="1.12.4. Using the @Configuration annotation"></a>1.12.4. Using the <code>@Configuration</code> annotation</h4><p><code>@Configuration</code> is a class-level annotation indicating that an object is a source of bean definitions. <code>@Configuration</code> classes declare beans through <code>@Bean</code>-annotated methods. Calls to <code>@Bean</code> methods on <code>@Configuration</code> classes can also be used to define inter-bean dependencies. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-basic-concepts">Basic Concepts: <code>@Bean</code> and <code>@Configuration</code></a> for a general introduction.</p>
<h5 id="Injecting-Inter-bean-Dependencies"><a href="#Injecting-Inter-bean-Dependencies" class="headerlink" title="Injecting Inter-bean Dependencies"></a>Injecting Inter-bean Dependencies</h5><p>When beans have dependencies on one another, expressing that dependency is as simple as having one bean method call another, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> BeanOne <span class="title function_">beanOne</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanOne</span>(beanTwo());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> BeanTwo <span class="title function_">beanTwo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanTwo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the preceding example, <code>beanOne</code> receives a reference to <code>beanTwo</code> through constructor injection.</p>
<table>
<thead>
<tr>
<th></th>
<th>This method of declaring inter-bean dependencies works only when the <code>@Bean</code> method is declared within a <code>@Configuration</code> class. You cannot declare inter-bean dependencies by using plain <code>@Component</code> classes.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Lookup-Method-Injection-1"><a href="#Lookup-Method-Injection-1" class="headerlink" title="Lookup Method Injection"></a>Lookup Method Injection</h5><p>As noted earlier, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-method-injection">lookup method injection</a> is an advanced feature that you should use rarely. It is useful in cases where a singleton-scoped bean has a dependency on a prototype-scoped bean. Using Java for this type of configuration provides a natural means for implementing this pattern. The following example shows how to use lookup method injection:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CommandManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(Object commandState)</span> &#123;</span><br><span class="line">        <span class="comment">// grab a new instance of the appropriate Command interface</span></span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> createCommand();</span><br><span class="line">        <span class="comment">// set the state on the (hopefully brand new) Command instance</span></span><br><span class="line">        command.setState(commandState);</span><br><span class="line">        <span class="keyword">return</span> command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// okay... but where is the implementation of this method?</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Command <span class="title function_">createCommand</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By using Java configuration, you can create a subclass of <code>CommandManager</code> where the abstract <code>createCommand()</code> method is overridden in such a way that it looks up a new (prototype) command object. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AsyncCommand <span class="title function_">asyncCommand</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AsyncCommand</span> <span class="variable">command</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsyncCommand</span>();</span><br><span class="line">    <span class="comment">// inject dependencies here as required</span></span><br><span class="line">    <span class="keyword">return</span> command;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CommandManager <span class="title function_">commandManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// return new anonymous implementation of CommandManager with createCommand()</span></span><br><span class="line">    <span class="comment">// overridden to return a new prototype Command object</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommandManager</span>() &#123;</span><br><span class="line">        <span class="keyword">protected</span> Command <span class="title function_">createCommand</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> asyncCommand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Further-Information-About-How-Java-based-Configuration-Works-Internally"><a href="#Further-Information-About-How-Java-based-Configuration-Works-Internally" class="headerlink" title="Further Information About How Java-based Configuration Works Internally"></a>Further Information About How Java-based Configuration Works Internally</h5><p>Consider the following example, which shows a <code>@Bean</code> annotated method being called twice:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ClientService <span class="title function_">clientService1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ClientServiceImpl</span> <span class="variable">clientService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientServiceImpl</span>();</span><br><span class="line">        clientService.setClientDao(clientDao());</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ClientService <span class="title function_">clientService2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ClientServiceImpl</span> <span class="variable">clientService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientServiceImpl</span>();</span><br><span class="line">        clientService.setClientDao(clientDao());</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ClientDao <span class="title function_">clientDao</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClientDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>clientDao()</code> has been called once in <code>clientService1()</code> and once in <code>clientService2()</code>. Since this method creates a new instance of <code>ClientDaoImpl</code> and returns it, you would normally expect to have two instances (one for each service). That definitely would be problematic: In Spring, instantiated beans have a <code>singleton</code> scope by default. This is where the magic comes in: All <code>@Configuration</code> classes are subclassed at startup-time with <code>CGLIB</code>. In the subclass, the child method checks the container first for any cached (scoped) beans before it calls the parent method and creates a new instance.</p>
<table>
<thead>
<tr>
<th></th>
<th>The behavior could be different according to the scope of your bean. We are talking about singletons here.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>As of Spring 3.2, it is no longer necessary to add CGLIB to your classpath because CGLIB classes have been repackaged under <code>org.springframework.cglib</code> and included directly within the spring-core JAR.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>There are a few restrictions due to the fact that CGLIB dynamically adds features at startup-time. In particular, configuration classes must not be final. However, as of 4.3, any constructors are allowed on configuration classes, including the use of <code>@Autowired</code> or a single non-default constructor declaration for default injection.If you prefer to avoid any CGLIB-imposed limitations, consider declaring your <code>@Bean</code> methods on non-<code>@Configuration</code> classes (for example, on plain <code>@Component</code> classes instead). Cross-method calls between <code>@Bean</code> methods are not then intercepted, so you have to exclusively rely on dependency injection at the constructor or method level there.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-12-5-Composing-Java-based-Configurations"><a href="#1-12-5-Composing-Java-based-Configurations" class="headerlink" title="1.12.5. Composing Java-based Configurations"></a>1.12.5. Composing Java-based Configurations</h4><p>Spring’s Java-based configuration feature lets you compose annotations, which can reduce the complexity of your configuration.</p>
<h5 id="Using-the-Import-Annotation"><a href="#Using-the-Import-Annotation" class="headerlink" title="Using the @Import Annotation"></a>Using the <code>@Import</code> Annotation</h5><p>Much as the <code>&lt;import/&gt;</code> element is used within Spring XML files to aid in modularizing configurations, the <code>@Import</code> annotation allows for loading <code>@Bean</code> definitions from another configuration class, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigA</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> A <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(ConfigA.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigB</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> B <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, rather than needing to specify both <code>ConfigA.class</code> and <code>ConfigB.class</code> when instantiating the context, only <code>ConfigB</code> needs to be supplied explicitly, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(ConfigB.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// now both beans A and B will be available...</span></span><br><span class="line">    <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> ctx.getBean(A.class);</span><br><span class="line">    <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> ctx.getBean(B.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This approach simplifies container instantiation, as only one class needs to be dealt with, rather than requiring you to remember a potentially large number of <code>@Configuration</code> classes during construction.</p>
<table>
<thead>
<tr>
<th></th>
<th>As of Spring Framework 4.2, <code>@Import</code> also supports references to regular component classes, analogous to the <code>AnnotationConfigApplicationContext.register</code> method. This is particularly useful if you want to avoid component scanning, by using a few configuration classes as entry points to explicitly define all your components.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h6 id="Injecting-Dependencies-on-Imported-Bean-Definitions"><a href="#Injecting-Dependencies-on-Imported-Bean-Definitions" class="headerlink" title="Injecting Dependencies on Imported @Bean Definitions"></a>Injecting Dependencies on Imported <code>@Bean</code> Definitions</h6><p>The preceding example works but is simplistic. In most practical scenarios, beans have dependencies on one another across configuration classes. When using XML, this is not an issue, because no compiler is involved, and you can declare <code>ref=&quot;someBean&quot;</code> and trust Spring to work it out during container initialization. When using <code>@Configuration</code> classes, the Java compiler places constraints on the configuration model, in that references to other beans must be valid Java syntax.</p>
<p>Fortunately, solving this problem is simple. As <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-dependencies">we already discussed</a>, a <code>@Bean</code> method can have an arbitrary number of parameters that describe the bean dependencies. Consider the following more real-world scenario with several <code>@Configuration</code> classes, each depending on beans declared in the others:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">(AccountRepository accountRepository)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>(accountRepository);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RepositoryConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AccountRepository <span class="title function_">accountRepository</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdbcAccountRepository</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(&#123;ServiceConfig.class, RepositoryConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemTestConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// return new DataSource</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SystemTestConfig.class);</span><br><span class="line">    <span class="comment">// everything wires up across configuration classes...</span></span><br><span class="line">    <span class="type">TransferService</span> <span class="variable">transferService</span> <span class="operator">=</span> ctx.getBean(TransferService.class);</span><br><span class="line">    transferService.transfer(<span class="number">100.00</span>, <span class="string">&quot;A123&quot;</span>, <span class="string">&quot;C456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There is another way to achieve the same result. Remember that <code>@Configuration</code> classes are ultimately only another bean in the container: This means that they can take advantage of <code>@Autowired</code> and <code>@Value</code> injection and other features the same as any other bean.</p>
<table>
<thead>
<tr>
<th></th>
<th>Make sure that the dependencies you inject that way are of the simplest kind only. <code>@Configuration</code> classes are processed quite early during the initialization of the context, and forcing a dependency to be injected this way may lead to unexpected early initialization. Whenever possible, resort to parameter-based injection, as in the preceding example.Also, be particularly careful with <code>BeanPostProcessor</code> and <code>BeanFactoryPostProcessor</code> definitions through <code>@Bean</code>. Those should usually be declared as <code>static @Bean</code> methods, not triggering the instantiation of their containing configuration class. Otherwise, <code>@Autowired</code> and <code>@Value</code> may not work on the configuration class itself, since it is possible to create it as a bean instance earlier than <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html"><code>AutowiredAnnotationBeanPostProcessor</code></a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following example shows how one bean can be autowired to another bean:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountRepository accountRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>(accountRepository);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RepositoryConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RepositoryConfig</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AccountRepository <span class="title function_">accountRepository</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdbcAccountRepository</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(&#123;ServiceConfig.class, RepositoryConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemTestConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// return new DataSource</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SystemTestConfig.class);</span><br><span class="line">    <span class="comment">// everything wires up across configuration classes...</span></span><br><span class="line">    <span class="type">TransferService</span> <span class="variable">transferService</span> <span class="operator">=</span> ctx.getBean(TransferService.class);</span><br><span class="line">    transferService.transfer(<span class="number">100.00</span>, <span class="string">&quot;A123&quot;</span>, <span class="string">&quot;C456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Constructor injection in <code>@Configuration</code> classes is only supported as of Spring Framework 4.3. Note also that there is no need to specify <code>@Autowired</code> if the target bean defines only one constructor.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Fully-qualifying imported beans for ease of navigation</p>
<p>In the preceding scenario, using <code>@Autowired</code> works well and provides the desired modularity, but determining exactly where the autowired bean definitions are declared is still somewhat ambiguous. For example, as a developer looking at <code>ServiceConfig</code>, how do you know exactly where the <code>@Autowired AccountRepository</code> bean is declared? It is not explicit in the code, and this may be just fine. Remember that the <a target="_blank" rel="noopener" href="https://spring.io/tools">Spring Tools for Eclipse</a> provides tooling that can render graphs showing how everything is wired, which may be all you need. Also, your Java IDE can easily find all declarations and uses of the <code>AccountRepository</code> type and quickly show you the location of <code>@Bean</code> methods that return that type.</p>
<p>In cases where this ambiguity is not acceptable and you wish to have direct navigation from within your IDE from one <code>@Configuration</code> class to another, consider autowiring the configuration classes themselves. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RepositoryConfig repositoryConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// navigate &#x27;through&#x27; the config class to the @Bean method!</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>(repositoryConfig.accountRepository());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the preceding situation, where <code>AccountRepository</code> is defined is completely explicit. However, <code>ServiceConfig</code> is now tightly coupled to <code>RepositoryConfig</code>. That is the tradeoff. This tight coupling can be somewhat mitigated by using interface-based or abstract class-based <code>@Configuration</code> classes. Consider the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RepositoryConfig repositoryConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>(repositoryConfig.accountRepository());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RepositoryConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    AccountRepository <span class="title function_">accountRepository</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultRepositoryConfig</span> <span class="keyword">implements</span> <span class="title class_">RepositoryConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AccountRepository <span class="title function_">accountRepository</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdbcAccountRepository</span>(...);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(&#123;ServiceConfig.class, DefaultRepositoryConfig.class&#125;)</span>  <span class="comment">// import the concrete config!</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemTestConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// return DataSource</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SystemTestConfig.class);</span><br><span class="line">    <span class="type">TransferService</span> <span class="variable">transferService</span> <span class="operator">=</span> ctx.getBean(TransferService.class);</span><br><span class="line">    transferService.transfer(<span class="number">100.00</span>, <span class="string">&quot;A123&quot;</span>, <span class="string">&quot;C456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now <code>ServiceConfig</code> is loosely coupled with respect to the concrete <code>DefaultRepositoryConfig</code>, and built-in IDE tooling is still useful: You can easily get a type hierarchy of <code>RepositoryConfig</code> implementations. In this way, navigating <code>@Configuration</code> classes and their dependencies becomes no different than the usual process of navigating interface-based code.</p>
<table>
<thead>
<tr>
<th></th>
<th>If you want to influence the startup creation order of certain beans, consider declaring some of them as <code>@Lazy</code> (for creation on first access instead of on startup) or as <code>@DependsOn</code> certain other beans (making sure that specific other beans are created before the current bean, beyond what the latter’s direct dependencies imply).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Conditionally-Include-Configuration-Classes-or-Bean-Methods"><a href="#Conditionally-Include-Configuration-Classes-or-Bean-Methods" class="headerlink" title="Conditionally Include @Configuration Classes or @Bean Methods"></a>Conditionally Include <code>@Configuration</code> Classes or <code>@Bean</code> Methods</h5><p>It is often useful to conditionally enable or disable a complete <code>@Configuration</code> class or even individual <code>@Bean</code> methods, based on some arbitrary system state. One common example of this is to use the <code>@Profile</code> annotation to activate beans only when a specific profile has been enabled in the Spring <code>Environment</code> (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-definition-profiles">Bean Definition Profiles</a> for details).</p>
<p>The <code>@Profile</code> annotation is actually implemented by using a much more flexible annotation called <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/Conditional.html"><code>@Conditional</code></a>. The <code>@Conditional</code> annotation indicates specific <code>org.springframework.context.annotation.Condition</code> implementations that should be consulted before a <code>@Bean</code> is registered.</p>
<p>Implementations of the <code>Condition</code> interface provide a <code>matches(…)</code> method that returns <code>true</code> or <code>false</code>. For example, the following listing shows the actual <code>Condition</code> implementation used for <code>@Profile</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">    <span class="comment">// Read the @Profile annotation attributes</span></span><br><span class="line">    MultiValueMap&lt;String, Object&gt; attrs = metadata.getAllAnnotationAttributes(Profile.class.getName());</span><br><span class="line">    <span class="keyword">if</span> (attrs != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Object value : attrs.get(<span class="string">&quot;value&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (context.getEnvironment().acceptsProfiles(((String[]) value))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/Conditional.html"><code>@Conditional</code></a> javadoc for more detail.</p>
<h5 id="Combining-Java-and-XML-Configuration"><a href="#Combining-Java-and-XML-Configuration" class="headerlink" title="Combining Java and XML Configuration"></a>Combining Java and XML Configuration</h5><p>Spring’s <code>@Configuration</code> class support does not aim to be a 100% complete replacement for Spring XML. Some facilities, such as Spring XML namespaces, remain an ideal way to configure the container. In cases where XML is convenient or necessary, you have a choice: either instantiate the container in an “XML-centric” way by using, for example, <code>ClassPathXmlApplicationContext</code>, or instantiate it in a “Java-centric” way by using <code>AnnotationConfigApplicationContext</code> and the <code>@ImportResource</code> annotation to import XML as needed.</p>
<h6 id="XML-centric-Use-of-Configuration-Classes"><a href="#XML-centric-Use-of-Configuration-Classes" class="headerlink" title="XML-centric Use of @Configuration Classes"></a>XML-centric Use of <code>@Configuration</code> Classes</h6><p>It may be preferable to bootstrap the Spring container from XML and include <code>@Configuration</code> classes in an ad-hoc fashion. For example, in a large existing codebase that uses Spring XML, it is easier to create <code>@Configuration</code> classes on an as-needed basis and include them from the existing XML files. Later in this section, we cover the options for using <code>@Configuration</code> classes in this kind of “XML-centric” situation.</p>
<p>Declaring <code>@Configuration</code> classes as plain Spring <code>&lt;bean/&gt;</code> elements</p>
<p>Remember that <code>@Configuration</code> classes are ultimately bean definitions in the container. In this series examples, we create a <code>@Configuration</code> class named <code>AppConfig</code> and include it within <code>system-test-config.xml</code> as a <code>&lt;bean/&gt;</code> definition. Because <code>&lt;context:annotation-config/&gt;</code> is switched on, the container recognizes the <code>@Configuration</code> annotation and processes the <code>@Bean</code> methods declared in <code>AppConfig</code> properly.</p>
<p>The following example shows an ordinary configuration class in Java:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AccountRepository <span class="title function_">accountRepository</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdbcAccountRepository</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferService</span>(accountRepository());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following example shows part of a sample <code>system-test-config.xml</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- enable processing of annotations such as @Autowired and @Configuration --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.acme.AppConfig&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The following example shows a possible <code>jdbc.properties</code> file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdbc.url=jdbc:hsqldb:hsql://localhost/xdb</span><br><span class="line">jdbc.username=sa</span><br><span class="line">jdbc.password=</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;classpath:/com/acme/system-test-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">TransferService</span> <span class="variable">transferService</span> <span class="operator">=</span> ctx.getBean(TransferService.class);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>In <code>system-test-config.xml</code> file, the <code>AppConfig</code> <code>&lt;bean/&gt;</code> does not declare an <code>id</code> element. While it would be acceptable to do so, it is unnecessary, given that no other bean ever refers to it, and it is unlikely to be explicitly fetched from the container by name. Similarly, the <code>DataSource</code> bean is only ever autowired by type, so an explicit bean <code>id</code> is not strictly required.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Using <a href="context:component-scan/">context:component-scan/</a> to pick up <code>@Configuration</code> classes</p>
<p>Because <code>@Configuration</code> is meta-annotated with <code>@Component</code>, <code>@Configuration</code>-annotated classes are automatically candidates for component scanning. Using the same scenario as describe in the previous example, we can redefine <code>system-test-config.xml</code> to take advantage of component-scanning. Note that, in this case, we need not explicitly declare <code>&lt;context:annotation-config/&gt;</code>, because <code>&lt;context:component-scan/&gt;</code> enables the same functionality.</p>
<p>The following example shows the modified <code>system-test-config.xml</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- picks up and registers AppConfig as a bean definition --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.acme&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="Configuration-Class-centric-Use-of-XML-with-ImportResource"><a href="#Configuration-Class-centric-Use-of-XML-with-ImportResource" class="headerlink" title="@Configuration Class-centric Use of XML with @ImportResource"></a><code>@Configuration</code> Class-centric Use of XML with <code>@ImportResource</code></h6><p>In applications where <code>@Configuration</code> classes are the primary mechanism for configuring the container, it is still likely necessary to use at least some XML. In these scenarios, you can use <code>@ImportResource</code> and define only as much XML as you need. Doing so achieves a “Java-centric” approach to configuring the container and keeps XML to a bare minimum. The following example (which includes a configuration class, an XML file that defines a bean, a properties file, and the <code>main</code> class) shows how to use the <code>@ImportResource</code> annotation to achieve “Java-centric” configuration that uses XML as needed:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:/com/acme/properties-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DriverManagerDataSource</span>(url, username, password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">properties-config.xml</span><br><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;context:property-placeholder location=<span class="string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br><span class="line">jdbc.properties</span><br><span class="line">jdbc.url=jdbc:hsqldb:hsql:<span class="comment">//localhost/xdb</span></span><br><span class="line">jdbc.username=sa</span><br><span class="line">jdbc.password=</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);</span><br><span class="line">    <span class="type">TransferService</span> <span class="variable">transferService</span> <span class="operator">=</span> ctx.getBean(TransferService.class);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-13-Environment-Abstraction"><a href="#1-13-Environment-Abstraction" class="headerlink" title="1.13. Environment Abstraction"></a>1.13. Environment Abstraction</h3><p>The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/env/Environment.html"><code>Environment</code></a> interface is an abstraction integrated in the container that models two key aspects of the application environment: <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-definition-profiles">profiles</a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-property-source-abstraction">properties</a>.</p>
<p>A profile is a named, logical group of bean definitions to be registered with the container only if the given profile is active. Beans may be assigned to a profile whether defined in XML or with annotations. The role of the <code>Environment</code> object with relation to profiles is in determining which profiles (if any) are currently active, and which profiles (if any) should be active by default.</p>
<p>Properties play an important role in almost all applications and may originate from a variety of sources: properties files, JVM system properties, system environment variables, JNDI, servlet context parameters, ad-hoc <code>Properties</code> objects, <code>Map</code> objects, and so on. The role of the <code>Environment</code> object with relation to properties is to provide the user with a convenient service interface for configuring property sources and resolving properties from them.</p>
<h4 id="1-13-1-Bean-Definition-Profiles"><a href="#1-13-1-Bean-Definition-Profiles" class="headerlink" title="1.13.1. Bean Definition Profiles"></a>1.13.1. Bean Definition Profiles</h4><p>Bean definition profiles provide a mechanism in the core container that allows for registration of different beans in different environments. The word, “environment,” can mean different things to different users, and this feature can help with many use cases, including:</p>
<ul>
<li>Working against an in-memory datasource in development versus looking up that same datasource from JNDI when in QA or production.</li>
<li>Registering monitoring infrastructure only when deploying an application into a performance environment.</li>
<li>Registering customized implementations of beans for customer A versus customer B deployments.</li>
</ul>
<p>Consider the first use case in a practical application that requires a <code>DataSource</code>. In a test environment, the configuration might resemble the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>()</span><br><span class="line">        .setType(EmbeddedDatabaseType.HSQL)</span><br><span class="line">        .addScript(<span class="string">&quot;my-schema.sql&quot;</span>)</span><br><span class="line">        .addScript(<span class="string">&quot;my-test-data.sql&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now consider how this application can be deployed into a QA or production environment, assuming that the datasource for the application is registered with the production application server’s JNDI directory. Our <code>dataSource</code> bean now looks like the following listing:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(destroyMethod=&quot;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">    <span class="keyword">return</span> (DataSource) ctx.lookup(<span class="string">&quot;java:comp/env/jdbc/datasource&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The problem is how to switch between using these two variations based on the current environment. Over time, Spring users have devised a number of ways to get this done, usually relying on a combination of system environment variables and XML <code>&lt;import/&gt;</code> statements containing <code>$&#123;placeholder&#125;</code> tokens that resolve to the correct configuration file path depending on the value of an environment variable. Bean definition profiles is a core container feature that provides a solution to this problem.</p>
<p>If we generalize the use case shown in the preceding example of environment-specific bean definitions, we end up with the need to register certain bean definitions in certain contexts but not in others. You could say that you want to register a certain profile of bean definitions in situation A and a different profile in situation B. We start by updating our configuration to reflect this need.</p>
<h5 id="Using-Profile"><a href="#Using-Profile" class="headerlink" title="Using @Profile"></a>Using <code>@Profile</code></h5><p>The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/Profile.html"><code>@Profile</code></a> annotation lets you indicate that a component is eligible for registration when one or more specified profiles are active. Using our preceding example, we can rewrite the <code>dataSource</code> configuration as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile(&quot;development&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandaloneDataConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>()</span><br><span class="line">            .setType(EmbeddedDatabaseType.HSQL)</span><br><span class="line">            .addScript(<span class="string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)</span><br><span class="line">            .addScript(<span class="string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JndiDataConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(destroyMethod=&quot;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        <span class="keyword">return</span> (DataSource) ctx.lookup(<span class="string">&quot;java:comp/env/jdbc/datasource&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>As mentioned earlier, with <code>@Bean</code> methods, you typically choose to use programmatic JNDI lookups, by using either Spring’s <code>JndiTemplate</code>&#x2F;<code>JndiLocatorDelegate</code> helpers or the straight JNDI <code>InitialContext</code> usage shown earlier but not the <code>JndiObjectFactoryBean</code> variant, which would force you to declare the return type as the <code>FactoryBean</code> type.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The profile string may contain a simple profile name (for example, <code>production</code>) or a profile expression. A profile expression allows for more complicated profile logic to be expressed (for example, <code>production &amp; us-east</code>). The following operators are supported in profile expressions:</p>
<ul>
<li><code>!</code>: A logical “not” of the profile</li>
<li><code>&amp;</code>: A logical “and” of the profiles</li>
<li><code>|</code>: A logical “or” of the profiles</li>
</ul>
<p>|      | You cannot mix the <code>&amp;</code> and <code>|</code> operators without using parentheses. For example, <code>production &amp; us-east | eu-central</code> is not a valid expression. It must be expressed as <code>production &amp; (us-east | eu-central)</code>. |<br>| —- | ———————————————————— |<br>|      |                                                              |</p>
<p>You can use <code>@Profile</code> as a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-meta-annotations">meta-annotation</a> for the purpose of creating a custom composed annotation. The following example defines a custom <code>@Production</code> annotation that you can use as a drop-in replacement for <code>@Profile(&quot;production&quot;)</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Production &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>If a <code>@Configuration</code> class is marked with <code>@Profile</code>, all of the <code>@Bean</code> methods and <code>@Import</code> annotations associated with that class are bypassed unless one or more of the specified profiles are active. If a <code>@Component</code> or <code>@Configuration</code> class is marked with <code>@Profile(&#123;&quot;p1&quot;, &quot;p2&quot;&#125;)</code>, that class is not registered or processed unless profiles ‘p1’ or ‘p2’ have been activated. If a given profile is prefixed with the NOT operator (<code>!</code>), the annotated element is registered only if the profile is not active. For example, given <code>@Profile(&#123;&quot;p1&quot;, &quot;!p2&quot;&#125;)</code>, registration will occur if profile ‘p1’ is active or if profile ‘p2’ is not active.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>@Profile</code> can also be declared at the method level to include only one particular bean of a configuration class (for example, for alternative variants of a particular bean), as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="meta">@Profile(&quot;development&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">standaloneDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>()</span><br><span class="line">            .setType(EmbeddedDatabaseType.HSQL)</span><br><span class="line">            .addScript(<span class="string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)</span><br><span class="line">            .addScript(<span class="string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="meta">@Profile(&quot;production&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">jndiDataSource</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        <span class="keyword">return</span> (DataSource) ctx.lookup(<span class="string">&quot;java:comp/env/jdbc/datasource&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The <code>standaloneDataSource</code> method is available only in the <code>development</code> profile.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>The <code>jndiDataSource</code> method is available only in the <code>production</code> profile.</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>With <code>@Profile</code> on <code>@Bean</code> methods, a special scenario may apply: In the case of overloaded <code>@Bean</code> methods of the same Java method name (analogous to constructor overloading), a <code>@Profile</code> condition needs to be consistently declared on all overloaded methods. If the conditions are inconsistent, only the condition on the first declaration among the overloaded methods matters. Therefore, <code>@Profile</code> can not be used to select an overloaded method with a particular argument signature over another. Resolution between all factory methods for the same bean follows Spring’s constructor resolution algorithm at creation time.If you want to define alternative beans with different profile conditions, use distinct Java method names that point to the same bean name by using the <code>@Bean</code> name attribute, as shown in the preceding example. If the argument signatures are all the same (for example, all of the variants have no-arg factory methods), this is the only way to represent such an arrangement in a valid Java class in the first place (since there can only be one method of a particular name and argument signature).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="XML-Bean-Definition-Profiles"><a href="#XML-Bean-Definition-Profiles" class="headerlink" title="XML Bean Definition Profiles"></a>XML Bean Definition Profiles</h5><p>The XML counterpart is the <code>profile</code> attribute of the <code>&lt;beans&gt;</code> element. Our preceding sample configuration can be rewritten in two XML files, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;development&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;production&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">jndi-name</span>=<span class="string">&quot;java:comp/env/jdbc/datasource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>It is also possible to avoid that split and nest <code>&lt;beans/&gt;</code> elements within the same file, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other bean definitions --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;production&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">jndi-name</span>=<span class="string">&quot;java:comp/env/jdbc/datasource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>spring-bean.xsd</code> has been constrained to allow such elements only as the last ones in the file. This should help provide flexibility without incurring clutter in the XML files.</p>
<table>
<thead>
<tr>
<th></th>
<th>The XML counterpart does not support the profile expressions described earlier. It is possible, however, to negate a profile by using the <code>!</code> operator. It is also possible to apply a logical “and” by nesting the profiles, as the following example shows:<code>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xmlns:jdbc=&quot;http://www.springframework.org/schema/jdbc&quot;    xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;    xsi:schemaLocation=&quot;...&quot;&gt;     &lt;!-- other bean definitions --&gt;     &lt;beans profile=&quot;production&quot;&gt;        &lt;beans profile=&quot;us-east&quot;&gt;            &lt;jee:jndi-lookup id=&quot;dataSource&quot; jndi-name=&quot;java:comp/env/jdbc/datasource&quot;/&gt;        &lt;/beans&gt;    &lt;/beans&gt; &lt;/beans&gt;</code>In the preceding example, the <code>dataSource</code> bean is exposed if both the <code>production</code> and <code>us-east</code> profiles are active.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Activating-a-Profile"><a href="#Activating-a-Profile" class="headerlink" title="Activating a Profile"></a>Activating a Profile</h5><p>Now that we have updated our configuration, we still need to instruct Spring which profile is active. If we started our sample application right now, we would see a <code>NoSuchBeanDefinitionException</code> thrown, because the container could not find the Spring bean named <code>dataSource</code>.</p>
<p>Activating a profile can be done in several ways, but the most straightforward is to do it programmatically against the <code>Environment</code> API which is available through an <code>ApplicationContext</code>. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">ctx.getEnvironment().setActiveProfiles(<span class="string">&quot;development&quot;</span>);</span><br><span class="line">ctx.register(SomeConfig.class, StandaloneDataConfig.class, JndiDataConfig.class);</span><br><span class="line">ctx.refresh();</span><br></pre></td></tr></table></figure>

<p>In addition, you can also declaratively activate profiles through the <code>spring.profiles.active</code> property, which may be specified through system environment variables, JVM system properties, servlet context parameters in <code>web.xml</code>, or even as an entry in JNDI (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-property-source-abstraction"><code>PropertySource</code> Abstraction</a>). In integration tests, active profiles can be declared by using the <code>@ActiveProfiles</code> annotation in the <code>spring-test</code> module (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testcontext-ctx-management-env-profiles">context configuration with environment profiles</a>).</p>
<p>Note that profiles are not an “either-or” proposition. You can activate multiple profiles at once. Programmatically, you can provide multiple profile names to the <code>setActiveProfiles()</code> method, which accepts <code>String…</code> varargs. The following example activates multiple profiles:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.getEnvironment().setActiveProfiles(<span class="string">&quot;profile1&quot;</span>, <span class="string">&quot;profile2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Declaratively, <code>spring.profiles.active</code> may accept a comma-separated list of profile names, as the following example shows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dspring.profiles.active=&quot;profile1,profile2&quot;</span><br></pre></td></tr></table></figure>

<h5 id="Default-Profile"><a href="#Default-Profile" class="headerlink" title="Default Profile"></a>Default Profile</h5><p>The default profile represents the profile that is enabled by default. Consider the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile(&quot;default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultDataConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>()</span><br><span class="line">            .setType(EmbeddedDatabaseType.HSQL)</span><br><span class="line">            .addScript(<span class="string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If no profile is active, the <code>dataSource</code> is created. You can see this as a way to provide a default definition for one or more beans. If any profile is enabled, the default profile does not apply.</p>
<p>You can change the name of the default profile by using <code>setDefaultProfiles()</code> on the <code>Environment</code> or, declaratively, by using the <code>spring.profiles.default</code> property.</p>
<h4 id="1-13-2-PropertySource-Abstraction"><a href="#1-13-2-PropertySource-Abstraction" class="headerlink" title="1.13.2. PropertySource Abstraction"></a>1.13.2. <code>PropertySource</code> Abstraction</h4><p>Spring’s <code>Environment</code> abstraction provides search operations over a configurable hierarchy of property sources. Consider the following listing:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line"><span class="type">Environment</span> <span class="variable">env</span> <span class="operator">=</span> ctx.getEnvironment();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">containsMyProperty</span> <span class="operator">=</span> env.containsProperty(<span class="string">&quot;my-property&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Does my environment contain the &#x27;my-property&#x27; property? &quot;</span> + containsMyProperty);</span><br></pre></td></tr></table></figure>

<p>In the preceding snippet, we see a high-level way of asking Spring whether the <code>my-property</code> property is defined for the current environment. To answer this question, the <code>Environment</code> object performs a search over a set of <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/env/PropertySource.html"><code>PropertySource</code></a> objects. A <code>PropertySource</code> is a simple abstraction over any source of key-value pairs, and Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/env/StandardEnvironment.html"><code>StandardEnvironment</code></a> is configured with two PropertySource objects — one representing the set of JVM system properties (<code>System.getProperties()</code>) and one representing the set of system environment variables (<code>System.getenv()</code>).</p>
<table>
<thead>
<tr>
<th></th>
<th>These default property sources are present for <code>StandardEnvironment</code>, for use in standalone applications. <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/web/context/support/StandardServletEnvironment.html"><code>StandardServletEnvironment</code></a> is populated with additional default property sources including servlet config and servlet context parameters. It can optionally enable a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/jndi/JndiPropertySource.html"><code>JndiPropertySource</code></a>. See the javadoc for details.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Concretely, when you use the <code>StandardEnvironment</code>, the call to <code>env.containsProperty(&quot;my-property&quot;)</code> returns true if a <code>my-property</code> system property or <code>my-property</code> environment variable is present at runtime.</p>
<table>
<thead>
<tr>
<th></th>
<th>The search performed is hierarchical. By default, system properties have precedence over environment variables. So, if the <code>my-property</code> property happens to be set in both places during a call to <code>env.getProperty(&quot;my-property&quot;)</code>, the system property value “wins” and is returned. Note that property values are not merged but rather completely overridden by a preceding entry.For a common <code>StandardServletEnvironment</code>, the full hierarchy is as follows, with the highest-precedence entries at the top:ServletConfig parameters (if applicable — for example, in case of a <code>DispatcherServlet</code> context)ServletContext parameters (web.xml context-param entries)JNDI environment variables (<code>java:comp/env/</code> entries)JVM system properties (<code>-D</code> command-line arguments)JVM system environment (operating system environment variables)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Most importantly, the entire mechanism is configurable. Perhaps you have a custom source of properties that you want to integrate into this search. To do so, implement and instantiate your own <code>PropertySource</code> and add it to the set of <code>PropertySources</code> for the current <code>Environment</code>. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line"><span class="type">MutablePropertySources</span> <span class="variable">sources</span> <span class="operator">=</span> ctx.getEnvironment().getPropertySources();</span><br><span class="line">sources.addFirst(<span class="keyword">new</span> <span class="title class_">MyPropertySource</span>());</span><br></pre></td></tr></table></figure>

<p>In the preceding code, <code>MyPropertySource</code> has been added with highest precedence in the search. If it contains a <code>my-property</code> property, the property is detected and returned, in favor of any <code>my-property</code> property in any other <code>PropertySource</code>. The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/env/MutablePropertySources.html"><code>MutablePropertySources</code></a> API exposes a number of methods that allow for precise manipulation of the set of property sources.</p>
<h4 id="1-13-3-Using-PropertySource"><a href="#1-13-3-Using-PropertySource" class="headerlink" title="1.13.3. Using @PropertySource"></a>1.13.3. Using <code>@PropertySource</code></h4><p>The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> annotation provides a convenient and declarative mechanism for adding a <code>PropertySource</code> to Spring’s <code>Environment</code>.</p>
<p>Given a file called <code>app.properties</code> that contains the key-value pair <code>testbean.name=myTestBean</code>, the following <code>@Configuration</code> class uses <code>@PropertySource</code> in such a way that a call to <code>testBean.getName()</code> returns <code>myTestBean</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/com/myco/app.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Environment env;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TestBean <span class="title function_">testBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TestBean</span> <span class="variable">testBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>();</span><br><span class="line">        testBean.setName(env.getProperty(<span class="string">&quot;testbean.name&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> testBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Any <code>$&#123;…&#125;</code> placeholders present in a <code>@PropertySource</code> resource location are resolved against the set of property sources already registered against the environment, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/com/$&#123;my.placeholder:default/path&#125;/app.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Environment env;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TestBean <span class="title function_">testBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TestBean</span> <span class="variable">testBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>();</span><br><span class="line">        testBean.setName(env.getProperty(<span class="string">&quot;testbean.name&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> testBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assuming that <code>my.placeholder</code> is present in one of the property sources already registered (for example, system properties or environment variables), the placeholder is resolved to the corresponding value. If not, then <code>default/path</code> is used as a default. If no default is specified and a property cannot be resolved, an <code>IllegalArgumentException</code> is thrown.</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>@PropertySource</code> annotation is repeatable, according to Java 8 conventions. However, all such <code>@PropertySource</code> annotations need to be declared at the same level, either directly on the configuration class or as meta-annotations within the same custom annotation. Mixing direct annotations and meta-annotations is not recommended, since direct annotations effectively override meta-annotations.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-13-4-Placeholder-Resolution-in-Statements"><a href="#1-13-4-Placeholder-Resolution-in-Statements" class="headerlink" title="1.13.4. Placeholder Resolution in Statements"></a>1.13.4. Placeholder Resolution in Statements</h4><p>Historically, the value of placeholders in elements could be resolved only against JVM system properties or environment variables. This is no longer the case. Because the <code>Environment</code> abstraction is integrated throughout the container, it is easy to route resolution of placeholders through it. This means that you may configure the resolution process in any way you like. You can change the precedence of searching through system properties and environment variables or remove them entirely. You can also add your own property sources to the mix, as appropriate.</p>
<p>Concretely, the following statement works regardless of where the <code>customer</code> property is defined, as long as it is available in the <code>Environment</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;com/bank/service/$&#123;customer&#125;-config.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-14-Registering-a-LoadTimeWeaver"><a href="#1-14-Registering-a-LoadTimeWeaver" class="headerlink" title="1.14. Registering a LoadTimeWeaver"></a>1.14. Registering a <code>LoadTimeWeaver</code></h3><p>The <code>LoadTimeWeaver</code> is used by Spring to dynamically transform classes as they are loaded into the Java virtual machine (JVM).</p>
<p>To enable load-time weaving, you can add the <code>@EnableLoadTimeWeaving</code> to one of your <code>@Configuration</code> classes, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableLoadTimeWeaving</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Alternatively, for XML configuration, you can use the <code>context:load-time-weaver</code> element:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:load-time-weaver</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Once configured for the <code>ApplicationContext</code>, any bean within that <code>ApplicationContext</code> may implement <code>LoadTimeWeaverAware</code>, thereby receiving a reference to the load-time weaver instance. This is particularly useful in combination with <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#orm-jpa">Spring’s JPA support</a> where load-time weaving may be necessary for JPA class transformation. Consult the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/orm/jpa/LocalContainerEntityManagerFactoryBean.html"><code>LocalContainerEntityManagerFactoryBean</code></a> javadoc for more detail. For more on AspectJ load-time weaving, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw">Load-time Weaving with AspectJ in the Spring Framework</a>.</p>
<h3 id="1-15-Additional-Capabilities-of-the-ApplicationContext"><a href="#1-15-Additional-Capabilities-of-the-ApplicationContext" class="headerlink" title="1.15. Additional Capabilities of the ApplicationContext"></a>1.15. Additional Capabilities of the <code>ApplicationContext</code></h3><p>As discussed in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans">chapter introduction</a>, the <code>org.springframework.beans.factory</code> package provides basic functionality for managing and manipulating beans, including in a programmatic way. The <code>org.springframework.context</code> package adds the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/ApplicationContext.html"><code>ApplicationContext</code></a> interface, which extends the <code>BeanFactory</code> interface, in addition to extending other interfaces to provide additional functionality in a more application framework-oriented style. Many people use the <code>ApplicationContext</code> in a completely declarative fashion, not even creating it programmatically, but instead relying on support classes such as <code>ContextLoader</code> to automatically instantiate an <code>ApplicationContext</code> as part of the normal startup process of a Java EE web application.</p>
<p>To enhance <code>BeanFactory</code> functionality in a more framework-oriented style, the context package also provides the following functionality:</p>
<ul>
<li>Access to messages in i18n-style, through the <code>MessageSource</code> interface.</li>
<li>Access to resources, such as URLs and files, through the <code>ResourceLoader</code> interface.</li>
<li>Event publication, namely to beans that implement the <code>ApplicationListener</code> interface, through the use of the <code>ApplicationEventPublisher</code> interface.</li>
<li>Loading of multiple (hierarchical) contexts, letting each be focused on one particular layer, such as the web layer of an application, through the <code>HierarchicalBeanFactory</code> interface.</li>
</ul>
<h4 id="1-15-1-Internationalization-using-MessageSource"><a href="#1-15-1-Internationalization-using-MessageSource" class="headerlink" title="1.15.1. Internationalization using MessageSource"></a>1.15.1. Internationalization using <code>MessageSource</code></h4><p>The <code>ApplicationContext</code> interface extends an interface called <code>MessageSource</code> and, therefore, provides internationalization (“i18n”) functionality. Spring also provides the <code>HierarchicalMessageSource</code> interface, which can resolve messages hierarchically. Together, these interfaces provide the foundation upon which Spring effects message resolution. The methods defined on these interfaces include:</p>
<ul>
<li><code>String getMessage(String code, Object[] args, String default, Locale loc)</code>: The basic method used to retrieve a message from the <code>MessageSource</code>. When no message is found for the specified locale, the default message is used. Any arguments passed in become replacement values, using the <code>MessageFormat</code> functionality provided by the standard library.</li>
<li><code>String getMessage(String code, Object[] args, Locale loc)</code>: Essentially the same as the previous method but with one difference: No default message can be specified. If the message cannot be found, a <code>NoSuchMessageException</code> is thrown.</li>
<li><code>String getMessage(MessageSourceResolvable resolvable, Locale locale)</code>: All properties used in the preceding methods are also wrapped in a class named <code>MessageSourceResolvable</code>, which you can use with this method.</li>
</ul>
<p>When an <code>ApplicationContext</code> is loaded, it automatically searches for a <code>MessageSource</code> bean defined in the context. The bean must have the name <code>messageSource</code>. If such a bean is found, all calls to the preceding methods are delegated to the message source. If no message source is found, the <code>ApplicationContext</code> attempts to find a parent containing a bean with the same name. If it does, it uses that bean as the <code>MessageSource</code>. If the <code>ApplicationContext</code> cannot find any source for messages, an empty <code>DelegatingMessageSource</code> is instantiated in order to be able to accept calls to the methods defined above.</p>
<p>Spring provides three <code>MessageSource</code> implementations, <code>ResourceBundleMessageSource</code>, <code>ReloadableResourceBundleMessageSource</code> and <code>StaticMessageSource</code>. All of them implement <code>HierarchicalMessageSource</code> in order to do nested messaging. The <code>StaticMessageSource</code> is rarely used but provides programmatic ways to add messages to the source. The following example shows <code>ResourceBundleMessageSource</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;messageSource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basenames&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>format<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>exceptions<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>windows<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The example assumes that you have three resource bundles called <code>format</code>, <code>exceptions</code> and <code>windows</code> defined in your classpath. Any request to resolve a message is handled in the JDK-standard way of resolving messages through <code>ResourceBundle</code> objects. For the purposes of the example, assume the contents of two of the above resource bundle files are as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># in format.properties</span><br><span class="line">message=Alligators rock!</span><br><span class="line"># in exceptions.properties</span><br><span class="line">argument.required=The &#123;0&#125; argument is required.</span><br></pre></td></tr></table></figure>

<p>The next example shows a program to run the <code>MessageSource</code> functionality. Remember that all <code>ApplicationContext</code> implementations are also <code>MessageSource</code> implementations and so can be cast to the <code>MessageSource</code> interface.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MessageSource</span> <span class="variable">resources</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> resources.getMessage(<span class="string">&quot;message&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Default&quot;</span>, Locale.ENGLISH);</span><br><span class="line">    System.out.println(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The resulting output from the above program is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alligators rock!</span><br></pre></td></tr></table></figure>

<p>To summarize, the <code>MessageSource</code> is defined in a file called <code>beans.xml</code>, which exists at the root of your classpath. The <code>messageSource</code> bean definition refers to a number of resource bundles through its <code>basenames</code> property. The three files that are passed in the list to the <code>basenames</code> property exist as files at the root of your classpath and are called <code>format.properties</code>, <code>exceptions.properties</code>, and <code>windows.properties</code>, respectively.</p>
<p>The next example shows arguments passed to the message lookup. These arguments are converted into <code>String</code> objects and inserted into placeholders in the lookup message.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- this MessageSource is being used in a web application --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;messageSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;exceptions&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- lets inject the above MessageSource into this POJO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;example&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.Example&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messages&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;messageSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MessageSource messages;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessages</span><span class="params">(MessageSource messages)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.messages = messages;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="built_in">this</span>.messages.getMessage(<span class="string">&quot;argument.required&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Object</span> [] &#123;<span class="string">&quot;userDao&quot;</span>&#125;, <span class="string">&quot;Required&quot;</span>, Locale.ENGLISH);</span><br><span class="line">        System.out.println(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The resulting output from the invocation of the <code>execute()</code> method is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The userDao argument is required.</span><br></pre></td></tr></table></figure>

<p>With regard to internationalization (“i18n”), Spring’s various <code>MessageSource</code> implementations follow the same locale resolution and fallback rules as the standard JDK <code>ResourceBundle</code>. In short, and continuing with the example <code>messageSource</code> defined previously, if you want to resolve messages against the British (<code>en-GB</code>) locale, you would create files called <code>format_en_GB.properties</code>, <code>exceptions_en_GB.properties</code>, and <code>windows_en_GB.properties</code>, respectively.</p>
<p>Typically, locale resolution is managed by the surrounding environment of the application. In the following example, the locale against which (British) messages are resolved is specified manually:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># in exceptions_en_GB.properties</span><br><span class="line">argument.required=Ebagum lad, the &#x27;&#x27;&#123;0&#125;&#x27;&#x27; argument is required, I say, required.</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MessageSource</span> <span class="variable">resources</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> resources.getMessage(<span class="string">&quot;argument.required&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Object</span> [] &#123;<span class="string">&quot;userDao&quot;</span>&#125;, <span class="string">&quot;Required&quot;</span>, Locale.UK);</span><br><span class="line">    System.out.println(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The resulting output from the running of the above program is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ebagum lad, the &#x27;userDao&#x27; argument is required, I say, required.</span><br></pre></td></tr></table></figure>

<p>You can also use the <code>MessageSourceAware</code> interface to acquire a reference to any <code>MessageSource</code> that has been defined. Any bean that is defined in an <code>ApplicationContext</code> that implements the <code>MessageSourceAware</code> interface is injected with the application context’s <code>MessageSource</code> when the bean is created and configured.</p>
<table>
<thead>
<tr>
<th></th>
<th>Because Spring’s <code>MessageSource</code> is based on Java’s <code>ResourceBundle</code>, it does not merge bundles with the same base name, but will only use the first bundle found. Subsequent message bundles with the same base name are ignored.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>As an alternative to <code>ResourceBundleMessageSource</code>, Spring provides a <code>ReloadableResourceBundleMessageSource</code> class. This variant supports the same bundle file format but is more flexible than the standard JDK based <code>ResourceBundleMessageSource</code> implementation. In particular, it allows for reading files from any Spring resource location (not only from the classpath) and supports hot reloading of bundle property files (while efficiently caching them in between). See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/support/ReloadableResourceBundleMessageSource.html"><code>ReloadableResourceBundleMessageSource</code></a> javadoc for details.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-15-2-Standard-and-Custom-Events"><a href="#1-15-2-Standard-and-Custom-Events" class="headerlink" title="1.15.2. Standard and Custom Events"></a>1.15.2. Standard and Custom Events</h4><p>Event handling in the <code>ApplicationContext</code> is provided through the <code>ApplicationEvent</code> class and the <code>ApplicationListener</code> interface. If a bean that implements the <code>ApplicationListener</code> interface is deployed into the context, every time an <code>ApplicationEvent</code> gets published to the <code>ApplicationContext</code>, that bean is notified. Essentially, this is the standard Observer design pattern.</p>
<table>
<thead>
<tr>
<th></th>
<th>As of Spring 4.2, the event infrastructure has been significantly improved and offers an <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-events-annotation">annotation-based model</a> as well as the ability to publish any arbitrary event (that is, an object that does not necessarily extend from <code>ApplicationEvent</code>). When such an object is published, we wrap it in an event for you.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following table describes the standard events that Spring provides:</p>
<table>
<thead>
<tr>
<th align="left">Event</th>
<th align="left">Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ContextRefreshedEvent</code></td>
<td align="left">Published when the <code>ApplicationContext</code> is initialized or refreshed (for example, by using the <code>refresh()</code> method on the <code>ConfigurableApplicationContext</code> interface). Here, “initialized” means that all beans are loaded, post-processor beans are detected and activated, singletons are pre-instantiated, and the <code>ApplicationContext</code> object is ready for use. As long as the context has not been closed, a refresh can be triggered multiple times, provided that the chosen <code>ApplicationContext</code> actually supports such “hot” refreshes. For example, <code>XmlWebApplicationContext</code> supports hot refreshes, but <code>GenericApplicationContext</code> does not.</td>
</tr>
<tr>
<td align="left"><code>ContextStartedEvent</code></td>
<td align="left">Published when the <code>ApplicationContext</code> is started by using the <code>start()</code> method on the <code>ConfigurableApplicationContext</code> interface. Here, “started” means that all <code>Lifecycle</code> beans receive an explicit start signal. Typically, this signal is used to restart beans after an explicit stop, but it may also be used to start components that have not been configured for autostart (for example, components that have not already started on initialization).</td>
</tr>
<tr>
<td align="left"><code>ContextStoppedEvent</code></td>
<td align="left">Published when the <code>ApplicationContext</code> is stopped by using the <code>stop()</code> method on the <code>ConfigurableApplicationContext</code> interface. Here, “stopped” means that all <code>Lifecycle</code> beans receive an explicit stop signal. A stopped context may be restarted through a <code>start()</code> call.</td>
</tr>
<tr>
<td align="left"><code>ContextClosedEvent</code></td>
<td align="left">Published when the <code>ApplicationContext</code> is being closed by using the <code>close()</code> method on the <code>ConfigurableApplicationContext</code> interface or via a JVM shutdown hook. Here, “closed” means that all singleton beans will be destroyed. Once the context is closed, it reaches its end of life and cannot be refreshed or restarted.</td>
</tr>
<tr>
<td align="left"><code>RequestHandledEvent</code></td>
<td align="left">A web-specific event telling all beans that an HTTP request has been serviced. This event is published after the request is complete. This event is only applicable to web applications that use Spring’s <code>DispatcherServlet</code>.</td>
</tr>
<tr>
<td align="left"><code>ServletRequestHandledEvent</code></td>
<td align="left">A subclass of <code>RequestHandledEvent</code> that adds Servlet-specific context information.</td>
</tr>
</tbody></table>
<p>You can also create and publish your own custom events. The following example shows a simple class that extends Spring’s <code>ApplicationEvent</code> base class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockedListEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String address;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BlockedListEvent</span><span class="params">(Object source, String address, String content)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// accessor and other methods...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To publish a custom <code>ApplicationEvent</code>, call the <code>publishEvent()</code> method on an <code>ApplicationEventPublisher</code>. Typically, this is done by creating a class that implements <code>ApplicationEventPublisherAware</code> and registering it as a Spring bean. The following example shows such a class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventPublisherAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; blockedList;</span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher publisher;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBlockedList</span><span class="params">(List&lt;String&gt; blockedList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.blockedList = blockedList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher publisher)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.publisher = publisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">(String address, String content)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (blockedList.contains(address)) &#123;</span><br><span class="line">            publisher.publishEvent(<span class="keyword">new</span> <span class="title class_">BlockedListEvent</span>(<span class="built_in">this</span>, address, content));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// send email...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At configuration time, the Spring container detects that <code>EmailService</code> implements <code>ApplicationEventPublisherAware</code> and automatically calls <code>setApplicationEventPublisher()</code>. In reality, the parameter passed in is the Spring container itself. You are interacting with the application context through its <code>ApplicationEventPublisher</code> interface.</p>
<p>To receive the custom <code>ApplicationEvent</code>, you can create a class that implements <code>ApplicationListener</code> and register it as a Spring bean. The following example shows such a class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockedListNotifier</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;BlockedListEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String notificationAddress;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNotificationAddress</span><span class="params">(String notificationAddress)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.notificationAddress = notificationAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(BlockedListEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// notify appropriate parties via notificationAddress...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that <code>ApplicationListener</code> is generically parameterized with the type of your custom event (<code>BlockedListEvent</code> in the preceding example). This means that the <code>onApplicationEvent()</code> method can remain type-safe, avoiding any need for downcasting. You can register as many event listeners as you wish, but note that, by default, event listeners receive events synchronously. This means that the <code>publishEvent()</code> method blocks until all listeners have finished processing the event. One advantage of this synchronous and single-threaded approach is that, when a listener receives an event, it operates inside the transaction context of the publisher if a transaction context is available. If another strategy for event publication becomes necessary, see the javadoc for Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/event/ApplicationEventMulticaster.html"><code>ApplicationEventMulticaster</code></a> interface and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/event/SimpleApplicationEventMulticaster.html"><code>SimpleApplicationEventMulticaster</code></a> implementation for configuration options.</p>
<p>The following example shows the bean definitions used to register and configure each of the classes above:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emailService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.EmailService&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;blockedList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>known.spammer@example.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>known.hacker@example.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>john.doe@example.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;blockedListNotifier&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.BlockedListNotifier&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;notificationAddress&quot;</span> <span class="attr">value</span>=<span class="string">&quot;blockedlist@example.org&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Putting it all together, when the <code>sendEmail()</code> method of the <code>emailService</code> bean is called, if there are any email messages that should be blocked, a custom event of type <code>BlockedListEvent</code> is published. The <code>blockedListNotifier</code> bean is registered as an <code>ApplicationListener</code> and receives the <code>BlockedListEvent</code>, at which point it can notify appropriate parties.</p>
<table>
<thead>
<tr>
<th></th>
<th>Spring’s eventing mechanism is designed for simple communication between Spring beans within the same application context. However, for more sophisticated enterprise integration needs, the separately maintained <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-integration/">Spring Integration</a> project provides complete support for building lightweight, <a target="_blank" rel="noopener" href="https://www.enterpriseintegrationpatterns.com/">pattern-oriented</a>, event-driven architectures that build upon the well-known Spring programming model.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Annotation-based-Event-Listeners"><a href="#Annotation-based-Event-Listeners" class="headerlink" title="Annotation-based Event Listeners"></a>Annotation-based Event Listeners</h5><p>You can register an event listener on any method of a managed bean by using the <code>@EventListener</code> annotation. The <code>BlockedListNotifier</code> can be rewritten as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockedListNotifier</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String notificationAddress;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNotificationAddress</span><span class="params">(String notificationAddress)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.notificationAddress = notificationAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processBlockedListEvent</span><span class="params">(BlockedListEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// notify appropriate parties via notificationAddress...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The method signature once again declares the event type to which it listens, but, this time, with a flexible name and without implementing a specific listener interface. The event type can also be narrowed through generics as long as the actual event type resolves your generic parameter in its implementation hierarchy.</p>
<p>If your method should listen to several events or if you want to define it with no parameter at all, the event types can also be specified on the annotation itself. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener(&#123;ContextStartedEvent.class, ContextRefreshedEvent.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleContextStart</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It is also possible to add additional runtime filtering by using the <code>condition</code> attribute of the annotation that defines a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions"><code>SpEL</code> expression</a>, which should match to actually invoke the method for a particular event.</p>
<p>The following example shows how our notifier can be rewritten to be invoked only if the <code>content</code> attribute of the event is equal to <code>my-event</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener(condition = &quot;#blEvent.content == &#x27;my-event&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processBlockedListEvent</span><span class="params">(BlockedListEvent blEvent)</span> &#123;</span><br><span class="line">    <span class="comment">// notify appropriate parties via notificationAddress...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Each <code>SpEL</code> expression evaluates against a dedicated context. The following table lists the items made available to the context so that you can use them for conditional event processing:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Location</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Event</td>
<td align="left">root object</td>
<td align="left">The actual <code>ApplicationEvent</code>.</td>
<td align="left"><code>#root.event</code> or <code>event</code></td>
</tr>
<tr>
<td align="left">Arguments array</td>
<td align="left">root object</td>
<td align="left">The arguments (as an object array) used to invoke the method.</td>
<td align="left"><code>#root.args</code> or <code>args</code>; <code>args[0]</code> to access the first argument, etc.</td>
</tr>
<tr>
<td align="left"><em>Argument name</em></td>
<td align="left">evaluation context</td>
<td align="left">The name of any of the method arguments. If, for some reason, the names are not available (for example, because there is no debug information in the compiled byte code), individual arguments are also available using the <code>#a&lt;#arg&gt;</code> syntax where <code>&lt;#arg&gt;</code> stands for the argument index (starting from 0).</td>
<td align="left"><code>#blEvent</code> or <code>#a0</code> (you can also use <code>#p0</code> or <code>#p&lt;#arg&gt;</code> parameter notation as an alias)</td>
</tr>
</tbody></table>
<p>Note that <code>#root.event</code> gives you access to the underlying event, even if your method signature actually refers to an arbitrary object that was published.</p>
<p>If you need to publish an event as the result of processing another event, you can change the method signature to return the event that should be published, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="keyword">public</span> ListUpdateEvent <span class="title function_">handleBlockedListEvent</span><span class="params">(BlockedListEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">// notify appropriate parties via notificationAddress and</span></span><br><span class="line">    <span class="comment">// then publish a ListUpdateEvent...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This feature is not supported for <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-events-async">asynchronous listeners</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The <code>handleBlockedListEvent()</code> method publishes a new <code>ListUpdateEvent</code> for every <code>BlockedListEvent</code> that it handles. If you need to publish several events, you can return a <code>Collection</code> or an array of events instead.</p>
<h5 id="Asynchronous-Listeners"><a href="#Asynchronous-Listeners" class="headerlink" title="Asynchronous Listeners"></a>Asynchronous Listeners</h5><p>If you want a particular listener to process events asynchronously, you can reuse the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#scheduling-annotation-support-async">regular <code>@Async</code> support</a>. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processBlockedListEvent</span><span class="params">(BlockedListEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">// BlockedListEvent is processed in a separate thread</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Be aware of the following limitations when using asynchronous events:</p>
<ul>
<li>If an asynchronous event listener throws an <code>Exception</code>, it is not propagated to the caller. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/aop/interceptor/AsyncUncaughtExceptionHandler.html"><code>AsyncUncaughtExceptionHandler</code></a> for more details.</li>
<li>Asynchronous event listener methods cannot publish a subsequent event by returning a value. If you need to publish another event as the result of the processing, inject an <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/ApplicationEventPublisher.html"><code>ApplicationEventPublisher</code></a> to publish the event manually.</li>
</ul>
<h5 id="Ordering-Listeners"><a href="#Ordering-Listeners" class="headerlink" title="Ordering Listeners"></a>Ordering Listeners</h5><p>If you need one listener to be invoked before another one, you can add the <code>@Order</code> annotation to the method declaration, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="meta">@Order(42)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processBlockedListEvent</span><span class="params">(BlockedListEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">// notify appropriate parties via notificationAddress...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Generic-Events"><a href="#Generic-Events" class="headerlink" title="Generic Events"></a>Generic Events</h5><p>You can also use generics to further define the structure of your event. Consider using an <code>EntityCreatedEvent&lt;T&gt;</code> where <code>T</code> is the type of the actual entity that got created. For example, you can create the following listener definition to receive only <code>EntityCreatedEvent</code> for a <code>Person</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPersonCreated</span><span class="params">(EntityCreatedEvent&lt;Person&gt; event)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Due to type erasure, this works only if the event that is fired resolves the generic parameters on which the event listener filters (that is, something like <code>class PersonCreatedEvent extends EntityCreatedEvent&lt;Person&gt; &#123; … &#125;</code>).</p>
<p>In certain circumstances, this may become quite tedious if all events follow the same structure (as should be the case for the event in the preceding example). In such a case, you can implement <code>ResolvableTypeProvider</code> to guide the framework beyond what the runtime environment provides. The following event shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EntityCreatedEvent</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> <span class="keyword">implements</span> <span class="title class_">ResolvableTypeProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EntityCreatedEvent</span><span class="params">(T entity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResolvableType <span class="title function_">getResolvableType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResolvableType.forClassWithGenerics(getClass(), ResolvableType.forInstance(getSource()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This works not only for <code>ApplicationEvent</code> but any arbitrary object that you send as an event.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-15-3-Convenient-Access-to-Low-level-Resources"><a href="#1-15-3-Convenient-Access-to-Low-level-Resources" class="headerlink" title="1.15.3. Convenient Access to Low-level Resources"></a>1.15.3. Convenient Access to Low-level Resources</h4><p>For optimal usage and understanding of application contexts, you should familiarize yourself with Spring’s <code>Resource</code> abstraction, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources">Resources</a>.</p>
<p>An application context is a <code>ResourceLoader</code>, which can be used to load <code>Resource</code> objects. A <code>Resource</code> is essentially a more feature rich version of the JDK <code>java.net.URL</code> class. In fact, the implementations of the <code>Resource</code> wrap an instance of <code>java.net.URL</code>, where appropriate. A <code>Resource</code> can obtain low-level resources from almost any location in a transparent fashion, including from the classpath, a filesystem location, anywhere describable with a standard URL, and some other variations. If the resource location string is a simple path without any special prefixes, where those resources come from is specific and appropriate to the actual application context type.</p>
<p>You can configure a bean deployed into the application context to implement the special callback interface, <code>ResourceLoaderAware</code>, to be automatically called back at initialization time with the application context itself passed in as the <code>ResourceLoader</code>. You can also expose properties of type <code>Resource</code>, to be used to access static resources. They are injected into it like any other properties. You can specify those <code>Resource</code> properties as simple <code>String</code> paths and rely on automatic conversion from those text strings to actual <code>Resource</code> objects when the bean is deployed.</p>
<p>The location path or paths supplied to an <code>ApplicationContext</code> constructor are actually resource strings and, in simple form, are treated appropriately according to the specific context implementation. For example <code>ClassPathXmlApplicationContext</code> treats a simple location path as a classpath location. You can also use location paths (resource strings) with special prefixes to force loading of definitions from the classpath or a URL, regardless of the actual context type.</p>
<h4 id="1-15-4-Application-Startup-Tracking"><a href="#1-15-4-Application-Startup-Tracking" class="headerlink" title="1.15.4. Application Startup Tracking"></a>1.15.4. Application Startup Tracking</h4><p>The <code>ApplicationContext</code> manages the lifecycle of Spring applications and provides a rich programming model around components. As a result, complex applications can have equally complex component graphs and startup phases.</p>
<p>Tracking the application startup steps with specific metrics can help understand where time is being spent during the startup phase, but it can also be used as a way to better understand the context lifecycle as a whole.</p>
<p>The <code>AbstractApplicationContext</code> (and its subclasses) is instrumented with an <code>ApplicationStartup</code>, which collects <code>StartupStep</code> data about various startup phases:</p>
<ul>
<li>application context lifecycle (base packages scanning, config classes management)</li>
<li>beans lifecycle (instantiation, smart initialization, post processing)</li>
<li>application events processing</li>
</ul>
<p>Here is an example of instrumentation in the <code>AnnotationConfigApplicationContext</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a startup step and start recording</span></span><br><span class="line"><span class="type">StartupStep</span> <span class="variable">scanPackages</span> <span class="operator">=</span> <span class="built_in">this</span>.getApplicationStartup().start(<span class="string">&quot;spring.context.base-packages.scan&quot;</span>);</span><br><span class="line"><span class="comment">// add tagging information to the current step</span></span><br><span class="line">scanPackages.tag(<span class="string">&quot;packages&quot;</span>, () -&gt; Arrays.toString(basePackages));</span><br><span class="line"><span class="comment">// perform the actual phase we&#x27;re instrumenting</span></span><br><span class="line"><span class="built_in">this</span>.scanner.scan(basePackages);</span><br><span class="line"><span class="comment">// end the current step</span></span><br><span class="line">scanPackages.end();</span><br></pre></td></tr></table></figure>

<p>The application context is already instrumented with multiple steps. Once recorded, these startup steps can be collected, displayed and analyzed with specific tools. For a complete list of existing startup steps, you can check out the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#application-startup-steps">dedicated appendix section</a>.</p>
<p>The default <code>ApplicationStartup</code> implementation is a no-op variant, for minimal overhead. This means no metrics will be collected during application startup by default. Spring Framework ships with an implementation for tracking startup steps with Java Flight Recorder: <code>FlightRecorderApplicationStartup</code>. To use this variant, you must configure an instance of it to the <code>ApplicationContext</code> as soon as it’s been created.</p>
<p>Developers can also use the <code>ApplicationStartup</code> infrastructure if they’re providing their own <code>AbstractApplicationContext</code> subclass, or if they wish to collect more precise data.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>ApplicationStartup</code> is meant to be only used during application startup and for the core container; this is by no means a replacement for Java profilers or metrics libraries like <a target="_blank" rel="noopener" href="https://micrometer.io/">Micrometer</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>To start collecting custom <code>StartupStep</code>, components can either get the <code>ApplicationStartup</code> instance from the application context directly, make their component implement <code>ApplicationStartupAware</code>, or ask for the <code>ApplicationStartup</code> type on any injection point.</p>
<table>
<thead>
<tr>
<th></th>
<th>Developers should not use the <code>&quot;spring.*&quot;</code> namespace when creating custom startup steps. This namespace is reserved for internal Spring usage and is subject to change.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-15-5-Convenient-ApplicationContext-Instantiation-for-Web-Applications"><a href="#1-15-5-Convenient-ApplicationContext-Instantiation-for-Web-Applications" class="headerlink" title="1.15.5. Convenient ApplicationContext Instantiation for Web Applications"></a>1.15.5. Convenient ApplicationContext Instantiation for Web Applications</h4><p>You can create <code>ApplicationContext</code> instances declaratively by using, for example, a <code>ContextLoader</code>. Of course, you can also create <code>ApplicationContext</code> instances programmatically by using one of the <code>ApplicationContext</code> implementations.</p>
<p>You can register an <code>ApplicationContext</code> by using the <code>ContextLoaderListener</code>, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The listener inspects the <code>contextConfigLocation</code> parameter. If the parameter does not exist, the listener uses <code>/WEB-INF/applicationContext.xml</code> as a default. When the parameter does exist, the listener separates the <code>String</code> by using predefined delimiters (comma, semicolon, and whitespace) and uses the values as locations where application contexts are searched. Ant-style path patterns are supported as well. Examples are <code>/WEB-INF/*Context.xml</code> (for all files with names that end with <code>Context.xml</code> and that reside in the <code>WEB-INF</code> directory) and <code>/WEB-INF/**/*Context.xml</code> (for all such files in any subdirectory of <code>WEB-INF</code>).</p>
<h4 id="1-15-6-Deploying-a-Spring-ApplicationContext-as-a-Java-EE-RAR-File"><a href="#1-15-6-Deploying-a-Spring-ApplicationContext-as-a-Java-EE-RAR-File" class="headerlink" title="1.15.6. Deploying a Spring ApplicationContext as a Java EE RAR File"></a>1.15.6. Deploying a Spring <code>ApplicationContext</code> as a Java EE RAR File</h4><p>It is possible to deploy a Spring <code>ApplicationContext</code> as a RAR file, encapsulating the context and all of its required bean classes and library JARs in a Java EE RAR deployment unit. This is the equivalent of bootstrapping a stand-alone <code>ApplicationContext</code> (only hosted in Java EE environment) being able to access the Java EE servers facilities. RAR deployment is a more natural alternative to a scenario of deploying a headless WAR file — in effect, a WAR file without any HTTP entry points that is used only for bootstrapping a Spring <code>ApplicationContext</code> in a Java EE environment.</p>
<p>RAR deployment is ideal for application contexts that do not need HTTP entry points but rather consist only of message endpoints and scheduled jobs. Beans in such a context can use application server resources such as the JTA transaction manager and JNDI-bound JDBC <code>DataSource</code> instances and JMS <code>ConnectionFactory</code> instances and can also register with the platform’s JMX server — all through Spring’s standard transaction management and JNDI and JMX support facilities. Application components can also interact with the application server’s JCA <code>WorkManager</code> through Spring’s <code>TaskExecutor</code> abstraction.</p>
<p>See the javadoc of the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html"><code>SpringContextResourceAdapter</code></a> class for the configuration details involved in RAR deployment.</p>
<p>For a simple deployment of a Spring ApplicationContext as a Java EE RAR file:</p>
<ol>
<li>Package all application classes into a RAR file (which is a standard JAR file with a different file extension).</li>
<li>Add all required library JARs into the root of the RAR archive.</li>
<li>Add a <code>META-INF/ra.xml</code> deployment descriptor (as shown in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html">javadoc for <code>SpringContextResourceAdapter</code></a>) and the corresponding Spring XML bean definition file(s) (typically <code>META-INF/applicationContext.xml</code>).</li>
<li>Drop the resulting RAR file into your application server’s deployment directory.</li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th>Such RAR deployment units are usually self-contained. They do not expose components to the outside world, not even to other modules of the same application. Interaction with a RAR-based <code>ApplicationContext</code> usually occurs through JMS destinations that it shares with other modules. A RAR-based <code>ApplicationContext</code> may also, for example, schedule some jobs or react to new files in the file system (or the like). If it needs to allow synchronous access from the outside, it could (for example) export RMI endpoints, which may be used by other application modules on the same machine.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-16-The-BeanFactory-API"><a href="#1-16-The-BeanFactory-API" class="headerlink" title="1.16. The BeanFactory API"></a>1.16. The <code>BeanFactory</code> API</h3><p>The <code>BeanFactory</code> API provides the underlying basis for Spring’s IoC functionality. Its specific contracts are mostly used in integration with other parts of Spring and related third-party frameworks, and its <code>DefaultListableBeanFactory</code> implementation is a key delegate within the higher-level <code>GenericApplicationContext</code> container.</p>
<p><code>BeanFactory</code> and related interfaces (such as <code>BeanFactoryAware</code>, <code>InitializingBean</code>, <code>DisposableBean</code>) are important integration points for other framework components. By not requiring any annotations or even reflection, they allow for very efficient interaction between the container and its components. Application-level beans may use the same callback interfaces but typically prefer declarative dependency injection instead, either through annotations or through programmatic configuration.</p>
<p>Note that the core <code>BeanFactory</code> API level and its <code>DefaultListableBeanFactory</code> implementation do not make assumptions about the configuration format or any component annotations to be used. All of these flavors come in through extensions (such as <code>XmlBeanDefinitionReader</code> and <code>AutowiredAnnotationBeanPostProcessor</code>) and operate on shared <code>BeanDefinition</code> objects as a core metadata representation. This is the essence of what makes Spring’s container so flexible and extensible.</p>
<h4 id="1-16-1-BeanFactory-or-ApplicationContext"><a href="#1-16-1-BeanFactory-or-ApplicationContext" class="headerlink" title="1.16.1. BeanFactory or ApplicationContext?"></a>1.16.1. <code>BeanFactory</code> or <code>ApplicationContext</code>?</h4><p>This section explains the differences between the <code>BeanFactory</code> and <code>ApplicationContext</code> container levels and the implications on bootstrapping.</p>
<p>You should use an <code>ApplicationContext</code> unless you have a good reason for not doing so, with <code>GenericApplicationContext</code> and its subclass <code>AnnotationConfigApplicationContext</code> as the common implementations for custom bootstrapping. These are the primary entry points to Spring’s core container for all common purposes: loading of configuration files, triggering a classpath scan, programmatically registering bean definitions and annotated classes, and (as of 5.0) registering functional bean definitions.</p>
<p>Because an <code>ApplicationContext</code> includes all the functionality of a <code>BeanFactory</code>, it is generally recommended over a plain <code>BeanFactory</code>, except for scenarios where full control over bean processing is needed. Within an <code>ApplicationContext</code> (such as the <code>GenericApplicationContext</code> implementation), several kinds of beans are detected by convention (that is, by bean name or by bean type — in particular, post-processors), while a plain <code>DefaultListableBeanFactory</code> is agnostic about any special beans.</p>
<p>For many extended container features, such as annotation processing and AOP proxying, the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-extension-bpp"><code>BeanPostProcessor</code> extension point</a> is essential. If you use only a plain <code>DefaultListableBeanFactory</code>, such post-processors do not get detected and activated by default. This situation could be confusing, because nothing is actually wrong with your bean configuration. Rather, in such a scenario, the container needs to be fully bootstrapped through additional setup.</p>
<p>The following table lists features provided by the <code>BeanFactory</code> and <code>ApplicationContext</code> interfaces and implementations.</p>
<table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left"><code>BeanFactory</code></th>
<th align="left"><code>ApplicationContext</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Bean instantiation&#x2F;wiring</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Integrated lifecycle management</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Automatic <code>BeanPostProcessor</code> registration</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Automatic <code>BeanFactoryPostProcessor</code> registration</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Convenient <code>MessageSource</code> access (for internationalization)</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Built-in <code>ApplicationEvent</code> publication mechanism</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
</tbody></table>
<p>To explicitly register a bean post-processor with a <code>DefaultListableBeanFactory</code>, you need to programmatically call <code>addBeanPostProcessor</code>, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="comment">// populate the factory with bean definitions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// now register any needed BeanPostProcessor instances</span></span><br><span class="line">factory.addBeanPostProcessor(<span class="keyword">new</span> <span class="title class_">AutowiredAnnotationBeanPostProcessor</span>());</span><br><span class="line">factory.addBeanPostProcessor(<span class="keyword">new</span> <span class="title class_">MyBeanPostProcessor</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// now start using the factory</span></span><br></pre></td></tr></table></figure>

<p>To apply a <code>BeanFactoryPostProcessor</code> to a plain <code>DefaultListableBeanFactory</code>, you need to call its <code>postProcessBeanFactory</code> method, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(factory);</span><br><span class="line">reader.loadBeanDefinitions(<span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(<span class="string">&quot;beans.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// bring in some property values from a Properties file</span></span><br><span class="line"><span class="type">PropertySourcesPlaceholderConfigurer</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertySourcesPlaceholderConfigurer</span>();</span><br><span class="line">cfg.setLocation(<span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(<span class="string">&quot;jdbc.properties&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// now actually do the replacement</span></span><br><span class="line">cfg.postProcessBeanFactory(factory);</span><br></pre></td></tr></table></figure>

<p>In both cases, the explicit registration steps are inconvenient, which is why the various <code>ApplicationContext</code> variants are preferred over a plain <code>DefaultListableBeanFactory</code> in Spring-backed applications, especially when relying on <code>BeanFactoryPostProcessor</code> and <code>BeanPostProcessor</code> instances for extended container functionality in a typical enterprise setup.</p>
<table>
<thead>
<tr>
<th></th>
<th>An <code>AnnotationConfigApplicationContext</code> has all common annotation post-processors registered and may bring in additional processors underneath the covers through configuration annotations, such as <code>@EnableTransactionManagement</code>. At the abstraction level of Spring’s annotation-based configuration model, the notion of bean post-processors becomes a mere internal container detail.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="2-Resources"><a href="#2-Resources" class="headerlink" title="2. Resources"></a>2. Resources</h2><p>This chapter covers how Spring handles resources and how you can work with resources in Spring. It includes the following topics:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-introduction">Introduction</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-resource">The <code>Resource</code> Interface</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations">Built-in <code>Resource</code> Implementations</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-resourceloader">The <code>ResourceLoader</code> Interface</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-resourcepatternresolver">The <code>ResourcePatternResolver</code> Interface</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-resourceloaderaware">The <code>ResourceLoaderAware</code> Interface</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-as-dependencies">Resources as Dependencies</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-app-ctx">Application Contexts and Resource Paths</a></li>
</ul>
<h3 id="2-1-Introduction"><a href="#2-1-Introduction" class="headerlink" title="2.1. Introduction"></a>2.1. Introduction</h3><p>Java’s standard <code>java.net.URL</code> class and standard handlers for various URL prefixes, unfortunately, are not quite adequate enough for all access to low-level resources. For example, there is no standardized <code>URL</code> implementation that may be used to access a resource that needs to be obtained from the classpath or relative to a <code>ServletContext</code>. While it is possible to register new handlers for specialized <code>URL</code> prefixes (similar to existing handlers for prefixes such as <code>http:</code>), this is generally quite complicated, and the <code>URL</code> interface still lacks some desirable functionality, such as a method to check for the existence of the resource being pointed to.</p>
<h3 id="2-2-The-Resource-Interface"><a href="#2-2-The-Resource-Interface" class="headerlink" title="2.2. The Resource Interface"></a>2.2. The <code>Resource</code> Interface</h3><p>Spring’s <code>Resource</code> interface located in the <code>org.springframework.core.io.</code> package is meant to be a more capable interface for abstracting access to low-level resources. The following listing provides an overview of the <code>Resource</code> interface. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/io/Resource.html"><code>Resource</code></a> javadoc for further details.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Resource</span> <span class="keyword">extends</span> <span class="title class_">InputStreamSource</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">exists</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isReadable</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isOpen</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isFile</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    URL <span class="title function_">getURL</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    URI <span class="title function_">getURI</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    File <span class="title function_">getFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    ReadableByteChannel <span class="title function_">readableChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="title function_">contentLength</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="title function_">lastModified</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    Resource <span class="title function_">createRelative</span><span class="params">(String relativePath)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getFilename</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As the definition of the <code>Resource</code> interface shows, it extends the <code>InputStreamSource</code> interface. The following listing shows the definition of the <code>InputStreamSource</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InputStreamSource</span> &#123;</span><br><span class="line"></span><br><span class="line">    InputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Some of the most important methods from the <code>Resource</code> interface are:</p>
<ul>
<li><code>getInputStream()</code>: Locates and opens the resource, returning an <code>InputStream</code> for reading from the resource. It is expected that each invocation returns a fresh <code>InputStream</code>. It is the responsibility of the caller to close the stream.</li>
<li><code>exists()</code>: Returns a <code>boolean</code> indicating whether this resource actually exists in physical form.</li>
<li><code>isOpen()</code>: Returns a <code>boolean</code> indicating whether this resource represents a handle with an open stream. If <code>true</code>, the <code>InputStream</code> cannot be read multiple times and must be read once only and then closed to avoid resource leaks. Returns <code>false</code> for all usual resource implementations, with the exception of <code>InputStreamResource</code>.</li>
<li><code>getDescription()</code>: Returns a description for this resource, to be used for error output when working with the resource. This is often the fully qualified file name or the actual URL of the resource.</li>
</ul>
<p>Other methods let you obtain an actual <code>URL</code> or <code>File</code> object representing the resource (if the underlying implementation is compatible and supports that functionality).</p>
<p>Some implementations of the <code>Resource</code> interface also implement the extended <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/io/WritableResource.html"><code>WritableResource</code></a> interface for a resource that supports writing to it.</p>
<p>Spring itself uses the <code>Resource</code> abstraction extensively, as an argument type in many method signatures when a resource is needed. Other methods in some Spring APIs (such as the constructors to various <code>ApplicationContext</code> implementations) take a <code>String</code> which in unadorned or simple form is used to create a <code>Resource</code> appropriate to that context implementation or, via special prefixes on the <code>String</code> path, let the caller specify that a specific <code>Resource</code> implementation must be created and used.</p>
<p>While the <code>Resource</code> interface is used a lot with Spring and by Spring, it is actually very convenient to use as a general utility class by itself in your own code, for access to resources, even when your code does not know or care about any other parts of Spring. While this couples your code to Spring, it really only couples it to this small set of utility classes, which serves as a more capable replacement for <code>URL</code> and can be considered equivalent to any other library you would use for this purpose.</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>Resource</code> abstraction does not replace functionality. It wraps it where possible. For example, a <code>UrlResource</code> wraps a URL and uses the wrapped <code>URL</code> to do its work.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-3-Built-in-Resource-Implementations"><a href="#2-3-Built-in-Resource-Implementations" class="headerlink" title="2.3. Built-in Resource Implementations"></a>2.3. Built-in <code>Resource</code> Implementations</h3><p>Spring includes several built-in <code>Resource</code> implementations:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-urlresource"><code>UrlResource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-classpathresource"><code>ClassPathResource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-filesystemresource"><code>FileSystemResource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-pathresource"><code>PathResource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-servletcontextresource"><code>ServletContextResource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-inputstreamresource"><code>InputStreamResource</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-implementations-bytearrayresource"><code>ByteArrayResource</code></a></li>
</ul>
<p>For a complete list of <code>Resource</code> implementations available in Spring, consult the “All Known Implementing Classes” section of the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/core/io/Resource.html"><code>Resource</code></a> javadoc.</p>
<h4 id="2-3-1-UrlResource"><a href="#2-3-1-UrlResource" class="headerlink" title="2.3.1. UrlResource"></a>2.3.1. <code>UrlResource</code></h4><p><code>UrlResource</code> wraps a <code>java.net.URL</code> and can be used to access any object that is normally accessible with a URL, such as files, an HTTPS target, an FTP target, and others. All URLs have a standardized <code>String</code> representation, such that appropriate standardized prefixes are used to indicate one URL type from another. This includes <code>file:</code> for accessing filesystem paths, <code>https:</code> for accessing resources through the HTTPS protocol, <code>ftp:</code> for accessing resources through FTP, and others.</p>
<p>A <code>UrlResource</code> is created by Java code by explicitly using the <code>UrlResource</code> constructor but is often created implicitly when you call an API method that takes a <code>String</code> argument meant to represent a path. For the latter case, a JavaBeans <code>PropertyEditor</code> ultimately decides which type of <code>Resource</code> to create. If the path string contains a well-known (to property editor, that is) prefix (such as <code>classpath:</code>), it creates an appropriate specialized <code>Resource</code> for that prefix. However, if it does not recognize the prefix, it assumes the string is a standard URL string and creates a <code>UrlResource</code>.</p>
<h4 id="2-3-2-ClassPathResource"><a href="#2-3-2-ClassPathResource" class="headerlink" title="2.3.2. ClassPathResource"></a>2.3.2. <code>ClassPathResource</code></h4><p>This class represents a resource that should be obtained from the classpath. It uses either the thread context class loader, a given class loader, or a given class for loading resources.</p>
<p>This <code>Resource</code> implementation supports resolution as a <code>java.io.File</code> if the class path resource resides in the file system but not for classpath resources that reside in a jar and have not been expanded (by the servlet engine or whatever the environment is) to the filesystem. To address this, the various <code>Resource</code> implementations always support resolution as a <code>java.net.URL</code>.</p>
<p>A <code>ClassPathResource</code> is created by Java code by explicitly using the <code>ClassPathResource</code> constructor but is often created implicitly when you call an API method that takes a <code>String</code> argument meant to represent a path. For the latter case, a JavaBeans <code>PropertyEditor</code> recognizes the special prefix, <code>classpath:</code>, on the string path and creates a <code>ClassPathResource</code> in that case.</p>
<h4 id="2-3-3-FileSystemResource"><a href="#2-3-3-FileSystemResource" class="headerlink" title="2.3.3. FileSystemResource"></a>2.3.3. <code>FileSystemResource</code></h4><p>This is a <code>Resource</code> implementation for <code>java.io.File</code> handles. It also supports <code>java.nio.file.Path</code> handles, applying Spring’s standard String-based path transformations but performing all operations via the <code>java.nio.file.Files</code> API. For pure <code>java.nio.path.Path</code> based support use a <code>PathResource</code> instead. <code>FileSystemResource</code> supports resolution as a <code>File</code> and as a <code>URL</code>.</p>
<h4 id="2-3-4-PathResource"><a href="#2-3-4-PathResource" class="headerlink" title="2.3.4. PathResource"></a>2.3.4. <code>PathResource</code></h4><p>This is a <code>Resource</code> implementation for <code>java.nio.file.Path</code> handles, performing all operations and transformations via the <code>Path</code> API. It supports resolution as a <code>File</code> and as a <code>URL</code> and also implements the extended <code>WritableResource</code> interface. <code>PathResource</code> is effectively a pure <code>java.nio.path.Path</code> based alternative to <code>FileSystemResource</code> with different <code>createRelative</code> behavior.</p>
<h4 id="2-3-5-ServletContextResource"><a href="#2-3-5-ServletContextResource" class="headerlink" title="2.3.5. ServletContextResource"></a>2.3.5. <code>ServletContextResource</code></h4><p>This is a <code>Resource</code> implementation for <code>ServletContext</code> resources that interprets relative paths within the relevant web application’s root directory.</p>
<p>It always supports stream access and URL access but allows <code>java.io.File</code> access only when the web application archive is expanded and the resource is physically on the filesystem. Whether or not it is expanded and on the filesystem or accessed directly from the JAR or somewhere else like a database (which is conceivable) is actually dependent on the Servlet container.</p>
<h4 id="2-3-6-InputStreamResource"><a href="#2-3-6-InputStreamResource" class="headerlink" title="2.3.6. InputStreamResource"></a>2.3.6. <code>InputStreamResource</code></h4><p>An <code>InputStreamResource</code> is a <code>Resource</code> implementation for a given <code>InputStream</code>. It should be used only if no specific <code>Resource</code> implementation is applicable. In particular, prefer <code>ByteArrayResource</code> or any of the file-based <code>Resource</code> implementations where possible.</p>
<p>In contrast to other <code>Resource</code> implementations, this is a descriptor for an already-opened resource. Therefore, it returns <code>true</code> from <code>isOpen()</code>. Do not use it if you need to keep the resource descriptor somewhere or if you need to read a stream multiple times.</p>
<h4 id="2-3-7-ByteArrayResource"><a href="#2-3-7-ByteArrayResource" class="headerlink" title="2.3.7. ByteArrayResource"></a>2.3.7. <code>ByteArrayResource</code></h4><p>This is a <code>Resource</code> implementation for a given byte array. It creates a <code>ByteArrayInputStream</code> for the given byte array.</p>
<p>It is useful for loading content from any given byte array without having to resort to a single-use <code>InputStreamResource</code>.</p>
<h3 id="2-4-The-ResourceLoader-Interface"><a href="#2-4-The-ResourceLoader-Interface" class="headerlink" title="2.4. The ResourceLoader Interface"></a>2.4. The <code>ResourceLoader</code> Interface</h3><p>The <code>ResourceLoader</code> interface is meant to be implemented by objects that can return (that is, load) <code>Resource</code> instances. The following listing shows the <code>ResourceLoader</code> interface definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResourceLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">    Resource <span class="title function_">getResource</span><span class="params">(String location)</span>;</span><br><span class="line"></span><br><span class="line">    ClassLoader <span class="title function_">getClassLoader</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>All application contexts implement the <code>ResourceLoader</code> interface. Therefore, all application contexts may be used to obtain <code>Resource</code> instances.</p>
<p>When you call <code>getResource()</code> on a specific application context, and the location path specified doesn’t have a specific prefix, you get back a <code>Resource</code> type that is appropriate to that particular application context. For example, assume the following snippet of code was run against a <code>ClassPathXmlApplicationContext</code> instance:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">template</span> <span class="operator">=</span> ctx.getResource(<span class="string">&quot;some/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Against a <code>ClassPathXmlApplicationContext</code>, that code returns a <code>ClassPathResource</code>. If the same method were run against a <code>FileSystemXmlApplicationContext</code> instance, it would return a <code>FileSystemResource</code>. For a <code>WebApplicationContext</code>, it would return a <code>ServletContextResource</code>. It would similarly return appropriate objects for each context.</p>
<p>As a result, you can load resources in a fashion appropriate to the particular application context.</p>
<p>On the other hand, you may also force <code>ClassPathResource</code> to be used, regardless of the application context type, by specifying the special <code>classpath:</code> prefix, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">template</span> <span class="operator">=</span> ctx.getResource(<span class="string">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Similarly, you can force a <code>UrlResource</code> to be used by specifying any of the standard <code>java.net.URL</code> prefixes. The following examples use the <code>file</code> and <code>https</code> prefixes:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">template</span> <span class="operator">=</span> ctx.getResource(<span class="string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">template</span> <span class="operator">=</span> ctx.getResource(<span class="string">&quot;https://myhost.com/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>The following table summarizes the strategy for converting <code>String</code> objects to <code>Resource</code> objects:</p>
<table>
<thead>
<tr>
<th align="left">Prefix</th>
<th align="left">Example</th>
<th align="left">Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">classpath:</td>
<td align="left"><code>classpath:com/myapp/config.xml</code></td>
<td align="left">Loaded from the classpath.</td>
</tr>
<tr>
<td align="left">file:</td>
<td align="left"><code>file:///data/config.xml</code></td>
<td align="left">Loaded as a <code>URL</code> from the filesystem. See also <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-filesystemresource-caveats"><code>FileSystemResource</code> Caveats</a>.</td>
</tr>
<tr>
<td align="left">https:</td>
<td align="left"><code>https://myserver/logo.png</code></td>
<td align="left">Loaded as a <code>URL</code>.</td>
</tr>
<tr>
<td align="left">(none)</td>
<td align="left"><code>/data/config.xml</code></td>
<td align="left">Depends on the underlying <code>ApplicationContext</code>.</td>
</tr>
</tbody></table>
<h3 id="2-5-The-ResourcePatternResolver-Interface"><a href="#2-5-The-ResourcePatternResolver-Interface" class="headerlink" title="2.5. The ResourcePatternResolver Interface"></a>2.5. The <code>ResourcePatternResolver</code> Interface</h3><p>The <code>ResourcePatternResolver</code> interface is an extension to the <code>ResourceLoader</code> interface which defines a strategy for resolving a location pattern (for example, an Ant-style path pattern) into <code>Resource</code> objects.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResourcePatternResolver</span> <span class="keyword">extends</span> <span class="title class_">ResourceLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">CLASSPATH_ALL_URL_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;classpath*:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Resource[] getResources(String locationPattern) <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As can be seen above, this interface also defines a special <code>classpath*:</code> resource prefix for all matching resources from the class path. Note that the resource location is expected to be a path without placeholders in this case — for example, <code>classpath*:/config/beans.xml</code>. JAR files or different directories in the class path can contain multiple files with the same path and the same name. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-app-ctx-wildcards-in-resource-paths">Wildcards in Application Context Constructor Resource Paths</a> and its subsections for further details on wildcard support with the <code>classpath*:</code> resource prefix.</p>
<p>A passed-in <code>ResourceLoader</code> (for example, one supplied via <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-resourceloaderaware"><code>ResourceLoaderAware</code></a> semantics) can be checked whether it implements this extended interface too.</p>
<p><code>PathMatchingResourcePatternResolver</code> is a standalone implementation that is usable outside an <code>ApplicationContext</code> and is also used by <code>ResourceArrayPropertyEditor</code> for populating <code>Resource[]</code> bean properties. <code>PathMatchingResourcePatternResolver</code> is able to resolve a specified resource location path into one or more matching <code>Resource</code> objects. The source path may be a simple path which has a one-to-one mapping to a target <code>Resource</code>, or alternatively may contain the special <code>classpath*:</code> prefix and&#x2F;or internal Ant-style regular expressions (matched using Spring’s <code>org.springframework.util.AntPathMatcher</code> utility). Both of the latter are effectively wildcards.</p>
<table>
<thead>
<tr>
<th></th>
<th>The default <code>ResourceLoader</code> in any standard <code>ApplicationContext</code> is in fact an instance of <code>PathMatchingResourcePatternResolver</code> which implements the <code>ResourcePatternResolver</code> interface. The same is true for the <code>ApplicationContext</code> instance itself which also implements the <code>ResourcePatternResolver</code> interface and delegates to the default <code>PathMatchingResourcePatternResolver</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-6-The-ResourceLoaderAware-Interface"><a href="#2-6-The-ResourceLoaderAware-Interface" class="headerlink" title="2.6. The ResourceLoaderAware Interface"></a>2.6. The <code>ResourceLoaderAware</code> Interface</h3><p>The <code>ResourceLoaderAware</code> interface is a special callback interface which identifies components that expect to be provided a <code>ResourceLoader</code> reference. The following listing shows the definition of the <code>ResourceLoaderAware</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResourceLoaderAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setResourceLoader</span><span class="params">(ResourceLoader resourceLoader)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When a class implements <code>ResourceLoaderAware</code> and is deployed into an application context (as a Spring-managed bean), it is recognized as <code>ResourceLoaderAware</code> by the application context. The application context then invokes <code>setResourceLoader(ResourceLoader)</code>, supplying itself as the argument (remember, all application contexts in Spring implement the <code>ResourceLoader</code> interface).</p>
<p>Since an <code>ApplicationContext</code> is a <code>ResourceLoader</code>, the bean could also implement the <code>ApplicationContextAware</code> interface and use the supplied application context directly to load resources. However, in general, it is better to use the specialized <code>ResourceLoader</code> interface if that is all you need. The code would be coupled only to the resource loading interface (which can be considered a utility interface) and not to the whole Spring <code>ApplicationContext</code> interface.</p>
<p>In application components, you may also rely upon autowiring of the <code>ResourceLoader</code> as an alternative to implementing the <code>ResourceLoaderAware</code> interface. The <em>traditional</em> <code>constructor</code> and <code>byType</code> autowiring modes (as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire">Autowiring Collaborators</a>) are capable of providing a <code>ResourceLoader</code> for either a constructor argument or a setter method parameter, respectively. For more flexibility (including the ability to autowire fields and multiple parameter methods), consider using the annotation-based autowiring features. In that case, the <code>ResourceLoader</code> is autowired into a field, constructor argument, or method parameter that expects the <code>ResourceLoader</code> type as long as the field, constructor, or method in question carries the <code>@Autowired</code> annotation. For more information, see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation">Using <code>@Autowired</code></a>.</p>
<table>
<thead>
<tr>
<th></th>
<th>To load one or more <code>Resource</code> objects for a resource path that contains wildcards or makes use of the special <code>classpath*:</code> resource prefix, consider having an instance of <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-resourcepatternresolver"><code>ResourcePatternResolver</code></a> autowired into your application components instead of <code>ResourceLoader</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-7-Resources-as-Dependencies"><a href="#2-7-Resources-as-Dependencies" class="headerlink" title="2.7. Resources as Dependencies"></a>2.7. Resources as Dependencies</h3><p>If the bean itself is going to determine and supply the resource path through some sort of dynamic process, it probably makes sense for the bean to use the <code>ResourceLoader</code> or <code>ResourcePatternResolver</code> interface to load resources. For example, consider the loading of a template of some sort, where the specific resource that is needed depends on the role of the user. If the resources are static, it makes sense to eliminate the use of the <code>ResourceLoader</code> interface (or <code>ResourcePatternResolver</code> interface) completely, have the bean expose the <code>Resource</code> properties it needs, and expect them to be injected into it.</p>
<p>What makes it trivial to then inject these properties is that all application contexts register and use a special JavaBeans <code>PropertyEditor</code>, which can convert <code>String</code> paths to <code>Resource</code> objects. For example, the following <code>MyBean</code> class has a <code>template</code> property of type <code>Resource</code>.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Resource template;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setTemplate</span><span class="params">(Resource template)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.template = template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In an XML configuration file, the <code>template</code> property can be configured with a simple string for that resource, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.MyBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;template&quot;</span> <span class="attr">value</span>=<span class="string">&quot;some/resource/path/myTemplate.txt&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that the resource path has no prefix. Consequently, because the application context itself is going to be used as the <code>ResourceLoader</code>, the resource is loaded through a <code>ClassPathResource</code>, a <code>FileSystemResource</code>, or a <code>ServletContextResource</code>, depending on the exact type of the application context.</p>
<p>If you need to force a specific <code>Resource</code> type to be used, you can use a prefix. The following two examples show how to force a <code>ClassPathResource</code> and a <code>UrlResource</code> (the latter being used to access a file in the filesystem):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;template&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;template&quot;</span> <span class="attr">value</span>=<span class="string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>If the <code>MyBean</code> class is refactored for use with annotation-driven configuration, the path to <code>myTemplate.txt</code> can be stored under a key named <code>template.path</code> — for example, in a properties file made available to the Spring <code>Environment</code> (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-environment">Environment Abstraction</a>). The template path can then be referenced via the <code>@Value</code> annotation using a property placeholder (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-value-annotations">Using <code>@Value</code></a>). Spring will retrieve the value of the template path as a string, and a special <code>PropertyEditor</code> will convert the string to a <code>Resource</code> object to be injected into the <code>MyBean</code> constructor. The following example demonstrates how to achieve this.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Resource template;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(<span class="meta">@Value(&quot;$&#123;template.path&#125;&quot;)</span> Resource template)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.template = template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we want to support multiple templates discovered under the same path in multiple locations in the classpath — for example, in multiple jars in the classpath — we can use the special <code>classpath*:</code> prefix and wildcarding to define a <code>templates.path</code> key as <code>classpath*:/config/templates/*.txt</code>. If we redefine the <code>MyBean</code> class as follows, Spring will convert the template path pattern into an array of <code>Resource</code> objects that can be injected into the <code>MyBean</code> constructor.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Resource[] templates;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(<span class="meta">@Value(&quot;$&#123;templates.path&#125;&quot;)</span> Resource[] templates)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.templates = templates;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-8-Application-Contexts-and-Resource-Paths"><a href="#2-8-Application-Contexts-and-Resource-Paths" class="headerlink" title="2.8. Application Contexts and Resource Paths"></a>2.8. Application Contexts and Resource Paths</h3><p>This section covers how to create application contexts with resources, including shortcuts that work with XML, how to use wildcards, and other details.</p>
<h4 id="2-8-1-Constructing-Application-Contexts"><a href="#2-8-1-Constructing-Application-Contexts" class="headerlink" title="2.8.1. Constructing Application Contexts"></a>2.8.1. Constructing Application Contexts</h4><p>An application context constructor (for a specific application context type) generally takes a string or array of strings as the location paths of the resources, such as XML files that make up the definition of the context.</p>
<p>When such a location path does not have a prefix, the specific <code>Resource</code> type built from that path and used to load the bean definitions depends on and is appropriate to the specific application context. For example, consider the following example, which creates a <code>ClassPathXmlApplicationContext</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;conf/appContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>The bean definitions are loaded from the classpath, because a <code>ClassPathResource</code> is used. However, consider the following example, which creates a <code>FileSystemXmlApplicationContext</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;conf/appContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Now the bean definitions are loaded from a filesystem location (in this case, relative to the current working directory).</p>
<p>Note that the use of the special <code>classpath</code> prefix or a standard URL prefix on the location path overrides the default type of <code>Resource</code> created to load the bean definitions. Consider the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;classpath:conf/appContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Using <code>FileSystemXmlApplicationContext</code> loads the bean definitions from the classpath. However, it is still a <code>FileSystemXmlApplicationContext</code>. If it is subsequently used as a <code>ResourceLoader</code>, any unprefixed paths are still treated as filesystem paths.</p>
<h5 id="Constructing-ClassPathXmlApplicationContext-Instances-—-Shortcuts"><a href="#Constructing-ClassPathXmlApplicationContext-Instances-—-Shortcuts" class="headerlink" title="Constructing ClassPathXmlApplicationContext Instances — Shortcuts"></a>Constructing <code>ClassPathXmlApplicationContext</code> Instances — Shortcuts</h5><p>The <code>ClassPathXmlApplicationContext</code> exposes a number of constructors to enable convenient instantiation. The basic idea is that you can supply merely a string array that contains only the filenames of the XML files themselves (without the leading path information) and also supply a <code>Class</code>. The <code>ClassPathXmlApplicationContext</code> then derives the path information from the supplied class.</p>
<p>Consider the following directory layout:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com/</span><br><span class="line">  example/</span><br><span class="line">    services.xml</span><br><span class="line">    repositories.xml</span><br><span class="line">    MessengerService.class</span><br></pre></td></tr></table></figure>

<p>The following example shows how a <code>ClassPathXmlApplicationContext</code> instance composed of the beans defined in files named <code>services.xml</code> and <code>repositories.xml</code> (which are on the classpath) can be instantiated:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;services.xml&quot;</span>, <span class="string">&quot;repositories.xml&quot;</span>&#125;, MessengerService.class);</span><br></pre></td></tr></table></figure>

<p>See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html"><code>ClassPathXmlApplicationContext</code></a> javadoc for details on the various constructors.</p>
<h4 id="2-8-2-Wildcards-in-Application-Context-Constructor-Resource-Paths"><a href="#2-8-2-Wildcards-in-Application-Context-Constructor-Resource-Paths" class="headerlink" title="2.8.2. Wildcards in Application Context Constructor Resource Paths"></a>2.8.2. Wildcards in Application Context Constructor Resource Paths</h4><p>The resource paths in application context constructor values may be simple paths (as shown earlier), each of which has a one-to-one mapping to a target <code>Resource</code> or, alternately, may contain the special <code>classpath*:</code> prefix or internal Ant-style patterns (matched by using Spring’s <code>PathMatcher</code> utility). Both of the latter are effectively wildcards.</p>
<p>One use for this mechanism is when you need to do component-style application assembly. All components can <em>publish</em> context definition fragments to a well-known location path, and, when the final application context is created using the same path prefixed with <code>classpath*:</code>, all component fragments are automatically picked up.</p>
<p>Note that this wildcarding is specific to the use of resource paths in application context constructors (or when you use the <code>PathMatcher</code> utility class hierarchy directly) and is resolved at construction time. It has nothing to do with the <code>Resource</code> type itself. You cannot use the <code>classpath*:</code> prefix to construct an actual <code>Resource</code>, as a resource points to just one resource at a time.</p>
<h5 id="Ant-style-Patterns"><a href="#Ant-style-Patterns" class="headerlink" title="Ant-style Patterns"></a>Ant-style Patterns</h5><p>Path locations can contain Ant-style patterns, as the following example shows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/WEB-INF/*-context.xml</span><br><span class="line">com/mycompany/**/applicationContext.xml</span><br><span class="line">file:C:/some/path/*-context.xml</span><br><span class="line">classpath:com/mycompany/**/applicationContext.xml</span><br></pre></td></tr></table></figure>

<p>When the path location contains an Ant-style pattern, the resolver follows a more complex procedure to try to resolve the wildcard. It produces a <code>Resource</code> for the path up to the last non-wildcard segment and obtains a URL from it. If this URL is not a <code>jar:</code> URL or container-specific variant (such as <code>zip:</code> in WebLogic, <code>wsjar</code> in WebSphere, and so on), a <code>java.io.File</code> is obtained from it and used to resolve the wildcard by traversing the filesystem. In the case of a jar URL, the resolver either gets a <code>java.net.JarURLConnection</code> from it or manually parses the jar URL and then traverses the contents of the jar file to resolve the wildcards.</p>
<h6 id="Implications-on-Portability"><a href="#Implications-on-Portability" class="headerlink" title="Implications on Portability"></a>Implications on Portability</h6><p>If the specified path is already a <code>file</code> URL (either implicitly because the base <code>ResourceLoader</code> is a filesystem one or explicitly), wildcarding is guaranteed to work in a completely portable fashion.</p>
<p>If the specified path is a <code>classpath</code> location, the resolver must obtain the last non-wildcard path segment URL by making a <code>Classloader.getResource()</code> call. Since this is just a node of the path (not the file at the end), it is actually undefined (in the <code>ClassLoader</code> javadoc) exactly what sort of a URL is returned in this case. In practice, it is always a <code>java.io.File</code> representing the directory (where the classpath resource resolves to a filesystem location) or a jar URL of some sort (where the classpath resource resolves to a jar location). Still, there is a portability concern on this operation.</p>
<p>If a jar URL is obtained for the last non-wildcard segment, the resolver must be able to get a <code>java.net.JarURLConnection</code> from it or manually parse the jar URL, to be able to walk the contents of the jar and resolve the wildcard. This does work in most environments but fails in others, and we strongly recommend that the wildcard resolution of resources coming from jars be thoroughly tested in your specific environment before you rely on it.</p>
<h5 id="The-classpath-Prefix"><a href="#The-classpath-Prefix" class="headerlink" title="The classpath*: Prefix"></a>The <code>classpath*:</code> Prefix</h5><p>When constructing an XML-based application context, a location string may use the special <code>classpath*:</code> prefix, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;classpath*:conf/appContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>This special prefix specifies that all classpath resources that match the given name must be obtained (internally, this essentially happens through a call to <code>ClassLoader.getResources(…)</code>) and then merged to form the final application context definition.</p>
<table>
<thead>
<tr>
<th></th>
<th>The wildcard classpath relies on the <code>getResources()</code> method of the underlying <code>ClassLoader</code>. As most application servers nowadays supply their own <code>ClassLoader</code> implementation, the behavior might differ, especially when dealing with jar files. A simple test to check if <code>classpath*</code> works is to use the <code>ClassLoader</code> to load a file from within a jar on the classpath: <code>getClass().getClassLoader().getResources(&quot;&lt;someFileInsideTheJar&gt;&quot;)</code>. Try this test with files that have the same name but reside in two different locations — for example, files with the same name and same path but in different jars on the classpath. In case an inappropriate result is returned, check the application server documentation for settings that might affect the <code>ClassLoader</code> behavior.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can also combine the <code>classpath*:</code> prefix with a <code>PathMatcher</code> pattern in the rest of the location path (for example, <code>classpath*:META-INF/*-beans.xml</code>). In this case, the resolution strategy is fairly simple: A <code>ClassLoader.getResources()</code> call is used on the last non-wildcard path segment to get all the matching resources in the class loader hierarchy and then, off each resource, the same <code>PathMatcher</code> resolution strategy described earlier is used for the wildcard subpath.</p>
<h5 id="Other-Notes-Relating-to-Wildcards"><a href="#Other-Notes-Relating-to-Wildcards" class="headerlink" title="Other Notes Relating to Wildcards"></a>Other Notes Relating to Wildcards</h5><p>Note that <code>classpath*:</code>, when combined with Ant-style patterns, only works reliably with at least one root directory before the pattern starts, unless the actual target files reside in the file system. This means that a pattern such as <code>classpath*:*.xml</code> might not retrieve files from the root of jar files but rather only from the root of expanded directories.</p>
<p>Spring’s ability to retrieve classpath entries originates from the JDK’s <code>ClassLoader.getResources()</code> method, which only returns file system locations for an empty string (indicating potential roots to search). Spring evaluates <code>URLClassLoader</code> runtime configuration and the <code>java.class.path</code> manifest in jar files as well, but this is not guaranteed to lead to portable behavior.</p>
<table>
<thead>
<tr>
<th></th>
<th>The scanning of classpath packages requires the presence of corresponding directory entries in the classpath. When you build JARs with Ant, do not activate the <code>files-only</code> switch of the JAR task. Also, classpath directories may not get exposed based on security policies in some environments — for example, stand-alone applications on JDK 1.7.0_45 and higher (which requires ‘Trusted-Library’ to be set up in your manifests. See <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources).On">https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources).On</a> JDK 9’s module path (Jigsaw), Spring’s classpath scanning generally works as expected. Putting resources into a dedicated directory is highly recommendable here as well, avoiding the aforementioned portability problems with searching the jar file root level.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Ant-style patterns with <code>classpath:</code> resources are not guaranteed to find matching resources if the root package to search is available in multiple classpath locations. Consider the following example of a resource location:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com/mycompany/package1/service-context.xml</span><br></pre></td></tr></table></figure>

<p>Now consider an Ant-style path that someone might use to try to find that file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classpath:com/mycompany/**/service-context.xml</span><br></pre></td></tr></table></figure>

<p>Such a resource may exist in only one location in the classpath, but when a path such as the preceding example is used to try to resolve it, the resolver works off the (first) URL returned by <code>getResource(&quot;com/mycompany&quot;);</code>. If this base package node exists in multiple <code>ClassLoader</code> locations, the desired resource may not exist in the first location found. Therefore, in such cases you should prefer using <code>classpath*:</code> with the same Ant-style pattern, which searches all classpath locations that contain the <code>com.mycompany</code> base package: <code>classpath*:com/mycompany/**/service-context.xml</code>.</p>
<h4 id="2-8-3-FileSystemResource-Caveats"><a href="#2-8-3-FileSystemResource-Caveats" class="headerlink" title="2.8.3. FileSystemResource Caveats"></a>2.8.3. <code>FileSystemResource</code> Caveats</h4><p>A <code>FileSystemResource</code> that is not attached to a <code>FileSystemApplicationContext</code> (that is, when a <code>FileSystemApplicationContext</code> is not the actual <code>ResourceLoader</code>) treats absolute and relative paths as you would expect. Relative paths are relative to the current working directory, while absolute paths are relative to the root of the filesystem.</p>
<p>For backwards compatibility (historical) reasons however, this changes when the <code>FileSystemApplicationContext</code> is the <code>ResourceLoader</code>. The <code>FileSystemApplicationContext</code> forces all attached <code>FileSystemResource</code> instances to treat all location paths as relative, whether they start with a leading slash or not. In practice, this means the following examples are equivalent:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;conf/context.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;/conf/context.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>The following examples are also equivalent (even though it would make sense for them to be different, as one case is relative and the other absolute):</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileSystemXmlApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> ...;</span><br><span class="line">ctx.getResource(<span class="string">&quot;some/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileSystemXmlApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> ...;</span><br><span class="line">ctx.getResource(<span class="string">&quot;/some/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>In practice, if you need true absolute filesystem paths, you should avoid using absolute paths with <code>FileSystemResource</code> or <code>FileSystemXmlApplicationContext</code> and force the use of a <code>UrlResource</code> by using the <code>file:</code> URL prefix. The following examples show how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// actual context type doesn&#x27;t matter, the Resource will always be UrlResource</span></span><br><span class="line">ctx.getResource(<span class="string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// force this FileSystemXmlApplicationContext to load its definition via a UrlResource</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;file:///conf/context.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-Validation-Data-Binding-and-Type-Conversion"><a href="#3-Validation-Data-Binding-and-Type-Conversion" class="headerlink" title="3. Validation, Data Binding, and Type Conversion"></a>3. Validation, Data Binding, and Type Conversion</h2><p>There are pros and cons for considering validation as business logic, and Spring offers a design for validation (and data binding) that does not exclude either one of them. Specifically, validation should not be tied to the web tier and should be easy to localize, and it should be possible to plug in any available validator. Considering these concerns, Spring provides a <code>Validator</code> contract that is both basic and eminently usable in every layer of an application.</p>
<p>Data binding is useful for letting user input be dynamically bound to the domain model of an application (or whatever objects you use to process user input). Spring provides the aptly named <code>DataBinder</code> to do exactly that. The <code>Validator</code> and the <code>DataBinder</code> make up the <code>validation</code> package, which is primarily used in but not limited to the web layer.</p>
<p>The <code>BeanWrapper</code> is a fundamental concept in the Spring Framework and is used in a lot of places. However, you probably do not need to use the <code>BeanWrapper</code> directly. Because this is reference documentation, however, we felt that some explanation might be in order. We explain the <code>BeanWrapper</code> in this chapter, since, if you are going to use it at all, you are most likely do so when trying to bind data to objects.</p>
<p>Spring’s <code>DataBinder</code> and the lower-level <code>BeanWrapper</code> both use <code>PropertyEditorSupport</code> implementations to parse and format property values. The <code>PropertyEditor</code> and <code>PropertyEditorSupport</code> types are part of the JavaBeans specification and are also explained in this chapter. Spring 3 introduced a <code>core.convert</code> package that provides a general type conversion facility, as well as a higher-level “format” package for formatting UI field values. You can use these packages as simpler alternatives to <code>PropertyEditorSupport</code> implementations. They are also discussed in this chapter.</p>
<p>Spring supports Java Bean Validation through setup infrastructure and an adaptor to Spring’s own <code>Validator</code> contract. Applications can enable Bean Validation once globally, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validation-beanvalidation">Java Bean Validation</a>, and use it exclusively for all validation needs. In the web layer, applications can further register controller-local Spring <code>Validator</code> instances per <code>DataBinder</code>, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validation-binder">Configuring a <code>DataBinder</code></a>, which can be useful for plugging in custom validation logic.</p>
<h3 id="3-1-Validation-by-Using-Spring’s-Validator-Interface"><a href="#3-1-Validation-by-Using-Spring’s-Validator-Interface" class="headerlink" title="3.1. Validation by Using Spring’s Validator Interface"></a>3.1. Validation by Using Spring’s Validator Interface</h3><p>Spring features a <code>Validator</code> interface that you can use to validate objects. The <code>Validator</code> interface works by using an <code>Errors</code> object so that, while validating, validators can report validation failures to the <code>Errors</code> object.</p>
<p>Consider the following example of a small data object:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the usual getters and setters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The next example provides validation behavior for the <code>Person</code> class by implementing the following two methods of the <code>org.springframework.validation.Validator</code> interface:</p>
<ul>
<li><code>supports(Class)</code>: Can this <code>Validator</code> validate instances of the supplied <code>Class</code>?</li>
<li><code>validate(Object, org.springframework.validation.Errors)</code>: Validates the given object and, in case of validation errors, registers those with the given <code>Errors</code> object.</li>
</ul>
<p>Implementing a <code>Validator</code> is fairly straightforward, especially when you know of the <code>ValidationUtils</code> helper class that the Spring Framework also provides. The following example implements <code>Validator</code> for <code>Person</code> instances:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This Validator validates only Person instances</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Person.class.equals(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Object obj, Errors e)</span> &#123;</span><br><span class="line">        ValidationUtils.rejectIfEmpty(e, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;name.empty&quot;</span>);</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> (Person) obj;</span><br><span class="line">        <span class="keyword">if</span> (p.getAge() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            e.rejectValue(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;negativevalue&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.getAge() &gt; <span class="number">110</span>) &#123;</span><br><span class="line">            e.rejectValue(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;too.darn.old&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>static</code> <code>rejectIfEmpty(..)</code> method on the <code>ValidationUtils</code> class is used to reject the <code>name</code> property if it is <code>null</code> or the empty string. Have a look at the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/validation/ValidationUtils.html"><code>ValidationUtils</code></a> javadoc to see what functionality it provides besides the example shown previously.</p>
<p>While it is certainly possible to implement a single <code>Validator</code> class to validate each of the nested objects in a rich object, it may be better to encapsulate the validation logic for each nested class of object in its own <code>Validator</code> implementation. A simple example of a “rich” object would be a <code>Customer</code> that is composed of two <code>String</code> properties (a first and a second name) and a complex <code>Address</code> object. <code>Address</code> objects may be used independently of <code>Customer</code> objects, so a distinct <code>AddressValidator</code> has been implemented. If you want your <code>CustomerValidator</code> to reuse the logic contained within the <code>AddressValidator</code> class without resorting to copy-and-paste, you can dependency-inject or instantiate an <code>AddressValidator</code> within your <code>CustomerValidator</code>, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator addressValidator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomerValidator</span><span class="params">(Validator addressValidator)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (addressValidator == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;The supplied [Validator] is &quot;</span> +</span><br><span class="line">                <span class="string">&quot;required and must not be null.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!addressValidator.supports(Address.class)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;The supplied [Validator] must &quot;</span> +</span><br><span class="line">                <span class="string">&quot;support the validation of [Address] instances.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.addressValidator = addressValidator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This Validator validates Customer instances, and any subclasses of Customer too</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Customer.class.isAssignableFrom(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Object target, Errors errors)</span> &#123;</span><br><span class="line">        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;field.required&quot;</span>);</span><br><span class="line">        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="string">&quot;surname&quot;</span>, <span class="string">&quot;field.required&quot;</span>);</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> (Customer) target;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            errors.pushNestedPath(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">            ValidationUtils.invokeValidator(<span class="built_in">this</span>.addressValidator, customer.getAddress(), errors);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            errors.popNestedPath();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Validation errors are reported to the <code>Errors</code> object passed to the validator. In the case of Spring Web MVC, you can use the <code>&lt;spring:bind/&gt;</code> tag to inspect the error messages, but you can also inspect the <code>Errors</code> object yourself. More information about the methods it offers can be found in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/validation/Errors.html">javadoc</a>.</p>
<h3 id="3-2-Resolving-Codes-to-Error-Messages"><a href="#3-2-Resolving-Codes-to-Error-Messages" class="headerlink" title="3.2. Resolving Codes to Error Messages"></a>3.2. Resolving Codes to Error Messages</h3><p>We covered databinding and validation. This section covers outputting messages that correspond to validation errors. In the example shown in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validator">preceding section</a>, we rejected the <code>name</code> and <code>age</code> fields. If we want to output the error messages by using a <code>MessageSource</code>, we can do so using the error code we provide when rejecting the field (‘name’ and ‘age’ in this case). When you call (either directly, or indirectly, by using, for example, the <code>ValidationUtils</code> class) <code>rejectValue</code> or one of the other <code>reject</code> methods from the <code>Errors</code> interface, the underlying implementation not only registers the code you passed in but also registers a number of additional error codes. The <code>MessageCodesResolver</code> determines which error codes the <code>Errors</code> interface registers. By default, the <code>DefaultMessageCodesResolver</code> is used, which (for example) not only registers a message with the code you gave but also registers messages that include the field name you passed to the reject method. So, if you reject a field by using <code>rejectValue(&quot;age&quot;, &quot;too.darn.old&quot;)</code>, apart from the <code>too.darn.old</code> code, Spring also registers <code>too.darn.old.age</code> and <code>too.darn.old.age.int</code> (the first includes the field name and the second includes the type of the field). This is done as a convenience to aid developers when targeting error messages.</p>
<p>More information on the <code>MessageCodesResolver</code> and the default strategy can be found in the javadoc of <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/validation/MessageCodesResolver.html"><code>MessageCodesResolver</code></a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.html"><code>DefaultMessageCodesResolver</code></a>, respectively.</p>
<h3 id="3-3-Bean-Manipulation-and-the-BeanWrapper"><a href="#3-3-Bean-Manipulation-and-the-BeanWrapper" class="headerlink" title="3.3. Bean Manipulation and the BeanWrapper"></a>3.3. Bean Manipulation and the <code>BeanWrapper</code></h3><p>The <code>org.springframework.beans</code> package adheres to the JavaBeans standard. A JavaBean is a class with a default no-argument constructor and that follows a naming convention where (for example) a property named <code>bingoMadness</code> would have a setter method <code>setBingoMadness(..)</code> and a getter method <code>getBingoMadness()</code>. For more information about JavaBeans and the specification, see <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/beans/package-summary.html">javabeans</a>.</p>
<p>One quite important class in the beans package is the <code>BeanWrapper</code> interface and its corresponding implementation (<code>BeanWrapperImpl</code>). As quoted from the javadoc, the <code>BeanWrapper</code> offers functionality to set and get property values (individually or in bulk), get property descriptors, and query properties to determine if they are readable or writable. Also, the <code>BeanWrapper</code> offers support for nested properties, enabling the setting of properties on sub-properties to an unlimited depth. The <code>BeanWrapper</code> also supports the ability to add standard JavaBeans <code>PropertyChangeListeners</code> and <code>VetoableChangeListeners</code>, without the need for supporting code in the target class. Last but not least, the <code>BeanWrapper</code> provides support for setting indexed properties. The <code>BeanWrapper</code> usually is not used by application code directly but is used by the <code>DataBinder</code> and the <code>BeanFactory</code>.</p>
<p>The way the <code>BeanWrapper</code> works is partly indicated by its name: it wraps a bean to perform actions on that bean, such as setting and retrieving properties.</p>
<h4 id="3-3-1-Setting-and-Getting-Basic-and-Nested-Properties"><a href="#3-3-1-Setting-and-Getting-Basic-and-Nested-Properties" class="headerlink" title="3.3.1. Setting and Getting Basic and Nested Properties"></a>3.3.1. Setting and Getting Basic and Nested Properties</h4><p>Setting and getting properties is done through the <code>setPropertyValue</code> and <code>getPropertyValue</code> overloaded method variants of <code>BeanWrapper</code>. See their Javadoc for details. The below table shows some examples of these conventions:</p>
<table>
<thead>
<tr>
<th align="left">Expression</th>
<th align="left">Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>name</code></td>
<td align="left">Indicates the property <code>name</code> that corresponds to the <code>getName()</code> or <code>isName()</code> and <code>setName(..)</code> methods.</td>
</tr>
<tr>
<td align="left"><code>account.name</code></td>
<td align="left">Indicates the nested property <code>name</code> of the property <code>account</code> that corresponds to (for example) the <code>getAccount().setName()</code> or <code>getAccount().getName()</code> methods.</td>
</tr>
<tr>
<td align="left"><code>account[2]</code></td>
<td align="left">Indicates the <em>third</em> element of the indexed property <code>account</code>. Indexed properties can be of type <code>array</code>, <code>list</code>, or other naturally ordered collection.</td>
</tr>
<tr>
<td align="left"><code>account[COMPANYNAME]</code></td>
<td align="left">Indicates the value of the map entry indexed by the <code>COMPANYNAME</code> key of the <code>account</code> <code>Map</code> property.</td>
</tr>
</tbody></table>
<p>(This next section is not vitally important to you if you do not plan to work with the <code>BeanWrapper</code> directly. If you use only the <code>DataBinder</code> and the <code>BeanFactory</code> and their default implementations, you should skip ahead to the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beans-conversion">section on <code>PropertyEditors</code></a>.)</p>
<p>The following two example classes use the <code>BeanWrapper</code> to get and set properties:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Company</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Employee managingDirector;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">getManagingDirector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.managingDirector;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setManagingDirector</span><span class="params">(Employee managingDirector)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.managingDirector = managingDirector;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSalary</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSalary</span><span class="params">(<span class="type">float</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following code snippets show some examples of how to retrieve and manipulate some of the properties of instantiated <code>Company</code>s and <code>Employee</code>s:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanWrapper</span> <span class="variable">company</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanWrapperImpl</span>(<span class="keyword">new</span> <span class="title class_">Company</span>());</span><br><span class="line"><span class="comment">// setting the company name..</span></span><br><span class="line">company.setPropertyValue(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Some Company Inc.&quot;</span>);</span><br><span class="line"><span class="comment">// ... can also be done like this:</span></span><br><span class="line"><span class="type">PropertyValue</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertyValue</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Some Company Inc.&quot;</span>);</span><br><span class="line">company.setPropertyValue(value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ok, let&#x27;s create the director and tie it to the company:</span></span><br><span class="line"><span class="type">BeanWrapper</span> <span class="variable">jim</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanWrapperImpl</span>(<span class="keyword">new</span> <span class="title class_">Employee</span>());</span><br><span class="line">jim.setPropertyValue(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jim Stravinsky&quot;</span>);</span><br><span class="line">company.setPropertyValue(<span class="string">&quot;managingDirector&quot;</span>, jim.getWrappedInstance());</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieving the salary of the managingDirector through the company</span></span><br><span class="line"><span class="type">Float</span> <span class="variable">salary</span> <span class="operator">=</span> (Float) company.getPropertyValue(<span class="string">&quot;managingDirector.salary&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-Built-in-PropertyEditor-Implementations"><a href="#3-3-2-Built-in-PropertyEditor-Implementations" class="headerlink" title="3.3.2. Built-in PropertyEditor Implementations"></a>3.3.2. Built-in <code>PropertyEditor</code> Implementations</h4><p>Spring uses the concept of a <code>PropertyEditor</code> to effect the conversion between an <code>Object</code> and a <code>String</code>. It can be handy to represent properties in a different way than the object itself. For example, a <code>Date</code> can be represented in a human readable way (as the <code>String</code>: <code>&#39;2007-14-09&#39;</code>), while we can still convert the human readable form back to the original date (or, even better, convert any date entered in a human readable form back to <code>Date</code> objects). This behavior can be achieved by registering custom editors of type <code>java.beans.PropertyEditor</code>. Registering custom editors on a <code>BeanWrapper</code> or, alternatively, in a specific IoC container (as mentioned in the previous chapter), gives it the knowledge of how to convert properties to the desired type. For more about <code>PropertyEditor</code>, see <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/beans/package-summary.html">the javadoc of the <code>java.beans</code> package from Oracle</a>.</p>
<p>A couple of examples where property editing is used in Spring:</p>
<ul>
<li>Setting properties on beans is done by using <code>PropertyEditor</code> implementations. When you use <code>String</code> as the value of a property of some bean that you declare in an XML file, Spring (if the setter of the corresponding property has a <code>Class</code> parameter) uses <code>ClassEditor</code> to try to resolve the parameter to a <code>Class</code> object.</li>
<li>Parsing HTTP request parameters in Spring’s MVC framework is done by using all kinds of <code>PropertyEditor</code> implementations that you can manually bind in all subclasses of the <code>CommandController</code>.</li>
</ul>
<p>Spring has a number of built-in <code>PropertyEditor</code> implementations to make life easy. They are all located in the <code>org.springframework.beans.propertyeditors</code> package. Most, (but not all, as indicated in the following table) are, by default, registered by <code>BeanWrapperImpl</code>. Where the property editor is configurable in some fashion, you can still register your own variant to override the default one. The following table describes the various <code>PropertyEditor</code> implementations that Spring provides:</p>
<table>
<thead>
<tr>
<th align="left">Class</th>
<th align="left">Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ByteArrayPropertyEditor</code></td>
<td align="left">Editor for byte arrays. Converts strings to their corresponding byte representations. Registered by default by <code>BeanWrapperImpl</code>.</td>
</tr>
<tr>
<td align="left"><code>ClassEditor</code></td>
<td align="left">Parses Strings that represent classes to actual classes and vice-versa. When a class is not found, an <code>IllegalArgumentException</code> is thrown. By default, registered by <code>BeanWrapperImpl</code>.</td>
</tr>
<tr>
<td align="left"><code>CustomBooleanEditor</code></td>
<td align="left">Customizable property editor for <code>Boolean</code> properties. By default, registered by <code>BeanWrapperImpl</code> but can be overridden by registering a custom instance of it as a custom editor.</td>
</tr>
<tr>
<td align="left"><code>CustomCollectionEditor</code></td>
<td align="left">Property editor for collections, converting any source <code>Collection</code> to a given target <code>Collection</code> type.</td>
</tr>
<tr>
<td align="left"><code>CustomDateEditor</code></td>
<td align="left">Customizable property editor for <code>java.util.Date</code>, supporting a custom <code>DateFormat</code>. NOT registered by default. Must be user-registered with the appropriate format as needed.</td>
</tr>
<tr>
<td align="left"><code>CustomNumberEditor</code></td>
<td align="left">Customizable property editor for any <code>Number</code> subclass, such as <code>Integer</code>, <code>Long</code>, <code>Float</code>, or <code>Double</code>. By default, registered by <code>BeanWrapperImpl</code> but can be overridden by registering a custom instance of it as a custom editor.</td>
</tr>
<tr>
<td align="left"><code>FileEditor</code></td>
<td align="left">Resolves strings to <code>java.io.File</code> objects. By default, registered by <code>BeanWrapperImpl</code>.</td>
</tr>
<tr>
<td align="left"><code>InputStreamEditor</code></td>
<td align="left">One-way property editor that can take a string and produce (through an intermediate <code>ResourceEditor</code> and <code>Resource</code>) an <code>InputStream</code> so that <code>InputStream</code> properties may be directly set as strings. Note that the default usage does not close the <code>InputStream</code> for you. By default, registered by <code>BeanWrapperImpl</code>.</td>
</tr>
<tr>
<td align="left"><code>LocaleEditor</code></td>
<td align="left">Can resolve strings to <code>Locale</code> objects and vice-versa (the string format is <code>[language]_[country]_[variant]</code>, same as the <code>toString()</code> method of <code>Locale</code>). Also accepts spaces as separators, as an alternative to underscores. By default, registered by <code>BeanWrapperImpl</code>.</td>
</tr>
<tr>
<td align="left"><code>PatternEditor</code></td>
<td align="left">Can resolve strings to <code>java.util.regex.Pattern</code> objects and vice-versa.</td>
</tr>
<tr>
<td align="left"><code>PropertiesEditor</code></td>
<td align="left">Can convert strings (formatted with the format defined in the javadoc of the <code>java.util.Properties</code> class) to <code>Properties</code> objects. By default, registered by <code>BeanWrapperImpl</code>.</td>
</tr>
<tr>
<td align="left"><code>StringTrimmerEditor</code></td>
<td align="left">Property editor that trims strings. Optionally allows transforming an empty string into a <code>null</code> value. NOT registered by default — must be user-registered.</td>
</tr>
<tr>
<td align="left"><code>URLEditor</code></td>
<td align="left">Can resolve a string representation of a URL to an actual <code>URL</code> object. By default, registered by <code>BeanWrapperImpl</code>.</td>
</tr>
</tbody></table>
<p>Spring uses the <code>java.beans.PropertyEditorManager</code> to set the search path for property editors that might be needed. The search path also includes <code>sun.bean.editors</code>, which includes <code>PropertyEditor</code> implementations for types such as <code>Font</code>, <code>Color</code>, and most of the primitive types. Note also that the standard JavaBeans infrastructure automatically discovers <code>PropertyEditor</code> classes (without you having to register them explicitly) if they are in the same package as the class they handle and have the same name as that class, with <code>Editor</code> appended. For example, one could have the following class and package structure, which would be sufficient for the <code>SomethingEditor</code> class to be recognized and used as the <code>PropertyEditor</code> for <code>Something</code>-typed properties.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">  chank</span><br><span class="line">    pop</span><br><span class="line">      Something</span><br><span class="line">      SomethingEditor // the PropertyEditor for the Something class</span><br></pre></td></tr></table></figure>

<p>Note that you can also use the standard <code>BeanInfo</code> JavaBeans mechanism here as well (described to some extent <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/javabeans/advanced/customization.html">here</a>). The following example uses the <code>BeanInfo</code> mechanism to explicitly register one or more <code>PropertyEditor</code> instances with the properties of an associated class:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">  chank</span><br><span class="line">    pop</span><br><span class="line">      Something</span><br><span class="line">      SomethingBeanInfo // the BeanInfo for the Something class</span><br></pre></td></tr></table></figure>

<p>The following Java source code for the referenced <code>SomethingBeanInfo</code> class associates a <code>CustomNumberEditor</code> with the <code>age</code> property of the <code>Something</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomethingBeanInfo</span> <span class="keyword">extends</span> <span class="title class_">SimpleBeanInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PropertyDescriptor[] getPropertyDescriptors() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">PropertyEditor</span> <span class="variable">numberPE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomNumberEditor</span>(Integer.class, <span class="literal">true</span>);</span><br><span class="line">            <span class="type">PropertyDescriptor</span> <span class="variable">ageDescriptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertyDescriptor</span>(<span class="string">&quot;age&quot;</span>, Something.class) &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> PropertyEditor <span class="title function_">createPropertyEditor</span><span class="params">(Object bean)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> numberPE;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertyDescriptor</span>[] &#123; ageDescriptor &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IntrospectionException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Registering-Additional-Custom-PropertyEditor-Implementations"><a href="#Registering-Additional-Custom-PropertyEditor-Implementations" class="headerlink" title="Registering Additional Custom PropertyEditor Implementations"></a>Registering Additional Custom <code>PropertyEditor</code> Implementations</h5><p>When setting bean properties as string values, a Spring IoC container ultimately uses standard JavaBeans <code>PropertyEditor</code> implementations to convert these strings to the complex type of the property. Spring pre-registers a number of custom <code>PropertyEditor</code> implementations (for example, to convert a class name expressed as a string into a <code>Class</code> object). Additionally, Java’s standard JavaBeans <code>PropertyEditor</code> lookup mechanism lets a <code>PropertyEditor</code> for a class be named appropriately and placed in the same package as the class for which it provides support, so that it can be found automatically.</p>
<p>If there is a need to register other custom <code>PropertyEditors</code>, several mechanisms are available. The most manual approach, which is not normally convenient or recommended, is to use the <code>registerCustomEditor()</code> method of the <code>ConfigurableBeanFactory</code> interface, assuming you have a <code>BeanFactory</code> reference. Another (slightly more convenient) mechanism is to use a special bean factory post-processor called <code>CustomEditorConfigurer</code>. Although you can use bean factory post-processors with <code>BeanFactory</code> implementations, the <code>CustomEditorConfigurer</code> has a nested property setup, so we strongly recommend that you use it with the <code>ApplicationContext</code>, where you can deploy it in similar fashion to any other bean and where it can be automatically detected and applied.</p>
<p>Note that all bean factories and application contexts automatically use a number of built-in property editors, through their use of a <code>BeanWrapper</code> to handle property conversions. The standard property editors that the <code>BeanWrapper</code> registers are listed in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beans-conversion">previous section</a>. Additionally, <code>ApplicationContext</code>s also override or add additional editors to handle resource lookups in a manner appropriate to the specific application context type.</p>
<p>Standard JavaBeans <code>PropertyEditor</code> instances are used to convert property values expressed as strings to the actual complex type of the property. You can use <code>CustomEditorConfigurer</code>, a bean factory post-processor, to conveniently add support for additional <code>PropertyEditor</code> instances to an <code>ApplicationContext</code>.</p>
<p>Consider the following example, which defines a user class called <code>ExoticType</code> and another class called <code>DependsOnExoticType</code>, which needs <code>ExoticType</code> set as a property:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExoticType</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExoticType</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependsOnExoticType</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ExoticType type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(ExoticType type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When things are properly set up, we want to be able to assign the type property as a string, which a <code>PropertyEditor</code> converts into an actual <code>ExoticType</code> instance. The following bean definition shows how to set up this relationship:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sample&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.DependsOnExoticType&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;aNameForExoticType&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>PropertyEditor</code> implementation could look similar to the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// converts string representation to ExoticType object</span></span><br><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExoticTypeEditor</span> <span class="keyword">extends</span> <span class="title class_">PropertyEditorSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAsText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        setValue(<span class="keyword">new</span> <span class="title class_">ExoticType</span>(text.toUpperCase()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the following example shows how to use <code>CustomEditorConfigurer</code> to register the new <code>PropertyEditor</code> with the <code>ApplicationContext</code>, which will then be able to use it as needed:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.CustomEditorConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;customEditors&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;example.ExoticType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;example.ExoticTypeEditor&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="Using-PropertyEditorRegistrar"><a href="#Using-PropertyEditorRegistrar" class="headerlink" title="Using PropertyEditorRegistrar"></a>Using <code>PropertyEditorRegistrar</code></h6><p>Another mechanism for registering property editors with the Spring container is to create and use a <code>PropertyEditorRegistrar</code>. This interface is particularly useful when you need to use the same set of property editors in several different situations. You can write a corresponding registrar and reuse it in each case. <code>PropertyEditorRegistrar</code> instances work in conjunction with an interface called <code>PropertyEditorRegistry</code>, an interface that is implemented by the Spring <code>BeanWrapper</code> (and <code>DataBinder</code>). <code>PropertyEditorRegistrar</code> instances are particularly convenient when used in conjunction with <code>CustomEditorConfigurer</code> (described <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-beans-conversion-customeditor-registration">here</a>), which exposes a property called <code>setPropertyEditorRegistrars(..)</code>. <code>PropertyEditorRegistrar</code> instances added to a <code>CustomEditorConfigurer</code> in this fashion can easily be shared with <code>DataBinder</code> and Spring MVC controllers. Furthermore, it avoids the need for synchronization on custom editors: A <code>PropertyEditorRegistrar</code> is expected to create fresh <code>PropertyEditor</code> instances for each bean creation attempt.</p>
<p>The following example shows how to create your own <code>PropertyEditorRegistrar</code> implementation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo.editors.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">CustomPropertyEditorRegistrar</span> <span class="keyword">implements</span> <span class="title class_">PropertyEditorRegistrar</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerCustomEditors</span><span class="params">(PropertyEditorRegistry registry)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// it is expected that new PropertyEditor instances are created</span></span><br><span class="line">        registry.registerCustomEditor(ExoticType.class, <span class="keyword">new</span> <span class="title class_">ExoticTypeEditor</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// you could register as many custom property editors as are required here...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>See also the <code>org.springframework.beans.support.ResourceEditorRegistrar</code> for an example <code>PropertyEditorRegistrar</code> implementation. Notice how in its implementation of the <code>registerCustomEditors(..)</code> method, it creates new instances of each property editor.</p>
<p>The next example shows how to configure a <code>CustomEditorConfigurer</code> and inject an instance of our <code>CustomPropertyEditorRegistrar</code> into it:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.CustomEditorConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;propertyEditorRegistrars&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;customPropertyEditorRegistrar&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;customPropertyEditorRegistrar&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;com.foo.editors.spring.CustomPropertyEditorRegistrar&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Finally (and in a bit of a departure from the focus of this chapter) for those of you using <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring’s MVC web framework</a>, using a <code>PropertyEditorRegistrar</code> in conjunction with data-binding web controllers can be very convenient. The following example uses a <code>PropertyEditorRegistrar</code> in the implementation of an <code>@InitBinder</code> method:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterUserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PropertyEditorRegistrar customPropertyEditorRegistrar;</span><br><span class="line"></span><br><span class="line">    RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) &#123;</span><br><span class="line">        <span class="built_in">this</span>.customPropertyEditorRegistrar = propertyEditorRegistrar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InitBinder</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder binder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customPropertyEditorRegistrar.registerCustomEditors(binder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other methods related to registering a User</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This style of <code>PropertyEditor</code> registration can lead to concise code (the implementation of the <code>@InitBinder</code> method is only one line long) and lets common <code>PropertyEditor</code> registration code be encapsulated in a class and then shared amongst as many controllers as needed.</p>
<h3 id="3-4-Spring-Type-Conversion"><a href="#3-4-Spring-Type-Conversion" class="headerlink" title="3.4. Spring Type Conversion"></a>3.4. Spring Type Conversion</h3><p>Spring 3 introduced a <code>core.convert</code> package that provides a general type conversion system. The system defines an SPI to implement type conversion logic and an API to perform type conversions at runtime. Within a Spring container, you can use this system as an alternative to <code>PropertyEditor</code> implementations to convert externalized bean property value strings to the required property types. You can also use the public API anywhere in your application where type conversion is needed.</p>
<h4 id="3-4-1-Converter-SPI"><a href="#3-4-1-Converter-SPI" class="headerlink" title="3.4.1. Converter SPI"></a>3.4.1. Converter SPI</h4><p>The SPI to implement type conversion logic is simple and strongly typed, as the following interface definition shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Converter</span>&lt;S, T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">convert</span><span class="params">(S source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To create your own converter, implement the <code>Converter</code> interface and parameterize <code>S</code> as the type you are converting from and <code>T</code> as the type you are converting to. You can also transparently apply such a converter if a collection or array of <code>S</code> needs to be converted to an array or collection of <code>T</code>, provided that a delegating array or collection converter has been registered as well (which <code>DefaultConversionService</code> does by default).</p>
<p>For each call to <code>convert(S)</code>, the source argument is guaranteed to not be null. Your <code>Converter</code> may throw any unchecked exception if conversion fails. Specifically, it should throw an <code>IllegalArgumentException</code> to report an invalid source value. Take care to ensure that your <code>Converter</code> implementation is thread-safe.</p>
<p>Several converter implementations are provided in the <code>core.convert.support</code> package as a convenience. These include converters from strings to numbers and other common types. The following listing shows the <code>StringToInteger</code> class, which is a typical <code>Converter</code> implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">StringToInteger</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-Using-ConverterFactory"><a href="#3-4-2-Using-ConverterFactory" class="headerlink" title="3.4.2. Using ConverterFactory"></a>3.4.2. Using <code>ConverterFactory</code></h4><p>When you need to centralize the conversion logic for an entire class hierarchy (for example, when converting from <code>String</code> to <code>Enum</code> objects), you can implement <code>ConverterFactory</code>, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConverterFactory</span>&lt;S, R&gt; &#123;</span><br><span class="line"></span><br><span class="line">    &lt;T <span class="keyword">extends</span> <span class="title class_">R</span>&gt; Converter&lt;S, T&gt; <span class="title function_">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Parameterize S to be the type you are converting from and R to be the base type defining the <em>range</em> of classes you can convert to. Then implement <code>getConverter(Class&lt;T&gt;)</code>, where T is a subclass of R.</p>
<p>Consider the <code>StringToEnumConverterFactory</code> as an example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">StringToEnumConverterFactory</span> <span class="keyword">implements</span> <span class="title class_">ConverterFactory</span>&lt;String, Enum&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Enum</span>&gt; Converter&lt;String, T&gt; <span class="title function_">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringToEnumConverter</span>(targetType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">StringToEnumConverter</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Enum</span>&gt; <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, T&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Class&lt;T&gt; enumType;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">StringToEnumConverter</span><span class="params">(Class&lt;T&gt; enumType)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.enumType = enumType;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) Enum.valueOf(<span class="built_in">this</span>.enumType, source.trim());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-3-Using-GenericConverter"><a href="#3-4-3-Using-GenericConverter" class="headerlink" title="3.4.3. Using GenericConverter"></a>3.4.3. Using <code>GenericConverter</code></h4><p>When you require a sophisticated <code>Converter</code> implementation, consider using the <code>GenericConverter</code> interface. With a more flexible but less strongly typed signature than <code>Converter</code>, a <code>GenericConverter</code> supports converting between multiple source and target types. In addition, a <code>GenericConverter</code> makes available source and target field context that you can use when you implement your conversion logic. Such context lets a type conversion be driven by a field annotation or by generic information declared on a field signature. The following listing shows the interface definition of <code>GenericConverter</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GenericConverter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;ConvertiblePair&gt; <span class="title function_">getConvertibleTypes</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">convert</span><span class="params">(Object source, TypeDescriptor sourceType, TypeDescriptor targetType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To implement a <code>GenericConverter</code>, have <code>getConvertibleTypes()</code> return the supported source→target type pairs. Then implement <code>convert(Object, TypeDescriptor, TypeDescriptor)</code> to contain your conversion logic. The source <code>TypeDescriptor</code> provides access to the source field that holds the value being converted. The target <code>TypeDescriptor</code> provides access to the target field where the converted value is to be set.</p>
<p>A good example of a <code>GenericConverter</code> is a converter that converts between a Java array and a collection. Such an <code>ArrayToCollectionConverter</code> introspects the field that declares the target collection type to resolve the collection’s element type. This lets each element in the source array be converted to the collection element type before the collection is set on the target field.</p>
<table>
<thead>
<tr>
<th></th>
<th>Because <code>GenericConverter</code> is a more complex SPI interface, you should use it only when you need it. Favor <code>Converter</code> or <code>ConverterFactory</code> for basic type conversion needs.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Using-ConditionalGenericConverter"><a href="#Using-ConditionalGenericConverter" class="headerlink" title="Using ConditionalGenericConverter"></a>Using <code>ConditionalGenericConverter</code></h5><p>Sometimes, you want a <code>Converter</code> to run only if a specific condition holds true. For example, you might want to run a <code>Converter</code> only if a specific annotation is present on the target field, or you might want to run a <code>Converter</code> only if a specific method (such as a <code>static valueOf</code> method) is defined on the target class. <code>ConditionalGenericConverter</code> is the union of the <code>GenericConverter</code> and <code>ConditionalConverter</code> interfaces that lets you define such custom matching criteria:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConditionalConverter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(TypeDescriptor sourceType, TypeDescriptor targetType)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConditionalGenericConverter</span> <span class="keyword">extends</span> <span class="title class_">GenericConverter</span>, ConditionalConverter &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A good example of a <code>ConditionalGenericConverter</code> is an <code>IdToEntityConverter</code> that converts between a persistent entity identifier and an entity reference. Such an <code>IdToEntityConverter</code> might match only if the target entity type declares a static finder method (for example, <code>findAccount(Long)</code>). You might perform such a finder method check in the implementation of <code>matches(TypeDescriptor, TypeDescriptor)</code>.</p>
<h4 id="3-4-4-The-ConversionService-API"><a href="#3-4-4-The-ConversionService-API" class="headerlink" title="3.4.4. The ConversionService API"></a>3.4.4. The <code>ConversionService</code> API</h4><p><code>ConversionService</code> defines a unified API for executing type conversion logic at runtime. Converters are often run behind the following facade interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConversionService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">canConvert</span><span class="params">(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">convert</span><span class="params">(Object source, Class&lt;T&gt; targetType)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">canConvert</span><span class="params">(TypeDescriptor sourceType, TypeDescriptor targetType)</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">convert</span><span class="params">(Object source, TypeDescriptor sourceType, TypeDescriptor targetType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Most <code>ConversionService</code> implementations also implement <code>ConverterRegistry</code>, which provides an SPI for registering converters. Internally, a <code>ConversionService</code> implementation delegates to its registered converters to carry out type conversion logic.</p>
<p>A robust <code>ConversionService</code> implementation is provided in the <code>core.convert.support</code> package. <code>GenericConversionService</code> is the general-purpose implementation suitable for use in most environments. <code>ConversionServiceFactory</code> provides a convenient factory for creating common <code>ConversionService</code> configurations.</p>
<h4 id="3-4-5-Configuring-a-ConversionService"><a href="#3-4-5-Configuring-a-ConversionService" class="headerlink" title="3.4.5. Configuring a ConversionService"></a>3.4.5. Configuring a <code>ConversionService</code></h4><p>A <code>ConversionService</code> is a stateless object designed to be instantiated at application startup and then shared between multiple threads. In a Spring application, you typically configure a <code>ConversionService</code> instance for each Spring container (or <code>ApplicationContext</code>). Spring picks up that <code>ConversionService</code> and uses it whenever a type conversion needs to be performed by the framework. You can also inject this <code>ConversionService</code> into any of your beans and invoke it directly.</p>
<table>
<thead>
<tr>
<th></th>
<th>If no <code>ConversionService</code> is registered with Spring, the original <code>PropertyEditor</code>-based system is used.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>To register a default <code>ConversionService</code> with Spring, add the following bean definition with an <code>id</code> of <code>conversionService</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>A default <code>ConversionService</code> can convert between strings, numbers, enums, collections, maps, and other common types. To supplement or override the default converters with your own custom converters, set the <code>converters</code> property. Property values can implement any of the <code>Converter</code>, <code>ConverterFactory</code>, or <code>GenericConverter</code> interfaces.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.MyCustomConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>It is also common to use a <code>ConversionService</code> within a Spring MVC application. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-config-conversion">Conversion and Formatting</a> in the Spring MVC chapter.</p>
<p>In certain situations, you may wish to apply formatting during conversion. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#format-FormatterRegistry-SPI">The <code>FormatterRegistry</code> SPI</a> for details on using <code>FormattingConversionServiceFactoryBean</code>.</p>
<h4 id="3-4-6-Using-a-ConversionService-Programmatically"><a href="#3-4-6-Using-a-ConversionService-Programmatically" class="headerlink" title="3.4.6. Using a ConversionService Programmatically"></a>3.4.6. Using a <code>ConversionService</code> Programmatically</h4><p>To work with a <code>ConversionService</code> instance programmatically, you can inject a reference to it like you would for any other bean. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(ConversionService conversionService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.conversionService = conversionService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doIt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.conversionService.convert(...)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For most use cases, you can use the <code>convert</code> method that specifies the <code>targetType</code>, but it does not work with more complex types, such as a collection of a parameterized element. For example, if you want to convert a <code>List</code> of <code>Integer</code> to a <code>List</code> of <code>String</code> programmatically, you need to provide a formal definition of the source and target types.</p>
<p>Fortunately, <code>TypeDescriptor</code> provides various options to make doing so straightforward, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DefaultConversionService</span> <span class="variable">cs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConversionService</span>();</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; input = ...</span><br><span class="line">cs.convert(input,</span><br><span class="line">    TypeDescriptor.forObject(input), <span class="comment">// List&lt;Integer&gt; type descriptor</span></span><br><span class="line">    TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(String.class)));</span><br></pre></td></tr></table></figure>

<p>Note that <code>DefaultConversionService</code> automatically registers converters that are appropriate for most environments. This includes collection converters, scalar converters, and basic <code>Object</code>-to-<code>String</code> converters. You can register the same converters with any <code>ConverterRegistry</code> by using the static <code>addDefaultConverters</code> method on the <code>DefaultConversionService</code> class.</p>
<p>Converters for value types are reused for arrays and collections, so there is no need to create a specific converter to convert from a <code>Collection</code> of <code>S</code> to a <code>Collection</code> of <code>T</code>, assuming that standard collection handling is appropriate.</p>
<h3 id="3-5-Spring-Field-Formatting"><a href="#3-5-Spring-Field-Formatting" class="headerlink" title="3.5. Spring Field Formatting"></a>3.5. Spring Field Formatting</h3><p>As discussed in the previous section, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#core-convert"><code>core.convert</code></a> is a general-purpose type conversion system. It provides a unified <code>ConversionService</code> API as well as a strongly typed <code>Converter</code> SPI for implementing conversion logic from one type to another. A Spring container uses this system to bind bean property values. In addition, both the Spring Expression Language (SpEL) and <code>DataBinder</code> use this system to bind field values. For example, when SpEL needs to coerce a <code>Short</code> to a <code>Long</code> to complete an <code>expression.setValue(Object bean, Object value)</code> attempt, the <code>core.convert</code> system performs the coercion.</p>
<p>Now consider the type conversion requirements of a typical client environment, such as a web or desktop application. In such environments, you typically convert from <code>String</code> to support the client postback process, as well as back to <code>String</code> to support the view rendering process. In addition, you often need to localize <code>String</code> values. The more general <code>core.convert</code> <code>Converter</code> SPI does not address such formatting requirements directly. To directly address them, Spring 3 introduced a convenient <code>Formatter</code> SPI that provides a simple and robust alternative to <code>PropertyEditor</code> implementations for client environments.</p>
<p>In general, you can use the <code>Converter</code> SPI when you need to implement general-purpose type conversion logic — for example, for converting between a <code>java.util.Date</code> and a <code>Long</code>. You can use the <code>Formatter</code> SPI when you work in a client environment (such as a web application) and need to parse and print localized field values. The <code>ConversionService</code> provides a unified type conversion API for both SPIs.</p>
<h4 id="3-5-1-The-Formatter-SPI"><a href="#3-5-1-The-Formatter-SPI" class="headerlink" title="3.5.1. The Formatter SPI"></a>3.5.1. The <code>Formatter</code> SPI</h4><p>The <code>Formatter</code> SPI to implement field formatting logic is simple and strongly typed. The following listing shows the <code>Formatter</code> interface definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Formatter</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Printer</span>&lt;T&gt;, Parser&lt;T&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Formatter</code> extends from the <code>Printer</code> and <code>Parser</code> building-block interfaces. The following listing shows the definitions of those two interfaces:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Printer</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">print</span><span class="params">(T fieldValue, Locale locale)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Parser</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">parse</span><span class="params">(String clientValue, Locale locale)</span> <span class="keyword">throws</span> ParseException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To create your own <code>Formatter</code>, implement the <code>Formatter</code> interface shown earlier. Parameterize <code>T</code> to be the type of object you wish to format — for example, <code>java.util.Date</code>. Implement the <code>print()</code> operation to print an instance of <code>T</code> for display in the client locale. Implement the <code>parse()</code> operation to parse an instance of <code>T</code> from the formatted representation returned from the client locale. Your <code>Formatter</code> should throw a <code>ParseException</code> or an <code>IllegalArgumentException</code> if a parse attempt fails. Take care to ensure that your <code>Formatter</code> implementation is thread-safe.</p>
<p>The <code>format</code> subpackages provide several <code>Formatter</code> implementations as a convenience. The <code>number</code> package provides <code>NumberStyleFormatter</code>, <code>CurrencyStyleFormatter</code>, and <code>PercentStyleFormatter</code> to format <code>Number</code> objects that use a <code>java.text.NumberFormat</code>. The <code>datetime</code> package provides a <code>DateFormatter</code> to format <code>java.util.Date</code> objects with a <code>java.text.DateFormat</code>.</p>
<p>The following <code>DateFormatter</code> is an example <code>Formatter</code> implementation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format.datetime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DateFormatter</span> <span class="keyword">implements</span> <span class="title class_">Formatter</span>&lt;Date&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String pattern;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DateFormatter</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pattern = pattern;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">print</span><span class="params">(Date date, Locale locale)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (date == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getDateFormat(locale).format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">parse</span><span class="params">(String formatted, Locale locale)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="keyword">if</span> (formatted.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getDateFormat(locale).parse(formatted);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> DateFormat <span class="title function_">getDateFormat</span><span class="params">(Locale locale)</span> &#123;</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="built_in">this</span>.pattern, locale);</span><br><span class="line">        dateFormat.setLenient(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> dateFormat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The Spring team welcomes community-driven <code>Formatter</code> contributions. See <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/issues">GitHub Issues</a> to contribute.</p>
<h4 id="3-5-2-Annotation-driven-Formatting"><a href="#3-5-2-Annotation-driven-Formatting" class="headerlink" title="3.5.2. Annotation-driven Formatting"></a>3.5.2. Annotation-driven Formatting</h4><p>Field formatting can be configured by field type or annotation. To bind an annotation to a <code>Formatter</code>, implement <code>AnnotationFormatterFactory</code>. The following listing shows the definition of the <code>AnnotationFormatterFactory</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AnnotationFormatterFactory</span>&lt;A <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Set&lt;Class&lt;?&gt;&gt; getFieldTypes();</span><br><span class="line"></span><br><span class="line">    Printer&lt;?&gt; getPrinter(A annotation, Class&lt;?&gt; fieldType);</span><br><span class="line"></span><br><span class="line">    Parser&lt;?&gt; getParser(A annotation, Class&lt;?&gt; fieldType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To create an implementation:</p>
<ol>
<li>Parameterize A to be the field <code>annotationType</code> with which you wish to associate formatting logic — for example <code>org.springframework.format.annotation.DateTimeFormat</code>.</li>
<li>Have <code>getFieldTypes()</code> return the types of fields on which the annotation can be used.</li>
<li>Have <code>getPrinter()</code> return a <code>Printer</code> to print the value of an annotated field.</li>
<li>Have <code>getParser()</code> return a <code>Parser</code> to parse a <code>clientValue</code> for an annotated field.</li>
</ol>
<p>The following example <code>AnnotationFormatterFactory</code> implementation binds the <code>@NumberFormat</code> annotation to a formatter to let a number style or pattern be specified:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">NumberFormatAnnotationFormatterFactory</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">AnnotationFormatterFactory</span>&lt;NumberFormat&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getFieldTypes() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Class&lt;?&gt;&gt;(asList(<span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123;</span><br><span class="line">            Short.class, Integer.class, Long.class, Float.class,</span><br><span class="line">            Double.class, BigDecimal.class, BigInteger.class &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Printer&lt;Number&gt; <span class="title function_">getPrinter</span><span class="params">(NumberFormat annotation, Class&lt;?&gt; fieldType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configureFormatterFrom(annotation, fieldType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Parser&lt;Number&gt; <span class="title function_">getParser</span><span class="params">(NumberFormat annotation, Class&lt;?&gt; fieldType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configureFormatterFrom(annotation, fieldType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Formatter&lt;Number&gt; <span class="title function_">configureFormatterFrom</span><span class="params">(NumberFormat annotation, Class&lt;?&gt; fieldType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!annotation.pattern().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NumberStyleFormatter</span>(annotation.pattern());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Style</span> <span class="variable">style</span> <span class="operator">=</span> annotation.style();</span><br><span class="line">            <span class="keyword">if</span> (style == Style.PERCENT) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PercentStyleFormatter</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (style == Style.CURRENCY) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CurrencyStyleFormatter</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NumberStyleFormatter</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To trigger formatting, you can annotate fields with @NumberFormat, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyModel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NumberFormat(style=Style.CURRENCY)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal decimal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Format-Annotation-API"><a href="#Format-Annotation-API" class="headerlink" title="Format Annotation API"></a>Format Annotation API</h5><p>A portable format annotation API exists in the <code>org.springframework.format.annotation</code> package. You can use <code>@NumberFormat</code> to format <code>Number</code> fields such as <code>Double</code> and <code>Long</code>, and <code>@DateTimeFormat</code> to format <code>java.util.Date</code>, <code>java.util.Calendar</code>, <code>Long</code> (for millisecond timestamps) as well as JSR-310 <code>java.time</code>.</p>
<p>The following example uses <code>@DateTimeFormat</code> to format a <code>java.util.Date</code> as an ISO Date (yyyy-MM-dd):</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyModel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DateTimeFormat(iso=ISO.DATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-3-The-FormatterRegistry-SPI"><a href="#3-5-3-The-FormatterRegistry-SPI" class="headerlink" title="3.5.3. The FormatterRegistry SPI"></a>3.5.3. The <code>FormatterRegistry</code> SPI</h4><p>The <code>FormatterRegistry</code> is an SPI for registering formatters and converters. <code>FormattingConversionService</code> is an implementation of <code>FormatterRegistry</code> suitable for most environments. You can programmatically or declaratively configure this variant as a Spring bean, e.g. by using <code>FormattingConversionServiceFactoryBean</code>. Because this implementation also implements <code>ConversionService</code>, you can directly configure it for use with Spring’s <code>DataBinder</code> and the Spring Expression Language (SpEL).</p>
<p>The following listing shows the <code>FormatterRegistry</code> SPI:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FormatterRegistry</span> <span class="keyword">extends</span> <span class="title class_">ConverterRegistry</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addPrinter</span><span class="params">(Printer&lt;?&gt; printer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addParser</span><span class="params">(Parser&lt;?&gt; parser)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addFormatter</span><span class="params">(Formatter&lt;?&gt; formatter)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addFormatterForFieldType</span><span class="params">(Class&lt;?&gt; fieldType, Formatter&lt;?&gt; formatter)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addFormatterForFieldType</span><span class="params">(Class&lt;?&gt; fieldType, Printer&lt;?&gt; printer, Parser&lt;?&gt; parser)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addFormatterForFieldAnnotation</span><span class="params">(AnnotationFormatterFactory&lt;? extends Annotation&gt; annotationFormatterFactory)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As shown in the preceding listing, you can register formatters by field type or by annotation.</p>
<p>The <code>FormatterRegistry</code> SPI lets you configure formatting rules centrally, instead of duplicating such configuration across your controllers. For example, you might want to enforce that all date fields are formatted a certain way or that fields with a specific annotation are formatted in a certain way. With a shared <code>FormatterRegistry</code>, you define these rules once, and they are applied whenever formatting is needed.</p>
<h4 id="3-5-4-The-FormatterRegistrar-SPI"><a href="#3-5-4-The-FormatterRegistrar-SPI" class="headerlink" title="3.5.4. The FormatterRegistrar SPI"></a>3.5.4. The <code>FormatterRegistrar</code> SPI</h4><p><code>FormatterRegistrar</code> is an SPI for registering formatters and converters through the FormatterRegistry. The following listing shows its interface definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FormatterRegistrar</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerFormatters</span><span class="params">(FormatterRegistry registry)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A <code>FormatterRegistrar</code> is useful when registering multiple related converters and formatters for a given formatting category, such as date formatting. It can also be useful where declarative registration is insufficient — for example, when a formatter needs to be indexed under a specific field type different from its own <code>&lt;T&gt;</code> or when registering a <code>Printer</code>&#x2F;<code>Parser</code> pair. The next section provides more information on converter and formatter registration.</p>
<h4 id="3-5-5-Configuring-Formatting-in-Spring-MVC"><a href="#3-5-5-Configuring-Formatting-in-Spring-MVC" class="headerlink" title="3.5.5. Configuring Formatting in Spring MVC"></a>3.5.5. Configuring Formatting in Spring MVC</h4><p>See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-config-conversion">Conversion and Formatting</a> in the Spring MVC chapter.</p>
<h3 id="3-6-Configuring-a-Global-Date-and-Time-Format"><a href="#3-6-Configuring-a-Global-Date-and-Time-Format" class="headerlink" title="3.6. Configuring a Global Date and Time Format"></a>3.6. Configuring a Global Date and Time Format</h3><p>By default, date and time fields not annotated with <code>@DateTimeFormat</code> are converted from strings by using the <code>DateFormat.SHORT</code> style. If you prefer, you can change this by defining your own global format.</p>
<p>To do that, ensure that Spring does not register default formatters. Instead, register formatters manually with the help of:</p>
<ul>
<li><code>org.springframework.format.datetime.standard.DateTimeFormatterRegistrar</code></li>
<li><code>org.springframework.format.datetime.DateFormatterRegistrar</code></li>
</ul>
<p>For example, the following Java configuration registers a global <code>yyyyMMdd</code> format:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FormattingConversionService <span class="title function_">conversionService</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use the DefaultFormattingConversionService but do not register defaults</span></span><br><span class="line">        <span class="type">DefaultFormattingConversionService</span> <span class="variable">conversionService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFormattingConversionService</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Ensure @NumberFormat is still supported</span></span><br><span class="line">        conversionService.addFormatterForFieldAnnotation(<span class="keyword">new</span> <span class="title class_">NumberFormatAnnotationFormatterFactory</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register JSR-310 date conversion with a specific global format</span></span><br><span class="line">        <span class="type">DateTimeFormatterRegistrar</span> <span class="variable">registrar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTimeFormatterRegistrar</span>();</span><br><span class="line">        registrar.setDateFormatter(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMMdd&quot;</span>));</span><br><span class="line">        registrar.registerFormatters(conversionService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register date conversion with a specific global format</span></span><br><span class="line">        <span class="type">DateFormatterRegistrar</span> <span class="variable">registrar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateFormatterRegistrar</span>();</span><br><span class="line">        registrar.setFormatter(<span class="keyword">new</span> <span class="title class_">DateFormatter</span>(<span class="string">&quot;yyyyMMdd&quot;</span>));</span><br><span class="line">        registrar.registerFormatters(conversionService);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> conversionService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you prefer XML-based configuration, you can use a <code>FormattingConversionServiceFactoryBean</code>. The following example shows how to do so:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag"></span></span></span><br><span class="line"><span class="string"><span class="tag">    &lt;bean id=&quot;</span><span class="attr">conversionService</span>&quot; <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;registerDefaultFormatters&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;formatters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.number.NumberFormatAnnotationFormatterFactory&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;formatterRegistrars&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.datetime.standard.DateTimeFormatterRegistrar&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dateFormatter&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.datetime.standard.DateTimeFormatterFactoryBean&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;yyyyMMdd&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note there are extra considerations when configuring date and time formats in web applications. Please see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-config-conversion">WebMVC Conversion and Formatting</a> or <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-conversion">WebFlux Conversion and Formatting</a>.</p>
<h3 id="3-7-Java-Bean-Validation"><a href="#3-7-Java-Bean-Validation" class="headerlink" title="3.7. Java Bean Validation"></a>3.7. Java Bean Validation</h3><p>The Spring Framework provides support for the <a target="_blank" rel="noopener" href="https://beanvalidation.org/">Java Bean Validation</a> API.</p>
<h4 id="3-7-1-Overview-of-Bean-Validation"><a href="#3-7-1-Overview-of-Bean-Validation" class="headerlink" title="3.7.1. Overview of Bean Validation"></a>3.7.1. Overview of Bean Validation</h4><p>Bean Validation provides a common way of validation through constraint declaration and metadata for Java applications. To use it, you annotate domain model properties with declarative validation constraints which are then enforced by the runtime. There are built-in constraints, and you can also define your own custom constraints.</p>
<p>Consider the following example, which shows a simple <code>PersonForm</code> model with two properties:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonForm</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bean Validation lets you declare constraints as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonForm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(max=64)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Min(0)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A Bean Validation validator then validates instances of this class based on the declared constraints. See <a target="_blank" rel="noopener" href="https://beanvalidation.org/">Bean Validation</a> for general information about the API. See the <a target="_blank" rel="noopener" href="https://hibernate.org/validator/">Hibernate Validator</a> documentation for specific constraints. To learn how to set up a bean validation provider as a Spring bean, keep reading.</p>
<h4 id="3-7-2-Configuring-a-Bean-Validation-Provider"><a href="#3-7-2-Configuring-a-Bean-Validation-Provider" class="headerlink" title="3.7.2. Configuring a Bean Validation Provider"></a>3.7.2. Configuring a Bean Validation Provider</h4><p>Spring provides full support for the Bean Validation API including the bootstrapping of a Bean Validation provider as a Spring bean. This lets you inject a <code>javax.validation.ValidatorFactory</code> or <code>javax.validation.Validator</code> wherever validation is needed in your application.</p>
<p>You can use the <code>LocalValidatorFactoryBean</code> to configure a default Validator as a Spring bean, as the following example shows:</p>
<p>Java</p>
<p>XML</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.validation.beanvalidation.LocalValidatorFactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LocalValidatorFactoryBean <span class="title function_">validator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LocalValidatorFactoryBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The basic configuration in the preceding example triggers bean validation to initialize by using its default bootstrap mechanism. A Bean Validation provider, such as the Hibernate Validator, is expected to be present in the classpath and is automatically detected.</p>
<h5 id="Injecting-a-Validator"><a href="#Injecting-a-Validator" class="headerlink" title="Injecting a Validator"></a>Injecting a Validator</h5><p><code>LocalValidatorFactoryBean</code> implements both <code>javax.validation.ValidatorFactory</code> and <code>javax.validation.Validator</code>, as well as Spring’s <code>org.springframework.validation.Validator</code>. You can inject a reference to either of these interfaces into beans that need to invoke validation logic.</p>
<p>You can inject a reference to <code>javax.validation.Validator</code> if you prefer to work with the Bean Validation API directly, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.Validator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Validator validator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can inject a reference to <code>org.springframework.validation.Validator</code> if your bean requires the Spring Validation API, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.validation.Validator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Validator validator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Configuring-Custom-Constraints"><a href="#Configuring-Custom-Constraints" class="headerlink" title="Configuring Custom Constraints"></a>Configuring Custom Constraints</h5><p>Each bean validation constraint consists of two parts:</p>
<ul>
<li>A <code>@Constraint</code> annotation that declares the constraint and its configurable properties.</li>
<li>An implementation of the <code>javax.validation.ConstraintValidator</code> interface that implements the constraint’s behavior.</li>
</ul>
<p>To associate a declaration with an implementation, each <code>@Constraint</code> annotation references a corresponding <code>ConstraintValidator</code> implementation class. At runtime, a <code>ConstraintValidatorFactory</code> instantiates the referenced implementation when the constraint annotation is encountered in your domain model.</p>
<p>By default, the <code>LocalValidatorFactoryBean</code> configures a <code>SpringConstraintValidatorFactory</code> that uses Spring to create <code>ConstraintValidator</code> instances. This lets your custom <code>ConstraintValidators</code> benefit from dependency injection like any other Spring bean.</p>
<p>The following example shows a custom <code>@Constraint</code> declaration followed by an associated <code>ConstraintValidator</code> implementation that uses Spring for dependency injection:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy=MyConstraintValidator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyConstraint &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConstraintValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span>;</span><br><span class="line">    <span class="keyword">private</span> Foo aDependency;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As the preceding example shows, a <code>ConstraintValidator</code> implementation can have its dependencies <code>@Autowired</code> as any other Spring bean.</p>
<h5 id="Spring-driven-Method-Validation"><a href="#Spring-driven-Method-Validation" class="headerlink" title="Spring-driven Method Validation"></a>Spring-driven Method Validation</h5><p>You can integrate the method validation feature supported by Bean Validation 1.1 (and, as a custom extension, also by Hibernate Validator 4.3) into a Spring context through a <code>MethodValidationPostProcessor</code> bean definition:</p>
<p>Java</p>
<p>XML</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.validation.beanvalidation.MethodValidationPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MethodValidationPostProcessor <span class="title function_">validationPostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MethodValidationPostProcessor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To be eligible for Spring-driven method validation, all target classes need to be annotated with Spring’s <code>@Validated</code> annotation, which can optionally also declare the validation groups to use. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/validation/beanvalidation/MethodValidationPostProcessor.html"><code>MethodValidationPostProcessor</code></a> for setup details with the Hibernate Validator and Bean Validation 1.1 providers.</p>
<table>
<thead>
<tr>
<th></th>
<th>Method validation relies on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-introduction-proxies">AOP Proxies</a> around the target classes, either JDK dynamic proxies for methods on interfaces or CGLIB proxies. There are certain limitations with the use of proxies, some of which are described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-understanding-aop-proxies">Understanding AOP Proxies</a>. In addition remember to always use methods and accessors on proxied classes; direct field access will not work.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Additional-Configuration-Options"><a href="#Additional-Configuration-Options" class="headerlink" title="Additional Configuration Options"></a>Additional Configuration Options</h5><p>The default <code>LocalValidatorFactoryBean</code> configuration suffices for most cases. There are a number of configuration options for various Bean Validation constructs, from message interpolation to traversal resolution. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/validation/beanvalidation/LocalValidatorFactoryBean.html"><code>LocalValidatorFactoryBean</code></a> javadoc for more information on these options.</p>
<h4 id="3-7-3-Configuring-a-DataBinder"><a href="#3-7-3-Configuring-a-DataBinder" class="headerlink" title="3.7.3. Configuring a DataBinder"></a>3.7.3. Configuring a <code>DataBinder</code></h4><p>Since Spring 3, you can configure a <code>DataBinder</code> instance with a <code>Validator</code>. Once configured, you can invoke the <code>Validator</code> by calling <code>binder.validate()</code>. Any validation <code>Errors</code> are automatically added to the binder’s <code>BindingResult</code>.</p>
<p>The following example shows how to use a <code>DataBinder</code> programmatically to invoke validation logic after binding to a target object:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Foo</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line"><span class="type">DataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataBinder</span>(target);</span><br><span class="line">binder.setValidator(<span class="keyword">new</span> <span class="title class_">FooValidator</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// bind to the target object</span></span><br><span class="line">binder.bind(propertyValues);</span><br><span class="line"></span><br><span class="line"><span class="comment">// validate the target object</span></span><br><span class="line">binder.validate();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get BindingResult that includes any validation errors</span></span><br><span class="line"><span class="type">BindingResult</span> <span class="variable">results</span> <span class="operator">=</span> binder.getBindingResult();</span><br></pre></td></tr></table></figure>

<p>You can also configure a <code>DataBinder</code> with multiple <code>Validator</code> instances through <code>dataBinder.addValidators</code> and <code>dataBinder.replaceValidators</code>. This is useful when combining globally configured bean validation with a Spring <code>Validator</code> configured locally on a DataBinder instance. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-config-validation">Spring MVC Validation Configuration</a>.</p>
<h4 id="3-7-4-Spring-MVC-3-Validation"><a href="#3-7-4-Spring-MVC-3-Validation" class="headerlink" title="3.7.4. Spring MVC 3 Validation"></a>3.7.4. Spring MVC 3 Validation</h4><p>See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-config-validation">Validation</a> in the Spring MVC chapter.</p>
<h2 id="4-Spring-Expression-Language-SpEL"><a href="#4-Spring-Expression-Language-SpEL" class="headerlink" title="4. Spring Expression Language (SpEL)"></a>4. Spring Expression Language (SpEL)</h2><p>The Spring Expression Language (“SpEL” for short) is a powerful expression language that supports querying and manipulating an object graph at runtime. The language syntax is similar to Unified EL but offers additional features, most notably method invocation and basic string templating functionality.</p>
<p>While there are several other Java expression languages available — OGNL, MVEL, and JBoss EL, to name a few — the Spring Expression Language was created to provide the Spring community with a single well supported expression language that can be used across all the products in the Spring portfolio. Its language features are driven by the requirements of the projects in the Spring portfolio, including tooling requirements for code completion support within the <a target="_blank" rel="noopener" href="https://spring.io/tools">Spring Tools for Eclipse</a>. That said, SpEL is based on a technology-agnostic API that lets other expression language implementations be integrated, should the need arise.</p>
<p>While SpEL serves as the foundation for expression evaluation within the Spring portfolio, it is not directly tied to Spring and can be used independently. To be self contained, many of the examples in this chapter use SpEL as if it were an independent expression language. This requires creating a few bootstrapping infrastructure classes, such as the parser. Most Spring users need not deal with this infrastructure and can, instead, author only expression strings for evaluation. An example of this typical use is the integration of SpEL into creating XML or annotation-based bean definitions, as shown in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-beandef">Expression support for defining bean definitions</a>.</p>
<p>This chapter covers the features of the expression language, its API, and its language syntax. In several places, <code>Inventor</code> and <code>Society</code> classes are used as the target objects for expression evaluation. These class declarations and the data used to populate them are listed at the end of the chapter.</p>
<p>The expression language supports the following functionality:</p>
<ul>
<li>Literal expressions</li>
<li>Boolean and relational operators</li>
<li>Regular expressions</li>
<li>Class expressions</li>
<li>Accessing properties, arrays, lists, and maps</li>
<li>Method invocation</li>
<li>Relational operators</li>
<li>Assignment</li>
<li>Calling constructors</li>
<li>Bean references</li>
<li>Array construction</li>
<li>Inline lists</li>
<li>Inline maps</li>
<li>Ternary operator</li>
<li>Variables</li>
<li>User-defined functions</li>
<li>Collection projection</li>
<li>Collection selection</li>
<li>Templated expressions</li>
</ul>
<h3 id="4-1-Evaluation"><a href="#4-1-Evaluation" class="headerlink" title="4.1. Evaluation"></a>4.1. Evaluation</h3><p>This section introduces the simple use of SpEL interfaces and its expression language. The complete language reference can be found in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-language-ref">Language Reference</a>.</p>
<p>The following code introduces the SpEL API to evaluate the literal string expression, <code>Hello World</code>.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;&quot;</span>); </span><br><span class="line"><span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> (String) exp.getValue();</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The value of the message variable is <code>&#39;Hello World&#39;</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The SpEL classes and interfaces you are most likely to use are located in the <code>org.springframework.expression</code> package and its sub-packages, such as <code>spel.support</code>.</p>
<p>The <code>ExpressionParser</code> interface is responsible for parsing an expression string. In the preceding example, the expression string is a string literal denoted by the surrounding single quotation marks. The <code>Expression</code> interface is responsible for evaluating the previously defined expression string. Two exceptions that can be thrown, <code>ParseException</code> and <code>EvaluationException</code>, when calling <code>parser.parseExpression</code> and <code>exp.getValue</code>, respectively.</p>
<p>SpEL supports a wide range of features, such as calling methods, accessing properties, and calling constructors.</p>
<p>In the following example of method invocation, we call the <code>concat</code> method on the string literal:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;.concat(&#x27;!&#x27;)&quot;</span>); </span><br><span class="line"><span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> (String) exp.getValue();</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The value of <code>message</code> is now ‘Hello World!’.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following example of calling a JavaBean property calls the <code>String</code> property <code>Bytes</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// invokes &#x27;getBytes()&#x27;</span></span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;.bytes&quot;</span>); </span><br><span class="line"><span class="type">byte</span>[] bytes = (<span class="type">byte</span>[]) exp.getValue();</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This line converts the literal to a byte array.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>SpEL also supports nested properties by using the standard dot notation (such as <code>prop1.prop2.prop3</code>) and also the corresponding setting of property values. Public fields may also be accessed.</p>
<p>The following example shows how to use dot notation to get the length of a literal:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// invokes &#x27;getBytes().length&#x27;</span></span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;.bytes.length&quot;</span>); </span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> (Integer) exp.getValue();</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>&#39;Hello World&#39;.bytes.length</code> gives the length of the literal.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The String’s constructor can be called instead of using a string literal, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;new String(&#x27;hello world&#x27;).toUpperCase()&quot;</span>); </span><br><span class="line"><span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> exp.getValue(String.class);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Construct a new <code>String</code> from the literal and make it be upper case.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Note the use of the generic method: <code>public &lt;T&gt; T getValue(Class&lt;T&gt; desiredResultType)</code>. Using this method removes the need to cast the value of the expression to the desired result type. An <code>EvaluationException</code> is thrown if the value cannot be cast to the type <code>T</code> or converted by using the registered type converter.</p>
<p>The more common usage of SpEL is to provide an expression string that is evaluated against a specific object instance (called the root object). The following example shows how to retrieve the <code>name</code> property from an instance of the <code>Inventor</code> class or create a boolean condition:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and set a calendar</span></span><br><span class="line"><span class="type">GregorianCalendar</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>();</span><br><span class="line">c.set(<span class="number">1856</span>, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The constructor arguments are name, birthday, and nationality.</span></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, c.getTime(), <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;name&quot;</span>); <span class="comment">// Parse name as an expression</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) exp.getValue(tesla);</span><br><span class="line"><span class="comment">// name == &quot;Nikola Tesla&quot;</span></span><br><span class="line"></span><br><span class="line">exp = parser.parseExpression(<span class="string">&quot;name == &#x27;Nikola Tesla&#x27;&quot;</span>);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> exp.getValue(tesla, Boolean.class);</span><br><span class="line"><span class="comment">// result == true</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-1-Understanding-EvaluationContext"><a href="#4-1-1-Understanding-EvaluationContext" class="headerlink" title="4.1.1. Understanding EvaluationContext"></a>4.1.1. Understanding <code>EvaluationContext</code></h4><p>The <code>EvaluationContext</code> interface is used when evaluating an expression to resolve properties, methods, or fields and to help perform type conversion. Spring provides two implementations.</p>
<ul>
<li><code>SimpleEvaluationContext</code>: Exposes a subset of essential SpEL language features and configuration options, for categories of expressions that do not require the full extent of the SpEL language syntax and should be meaningfully restricted. Examples include but are not limited to data binding expressions and property-based filters.</li>
<li><code>StandardEvaluationContext</code>: Exposes the full set of SpEL language features and configuration options. You can use it to specify a default root object and to configure every available evaluation-related strategy.</li>
</ul>
<p><code>SimpleEvaluationContext</code> is designed to support only a subset of the SpEL language syntax. It excludes Java type references, constructors, and bean references. It also requires you to explicitly choose the level of support for properties and methods in expressions. By default, the <code>create()</code> static factory method enables only read access to properties. You can also obtain a builder to configure the exact level of support needed, targeting one or some combination of the following:</p>
<ul>
<li>Custom <code>PropertyAccessor</code> only (no reflection)</li>
<li>Data binding properties for read-only access</li>
<li>Data binding properties for read and write</li>
</ul>
<h5 id="Type-Conversion"><a href="#Type-Conversion" class="headerlink" title="Type Conversion"></a>Type Conversion</h5><p>By default, SpEL uses the conversion service available in Spring core (<code>org.springframework.core.convert.ConversionService</code>). This conversion service comes with many built-in converters for common conversions but is also fully extensible so that you can add custom conversions between types. Additionally, it is generics-aware. This means that, when you work with generic types in expressions, SpEL attempts conversions to maintain type correctness for any objects it encounters.</p>
<p>What does this mean in practice? Suppose assignment, using <code>setValue()</code>, is being used to set a <code>List</code> property. The type of the property is actually <code>List&lt;Boolean&gt;</code>. SpEL recognizes that the elements of the list need to be converted to <code>Boolean</code> before being placed in it. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Simple</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Boolean&gt; booleanList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Boolean&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Simple</span> <span class="variable">simple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Simple</span>();</span><br><span class="line">simple.booleanList.add(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;false&quot; is passed in here as a String. SpEL and the conversion service</span></span><br><span class="line"><span class="comment">// will recognize that it needs to be a Boolean and convert it accordingly.</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;booleanList[0]&quot;</span>).setValue(context, simple, <span class="string">&quot;false&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// b is false</span></span><br><span class="line"><span class="type">Boolean</span> <span class="variable">b</span> <span class="operator">=</span> simple.booleanList.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-Parser-Configuration"><a href="#4-1-2-Parser-Configuration" class="headerlink" title="4.1.2. Parser Configuration"></a>4.1.2. Parser Configuration</h4><p>It is possible to configure the SpEL expression parser by using a parser configuration object (<code>org.springframework.expression.spel.SpelParserConfiguration</code>). The configuration object controls the behavior of some of the expression components. For example, if you index into an array or collection and the element at the specified index is <code>null</code>, SpEL can automatically create the element. This is useful when using expressions made up of a chain of property references. If you index into an array or list and specify an index that is beyond the end of the current size of the array or list, SpEL can automatically grow the array or list to accommodate that index. In order to add an element at the specified index, SpEL will try to create the element using the element type’s default constructor before setting the specified value. If the element type does not have a default constructor, <code>null</code> will be added to the array or list. If there is no built-in or custom converter that knows how to set the value, <code>null</code> will remain in the array or list at the specified index. The following example demonstrates how to automatically grow the list:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Turn on:</span></span><br><span class="line"><span class="comment">// - auto null reference initialization</span></span><br><span class="line"><span class="comment">// - auto collection growing</span></span><br><span class="line"><span class="type">SpelParserConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelParserConfiguration</span>(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>(config);</span><br><span class="line"></span><br><span class="line"><span class="type">Expression</span> <span class="variable">expression</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;list[3]&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> expression.getValue(demo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// demo.list will now be a real collection of 4 entries</span></span><br><span class="line"><span class="comment">// Each entry is a new empty String</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-SpEL-Compilation"><a href="#4-1-3-SpEL-Compilation" class="headerlink" title="4.1.3. SpEL Compilation"></a>4.1.3. SpEL Compilation</h4><p>Spring Framework 4.1 includes a basic expression compiler. Expressions are usually interpreted, which provides a lot of dynamic flexibility during evaluation but does not provide optimum performance. For occasional expression usage, this is fine, but, when used by other components such as Spring Integration, performance can be very important, and there is no real need for the dynamism.</p>
<p>The SpEL compiler is intended to address this need. During evaluation, the compiler generates a Java class that embodies the expression behavior at runtime and uses that class to achieve much faster expression evaluation. Due to the lack of typing around expressions, the compiler uses information gathered during the interpreted evaluations of an expression when performing compilation. For example, it does not know the type of a property reference purely from the expression, but during the first interpreted evaluation, it finds out what it is. Of course, basing compilation on such derived information can cause trouble later if the types of the various expression elements change over time. For this reason, compilation is best suited to expressions whose type information is not going to change on repeated evaluations.</p>
<p>Consider the following basic expression:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">someArray[0].someProperty.someOtherProperty &lt; 0.1</span><br></pre></td></tr></table></figure>

<p>Because the preceding expression involves array access, some property de-referencing, and numeric operations, the performance gain can be very noticeable. In an example micro benchmark run of 50000 iterations, it took 75ms to evaluate by using the interpreter and only 3ms using the compiled version of the expression.</p>
<h5 id="Compiler-Configuration"><a href="#Compiler-Configuration" class="headerlink" title="Compiler Configuration"></a>Compiler Configuration</h5><p>The compiler is not turned on by default, but you can turn it on in either of two different ways. You can turn it on by using the parser configuration process (<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-parser-configuration">discussed earlier</a>) or by using a Spring property when SpEL usage is embedded inside another component. This section discusses both of these options.</p>
<p>The compiler can operate in one of three modes, which are captured in the <code>org.springframework.expression.spel.SpelCompilerMode</code> enum. The modes are as follows:</p>
<ul>
<li><code>OFF</code> (default): The compiler is switched off.</li>
<li><code>IMMEDIATE</code>: In immediate mode, the expressions are compiled as soon as possible. This is typically after the first interpreted evaluation. If the compiled expression fails (typically due to a type changing, as described earlier), the caller of the expression evaluation receives an exception.</li>
<li><code>MIXED</code>: In mixed mode, the expressions silently switch between interpreted and compiled mode over time. After some number of interpreted runs, they switch to compiled form and, if something goes wrong with the compiled form (such as a type changing, as described earlier), the expression automatically switches back to interpreted form again. Sometime later, it may generate another compiled form and switch to it. Basically, the exception that the user gets in <code>IMMEDIATE</code> mode is instead handled internally.</li>
</ul>
<p><code>IMMEDIATE</code> mode exists because <code>MIXED</code> mode could cause issues for expressions that have side effects. If a compiled expression blows up after partially succeeding, it may have already done something that has affected the state of the system. If this has happened, the caller may not want it to silently re-run in interpreted mode, since part of the expression may be running twice.</p>
<p>After selecting a mode, use the <code>SpelParserConfiguration</code> to configure the parser. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SpelParserConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelParserConfiguration</span>(SpelCompilerMode.IMMEDIATE,</span><br><span class="line">        <span class="built_in">this</span>.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line"><span class="type">SpelExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>(config);</span><br><span class="line"></span><br><span class="line"><span class="type">Expression</span> <span class="variable">expr</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;payload&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">MyMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyMessage</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">payload</span> <span class="operator">=</span> expr.getValue(message);</span><br></pre></td></tr></table></figure>

<p>When you specify the compiler mode, you can also specify a classloader (passing null is allowed). Compiled expressions are defined in a child classloader created under any that is supplied. It is important to ensure that, if a classloader is specified, it can see all the types involved in the expression evaluation process. If you do not specify a classloader, a default classloader is used (typically the context classloader for the thread that is running during expression evaluation).</p>
<p>The second way to configure the compiler is for use when SpEL is embedded inside some other component and it may not be possible to configure it through a configuration object. In these cases, it is possible to set the <code>spring.expression.compiler.mode</code> property via a JVM system property (or via the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/appendix.html#appendix-spring-properties"><code>SpringProperties</code></a> mechanism) to one of the <code>SpelCompilerMode</code> enum values (<code>off</code>, <code>immediate</code>, or <code>mixed</code>).</p>
<h5 id="Compiler-Limitations"><a href="#Compiler-Limitations" class="headerlink" title="Compiler Limitations"></a>Compiler Limitations</h5><p>Since Spring Framework 4.1, the basic compilation framework is in place. However, the framework does not yet support compiling every kind of expression. The initial focus has been on the common expressions that are likely to be used in performance-critical contexts. The following kinds of expression cannot be compiled at the moment:</p>
<ul>
<li>Expressions involving assignment</li>
<li>Expressions relying on the conversion service</li>
<li>Expressions using custom resolvers or accessors</li>
<li>Expressions using selection or projection</li>
</ul>
<p>More types of expressions will be compilable in the future.</p>
<h3 id="4-2-Expressions-in-Bean-Definitions"><a href="#4-2-Expressions-in-Bean-Definitions" class="headerlink" title="4.2. Expressions in Bean Definitions"></a>4.2. Expressions in Bean Definitions</h3><p>You can use SpEL expressions with XML-based or annotation-based configuration metadata for defining <code>BeanDefinition</code> instances. In both cases, the syntax to define the expression is of the form <code>#&#123; &lt;expression string&gt; &#125;</code>.</p>
<h4 id="4-2-1-XML-Configuration"><a href="#4-2-1-XML-Configuration" class="headerlink" title="4.2.1. XML Configuration"></a>4.2.1. XML Configuration</h4><p>A property or constructor argument value can be set by using expressions, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;numberGuess&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.NumberGuess&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;randomNumber&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; T(java.lang.Math).random() * 100.0 &#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>All beans in the application context are available as predefined variables with their common bean name. This includes standard context beans such as <code>environment</code> (of type <code>org.springframework.core.env.Environment</code>) as well as <code>systemProperties</code> and <code>systemEnvironment</code> (of type <code>Map&lt;String, Object&gt;</code>) for access to the runtime environment.</p>
<p>The following example shows access to the <code>systemProperties</code> bean as a SpEL variable:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;taxCalculator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.TaxCalculator&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultLocale&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that you do not have to prefix the predefined variable with the <code>#</code> symbol here.</p>
<p>You can also refer to other bean properties by name, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;numberGuess&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.NumberGuess&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;randomNumber&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; T(java.lang.Math).random() * 100.0 &#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;shapeGuess&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.ShapeGuess&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialShapeSeed&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; numberGuess.randomNumber &#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-Annotation-Configuration"><a href="#4-2-2-Annotation-Configuration" class="headerlink" title="4.2.2. Annotation Configuration"></a>4.2.2. Annotation Configuration</h4><p>To specify a default value, you can place the <code>@Value</code> annotation on fields, methods, and method or constructor parameters.</p>
<p>The following example sets the default value of a field:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldValueTestBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefaultLocale</span><span class="params">(String defaultLocale)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDefaultLocale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following example shows the equivalent but on a property setter method:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertyValueTestBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefaultLocale</span><span class="params">(String defaultLocale)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDefaultLocale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Autowired methods and constructors can also use the <code>@Value</code> annotation, as the following examples show:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(MovieFinder movieFinder,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span> String defaultLocale)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">        <span class="built_in">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;user.country&#x27;]&#125;&quot;)</span> String defaultLocale)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">        <span class="built_in">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Language-Reference"><a href="#4-3-Language-Reference" class="headerlink" title="4.3. Language Reference"></a>4.3. Language Reference</h3><p>This section describes how the Spring Expression Language works. It covers the following topics:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-ref-literal">Literal Expressions</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-properties-arrays">Properties, Arrays, Lists, Maps, and Indexers</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-inline-lists">Inline Lists</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-inline-maps">Inline Maps</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-array-construction">Array Construction</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-methods">Methods</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators">Operators</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-types">Types</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-constructors">Constructors</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-ref-variables">Variables</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-ref-functions">Functions</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-bean-references">Bean References</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operator-ternary">Ternary Operator (If-Then-Else)</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operator-elvis">The Elvis Operator</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operator-safe-navigation">Safe Navigation Operator</a></li>
</ul>
<h4 id="4-3-1-Literal-Expressions"><a href="#4-3-1-Literal-Expressions" class="headerlink" title="4.3.1. Literal Expressions"></a>4.3.1. Literal Expressions</h4><p>The types of literal expressions supported are strings, numeric values (int, real, hex), boolean, and null. Strings are delimited by single quotation marks. To put a single quotation mark itself in a string, use two single quotation mark characters.</p>
<p>The following listing shows simple usage of literals. Typically, they are not used in isolation like this but, rather, as part of a more complex expression — for example, using a literal on one side of a logical comparison operator.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// evals to &quot;Hello World&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">helloWorld</span> <span class="operator">=</span> (String) parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;&quot;</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">avogadrosNumber</span> <span class="operator">=</span> (Double) parser.parseExpression(<span class="string">&quot;6.0221415E+23&quot;</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// evals to 2147483647</span></span><br><span class="line"><span class="type">int</span> <span class="variable">maxValue</span> <span class="operator">=</span> (Integer) parser.parseExpression(<span class="string">&quot;0x7FFFFFFF&quot;</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> (Boolean) parser.parseExpression(<span class="string">&quot;true&quot;</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">nullValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;null&quot;</span>).getValue();</span><br></pre></td></tr></table></figure>

<p>Numbers support the use of the negative sign, exponential notation, and decimal points. By default, real numbers are parsed by using <code>Double.parseDouble()</code>.</p>
<h4 id="4-3-2-Properties-Arrays-Lists-Maps-and-Indexers"><a href="#4-3-2-Properties-Arrays-Lists-Maps-and-Indexers" class="headerlink" title="4.3.2. Properties, Arrays, Lists, Maps, and Indexers"></a>4.3.2. Properties, Arrays, Lists, Maps, and Indexers</h4><p>Navigating with property references is easy. To do so, use a period to indicate a nested property value. The instances of the <code>Inventor</code> class, <code>pupin</code> and <code>tesla</code>, were populated with data listed in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-example-classes">Classes used in the examples</a> section. To navigate “down” the object graph and get Tesla’s year of birth and Pupin’s city of birth, we use the following expressions:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evals to 1856</span></span><br><span class="line"><span class="type">int</span> <span class="variable">year</span> <span class="operator">=</span> (Integer) parser.parseExpression(<span class="string">&quot;birthdate.year + 1900&quot;</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> (String) parser.parseExpression(<span class="string">&quot;placeOfBirth.city&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Case insensitivity is allowed for the first letter of property names. Thus, the expressions in the above example may be written as <code>Birthdate.Year + 1900</code> and <code>PlaceOfBirth.City</code>, respectively. In addition, properties may optionally be accessed via method invocations — for example, <code>getPlaceOfBirth().getCity()</code> instead of <code>placeOfBirth.city</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The contents of arrays and lists are obtained by using square bracket notation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inventions Array</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to &quot;Induction motor&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">invention</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;inventions[3]&quot;</span>).getValue(</span><br><span class="line">        context, tesla, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Members List</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to &quot;Nikola Tesla&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;members[0].name&quot;</span>).getValue(</span><br><span class="line">        context, ieee, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// List and Array navigation</span></span><br><span class="line"><span class="comment">// evaluates to &quot;Wireless communication&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">invention</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;members[0].inventions[6]&quot;</span>).getValue(</span><br><span class="line">        context, ieee, String.class);</span><br></pre></td></tr></table></figure>

<p>The contents of maps are obtained by specifying the literal key value within the brackets. In the following example, because keys for the <code>officers</code> map are strings, we can specify string literals:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Officer&#x27;s Dictionary</span></span><br><span class="line"></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">pupin</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;officers[&#x27;president&#x27;]&quot;</span>).getValue(</span><br><span class="line">        societyContext, Inventor.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to &quot;Idvor&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;officers[&#x27;president&#x27;].placeOfBirth.city&quot;</span>).getValue(</span><br><span class="line">        societyContext, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// setting values</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;officers[&#x27;advisors&#x27;][0].placeOfBirth.country&quot;</span>).setValue(</span><br><span class="line">        societyContext, <span class="string">&quot;Croatia&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-3-Inline-Lists"><a href="#4-3-3-Inline-Lists" class="headerlink" title="4.3.3. Inline Lists"></a>4.3.3. Inline Lists</h4><p>You can directly express lists in an expression by using <code>&#123;&#125;</code> notation.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to a Java list containing the four numbers</span></span><br><span class="line"><span class="type">List</span> <span class="variable">numbers</span> <span class="operator">=</span> (List) parser.parseExpression(<span class="string">&quot;&#123;1,2,3,4&#125;&quot;</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="type">List</span> <span class="variable">listOfLists</span> <span class="operator">=</span> (List) parser.parseExpression(<span class="string">&quot;&#123;&#123;&#x27;a&#x27;,&#x27;b&#x27;&#125;,&#123;&#x27;x&#x27;,&#x27;y&#x27;&#125;&#125;&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p><code>&#123;&#125;</code> by itself means an empty list. For performance reasons, if the list is itself entirely composed of fixed literals, a constant list is created to represent the expression (rather than building a new list on each evaluation).</p>
<h4 id="4-3-4-Inline-Maps"><a href="#4-3-4-Inline-Maps" class="headerlink" title="4.3.4. Inline Maps"></a>4.3.4. Inline Maps</h4><p>You can also directly express maps in an expression by using <code>&#123;key:value&#125;</code> notation. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to a Java map containing the two entries</span></span><br><span class="line"><span class="type">Map</span> <span class="variable">inventorInfo</span> <span class="operator">=</span> (Map) parser.parseExpression(<span class="string">&quot;&#123;name:&#x27;Nikola&#x27;,dob:&#x27;10-July-1856&#x27;&#125;&quot;</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="type">Map</span> <span class="variable">mapOfMaps</span> <span class="operator">=</span> (Map) parser.parseExpression(<span class="string">&quot;&#123;name:&#123;first:&#x27;Nikola&#x27;,last:&#x27;Tesla&#x27;&#125;,dob:&#123;day:10,month:&#x27;July&#x27;,year:1856&#125;&#125;&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p><code>&#123;:&#125;</code> by itself means an empty map. For performance reasons, if the map is itself composed of fixed literals or other nested constant structures (lists or maps), a constant map is created to represent the expression (rather than building a new map on each evaluation). Quoting of the map keys is optional (unless the key contains a period (<code>.</code>)). The examples above do not use quoted keys.</p>
<h4 id="4-3-5-Array-Construction"><a href="#4-3-5-Array-Construction" class="headerlink" title="4.3.5. Array Construction"></a>4.3.5. Array Construction</h4><p>You can build arrays by using the familiar Java syntax, optionally supplying an initializer to have the array populated at construction time. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers1 = (<span class="type">int</span>[]) parser.parseExpression(<span class="string">&quot;new int[4]&quot;</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array with initializer</span></span><br><span class="line"><span class="type">int</span>[] numbers2 = (<span class="type">int</span>[]) parser.parseExpression(<span class="string">&quot;new int[]&#123;1,2,3&#125;&quot;</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Multi dimensional array</span></span><br><span class="line"><span class="type">int</span>[][] numbers3 = (<span class="type">int</span>[][]) parser.parseExpression(<span class="string">&quot;new int[4][5]&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p>You cannot currently supply an initializer when you construct a multi-dimensional array.</p>
<h4 id="4-3-6-Methods"><a href="#4-3-6-Methods" class="headerlink" title="4.3.6. Methods"></a>4.3.6. Methods</h4><p>You can invoke methods by using typical Java programming syntax. You can also invoke methods on literals. Variable arguments are also supported. The following examples show how to invoke methods:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string literal, evaluates to &quot;bc&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">bc</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;abc&#x27;.substring(1, 3)&quot;</span>).getValue(String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>).getValue(</span><br><span class="line">        societyContext, Boolean.class);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-7-Operators"><a href="#4-3-7-Operators" class="headerlink" title="4.3.7. Operators"></a>4.3.7. Operators</h4><p>The Spring Expression Language supports the following kinds of operators:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators-relational">Relational Operators</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators-logical">Logical Operators</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators-mathematical">Mathematical Operators</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-assignment">The Assignment Operator</a></li>
</ul>
<h5 id="Relational-Operators"><a href="#Relational-Operators" class="headerlink" title="Relational Operators"></a>Relational Operators</h5><p>The relational operators (equal, not equal, less than, less than or equal, greater than, and greater than or equal) are supported by using standard operator notation. The following listing shows a few examples of operators:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;2 == 2&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;2 &lt; -5.0&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;black&#x27; &lt; &#x27;block&#x27;&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Greater-than and less-than comparisons against <code>null</code> follow a simple rule: <code>null</code> is treated as nothing (that is NOT as zero). As a consequence, any other value is always greater than <code>null</code> (<code>X &gt; null</code> is always <code>true</code>) and no other value is ever less than nothing (<code>X &lt; null</code> is always <code>false</code>).If you prefer numeric comparisons instead, avoid number-based <code>null</code> comparisons in favor of comparisons against zero (for example, <code>X &gt; 0</code> or <code>X &lt; 0</code>).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In addition to the standard relational operators, SpEL supports the <code>instanceof</code> and regular expression-based <code>matches</code> operator. The following listing shows examples of both:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;&#x27;xyz&#x27; instanceof T(Integer)&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;&#x27;5.00&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;&#x27;5.0067&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Be careful with primitive types, as they are immediately boxed up to their wrapper types. For example, <code>1 instanceof T(int)</code> evaluates to <code>false</code>, while <code>1 instanceof T(Integer)</code> evaluates to <code>true</code>, as expected.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Each symbolic operator can also be specified as a purely alphabetic equivalent. This avoids problems where the symbols used have special meaning for the document type in which the expression is embedded (such as in an XML document). The textual equivalents are:</p>
<ul>
<li><code>lt</code> (<code>&lt;</code>)</li>
<li><code>gt</code> (<code>&gt;</code>)</li>
<li><code>le</code> (<code>&lt;=</code>)</li>
<li><code>ge</code> (<code>&gt;=</code>)</li>
<li><code>eq</code> (<code>==</code>)</li>
<li><code>ne</code> (<code>!=</code>)</li>
<li><code>div</code> (<code>/</code>)</li>
<li><code>mod</code> (<code>%</code>)</li>
<li><code>not</code> (<code>!</code>).</li>
</ul>
<p>All of the textual operators are case-insensitive.</p>
<h5 id="Logical-Operators"><a href="#Logical-Operators" class="headerlink" title="Logical Operators"></a>Logical Operators</h5><p>SpEL supports the following logical operators:</p>
<ul>
<li><code>and</code> (<code>&amp;&amp;</code>)</li>
<li><code>or</code> (<code>||</code>)</li>
<li><code>not</code> (<code>!</code>)</li>
</ul>
<p>The following example shows how to use the logical operators:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -- AND --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;true and false&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="string">&quot;isMember(&#x27;Nikola Tesla&#x27;) and isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- OR --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;true or false&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="string">&quot;isMember(&#x27;Nikola Tesla&#x27;) or isMember(&#x27;Albert Einstein&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- NOT --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;!true&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- AND and NOT --</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="string">&quot;isMember(&#x27;Nikola Tesla&#x27;) and !isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br></pre></td></tr></table></figure>

<h5 id="Mathematical-Operators"><a href="#Mathematical-Operators" class="headerlink" title="Mathematical Operators"></a>Mathematical Operators</h5><p>You can use the addition operator (<code>+</code>) on both numbers and strings. You can use the subtraction (<code>-</code>), multiplication (<code>*</code>), and division (<code>/</code>) operators only on numbers. You can also use the modulus (<code>%</code>) and exponential power (<code>^</code>) operators on numbers. Standard operator precedence is enforced. The following example shows the mathematical operators in use:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Addition</span></span><br><span class="line"><span class="type">int</span> <span class="variable">two</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1 + 1&quot;</span>).getValue(Integer.class);  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">testString</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;&#x27;test&#x27; + &#x27; &#x27; + &#x27;string&#x27;&quot;</span>).getValue(String.class);  <span class="comment">// &#x27;test string&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Subtraction</span></span><br><span class="line"><span class="type">int</span> <span class="variable">four</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1 - -3&quot;</span>).getValue(Integer.class);  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1000.00 - 1e4&quot;</span>).getValue(Double.class);  <span class="comment">// -9000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Multiplication</span></span><br><span class="line"><span class="type">int</span> <span class="variable">six</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;-2 * -3&quot;</span>).getValue(Integer.class);  <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">twentyFour</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;2.0 * 3e0 * 4&quot;</span>).getValue(Double.class);  <span class="comment">// 24.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Division</span></span><br><span class="line"><span class="type">int</span> <span class="variable">minusTwo</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;6 / -3&quot;</span>).getValue(Integer.class);  <span class="comment">// -2</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">one</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;8.0 / 4e0 / 2&quot;</span>).getValue(Double.class);  <span class="comment">// 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Modulus</span></span><br><span class="line"><span class="type">int</span> <span class="variable">three</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;7 % 4&quot;</span>).getValue(Integer.class);  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">one</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;8 / 5 % 2&quot;</span>).getValue(Integer.class);  <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Operator precedence</span></span><br><span class="line"><span class="type">int</span> <span class="variable">minusTwentyOne</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1+2-3*8&quot;</span>).getValue(Integer.class);  <span class="comment">// -21</span></span><br></pre></td></tr></table></figure>

<h5 id="The-Assignment-Operator"><a href="#The-Assignment-Operator" class="headerlink" title="The Assignment Operator"></a>The Assignment Operator</h5><p>To set a property, use the assignment operator (<code>=</code>). This is typically done within a call to <code>setValue</code> but can also be done inside a call to <code>getValue</code>. The following listing shows both ways to use the assignment operator:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Inventor</span> <span class="variable">inventor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>();</span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadWriteDataBinding().build();</span><br><span class="line"></span><br><span class="line">parser.parseExpression(<span class="string">&quot;name&quot;</span>).setValue(context, inventor, <span class="string">&quot;Aleksandar Seovic&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alternatively</span></span><br><span class="line"><span class="type">String</span> <span class="variable">aleks</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;name = &#x27;Aleksandar Seovic&#x27;&quot;</span>).getValue(context, inventor, String.class);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-8-Types"><a href="#4-3-8-Types" class="headerlink" title="4.3.8. Types"></a>4.3.8. Types</h4><p>You can use the special <code>T</code> operator to specify an instance of <code>java.lang.Class</code> (the type). Static methods are invoked by using this operator as well. The <code>StandardEvaluationContext</code> uses a <code>TypeLocator</code> to find types, and the <code>StandardTypeLocator</code> (which can be replaced) is built with an understanding of the <code>java.lang</code> package. This means that <code>T()</code> references to types within the <code>java.lang</code> package do not need to be fully qualified, but all other type references must be. The following example shows how to use the <code>T</code> operator:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">dateClass</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;T(java.util.Date)&quot;</span>).getValue(Class.class);</span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">stringClass</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;T(String)&quot;</span>).getValue(Class.class);</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR&quot;</span>)</span><br><span class="line">        .getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-9-Constructors"><a href="#4-3-9-Constructors" class="headerlink" title="4.3.9. Constructors"></a>4.3.9. Constructors</h4><p>You can invoke constructors by using the <code>new</code> operator. You should use the fully qualified class name for all types except those located in the <code>java.lang</code> package (<code>Integer</code>, <code>Float</code>, <code>String</code>, and so on). The following example shows how to use the <code>new</code> operator to invoke constructors:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Inventor</span> <span class="variable">einstein</span> <span class="operator">=</span> p.parseExpression(</span><br><span class="line">        <span class="string">&quot;new org.spring.samples.spel.inventor.Inventor(&#x27;Albert Einstein&#x27;, &#x27;German&#x27;)&quot;</span>)</span><br><span class="line">        .getValue(Inventor.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create new Inventor instance within the add() method of List</span></span><br><span class="line">p.parseExpression(</span><br><span class="line">        <span class="string">&quot;Members.add(new org.spring.samples.spel.inventor.Inventor(</span></span><br><span class="line"><span class="string">            &#x27;Albert Einstein&#x27;, &#x27;German&#x27;))&quot;</span>).getValue(societyContext);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-10-Variables"><a href="#4-3-10-Variables" class="headerlink" title="4.3.10. Variables"></a>4.3.10. Variables</h4><p>You can reference variables in the expression by using the <code>#variableName</code> syntax. Variables are set by using the <code>setVariable</code> method on <code>EvaluationContext</code> implementations.</p>
<table>
<thead>
<tr>
<th></th>
<th>Valid variable names must be composed of one or more of the following supported characters.letters: <code>A</code> to <code>Z</code> and <code>a</code> to <code>z</code>digits: <code>0</code> to <code>9</code>underscore: <code>_</code>dollar sign: <code>$</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following example shows how to use variables.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadWriteDataBinding().build();</span><br><span class="line">context.setVariable(<span class="string">&quot;newName&quot;</span>, <span class="string">&quot;Mike Tesla&quot;</span>);</span><br><span class="line"></span><br><span class="line">parser.parseExpression(<span class="string">&quot;name = #newName&quot;</span>).getValue(context, tesla);</span><br><span class="line">System.out.println(tesla.getName())  <span class="comment">// &quot;Mike Tesla&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="The-this-and-root-Variables"><a href="#The-this-and-root-Variables" class="headerlink" title="The #this and #root Variables"></a>The <code>#this</code> and <code>#root</code> Variables</h5><p>The <code>#this</code> variable is always defined and refers to the current evaluation object (against which unqualified references are resolved). The <code>#root</code> variable is always defined and refers to the root context object. Although <code>#this</code> may vary as components of an expression are evaluated, <code>#root</code> always refers to the root. The following examples show how to use the <code>#this</code> and <code>#root</code> variables:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create an array of integers</span></span><br><span class="line">List&lt;Integer&gt; primes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">primes.addAll(Arrays.asList(<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// create parser and set variable &#x27;primes&#x27; as the array of integers</span></span><br><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataAccess();</span><br><span class="line">context.setVariable(<span class="string">&quot;primes&quot;</span>, primes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// all prime numbers &gt; 10 from the list (using selection ?&#123;...&#125;)</span></span><br><span class="line"><span class="comment">// evaluates to [11, 13, 17]</span></span><br><span class="line">List&lt;Integer&gt; primesGreaterThanTen = (List&lt;Integer&gt;) parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;#primes.?[#this&gt;10]&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-11-Functions"><a href="#4-3-11-Functions" class="headerlink" title="4.3.11. Functions"></a>4.3.11. Functions</h4><p>You can extend SpEL by registering user-defined functions that can be called within the expression string. The function is registered through the <code>EvaluationContext</code>. The following example shows how to register a user-defined function:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ...;</span><br><span class="line"></span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line">context.setVariable(<span class="string">&quot;myFunction&quot;</span>, method);</span><br></pre></td></tr></table></figure>

<p>For example, consider the following utility method that reverses a string:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">StringUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">reverseString</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">backwards</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(input.length());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; input.length(); i++) &#123;</span><br><span class="line">            backwards.append(input.charAt(input.length() - <span class="number">1</span> - i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> backwards.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can then register and use the preceding method, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line">context.setVariable(<span class="string">&quot;reverseString&quot;</span>,</span><br><span class="line">        StringUtils.class.getDeclaredMethod(<span class="string">&quot;reverseString&quot;</span>, String.class));</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">helloWorldReversed</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;#reverseString(&#x27;hello&#x27;)&quot;</span>).getValue(context, String.class);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-12-Bean-References"><a href="#4-3-12-Bean-References" class="headerlink" title="4.3.12. Bean References"></a>4.3.12. Bean References</h4><p>If the evaluation context has been configured with a bean resolver, you can look up beans from an expression by using the <code>@</code> symbol. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line">context.setBeanResolver(<span class="keyword">new</span> <span class="title class_">MyBeanResolver</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will end up calling resolve(context,&quot;something&quot;) on MyBeanResolver during evaluation</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;@something&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p>To access a factory bean itself, you should instead prefix the bean name with an <code>&amp;</code> symbol. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line">context.setBeanResolver(<span class="keyword">new</span> <span class="title class_">MyBeanResolver</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will end up calling resolve(context,&quot;&amp;foo&quot;) on MyBeanResolver during evaluation</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&amp;foo&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-13-Ternary-Operator-If-Then-Else"><a href="#4-3-13-Ternary-Operator-If-Then-Else" class="headerlink" title="4.3.13. Ternary Operator (If-Then-Else)"></a>4.3.13. Ternary Operator (If-Then-Else)</h4><p>You can use the ternary operator for performing if-then-else conditional logic inside the expression. The following listing shows a minimal example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">falseString</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;false ? &#x27;trueExp&#x27; : &#x27;falseExp&#x27;&quot;</span>).getValue(String.class);</span><br></pre></td></tr></table></figure>

<p>In this case, the boolean <code>false</code> results in returning the string value <code>&#39;falseExp&#39;</code>. A more realistic example follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">parser.parseExpression(<span class="string">&quot;name&quot;</span>).setValue(societyContext, <span class="string">&quot;IEEE&quot;</span>);</span><br><span class="line">societyContext.setVariable(<span class="string">&quot;queryName&quot;</span>, <span class="string">&quot;Nikola Tesla&quot;</span>);</span><br><span class="line"></span><br><span class="line">expression = <span class="string">&quot;isMember(#queryName)? #queryName + &#x27; is a member of the &#x27; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;+ Name + &#x27; Society&#x27; : #queryName + &#x27; is not a member of the &#x27; + Name + &#x27; Society&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">queryResultString</span> <span class="operator">=</span> parser.parseExpression(expression)</span><br><span class="line">        .getValue(societyContext, String.class);</span><br><span class="line"><span class="comment">// queryResultString = &quot;Nikola Tesla is a member of the IEEE Society&quot;</span></span><br></pre></td></tr></table></figure>

<p>See the next section on the Elvis operator for an even shorter syntax for the ternary operator.</p>
<h4 id="4-3-14-The-Elvis-Operator"><a href="#4-3-14-The-Elvis-Operator" class="headerlink" title="4.3.14. The Elvis Operator"></a>4.3.14. The Elvis Operator</h4><p>The Elvis operator is a shortening of the ternary operator syntax and is used in the <a target="_blank" rel="noopener" href="http://www.groovy-lang.org/operators.html#_elvis_operator">Groovy</a> language. With the ternary operator syntax, you usually have to repeat a variable twice, as the following example shows:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">&quot;Elvis Presley&quot;</span>;</span><br><span class="line">String displayName = (name != <span class="literal">null</span> ? name : <span class="string">&quot;Unknown&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Instead, you can use the Elvis operator (named for the resemblance to Elvis’ hair style). The following example shows how to use the Elvis operator:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;name?:&#x27;Unknown&#x27;&quot;</span>).getValue(<span class="keyword">new</span> <span class="title class_">Inventor</span>(), String.class);</span><br><span class="line">System.out.println(name);  <span class="comment">// &#x27;Unknown&#x27;</span></span><br></pre></td></tr></table></figure>

<p>The following listing shows a more complex example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;name?:&#x27;Elvis Presley&#x27;&quot;</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(name);  <span class="comment">// Nikola Tesla</span></span><br><span class="line"></span><br><span class="line">tesla.setName(<span class="literal">null</span>);</span><br><span class="line">name = parser.parseExpression(<span class="string">&quot;name?:&#x27;Elvis Presley&#x27;&quot;</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(name);  <span class="comment">// Elvis Presley</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can use the Elvis operator to apply default values in expressions. The following example shows how to use the Elvis operator in a <code>@Value</code> expression:<code>@Value(&quot;#&#123;systemProperties[&#39;pop3.port&#39;] ?: 25&#125;&quot;)</code>This will inject a system property <code>pop3.port</code> if it is defined or 25 if not.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="4-3-15-Safe-Navigation-Operator"><a href="#4-3-15-Safe-Navigation-Operator" class="headerlink" title="4.3.15. Safe Navigation Operator"></a>4.3.15. Safe Navigation Operator</h4><p>The safe navigation operator is used to avoid a <code>NullPointerException</code> and comes from the <a target="_blank" rel="noopener" href="http://www.groovy-lang.org/operators.html#_safe_navigation_operator">Groovy</a> language. Typically, when you have a reference to an object, you might need to verify that it is not null before accessing methods or properties of the object. To avoid this, the safe navigation operator returns null instead of throwing an exception. The following example shows how to use the safe navigation operator:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line">tesla.setPlaceOfBirth(<span class="keyword">new</span> <span class="title class_">PlaceOfBirth</span>(<span class="string">&quot;Smiljan&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;placeOfBirth?.city&quot;</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(city);  <span class="comment">// Smiljan</span></span><br><span class="line"></span><br><span class="line">tesla.setPlaceOfBirth(<span class="literal">null</span>);</span><br><span class="line">city = parser.parseExpression(<span class="string">&quot;placeOfBirth?.city&quot;</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(city);  <span class="comment">// null - does not throw NullPointerException!!!</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-16-Collection-Selection"><a href="#4-3-16-Collection-Selection" class="headerlink" title="4.3.16. Collection Selection"></a>4.3.16. Collection Selection</h4><p>Selection is a powerful expression language feature that lets you transform a source collection into another collection by selecting from its entries.</p>
<p>Selection uses a syntax of <code>.?[selectionExpression]</code>. It filters the collection and returns a new collection that contains a subset of the original elements. For example, selection lets us easily get a list of Serbian inventors, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Inventor&gt; list = (List&lt;Inventor&gt;) parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;members.?[nationality == &#x27;Serbian&#x27;]&quot;</span>).getValue(societyContext);</span><br></pre></td></tr></table></figure>

<p>Selection is supported for arrays and anything that implements <code>java.lang.Iterable</code> or <code>java.util.Map</code>. For a list or array, the selection criteria is evaluated against each individual element. Against a map, the selection criteria is evaluated against each map entry (objects of the Java type <code>Map.Entry</code>). Each map entry has its <code>key</code> and <code>value</code> accessible as properties for use in the selection.</p>
<p>The following expression returns a new map that consists of those elements of the original map where the entry’s value is less than 27:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">newMap</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;map.?[value&lt;27]&quot;</span>).getValue();</span><br></pre></td></tr></table></figure>

<p>In addition to returning all the selected elements, you can retrieve only the first or the last element. To obtain the first element matching the selection, the syntax is <code>.^[selectionExpression]</code>. To obtain the last matching selection, the syntax is <code>.$[selectionExpression]</code>.</p>
<h4 id="4-3-17-Collection-Projection"><a href="#4-3-17-Collection-Projection" class="headerlink" title="4.3.17. Collection Projection"></a>4.3.17. Collection Projection</h4><p>Projection lets a collection drive the evaluation of a sub-expression, and the result is a new collection. The syntax for projection is <code>.![projectionExpression]</code>. For example, suppose we have a list of inventors but want the list of cities where they were born. Effectively, we want to evaluate ‘placeOfBirth.city’ for every entry in the inventor list. The following example uses projection to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returns [&#x27;Smiljan&#x27;, &#x27;Idvor&#x27; ]</span></span><br><span class="line"><span class="type">List</span> <span class="variable">placesOfBirth</span> <span class="operator">=</span> (List)parser.parseExpression(<span class="string">&quot;members.![placeOfBirth.city]&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Projection is supported for arrays and anything that implements <code>java.lang.Iterable</code> or <code>java.util.Map</code>. When using a map to drive projection, the projection expression is evaluated against each entry in the map (represented as a Java <code>Map.Entry</code>). The result of a projection across a map is a list that consists of the evaluation of the projection expression against each map entry.</p>
<h4 id="4-3-18-Expression-templating"><a href="#4-3-18-Expression-templating" class="headerlink" title="4.3.18. Expression templating"></a>4.3.18. Expression templating</h4><p>Expression templates allow mixing literal text with one or more evaluation blocks. Each evaluation block is delimited with prefix and suffix characters that you can define. A common choice is to use <code>#&#123; &#125;</code> as the delimiters, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">randomPhrase</span> <span class="operator">=</span> parser.parseExpression(</span><br><span class="line">        <span class="string">&quot;random number is #&#123;T(java.lang.Math).random()&#125;&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TemplateParserContext</span>()).getValue(String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to &quot;random number is 0.7038186818312008&quot;</span></span><br></pre></td></tr></table></figure>

<p>The string is evaluated by concatenating the literal text <code>&#39;random number is &#39;</code> with the result of evaluating the expression inside the <code>#&#123; &#125;</code> delimiter (in this case, the result of calling that <code>random()</code> method). The second argument to the <code>parseExpression()</code> method is of the type <code>ParserContext</code>. The <code>ParserContext</code> interface is used to influence how the expression is parsed in order to support the expression templating functionality. The definition of <code>TemplateParserContext</code> follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateParserContext</span> <span class="keyword">implements</span> <span class="title class_">ParserContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getExpressionPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;#&#123;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getExpressionSuffix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-Classes-Used-in-the-Examples"><a href="#4-4-Classes-Used-in-the-Examples" class="headerlink" title="4.4. Classes Used in the Examples"></a>4.4. Classes Used in the Examples</h3><p>This section lists the classes used in the examples throughout this chapter.</p>
<p>Inventor.Java</p>
<p>Inventor.kt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.samples.spel.inventor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.GregorianCalendar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Inventor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nationality;</span><br><span class="line">    <span class="keyword">private</span> String[] inventions;</span><br><span class="line">    <span class="keyword">private</span> Date birthdate;</span><br><span class="line">    <span class="keyword">private</span> PlaceOfBirth placeOfBirth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Inventor</span><span class="params">(String name, String nationality)</span> &#123;</span><br><span class="line">        GregorianCalendar c= <span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>();</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.nationality = nationality;</span><br><span class="line">        <span class="built_in">this</span>.birthdate = c.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Inventor</span><span class="params">(String name, Date birthdate, String nationality)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.nationality = nationality;</span><br><span class="line">        <span class="built_in">this</span>.birthdate = birthdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Inventor</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNationality</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nationality;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNationality</span><span class="params">(String nationality)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nationality = nationality;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getBirthdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> birthdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBirthdate</span><span class="params">(Date birthdate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.birthdate = birthdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PlaceOfBirth <span class="title function_">getPlaceOfBirth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> placeOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPlaceOfBirth</span><span class="params">(PlaceOfBirth placeOfBirth)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.placeOfBirth = placeOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInventions</span><span class="params">(String[] inventions)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inventions = inventions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getInventions() &#123;</span><br><span class="line">        <span class="keyword">return</span> inventions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PlaceOfBirth.java</p>
<p>PlaceOfBirth.kt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.samples.spel.inventor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlaceOfBirth</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String country;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PlaceOfBirth</span><span class="params">(String city)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city=city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PlaceOfBirth</span><span class="params">(String city, String country)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(city);</span><br><span class="line">        <span class="built_in">this</span>.country = country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCity</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCountry</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCountry</span><span class="params">(String country)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.country = country;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Society.java</p>
<p>Society.kt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.samples.spel.inventor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Society</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">Advisors</span> <span class="operator">=</span> <span class="string">&quot;advisors&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">President</span> <span class="operator">=</span> <span class="string">&quot;president&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Inventor&gt; members = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Inventor&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">officers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List <span class="title function_">getMembers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> members;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">getOfficers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> officers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMember</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Inventor inventor : members) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inventor.getName().equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Aspect-Oriented-Programming-with-Spring"><a href="#5-Aspect-Oriented-Programming-with-Spring" class="headerlink" title="5. Aspect Oriented Programming with Spring"></a>5. Aspect Oriented Programming with Spring</h2><p>Aspect-oriented Programming (AOP) complements Object-oriented Programming (OOP) by providing another way of thinking about program structure. The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the aspect. Aspects enable the modularization of concerns (such as transaction management) that cut across multiple types and objects. (Such concerns are often termed “crosscutting” concerns in AOP literature.)</p>
<p>One of the key components of Spring is the AOP framework. While the Spring IoC container does not depend on AOP (meaning you do not need to use AOP if you don’t want to), AOP complements Spring IoC to provide a very capable middleware solution.</p>
<p>Spring AOP with AspectJ pointcuts</p>
<p>Spring provides simple and powerful ways of writing custom aspects by using either a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-schema">schema-based approach</a> or the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj">@AspectJ annotation style</a>. Both of these styles offer fully typed advice and use of the AspectJ pointcut language while still using Spring AOP for weaving.</p>
<p>This chapter discusses the schema- and @AspectJ-based AOP support. The lower-level AOP support is discussed in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-api">the following chapter</a>.</p>
<p>AOP is used in the Spring Framework to:</p>
<ul>
<li>Provide declarative enterprise services. The most important such service is <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#transaction-declarative">declarative transaction management</a>.</li>
<li>Let users implement custom aspects, complementing their use of OOP with AOP.</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>If you are interested only in generic declarative services or other pre-packaged declarative middleware services such as pooling, you do not need to work directly with Spring AOP, and can skip most of this chapter.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="5-1-AOP-Concepts"><a href="#5-1-AOP-Concepts" class="headerlink" title="5.1. AOP Concepts"></a>5.1. AOP Concepts</h3><p>Let us begin by defining some central AOP concepts and terminology. These terms are not Spring-specific. Unfortunately, AOP terminology is not particularly intuitive. However, it would be even more confusing if Spring used its own terminology.</p>
<ul>
<li>Aspect: A modularization of a concern that cuts across multiple classes. Transaction management is a good example of a crosscutting concern in enterprise Java applications. In Spring AOP, aspects are implemented by using regular classes (the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-schema">schema-based approach</a>) or regular classes annotated with the <code>@Aspect</code> annotation (the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj">@AspectJ style</a>).</li>
<li>Join point: A point during the execution of a program, such as the execution of a method or the handling of an exception. In Spring AOP, a join point always represents a method execution.</li>
<li>Advice: Action taken by an aspect at a particular join point. Different types of advice include “around”, “before” and “after” advice. (Advice types are discussed later.) Many AOP frameworks, including Spring, model an advice as an interceptor and maintain a chain of interceptors around the join point.</li>
<li>Pointcut: A predicate that matches join points. Advice is associated with a pointcut expression and runs at any join point matched by the pointcut (for example, the execution of a method with a certain name). The concept of join points as matched by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut expression language by default.</li>
<li>Introduction: Declaring additional methods or fields on behalf of a type. Spring AOP lets you introduce new interfaces (and a corresponding implementation) to any advised object. For example, you could use an introduction to make a bean implement an <code>IsModified</code> interface, to simplify caching. (An introduction is known as an inter-type declaration in the AspectJ community.)</li>
<li>Target object: An object being advised by one or more aspects. Also referred to as the “advised object”. Since Spring AOP is implemented by using runtime proxies, this object is always a proxied object.</li>
<li>AOP proxy: An object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy is a JDK dynamic proxy or a CGLIB proxy.</li>
<li>Weaving: linking aspects with other application types or objects to create an advised object. This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime.</li>
</ul>
<p>Spring AOP includes the following types of advice:</p>
<ul>
<li>Before advice: Advice that runs before a join point but that does not have the ability to prevent execution flow proceeding to the join point (unless it throws an exception).</li>
<li>After returning advice: Advice to be run after a join point completes normally (for example, if a method returns without throwing an exception).</li>
<li>After throwing advice: Advice to be run if a method exits by throwing an exception.</li>
<li>After (finally) advice: Advice to be run regardless of the means by which a join point exits (normal or exceptional return).</li>
<li>Around advice: Advice that surrounds a join point such as a method invocation. This is the most powerful kind of advice. Around advice can perform custom behavior before and after the method invocation. It is also responsible for choosing whether to proceed to the join point or to shortcut the advised method execution by returning its own return value or throwing an exception.</li>
</ul>
<p>Around advice is the most general kind of advice. Since Spring AOP, like AspectJ, provides a full range of advice types, we recommend that you use the least powerful advice type that can implement the required behavior. For example, if you need only to update a cache with the return value of a method, you are better off implementing an after returning advice than an around advice, although an around advice can accomplish the same thing. Using the most specific advice type provides a simpler programming model with less potential for errors. For example, you do not need to invoke the <code>proceed()</code> method on the <code>JoinPoint</code> used for around advice, and, hence, you cannot fail to invoke it.</p>
<p>All advice parameters are statically typed so that you work with advice parameters of the appropriate type (e.g. the type of the return value from a method execution) rather than <code>Object</code> arrays.</p>
<p>The concept of join points matched by pointcuts is the key to AOP, which distinguishes it from older technologies offering only interception. Pointcuts enable advice to be targeted independently of the object-oriented hierarchy. For example, you can apply an around advice providing declarative transaction management to a set of methods that span multiple objects (such as all business operations in the service layer).</p>
<h3 id="5-2-Spring-AOP-Capabilities-and-Goals"><a href="#5-2-Spring-AOP-Capabilities-and-Goals" class="headerlink" title="5.2. Spring AOP Capabilities and Goals"></a>5.2. Spring AOP Capabilities and Goals</h3><p>Spring AOP is implemented in pure Java. There is no need for a special compilation process. Spring AOP does not need to control the class loader hierarchy and is thus suitable for use in a servlet container or application server.</p>
<p>Spring AOP currently supports only method execution join points (advising the execution of methods on Spring beans). Field interception is not implemented, although support for field interception could be added without breaking the core Spring AOP APIs. If you need to advise field access and update join points, consider a language such as AspectJ.</p>
<p>Spring AOP’s approach to AOP differs from that of most other AOP frameworks. The aim is not to provide the most complete AOP implementation (although Spring AOP is quite capable). Rather, the aim is to provide a close integration between AOP implementation and Spring IoC, to help solve common problems in enterprise applications.</p>
<p>Thus, for example, the Spring Framework’s AOP functionality is normally used in conjunction with the Spring IoC container. Aspects are configured by using normal bean definition syntax (although this allows powerful “auto-proxying” capabilities). This is a crucial difference from other AOP implementations. You cannot do some things easily or efficiently with Spring AOP, such as advise very fine-grained objects (typically, domain objects). AspectJ is the best choice in such cases. However, our experience is that Spring AOP provides an excellent solution to most problems in enterprise Java applications that are amenable to AOP.</p>
<p>Spring AOP never strives to compete with AspectJ to provide a comprehensive AOP solution. We believe that both proxy-based frameworks such as Spring AOP and full-blown frameworks such as AspectJ are valuable and that they are complementary, rather than in competition. Spring seamlessly integrates Spring AOP and IoC with AspectJ, to enable all uses of AOP within a consistent Spring-based application architecture. This integration does not affect the Spring AOP API or the AOP Alliance API. Spring AOP remains backward-compatible. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-api">the following chapter</a> for a discussion of the Spring AOP APIs.</p>
<table>
<thead>
<tr>
<th></th>
<th>One of the central tenets of the Spring Framework is that of non-invasiveness. This is the idea that you should not be forced to introduce framework-specific classes and interfaces into your business or domain model. However, in some places, the Spring Framework does give you the option to introduce Spring Framework-specific dependencies into your codebase. The rationale in giving you such options is because, in certain scenarios, it might be just plain easier to read or code some specific piece of functionality in such a way. However, the Spring Framework (almost) always offers you the choice: You have the freedom to make an informed decision as to which option best suits your particular use case or scenario.One such choice that is relevant to this chapter is that of which AOP framework (and which AOP style) to choose. You have the choice of AspectJ, Spring AOP, or both. You also have the choice of either the @AspectJ annotation-style approach or the Spring XML configuration-style approach. The fact that this chapter chooses to introduce the @AspectJ-style approach first should not be taken as an indication that the Spring team favors the @AspectJ annotation-style approach over the Spring XML configuration-style.See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-choosing">Choosing which AOP Declaration Style to Use</a> for a more complete discussion of the “whys and wherefores” of each style.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="5-3-AOP-Proxies"><a href="#5-3-AOP-Proxies" class="headerlink" title="5.3. AOP Proxies"></a>5.3. AOP Proxies</h3><p>Spring AOP defaults to using standard JDK dynamic proxies for AOP proxies. This enables any interface (or set of interfaces) to be proxied.</p>
<p>Spring AOP can also use CGLIB proxies. This is necessary to proxy classes rather than interfaces. By default, CGLIB is used if a business object does not implement an interface. As it is good practice to program to interfaces rather than classes, business classes normally implement one or more business interfaces. It is possible to <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-proxying">force the use of CGLIB</a>, in those (hopefully rare) cases where you need to advise a method that is not declared on an interface or where you need to pass a proxied object to a method as a concrete type.</p>
<p>It is important to grasp the fact that Spring AOP is proxy-based. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-understanding-aop-proxies">Understanding AOP Proxies</a> for a thorough examination of exactly what this implementation detail actually means.</p>
<h3 id="5-4-AspectJ-support"><a href="#5-4-AspectJ-support" class="headerlink" title="5.4. @AspectJ support"></a>5.4. @AspectJ support</h3><p>@AspectJ refers to a style of declaring aspects as regular Java classes annotated with annotations. The @AspectJ style was introduced by the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj">AspectJ project</a> as part of the AspectJ 5 release. Spring interprets the same annotations as AspectJ 5, using a library supplied by AspectJ for pointcut parsing and matching. The AOP runtime is still pure Spring AOP, though, and there is no dependency on the AspectJ compiler or weaver.</p>
<table>
<thead>
<tr>
<th></th>
<th>Using the AspectJ compiler and weaver enables use of the full AspectJ language and is discussed in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-using-aspectj">Using AspectJ with Spring Applications</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-4-1-Enabling-AspectJ-Support"><a href="#5-4-1-Enabling-AspectJ-Support" class="headerlink" title="5.4.1. Enabling @AspectJ Support"></a>5.4.1. Enabling @AspectJ Support</h4><p>To use @AspectJ aspects in a Spring configuration, you need to enable Spring support for configuring Spring AOP based on @AspectJ aspects and auto-proxying beans based on whether or not they are advised by those aspects. By auto-proxying, we mean that, if Spring determines that a bean is advised by one or more aspects, it automatically generates a proxy for that bean to intercept method invocations and ensures that advice is run as needed.</p>
<p>The @AspectJ support can be enabled with XML- or Java-style configuration. In either case, you also need to ensure that AspectJ’s <code>aspectjweaver.jar</code> library is on the classpath of your application (version 1.8 or later). This library is available in the <code>lib</code> directory of an AspectJ distribution or from the Maven Central repository.</p>
<h5 id="Enabling-AspectJ-Support-with-Java-Configuration"><a href="#Enabling-AspectJ-Support-with-Java-Configuration" class="headerlink" title="Enabling @AspectJ Support with Java Configuration"></a>Enabling @AspectJ Support with Java Configuration</h5><p>To enable @AspectJ support with Java <code>@Configuration</code>, add the <code>@EnableAspectJAutoProxy</code> annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Enabling-AspectJ-Support-with-XML-Configuration"><a href="#Enabling-AspectJ-Support-with-XML-Configuration" class="headerlink" title="Enabling @AspectJ Support with XML Configuration"></a>Enabling @AspectJ Support with XML Configuration</h5><p>To enable @AspectJ support with XML-based configuration, use the <code>aop:aspectj-autoproxy</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>This assumes that you use schema support as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas">XML Schema-based configuration</a>. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas-aop">the AOP schema</a> for how to import the tags in the <code>aop</code> namespace.</p>
<h4 id="5-4-2-Declaring-an-Aspect"><a href="#5-4-2-Declaring-an-Aspect" class="headerlink" title="5.4.2. Declaring an Aspect"></a>5.4.2. Declaring an Aspect</h4><p>With @AspectJ support enabled, any bean defined in your application context with a class that is an @AspectJ aspect (has the <code>@Aspect</code> annotation) is automatically detected by Spring and used to configure Spring AOP. The next two examples show the minimal definition required for a not-very-useful aspect.</p>
<p>The first of the two example shows a regular bean definition in the application context that points to a bean class that has the <code>@Aspect</code> annotation:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.xyz.NotVeryUsefulAspect&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configure properties of the aspect here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The second of the two examples shows the <code>NotVeryUsefulAspect</code> class definition, which is annotated with the <code>org.aspectj.lang.annotation.Aspect</code> annotation;</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.xyz;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotVeryUsefulAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Aspects (classes annotated with <code>@Aspect</code>) can have methods and fields, the same as any other class. They can also contain pointcut, advice, and introduction (inter-type) declarations.</p>
<table>
<thead>
<tr>
<th></th>
<th>Autodetecting aspects through component scanningYou can register aspect classes as regular beans in your Spring XML configuration, via <code>@Bean</code> methods in <code>@Configuration</code> classes, or have Spring autodetect them through classpath scanning — the same as any other Spring-managed bean. However, note that the <code>@Aspect</code> annotation is not sufficient for autodetection in the classpath. For that purpose, you need to add a separate <code>@Component</code> annotation (or, alternatively, a custom stereotype annotation that qualifies, as per the rules of Spring’s component scanner).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>Advising aspects with other aspects?In Spring AOP, aspects themselves cannot be the targets of advice from other aspects. The <code>@Aspect</code> annotation on a class marks it as an aspect and, hence, excludes it from auto-proxying.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-4-3-Declaring-a-Pointcut"><a href="#5-4-3-Declaring-a-Pointcut" class="headerlink" title="5.4.3. Declaring a Pointcut"></a>5.4.3. Declaring a Pointcut</h4><p>Pointcuts determine join points of interest and thus enable us to control when advice runs. Spring AOP only supports method execution join points for Spring beans, so you can think of a pointcut as matching the execution of methods on Spring beans. A pointcut declaration has two parts: a signature comprising a name and any parameters and a pointcut expression that determines exactly which method executions we are interested in. In the @AspectJ annotation-style of AOP, a pointcut signature is provided by a regular method definition, and the pointcut expression is indicated by using the <code>@Pointcut</code> annotation (the method serving as the pointcut signature must have a <code>void</code> return type).</p>
<p>An example may help make this distinction between a pointcut signature and a pointcut expression clear. The following example defines a pointcut named <code>anyOldTransfer</code> that matches the execution of any method named <code>transfer</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* transfer(..))&quot;)</span> <span class="comment">// the pointcut expression</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">anyOldTransfer</span><span class="params">()</span> &#123;&#125; <span class="comment">// the pointcut signature</span></span><br></pre></td></tr></table></figure>

<p>The pointcut expression that forms the value of the <code>@Pointcut</code> annotation is a regular AspectJ pointcut expression. For a full discussion of AspectJ’s pointcut language, see the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJ Programming Guide</a> (and, for extensions, the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html">AspectJ 5 Developer’s Notebook</a>) or one of the books on AspectJ (such as <em>Eclipse AspectJ</em>, by Colyer et al., or <em>AspectJ in Action</em>, by Ramnivas Laddad).</p>
<h5 id="Supported-Pointcut-Designators"><a href="#Supported-Pointcut-Designators" class="headerlink" title="Supported Pointcut Designators"></a>Supported Pointcut Designators</h5><p>Spring AOP supports the following AspectJ pointcut designators (PCD) for use in pointcut expressions:</p>
<ul>
<li><code>execution</code>: For matching method execution join points. This is the primary pointcut designator to use when working with Spring AOP.</li>
<li><code>within</code>: Limits matching to join points within certain types (the execution of a method declared within a matching type when using Spring AOP).</li>
<li><code>this</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the bean reference (Spring AOP proxy) is an instance of the given type.</li>
<li><code>target</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the target object (application object being proxied) is an instance of the given type.</li>
<li><code>args</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the arguments are instances of the given types.</li>
<li><code>@target</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the class of the executing object has an annotation of the given type.</li>
<li><code>@args</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the runtime type of the actual arguments passed have annotations of the given types.</li>
<li><code>@within</code>: Limits matching to join points within types that have the given annotation (the execution of methods declared in types with the given annotation when using Spring AOP).</li>
<li><code>@annotation</code>: Limits matching to join points where the subject of the join point (the method being run in Spring AOP) has the given annotation.</li>
</ul>
<p>Other pointcut types</p>
<p>The full AspectJ pointcut language supports additional pointcut designators that are not supported in Spring: <code>call</code>, <code>get</code>, <code>set</code>, <code>preinitialization</code>, <code>staticinitialization</code>, <code>initialization</code>, <code>handler</code>, <code>adviceexecution</code>, <code>withincode</code>, <code>cflow</code>, <code>cflowbelow</code>, <code>if</code>, <code>@this</code>, and <code>@withincode</code>. Use of these pointcut designators in pointcut expressions interpreted by Spring AOP results in an <code>IllegalArgumentException</code> being thrown.</p>
<p>The set of pointcut designators supported by Spring AOP may be extended in future releases to support more of the AspectJ pointcut designators.</p>
<p>Because Spring AOP limits matching to only method execution join points, the preceding discussion of the pointcut designators gives a narrower definition than you can find in the AspectJ programming guide. In addition, AspectJ itself has type-based semantics and, at an execution join point, both <code>this</code> and <code>target</code> refer to the same object: the object executing the method. Spring AOP is a proxy-based system and differentiates between the proxy object itself (which is bound to <code>this</code>) and the target object behind the proxy (which is bound to <code>target</code>).</p>
<table>
<thead>
<tr>
<th></th>
<th>Due to the proxy-based nature of Spring’s AOP framework, calls within the target object are, by definition, not intercepted. For JDK proxies, only public interface method calls on the proxy can be intercepted. With CGLIB, public and protected method calls on the proxy are intercepted (and even package-visible methods, if necessary). However, common interactions through proxies should always be designed through public signatures.Note that pointcut definitions are generally matched against any intercepted method. If a pointcut is strictly meant to be public-only, even in a CGLIB proxy scenario with potential non-public interactions through proxies, it needs to be defined accordingly.If your interception needs include method calls or even constructors within the target class, consider the use of Spring-driven <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw">native AspectJ weaving</a> instead of Spring’s proxy-based AOP framework. This constitutes a different mode of AOP usage with different characteristics, so be sure to make yourself familiar with weaving before making a decision.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Spring AOP also supports an additional PCD named <code>bean</code>. This PCD lets you limit the matching of join points to a particular named Spring bean or to a set of named Spring beans (when using wildcards). The <code>bean</code> PCD has the following form:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean(idOrNameOfBean)</span><br></pre></td></tr></table></figure>

<p>The <code>idOrNameOfBean</code> token can be the name of any Spring bean. Limited wildcard support that uses the <code>*</code> character is provided, so, if you establish some naming conventions for your Spring beans, you can write a <code>bean</code> PCD expression to select them. As is the case with other pointcut designators, the <code>bean</code> PCD can be used with the <code>&amp;&amp;</code> (and), <code>||</code> (or), and <code>!</code> (negation) operators, too.</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>bean</code> PCD is supported only in Spring AOP and not in native AspectJ weaving. It is a Spring-specific extension to the standard PCDs that AspectJ defines and is, therefore, not available for aspects declared in the <code>@Aspect</code> model.The <code>bean</code> PCD operates at the instance level (building on the Spring bean name concept) rather than at the type level only (to which weaving-based AOP is limited). Instance-based pointcut designators are a special capability of Spring’s proxy-based AOP framework and its close integration with the Spring bean factory, where it is natural and straightforward to identify specific beans by name.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Combining-Pointcut-Expressions"><a href="#Combining-Pointcut-Expressions" class="headerlink" title="Combining Pointcut Expressions"></a>Combining Pointcut Expressions</h5><p>You can combine pointcut expressions by using <code>&amp;&amp;,</code> <code>||</code> and <code>!</code>. You can also refer to pointcut expressions by name. The following example shows three pointcut expressions:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(public * *(..))&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">anyPublicOperation</span><span class="params">()</span> &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;within(com.xyz.myapp.trading..*)&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inTrading</span><span class="params">()</span> &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;anyPublicOperation() &amp;&amp; inTrading()&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">tradingOperation</span><span class="params">()</span> &#123;&#125; </span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>anyPublicOperation</code> matches if a method execution join point represents the execution of any public method.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td><code>inTrading</code> matches if a method execution is in the trading module.</td>
</tr>
<tr>
<td></td>
<td><code>tradingOperation</code> matches if a method execution represents any public method in the trading module.</td>
</tr>
</tbody></table>
<p>It is a best practice to build more complex pointcut expressions out of smaller named components, as shown earlier. When referring to pointcuts by name, normal Java visibility rules apply (you can see private pointcuts in the same type, protected pointcuts in the hierarchy, public pointcuts anywhere, and so on). Visibility does not affect pointcut matching.</p>
<h5 id="Sharing-Common-Pointcut-Definitions"><a href="#Sharing-Common-Pointcut-Definitions" class="headerlink" title="Sharing Common Pointcut Definitions"></a>Sharing Common Pointcut Definitions</h5><p>When working with enterprise applications, developers often want to refer to modules of the application and particular sets of operations from within several aspects. We recommend defining a <code>CommonPointcuts</code> aspect that captures common pointcut expressions for this purpose. Such an aspect typically resembles the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyz.myapp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonPointcuts</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the web layer if the method is defined</span></span><br><span class="line"><span class="comment">     * in a type in the com.xyz.myapp.web package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(com.xyz.myapp.web..*)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inWebLayer</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the service layer if the method is defined</span></span><br><span class="line"><span class="comment">     * in a type in the com.xyz.myapp.service package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(com.xyz.myapp.service..*)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inServiceLayer</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the data access layer if the method is defined</span></span><br><span class="line"><span class="comment">     * in a type in the com.xyz.myapp.dao package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(com.xyz.myapp.dao..*)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inDataAccessLayer</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A business service is the execution of any method defined on a service</span></span><br><span class="line"><span class="comment">     * interface. This definition assumes that interfaces are placed in the</span></span><br><span class="line"><span class="comment">     * &quot;service&quot; package, and that implementation types are in sub-packages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If you group service interfaces by functional area (for example,</span></span><br><span class="line"><span class="comment">     * in packages com.xyz.myapp.abc.service and com.xyz.myapp.def.service) then</span></span><br><span class="line"><span class="comment">     * the pointcut expression &quot;execution(* com.xyz.myapp..service.*.*(..))&quot;</span></span><br><span class="line"><span class="comment">     * could be used instead.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Alternatively, you can write the expression using the &#x27;bean&#x27;</span></span><br><span class="line"><span class="comment">     * PCD, like so &quot;bean(*Service)&quot;. (This assumes that you have</span></span><br><span class="line"><span class="comment">     * named your Spring service beans in a consistent fashion.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.xyz.myapp..service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">businessService</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A data access operation is the execution of any method defined on a</span></span><br><span class="line"><span class="comment">     * dao interface. This definition assumes that interfaces are placed in the</span></span><br><span class="line"><span class="comment">     * &quot;dao&quot; package, and that implementation types are in sub-packages.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dataAccessOperation</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can refer to the pointcuts defined in such an aspect anywhere you need a pointcut expression. For example, to make the service layer transactional, you could write the following:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut</span>=<span class="string">&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">advice-ref</span>=<span class="string">&quot;tx-advice&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;tx-advice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>&lt;aop:config&gt;</code> and <code>&lt;aop:advisor&gt;</code> elements are discussed in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-schema">Schema-based AOP Support</a>. The transaction elements are discussed in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#transaction">Transaction Management</a>.</p>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h5><p>Spring AOP users are likely to use the <code>execution</code> pointcut designator the most often. The format of an execution expression follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern)</span><br><span class="line">            throws-pattern?)</span><br></pre></td></tr></table></figure>

<p>All parts except the returning type pattern (<code>ret-type-pattern</code> in the preceding snippet), the name pattern, and the parameters pattern are optional. The returning type pattern determines what the return type of the method must be in order for a join point to be matched. <code>*</code> is most frequently used as the returning type pattern. It matches any return type. A fully-qualified type name matches only when the method returns the given type. The name pattern matches the method name. You can use the <code>*</code> wildcard as all or part of a name pattern. If you specify a declaring type pattern, include a trailing <code>.</code> to join it to the name pattern component. The parameters pattern is slightly more complex: <code>()</code> matches a method that takes no parameters, whereas <code>(..)</code> matches any number (zero or more) of parameters. The <code>(*)</code> pattern matches a method that takes one parameter of any type. <code>(*,String)</code> matches a method that takes two parameters. The first can be of any type, while the second must be a <code>String</code>. Consult the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html">Language Semantics</a> section of the AspectJ Programming Guide for more information.</p>
<p>The following examples show some common pointcut expressions:</p>
<ul>
<li><p>The execution of any public method:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(public * *(..))</span><br></pre></td></tr></table></figure>
</li>
<li><p>The execution of any method with a name that begins with <code>set</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* set*(..))</span><br></pre></td></tr></table></figure>
</li>
<li><p>The execution of any method defined by the <code>AccountService</code> interface:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service.AccountService.*(..))</span><br></pre></td></tr></table></figure>
</li>
<li><p>The execution of any method defined in the <code>service</code> package:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service.*.*(..))</span><br></pre></td></tr></table></figure>
</li>
<li><p>The execution of any method defined in the service package or one of its sub-packages:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service..*.*(..))</span><br></pre></td></tr></table></figure>
</li>
<li><p>Any join point (method execution only in Spring AOP) within the service package:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(com.xyz.service.*)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Any join point (method execution only in Spring AOP) within the service package or one of its sub-packages:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(com.xyz.service..*)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Any join point (method execution only in Spring AOP) where the proxy implements the <code>AccountService</code> interface:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>this</code> is more commonly used in a binding form. See the section on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> for how to make the proxy object available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>Any join point (method execution only in Spring AOP) where the target object implements the <code>AccountService</code> interface:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>target</code> is more commonly used in a binding form. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> section for how to make the target object available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>Any join point (method execution only in Spring AOP) that takes a single parameter and where the argument passed at runtime is <code>Serializable</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args(java.io.Serializable)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>args</code> is more commonly used in a binding form. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> section for how to make the method arguments available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Note that the pointcut given in this example is different from <code>execution(* *(java.io.Serializable))</code>. The args version matches if the argument passed at runtime is <code>Serializable</code>, and the execution version matches if the method signature declares a single parameter of type <code>Serializable</code>.</p>
</li>
<li><p>Any join point (method execution only in Spring AOP) where the target object has a <code>@Transactional</code> annotation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@target(org.springframework.transaction.annotation.Transactional)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can also use <code>@target</code> in a binding form. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> section for how to make the annotation object available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>Any join point (method execution only in Spring AOP) where the declared type of the target object has an <code>@Transactional</code> annotation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@within(org.springframework.transaction.annotation.Transactional)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can also use <code>@within</code> in a binding form. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> section for how to make the annotation object available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>Any join point (method execution only in Spring AOP) where the executing method has an <code>@Transactional</code> annotation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@annotation(org.springframework.transaction.annotation.Transactional)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can also use <code>@annotation</code> in a binding form. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> section for how to make the annotation object available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>Any join point (method execution only in Spring AOP) which takes a single parameter, and where the runtime type of the argument passed has the <code>@Classified</code> annotation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@args(com.xyz.security.Classified)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can also use <code>@args</code> in a binding form. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a> section how to make the annotation object(s) available in the advice body.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>Any join point (method execution only in Spring AOP) on a Spring bean named <code>tradeService</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean(tradeService)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Any join point (method execution only in Spring AOP) on Spring beans having names that match the wildcard expression <code>*Service</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean(*Service)</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Writing-Good-Pointcuts"><a href="#Writing-Good-Pointcuts" class="headerlink" title="Writing Good Pointcuts"></a>Writing Good Pointcuts</h5><p>During compilation, AspectJ processes pointcuts in order to optimize matching performance. Examining code and determining if each join point matches (statically or dynamically) a given pointcut is a costly process. (A dynamic match means the match cannot be fully determined from static analysis and that a test is placed in the code to determine if there is an actual match when the code is running). On first encountering a pointcut declaration, AspectJ rewrites it into an optimal form for the matching process. What does this mean? Basically, pointcuts are rewritten in DNF (Disjunctive Normal Form) and the components of the pointcut are sorted such that those components that are cheaper to evaluate are checked first. This means you do not have to worry about understanding the performance of various pointcut designators and may supply them in any order in a pointcut declaration.</p>
<p>However, AspectJ can work only with what it is told. For optimal performance of matching, you should think about what they are trying to achieve and narrow the search space for matches as much as possible in the definition. The existing designators naturally fall into one of three groups: kinded, scoping, and contextual:</p>
<ul>
<li>Kinded designators select a particular kind of join point: <code>execution</code>, <code>get</code>, <code>set</code>, <code>call</code>, and <code>handler</code>.</li>
<li>Scoping designators select a group of join points of interest (probably of many kinds): <code>within</code> and <code>withincode</code></li>
<li>Contextual designators match (and optionally bind) based on context: <code>this</code>, <code>target</code>, and <code>@annotation</code></li>
</ul>
<p>A well written pointcut should include at least the first two types (kinded and scoping). You can include the contextual designators to match based on join point context or bind that context for use in the advice. Supplying only a kinded designator or only a contextual designator works but could affect weaving performance (time and memory used), due to extra processing and analysis. Scoping designators are very fast to match, and using them means AspectJ can very quickly dismiss groups of join points that should not be further processed. A good pointcut should always include one if possible.</p>
<h4 id="5-4-4-Declaring-Advice"><a href="#5-4-4-Declaring-Advice" class="headerlink" title="5.4.4. Declaring Advice"></a>5.4.4. Declaring Advice</h4><p>Advice is associated with a pointcut expression and runs before, after, or around method executions matched by the pointcut. The pointcut expression may be either a simple reference to a named pointcut or a pointcut expression declared in place.</p>
<h5 id="Before-Advice"><a href="#Before-Advice" class="headerlink" title="Before Advice"></a>Before Advice</h5><p>You can declare before advice in an aspect by using the <code>@Before</code> annotation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeforeExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we use an in-place pointcut expression, we could rewrite the preceding example as the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeforeExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="After-Returning-Advice"><a href="#After-Returning-Advice" class="headerlink" title="After Returning Advice"></a>After Returning Advice</h5><p>After returning advice runs when a matched method execution returns normally. You can declare it by using the <code>@AfterReturning</code> annotation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterReturningExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>You can have multiple advice declarations (and other members as well), all inside the same aspect. We show only a single advice declaration in these examples to focus the effect of each one.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Sometimes, you need access in the advice body to the actual value that was returned. You can use the form of <code>@AfterReturning</code> that binds the return value to get that access, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterReturningExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">        pointcut=&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;,</span></span><br><span class="line"><span class="meta">        returning=&quot;retVal&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">(Object retVal)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The name used in the <code>returning</code> attribute must correspond to the name of a parameter in the advice method. When a method execution returns, the return value is passed to the advice method as the corresponding argument value. A <code>returning</code> clause also restricts matching to only those method executions that return a value of the specified type (in this case, <code>Object</code>, which matches any return value).</p>
<p>Please note that it is not possible to return a totally different reference when using after returning advice.</p>
<h5 id="After-Throwing-Advice"><a href="#After-Throwing-Advice" class="headerlink" title="After Throwing Advice"></a>After Throwing Advice</h5><p>After throwing advice runs when a matched method execution exits by throwing an exception. You can declare it by using the <code>@AfterThrowing</code> annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterThrowingExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doRecoveryActions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Often, you want the advice to run only when exceptions of a given type are thrown, and you also often need access to the thrown exception in the advice body. You can use the <code>throwing</code> attribute to both restrict matching (if desired — use <code>Throwable</code> as the exception type otherwise) and bind the thrown exception to an advice parameter. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterThrowingExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(</span></span><br><span class="line"><span class="meta">        pointcut=&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;,</span></span><br><span class="line"><span class="meta">        throwing=&quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doRecoveryActions</span><span class="params">(DataAccessException ex)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The name used in the <code>throwing</code> attribute must correspond to the name of a parameter in the advice method. When a method execution exits by throwing an exception, the exception is passed to the advice method as the corresponding argument value. A <code>throwing</code> clause also restricts matching to only those method executions that throw an exception of the specified type (<code>DataAccessException</code>, in this case).</p>
<table>
<thead>
<tr>
<th></th>
<th>Note that <code>@AfterThrowing</code> does not indicate a general exception handling callback. Specifically, an <code>@AfterThrowing</code> advice method is only supposed to receive exceptions from the join point (user-declared target method) itself but not from an accompanying <code>@After</code>&#x2F;<code>@AfterReturning</code> method.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="After-Finally-Advice"><a href="#After-Finally-Advice" class="headerlink" title="After (Finally) Advice"></a>After (Finally) Advice</h5><p>After (finally) advice runs when a matched method execution exits. It is declared by using the <code>@After</code> annotation. After advice must be prepared to handle both normal and exception return conditions. It is typically used for releasing resources and similar purposes. The following example shows how to use after finally advice:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterFinallyExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doReleaseLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Note that <code>@After</code> advice in AspectJ is defined as “after finally advice”, analogous to a finally block in a try-catch statement. It will be invoked for any outcome, normal return or exception thrown from the join point (user-declared target method), in contrast to <code>@AfterReturning</code> which only applies to successful normal returns.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Around-Advice"><a href="#Around-Advice" class="headerlink" title="Around Advice"></a>Around Advice</h5><p>The last kind of advice is <em>around</em> advice. Around advice runs “around” a matched method’s execution. It has the opportunity to do work both before and after the method runs and to determine when, how, and even if the method actually gets to run at all. Around advice is often used if you need to share state before and after a method execution in a thread-safe manner – for example, starting and stopping a timer.</p>
<table>
<thead>
<tr>
<th></th>
<th>Always use the least powerful form of advice that meets your requirements.For example, do not use <em>around</em> advice if <em>before</em> advice is sufficient for your needs.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Around advice is declared by annotating a method with the <code>@Around</code> annotation. The method should declare <code>Object</code> as its return type, and the first parameter of the method must be of type <code>ProceedingJoinPoint</code>. Within the body of the advice method, you must invoke <code>proceed()</code> on the <code>ProceedingJoinPoint</code> in order for the underlying method to run. Invoking <code>proceed()</code> without arguments will result in the caller’s original arguments being supplied to the underlying method when it is invoked. For advanced use cases, there is an overloaded variant of the <code>proceed()</code> method which accepts an array of arguments (<code>Object[]</code>). The values in the array will be used as the arguments to the underlying method when it is invoked.</p>
<table>
<thead>
<tr>
<th></th>
<th>The behavior of <code>proceed</code> when called with an <code>Object[]</code> is a little different than the behavior of <code>proceed</code> for around advice compiled by the AspectJ compiler. For around advice written using the traditional AspectJ language, the number of arguments passed to <code>proceed</code> must match the number of arguments passed to the around advice (not the number of arguments taken by the underlying join point), and the value passed to proceed in a given argument position supplants the original value at the join point for the entity the value was bound to (do not worry if this does not make sense right now).The approach taken by Spring is simpler and a better match to its proxy-based, execution-only semantics. You only need to be aware of this difference if you compile <code>@AspectJ</code> aspects written for Spring and use <code>proceed</code> with arguments with the AspectJ compiler and weaver. There is a way to write such aspects that is 100% compatible across both Spring AOP and AspectJ, and this is discussed in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-advice-proceeding-with-the-call">following section on advice parameters</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The value returned by the around advice is the return value seen by the caller of the method. For example, a simple caching aspect could return a value from a cache if it has one or invoke <code>proceed()</code> (and return that value) if it does not. Note that <code>proceed</code> may be invoked once, many times, or not at all within the body of the around advice. All of these are legal.</p>
<table>
<thead>
<tr>
<th></th>
<th>If you declare the return type of your around advice method as <code>void</code>, <code>null</code> will always be returned to the caller, effectively ignoring the result of any invocation of <code>proceed()</code>. It is therefore recommended that an around advice method declare a return type of <code>Object</code>. The advice method should typically return the value returned from an invocation of <code>proceed()</code>, even if the underlying method has a <code>void</code> return type. However, the advice may optionally return a cached value, a wrapped value, or some other value depending on the use case.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following example shows how to use around advice:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AroundExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doBasicProfiling</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// start stopwatch</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        <span class="comment">// stop stopwatch</span></span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Advice-Parameters"><a href="#Advice-Parameters" class="headerlink" title="Advice Parameters"></a>Advice Parameters</h5><p>Spring offers fully typed advice, meaning that you declare the parameters you need in the advice signature (as we saw earlier for the returning and throwing examples) rather than work with <code>Object[]</code> arrays all the time. We see how to make argument and other contextual values available to the advice body later in this section. First, we take a look at how to write generic advice that can find out about the method the advice is currently advising.</p>
<h6 id="Access-to-the-Current-JoinPoint"><a href="#Access-to-the-Current-JoinPoint" class="headerlink" title="Access to the Current JoinPoint"></a>Access to the Current <code>JoinPoint</code></h6><p>Any advice method may declare, as its first parameter, a parameter of type <code>org.aspectj.lang.JoinPoint</code>. Note that around advice is required to declare a first parameter of type <code>ProceedingJoinPoint</code>, which is a subclass of <code>JoinPoint</code>.</p>
<p>The <code>JoinPoint</code> interface provides a number of useful methods:</p>
<ul>
<li><code>getArgs()</code>: Returns the method arguments.</li>
<li><code>getThis()</code>: Returns the proxy object.</li>
<li><code>getTarget()</code>: Returns the target object.</li>
<li><code>getSignature()</code>: Returns a description of the method that is being advised.</li>
<li><code>toString()</code>: Prints a useful description of the method being advised.</li>
</ul>
<p>See the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/JoinPoint.html">javadoc</a> for more detail.</p>
<h6 id="Passing-Parameters-to-Advice"><a href="#Passing-Parameters-to-Advice" class="headerlink" title="Passing Parameters to Advice"></a>Passing Parameters to Advice</h6><p>We have already seen how to bind the returned value or exception value (using after returning and after throwing advice). To make argument values available to the advice body, you can use the binding form of <code>args</code>. If you use a parameter name in place of a type name in an <code>args</code> expression, the value of the corresponding argument is passed as the parameter value when the advice is invoked. An example should make this clearer. Suppose you want to advise the execution of DAO operations that take an <code>Account</code> object as the first parameter, and you need access to the account in the advice body. You could write the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation() &amp;&amp; args(account,..)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validateAccount</span><span class="params">(Account account)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>args(account,..)</code> part of the pointcut expression serves two purposes. First, it restricts matching to only those method executions where the method takes at least one parameter, and the argument passed to that parameter is an instance of <code>Account</code>. Second, it makes the actual <code>Account</code> object available to the advice through the <code>account</code> parameter.</p>
<p>Another way of writing this is to declare a pointcut that “provides” the <code>Account</code> object value when it matches a join point, and then refer to the named pointcut from the advice. This would look as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation() &amp;&amp; args(account,..)&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">accountDataAccessOperation</span><span class="params">(Account account)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before(&quot;accountDataAccessOperation(account)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validateAccount</span><span class="params">(Account account)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>See the AspectJ programming guide for more details.</p>
<p>The proxy object (<code>this</code>), target object (<code>target</code>), and annotations (<code>@within</code>, <code>@target</code>, <code>@annotation</code>, and <code>@args</code>) can all be bound in a similar fashion. The next two examples show how to match the execution of methods annotated with an <code>@Auditable</code> annotation and extract the audit code:</p>
<p>The first of the two examples shows the definition of the <code>@Auditable</code> annotation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Auditable &#123;</span><br><span class="line">    AuditCode <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The second of the two examples shows the advice that matches the execution of <code>@Auditable</code> methods:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">audit</span><span class="params">(Auditable auditable)</span> &#123;</span><br><span class="line">    <span class="type">AuditCode</span> <span class="variable">code</span> <span class="operator">=</span> auditable.value();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Advice-Parameters-and-Generics"><a href="#Advice-Parameters-and-Generics" class="headerlink" title="Advice Parameters and Generics"></a>Advice Parameters and Generics</h6><p>Spring AOP can handle generics used in class declarations and method parameters. Suppose you have a generic type like the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sample</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sampleGenericMethod</span><span class="params">(T param)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sampleGenericCollectionMethod</span><span class="params">(Collection&lt;T&gt; param)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can restrict interception of method types to certain parameter types by tying the advice parameter to the parameter type for which you want to intercept the method:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeSampleMethod</span><span class="params">(MyType param)</span> &#123;</span><br><span class="line">    <span class="comment">// Advice implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This approach does not work for generic collections. So you cannot define a pointcut as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeSampleMethod</span><span class="params">(Collection&lt;MyType&gt; param)</span> &#123;</span><br><span class="line">    <span class="comment">// Advice implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To make this work, we would have to inspect every element of the collection, which is not reasonable, as we also cannot decide how to treat <code>null</code> values in general. To achieve something similar to this, you have to type the parameter to <code>Collection&lt;?&gt;</code> and manually check the type of the elements.</p>
<h6 id="Determining-Argument-Names"><a href="#Determining-Argument-Names" class="headerlink" title="Determining Argument Names"></a>Determining Argument Names</h6><p>The parameter binding in advice invocations relies on matching names used in pointcut expressions to declared parameter names in advice and pointcut method signatures. Parameter names are not available through Java reflection, so Spring AOP uses the following strategy to determine parameter names:</p>
<ul>
<li>If the parameter names have been explicitly specified by the user, the specified parameter names are used. Both the advice and the pointcut annotations have an optional <code>argNames</code> attribute that you can use to specify the argument names of the annotated method. These argument names are available at runtime. The following example shows how to use the <code>argNames</code> attribute:</li>
</ul>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(value=&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)&quot;,</span></span><br><span class="line"><span class="meta">        argNames=&quot;bean,auditable&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">audit</span><span class="params">(Object bean, Auditable auditable)</span> &#123;</span><br><span class="line">    <span class="type">AuditCode</span> <span class="variable">code</span> <span class="operator">=</span> auditable.value();</span><br><span class="line">    <span class="comment">// ... use code and bean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If the first parameter is of the <code>JoinPoint</code>, <code>ProceedingJoinPoint</code>, or <code>JoinPoint.StaticPart</code> type, you can leave out the name of the parameter from the value of the <code>argNames</code> attribute. For example, if you modify the preceding advice to receive the join point object, the <code>argNames</code> attribute need not include it:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(value=&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)&quot;,</span></span><br><span class="line"><span class="meta">        argNames=&quot;bean,auditable&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">audit</span><span class="params">(JoinPoint jp, Object bean, Auditable auditable)</span> &#123;</span><br><span class="line">    <span class="type">AuditCode</span> <span class="variable">code</span> <span class="operator">=</span> auditable.value();</span><br><span class="line">    <span class="comment">// ... use code, bean, and jp</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The special treatment given to the first parameter of the <code>JoinPoint</code>, <code>ProceedingJoinPoint</code>, and <code>JoinPoint.StaticPart</code> types is particularly convenient for advice instances that do not collect any other join point context. In such situations, you may omit the <code>argNames</code> attribute. For example, the following advice need not declare the <code>argNames</code> attribute:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;com.xyz.lib.Pointcuts.anyPublicMethod()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">audit</span><span class="params">(JoinPoint jp)</span> &#123;</span><br><span class="line">    <span class="comment">// ... use jp</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Using the <code>argNames</code> attribute is a little clumsy, so if the <code>argNames</code> attribute has not been specified, Spring AOP looks at the debug information for the class and tries to determine the parameter names from the local variable table. This information is present as long as the classes have been compiled with debug information (<code>-g:vars</code> at a minimum). The consequences of compiling with this flag on are: (1) your code is slightly easier to understand (reverse engineer), (2) the class file sizes are very slightly bigger (typically inconsequential), (3) the optimization to remove unused local variables is not applied by your compiler. In other words, you should encounter no difficulties by building with this flag on.</p>
<table>
<thead>
<tr>
<th></th>
<th>If an @AspectJ aspect has been compiled by the AspectJ compiler (<code>ajc</code>) even without the debug information, you need not add the <code>argNames</code> attribute, as the compiler retain the needed information.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>If the code has been compiled without the necessary debug information, Spring AOP tries to deduce the pairing of binding variables to parameters (for example, if only one variable is bound in the pointcut expression, and the advice method takes only one parameter, the pairing is obvious). If the binding of variables is ambiguous given the available information, an <code>AmbiguousBindingException</code> is thrown.</p>
</li>
<li><p>If all of the above strategies fail, an <code>IllegalArgumentException</code> is thrown.</p>
</li>
</ul>
<h6 id="Proceeding-with-Arguments"><a href="#Proceeding-with-Arguments" class="headerlink" title="Proceeding with Arguments"></a>Proceeding with Arguments</h6><p>We remarked earlier that we would describe how to write a <code>proceed</code> call with arguments that works consistently across Spring AOP and AspectJ. The solution is to ensure that the advice signature binds each of the method parameters in order. The following example shows how to do so:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(List&lt;Account&gt; find*(..)) &amp;&amp; &quot; +</span></span><br><span class="line"><span class="meta">        &quot;com.xyz.myapp.CommonPointcuts.inDataAccessLayer() &amp;&amp; &quot; +</span></span><br><span class="line"><span class="meta">        &quot;args(accountHolderNamePattern)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">preProcessQueryPattern</span><span class="params">(ProceedingJoinPoint pjp,</span></span><br><span class="line"><span class="params">        String accountHolderNamePattern)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">newPattern</span> <span class="operator">=</span> preProcess(accountHolderNamePattern);</span><br><span class="line">    <span class="keyword">return</span> pjp.proceed(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;newPattern&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In many cases, you do this binding anyway (as in the preceding example).</p>
<h5 id="Advice-Ordering"><a href="#Advice-Ordering" class="headerlink" title="Advice Ordering"></a>Advice Ordering</h5><p>What happens when multiple pieces of advice all want to run at the same join point? Spring AOP follows the same precedence rules as AspectJ to determine the order of advice execution. The highest precedence advice runs first “on the way in” (so, given two pieces of before advice, the one with highest precedence runs first). “On the way out” from a join point, the highest precedence advice runs last (so, given two pieces of after advice, the one with the highest precedence will run second).</p>
<p>When two pieces of advice defined in different aspects both need to run at the same join point, unless you specify otherwise, the order of execution is undefined. You can control the order of execution by specifying precedence. This is done in the normal Spring way by either implementing the <code>org.springframework.core.Ordered</code> interface in the aspect class or annotating it with the <code>@Order</code> annotation. Given two aspects, the aspect returning the lower value from <code>Ordered.getOrder()</code> (or the annotation value) has the higher precedence.</p>
<table>
<thead>
<tr>
<th></th>
<th>Each of the distinct advice types of a particular aspect is conceptually meant to apply to the join point directly. As a consequence, an <code>@AfterThrowing</code> advice method is not supposed to receive an exception from an accompanying <code>@After</code>&#x2F;<code>@AfterReturning</code> method.As of Spring Framework 5.2.7, advice methods defined in the same <code>@Aspect</code> class that need to run at the same join point are assigned precedence based on their advice type in the following order, from highest to lowest precedence: <code>@Around</code>, <code>@Before</code>, <code>@After</code>, <code>@AfterReturning</code>, <code>@AfterThrowing</code>. Note, however, that an <code>@After</code> advice method will effectively be invoked after any <code>@AfterReturning</code> or <code>@AfterThrowing</code> advice methods in the same aspect, following AspectJ’s “after finally advice” semantics for <code>@After</code>.When two pieces of the same type of advice (for example, two <code>@After</code> advice methods) defined in the same <code>@Aspect</code> class both need to run at the same join point, the ordering is undefined (since there is no way to retrieve the source code declaration order through reflection for javac-compiled classes). Consider collapsing such advice methods into one advice method per join point in each <code>@Aspect</code> class or refactor the pieces of advice into separate <code>@Aspect</code> classes that you can order at the aspect level via <code>Ordered</code> or <code>@Order</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-4-5-Introductions"><a href="#5-4-5-Introductions" class="headerlink" title="5.4.5. Introductions"></a>5.4.5. Introductions</h4><p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare that advised objects implement a given interface, and to provide an implementation of that interface on behalf of those objects.</p>
<p>You can make an introduction by using the <code>@DeclareParents</code> annotation. This annotation is used to declare that matching types have a new parent (hence the name). For example, given an interface named <code>UsageTracked</code> and an implementation of that interface named <code>DefaultUsageTracked</code>, the following aspect declares that all implementors of service interfaces also implement the <code>UsageTracked</code> interface (e.g. for statistics via JMX):</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsageTracking</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeclareParents(value=&quot;com.xzy.myapp.service.*+&quot;, defaultImpl=DefaultUsageTracked.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UsageTracked mixin;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;com.xyz.myapp.CommonPointcuts.businessService() &amp;&amp; this(usageTracked)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordUsage</span><span class="params">(UsageTracked usageTracked)</span> &#123;</span><br><span class="line">        usageTracked.incrementUseCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The interface to be implemented is determined by the type of the annotated field. The <code>value</code> attribute of the <code>@DeclareParents</code> annotation is an AspectJ type pattern. Any bean of a matching type implements the <code>UsageTracked</code> interface. Note that, in the before advice of the preceding example, service beans can be directly used as implementations of the <code>UsageTracked</code> interface. If accessing a bean programmatically, you would write the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UsageTracked</span> <span class="variable">usageTracked</span> <span class="operator">=</span> (UsageTracked) context.getBean(<span class="string">&quot;myService&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-4-6-Aspect-Instantiation-Models"><a href="#5-4-6-Aspect-Instantiation-Models" class="headerlink" title="5.4.6. Aspect Instantiation Models"></a>5.4.6. Aspect Instantiation Models</h4><table>
<thead>
<tr>
<th></th>
<th>This is an advanced topic. If you are just starting out with AOP, you can safely skip it until later.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>By default, there is a single instance of each aspect within the application context. AspectJ calls this the singleton instantiation model. It is possible to define aspects with alternate lifecycles. Spring supports AspectJ’s <code>perthis</code> and <code>pertarget</code> instantiation models; <code>percflow</code>, <code>percflowbelow</code>, and <code>pertypewithin</code> are not currently supported.</p>
<p>You can declare a <code>perthis</code> aspect by specifying a <code>perthis</code> clause in the <code>@Aspect</code> annotation. Consider the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect(&quot;perthis(com.xyz.myapp.CommonPointcuts.businessService())&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> someState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordServiceUsage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the preceding example, the effect of the <code>perthis</code> clause is that one aspect instance is created for each unique service object that performs a business service (each unique object bound to <code>this</code> at join points matched by the pointcut expression). The aspect instance is created the first time that a method is invoked on the service object. The aspect goes out of scope when the service object goes out of scope. Before the aspect instance is created, none of the advice within it runs. As soon as the aspect instance has been created, the advice declared within it runs at matched join points, but only when the service object is the one with which this aspect is associated. See the AspectJ Programming Guide for more information on <code>per</code> clauses.</p>
<p>The <code>pertarget</code> instantiation model works in exactly the same way as <code>perthis</code>, but it creates one aspect instance for each unique target object at matched join points.</p>
<h4 id="5-4-7-An-AOP-Example"><a href="#5-4-7-An-AOP-Example" class="headerlink" title="5.4.7. An AOP Example"></a>5.4.7. An AOP Example</h4><p>Now that you have seen how all the constituent parts work, we can put them together to do something useful.</p>
<p>The execution of business services can sometimes fail due to concurrency issues (for example, a deadlock loser). If the operation is retried, it is likely to succeed on the next try. For business services where it is appropriate to retry in such conditions (idempotent operations that do not need to go back to the user for conflict resolution), we want to transparently retry the operation to avoid the client seeing a <code>PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across multiple services in the service layer and, hence, is ideal for implementing through an aspect.</p>
<p>Because we want to retry the operation, we need to use around advice so that we can call <code>proceed</code> multiple times. The following listing shows the basic aspect implementation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentOperationExecutor</span> <span class="keyword">implements</span> <span class="title class_">Ordered</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_RETRIES</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxRetries</span> <span class="operator">=</span> DEFAULT_MAX_RETRIES;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">order</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMaxRetries</span><span class="params">(<span class="type">int</span> maxRetries)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxRetries = maxRetries;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrder</span><span class="params">(<span class="type">int</span> order)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doConcurrentOperation</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numAttempts</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        PessimisticLockingFailureException lockFailureException;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            numAttempts++;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(PessimisticLockingFailureException ex) &#123;</span><br><span class="line">                lockFailureException = ex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span>(numAttempts &lt;= <span class="built_in">this</span>.maxRetries);</span><br><span class="line">        <span class="keyword">throw</span> lockFailureException;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that the aspect implements the <code>Ordered</code> interface so that we can set the precedence of the aspect higher than the transaction advice (we want a fresh transaction each time we retry). The <code>maxRetries</code> and <code>order</code> properties are both configured by Spring. The main action happens in the <code>doConcurrentOperation</code> around advice. Notice that, for the moment, we apply the retry logic to each <code>businessService()</code>. We try to proceed, and if we fail with a <code>PessimisticLockingFailureException</code>, we try again, unless we have exhausted all of our retry attempts.</p>
<p>The corresponding Spring configuration follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;concurrentOperationExecutor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxRetries&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>To refine the aspect so that it retries only idempotent operations, we might define the following <code>Idempotent</code> annotation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Idempotent &#123;</span><br><span class="line">    <span class="comment">// marker annotation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can then use the annotation to annotate the implementation of service operations. The change to the aspect to retry only idempotent operations involves refining the pointcut expression so that only <code>@Idempotent</code> operations match, as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;com.xyz.myapp.CommonPointcuts.businessService() &amp;&amp; &quot; +</span></span><br><span class="line"><span class="meta">        &quot;@annotation(com.xyz.myapp.service.Idempotent)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doConcurrentOperation</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-Schema-based-AOP-Support"><a href="#5-5-Schema-based-AOP-Support" class="headerlink" title="5.5. Schema-based AOP Support"></a>5.5. Schema-based AOP Support</h3><p>If you prefer an XML-based format, Spring also offers support for defining aspects using the <code>aop</code> namespace tags. The exact same pointcut expressions and advice kinds as when using the @AspectJ style are supported. Hence, in this section we focus on that syntax and refer the reader to the discussion in the previous section (<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj">@AspectJ support</a>) for an understanding of writing pointcut expressions and the binding of advice parameters.</p>
<p>To use the aop namespace tags described in this section, you need to import the <code>spring-aop</code> schema, as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas">XML Schema-based configuration</a>. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas-aop">the AOP schema</a> for how to import the tags in the <code>aop</code> namespace.</p>
<p>Within your Spring configurations, all aspect and advisor elements must be placed within an <code>&lt;aop:config&gt;</code> element (you can have more than one <code>&lt;aop:config&gt;</code> element in an application context configuration). An <code>&lt;aop:config&gt;</code> element can contain pointcut, advisor, and aspect elements (note that these must be declared in that order).</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>&lt;aop:config&gt;</code> style of configuration makes heavy use of Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-autoproxy">auto-proxying</a> mechanism. This can cause issues (such as advice not being woven) if you already use explicit auto-proxying through the use of <code>BeanNameAutoProxyCreator</code> or something similar. The recommended usage pattern is to use either only the <code>&lt;aop:config&gt;</code> style or only the <code>AutoProxyCreator</code> style and never mix them.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-5-1-Declaring-an-Aspect"><a href="#5-5-1-Declaring-an-Aspect" class="headerlink" title="5.5.1. Declaring an Aspect"></a>5.5.1. Declaring an Aspect</h4><p>When you use the schema support, an aspect is a regular Java object defined as a bean in your Spring application context. The state and behavior are captured in the fields and methods of the object, and the pointcut and advice information are captured in the XML.</p>
<p>You can declare an aspect by using the <code>&lt;aop:aspect&gt;</code> element, and reference the backing bean by using the <code>ref</code> attribute, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;aBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The bean that backs the aspect (<code>aBean</code> in this case) can of course be configured and dependency injected just like any other Spring bean.</p>
<h4 id="5-5-2-Declaring-a-Pointcut"><a href="#5-5-2-Declaring-a-Pointcut" class="headerlink" title="5.5.2. Declaring a Pointcut"></a>5.5.2. Declaring a Pointcut</h4><p>You can declare a named pointcut inside an <code>&lt;aop:config&gt;</code> element, letting the pointcut definition be shared across several aspects and advisors.</p>
<p>A pointcut that represents the execution of any business service in the service layer can be defined as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that the pointcut expression itself is using the same AspectJ pointcut expression language as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj">@AspectJ support</a>. If you use the schema based declaration style, you can refer to named pointcuts defined in types (@Aspects) within the pointcut expression. Another way of defining the above pointcut would be as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Assume that you have a <code>CommonPointcuts</code> aspect as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-common-pointcuts">Sharing Common Pointcut Definitions</a>.</p>
<p>Then declaring a pointcut inside an aspect is very similar to declaring a top-level pointcut, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In much the same way as an @AspectJ aspect, pointcuts declared by using the schema based definition style can collect join point context. For example, the following pointcut collects the <code>this</code> object as the join point context and passes it to the advice:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..)) <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> this(service)&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;businessService&quot;</span> <span class="attr">method</span>=<span class="string">&quot;monitor&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The advice must be declared to receive the collected join point context by including parameters of the matching names, as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monitor</span><span class="params">(Object service)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When combining pointcut sub-expressions, <code>&amp;&amp;</code> is awkward within an XML document, so you can use the <code>and</code>, <code>or</code>, and <code>not</code> keywords in place of <code>&amp;&amp;</code>, <code>||</code>, and <code>!</code>, respectively. For example, the previous pointcut can be better written as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..)) and this(service)&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;businessService&quot;</span> <span class="attr">method</span>=<span class="string">&quot;monitor&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that pointcuts defined in this way are referred to by their XML <code>id</code> and cannot be used as named pointcuts to form composite pointcuts. The named pointcut support in the schema-based definition style is thus more limited than that offered by the @AspectJ style.</p>
<h4 id="5-5-3-Declaring-Advice"><a href="#5-5-3-Declaring-Advice" class="headerlink" title="5.5.3. Declaring Advice"></a>5.5.3. Declaring Advice</h4><p>The schema-based AOP support uses the same five kinds of advice as the @AspectJ style, and they have exactly the same semantics.</p>
<h5 id="Before-Advice-1"><a href="#Before-Advice-1" class="headerlink" title="Before Advice"></a>Before Advice</h5><p>Before advice runs before a matched method execution. It is declared inside an <code>&lt;aop:aspect&gt;</code> by using the <code>&lt;aop:before&gt;</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;beforeExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;dataAccessOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doAccessCheck&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Here, <code>dataAccessOperation</code> is the <code>id</code> of a pointcut defined at the top (<code>&lt;aop:config&gt;</code>) level. To define the pointcut inline instead, replace the <code>pointcut-ref</code> attribute with a <code>pointcut</code> attribute, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;beforeExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doAccessCheck&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>As we noted in the discussion of the @AspectJ style, using named pointcuts can significantly improve the readability of your code.</p>
<p>The <code>method</code> attribute identifies a method (<code>doAccessCheck</code>) that provides the body of the advice. This method must be defined for the bean referenced by the aspect element that contains the advice. Before a data access operation is performed (a method execution join point matched by the pointcut expression), the <code>doAccessCheck</code> method on the aspect bean is invoked.</p>
<h5 id="After-Returning-Advice-1"><a href="#After-Returning-Advice-1" class="headerlink" title="After Returning Advice"></a>After Returning Advice</h5><p>After returning advice runs when a matched method execution completes normally. It is declared inside an <code>&lt;aop:aspect&gt;</code> in the same way as before advice. The following example shows how to declare it:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;afterReturningExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;dataAccessOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doAccessCheck&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>As in the @AspectJ style, you can get the return value within the advice body. To do so, use the <code>returning</code> attribute to specify the name of the parameter to which the return value should be passed, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;afterReturningExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;dataAccessOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">returning</span>=<span class="string">&quot;retVal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doAccessCheck&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>doAccessCheck</code> method must declare a parameter named <code>retVal</code>. The type of this parameter constrains matching in the same way as described for <code>@AfterReturning</code>. For example, you can declare the method signature as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">(Object retVal)</span> &#123;...</span><br></pre></td></tr></table></figure>

<h5 id="After-Throwing-Advice-1"><a href="#After-Throwing-Advice-1" class="headerlink" title="After Throwing Advice"></a>After Throwing Advice</h5><p>After throwing advice runs when a matched method execution exits by throwing an exception. It is declared inside an <code>&lt;aop:aspect&gt;</code> by using the <code>after-throwing</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;afterThrowingExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;dataAccessOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doRecoveryActions&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>As in the @AspectJ style, you can get the thrown exception within the advice body. To do so, use the <code>throwing</code> attribute to specify the name of the parameter to which the exception should be passed as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;afterThrowingExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;dataAccessOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">throwing</span>=<span class="string">&quot;dataAccessEx&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doRecoveryActions&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>doRecoveryActions</code> method must declare a parameter named <code>dataAccessEx</code>. The type of this parameter constrains matching in the same way as described for <code>@AfterThrowing</code>. For example, the method signature may be declared as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doRecoveryActions</span><span class="params">(DataAccessException dataAccessEx)</span> &#123;...</span><br></pre></td></tr></table></figure>

<h5 id="After-Finally-Advice-1"><a href="#After-Finally-Advice-1" class="headerlink" title="After (Finally) Advice"></a>After (Finally) Advice</h5><p>After (finally) advice runs no matter how a matched method execution exits. You can declare it by using the <code>after</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;afterFinallyExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;dataAccessOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doReleaseLock&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Around-Advice-1"><a href="#Around-Advice-1" class="headerlink" title="Around Advice"></a>Around Advice</h5><p>The last kind of advice is <em>around</em> advice. Around advice runs “around” a matched method’s execution. It has the opportunity to do work both before and after the method runs and to determine when, how, and even if the method actually gets to run at all. Around advice is often used if you need to share state before and after a method execution in a thread-safe manner – for example, starting and stopping a timer.</p>
<table>
<thead>
<tr>
<th></th>
<th>Always use the least powerful form of advice that meets your requirements.For example, do not use <em>around</em> advice if <em>before</em> advice is sufficient for your needs.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>You can declare around advice by using the <code>aop:around</code> element. The advice method should declare <code>Object</code> as its return type, and the first parameter of the method must be of type <code>ProceedingJoinPoint</code>. Within the body of the advice method, you must invoke <code>proceed()</code> on the <code>ProceedingJoinPoint</code> in order for the underlying method to run. Invoking <code>proceed()</code> without arguments will result in the caller’s original arguments being supplied to the underlying method when it is invoked. For advanced use cases, there is an overloaded variant of the <code>proceed()</code> method which accepts an array of arguments (<code>Object[]</code>). The values in the array will be used as the arguments to the underlying method when it is invoked. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-around-advice">Around Advice</a> for notes on calling <code>proceed</code> with an <code>Object[]</code>.</p>
<p>The following example shows how to declare around advice in XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;aroundExample&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;aBean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:around</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;doBasicProfiling&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The implementation of the <code>doBasicProfiling</code> advice can be exactly the same as in the @AspectJ example (minus the annotation, of course), as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">doBasicProfiling</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// start stopwatch</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">    <span class="comment">// stop stopwatch</span></span><br><span class="line">    <span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Advice-Parameters-1"><a href="#Advice-Parameters-1" class="headerlink" title="Advice Parameters"></a>Advice Parameters</h5><p>The schema-based declaration style supports fully typed advice in the same way as described for the @AspectJ support — by matching pointcut parameters by name against advice method parameters. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-advice-params">Advice Parameters</a> for details. If you wish to explicitly specify argument names for the advice methods (not relying on the detection strategies previously described), you can do so by using the <code>arg-names</code> attribute of the advice element, which is treated in the same manner as the <code>argNames</code> attribute in an advice annotation (as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-advice-params-names">Determining Argument Names</a>). The following example shows how to specify an argument name in XML:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:before</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pointcut</span>=<span class="string">&quot;com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">method</span>=<span class="string">&quot;audit&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">arg-names</span>=<span class="string">&quot;auditable&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>arg-names</code> attribute accepts a comma-delimited list of parameter names.</p>
<p>The following slightly more involved example of the XSD-based approach shows some around advice used in conjunction with a number of strongly typed parameters:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonService</span> &#123;</span><br><span class="line"></span><br><span class="line">    Person <span class="title function_">getPerson</span><span class="params">(String personName, <span class="type">int</span> age)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultPersonService</span> <span class="keyword">implements</span> <span class="title class_">PersonService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">getPerson</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next up is the aspect. Notice the fact that the <code>profile(..)</code> method accepts a number of strongly-typed parameters, the first of which happens to be the join point used to proceed with the method call. The presence of this parameter is an indication that the <code>profile(..)</code> is to be used as <code>around</code> advice, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleProfiler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">profile</span><span class="params">(ProceedingJoinPoint call, String name, <span class="type">int</span> age)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">clock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>(<span class="string">&quot;Profiling for &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + age + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            clock.start(call.toShortString());</span><br><span class="line">            <span class="keyword">return</span> call.proceed();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            clock.stop();</span><br><span class="line">            System.out.println(clock.prettyPrint());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the following example XML configuration effects the execution of the preceding advice for a particular join point:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- this is the object that will be proxied by Spring&#x27;s AOP infrastructure --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;personService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.service.DefaultPersonService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- this is the actual advice itself --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;profiler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.SimpleProfiler&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;profiler&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;theExecutionOfSomePersonServiceMethod&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">expression</span>=<span class="string">&quot;execution(* x.y.service.PersonService.getPerson(String,int))</span></span></span><br><span class="line"><span class="string"><span class="tag">                and args(name, age)&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;theExecutionOfSomePersonServiceMethod&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">method</span>=<span class="string">&quot;profile&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Consider the following driver script:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> x.y.service.PersonService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Boot</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">BeanFactory</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;x/y/plain.xml&quot;</span>);</span><br><span class="line">        <span class="type">PersonService</span> <span class="variable">person</span> <span class="operator">=</span> (PersonService) ctx.getBean(<span class="string">&quot;personService&quot;</span>);</span><br><span class="line">        person.getPerson(<span class="string">&quot;Pengo&quot;</span>, <span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With such a Boot class, we would get output similar to the following on standard output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">StopWatch &#x27;Profiling for &#x27;Pengo&#x27; and &#x27;12&#x27;: running time (millis) = 0</span><br><span class="line">-----------------------------------------</span><br><span class="line">ms     %     Task name</span><br><span class="line">-----------------------------------------</span><br><span class="line">00000  ?  execution(getFoo)</span><br></pre></td></tr></table></figure>

<h5 id="Advice-Ordering-1"><a href="#Advice-Ordering-1" class="headerlink" title="Advice Ordering"></a>Advice Ordering</h5><p>When multiple pieces of advice need to run at the same join point (executing method) the ordering rules are as described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-advice-ordering">Advice Ordering</a>. The precedence between aspects is determined via the <code>order</code> attribute in the <code>&lt;aop:aspect&gt;</code> element or by either adding the <code>@Order</code> annotation to the bean that backs the aspect or by having the bean implement the <code>Ordered</code> interface.</p>
<table>
<thead>
<tr>
<th></th>
<th>In contrast to the precedence rules for advice methods defined in the same <code>@Aspect</code> class, when two pieces of advice defined in the same <code>&lt;aop:aspect&gt;</code> element both need to run at the same join point, the precedence is determined by the order in which the advice elements are declared within the enclosing <code>&lt;aop:aspect&gt;</code> element, from highest to lowest precedence.For example, given an <code>around</code> advice and a <code>before</code> advice defined in the same <code>&lt;aop:aspect&gt;</code> element that apply to the same join point, to ensure that the <code>around</code> advice has higher precedence than the <code>before</code> advice, the <code>&lt;aop:around&gt;</code> element must be declared before the <code>&lt;aop:before&gt;</code> element.As a general rule of thumb, if you find that you have multiple pieces of advice defined in the same <code>&lt;aop:aspect&gt;</code> element that apply to the same join point, consider collapsing such advice methods into one advice method per join point in each <code>&lt;aop:aspect&gt;</code> element or refactor the pieces of advice into separate <code>&lt;aop:aspect&gt;</code> elements that you can order at the aspect level.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-5-4-Introductions"><a href="#5-5-4-Introductions" class="headerlink" title="5.5.4. Introductions"></a>5.5.4. Introductions</h4><p>Introductions (known as inter-type declarations in AspectJ) let an aspect declare that advised objects implement a given interface and provide an implementation of that interface on behalf of those objects.</p>
<p>You can make an introduction by using the <code>aop:declare-parents</code> element inside an <code>aop:aspect</code>. You can use the <code>aop:declare-parents</code> element to declare that matching types have a new parent (hence the name). For example, given an interface named <code>UsageTracked</code> and an implementation of that interface named <code>DefaultUsageTracked</code>, the following aspect declares that all implementors of service interfaces also implement the <code>UsageTracked</code> interface. (In order to expose statistics through JMX for example.)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;usageTrackerAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;usageTracking&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:declare-parents</span></span></span><br><span class="line"><span class="tag">        <span class="attr">types-matching</span>=<span class="string">&quot;com.xzy.myapp.service.*+&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">implement-interface</span>=<span class="string">&quot;com.xyz.myapp.service.tracking.UsageTracked&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">default-impl</span>=<span class="string">&quot;com.xyz.myapp.service.tracking.DefaultUsageTracked&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut</span>=<span class="string">&quot;com.xyz.myapp.CommonPointcuts.businessService()</span></span></span><br><span class="line"><span class="string"><span class="tag">            and this(usageTracked)&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">method</span>=<span class="string">&quot;recordUsage&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The class that backs the <code>usageTracking</code> bean would then contain the following method:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordUsage</span><span class="params">(UsageTracked usageTracked)</span> &#123;</span><br><span class="line">    usageTracked.incrementUseCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The interface to be implemented is determined by the <code>implement-interface</code> attribute. The value of the <code>types-matching</code> attribute is an AspectJ type pattern. Any bean of a matching type implements the <code>UsageTracked</code> interface. Note that, in the before advice of the preceding example, service beans can be directly used as implementations of the <code>UsageTracked</code> interface. To access a bean programmatically, you could write the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UsageTracked</span> <span class="variable">usageTracked</span> <span class="operator">=</span> (UsageTracked) context.getBean(<span class="string">&quot;myService&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-5-5-Aspect-Instantiation-Models"><a href="#5-5-5-Aspect-Instantiation-Models" class="headerlink" title="5.5.5. Aspect Instantiation Models"></a>5.5.5. Aspect Instantiation Models</h4><p>The only supported instantiation model for schema-defined aspects is the singleton model. Other instantiation models may be supported in future releases.</p>
<h4 id="5-5-6-Advisors"><a href="#5-5-6-Advisors" class="headerlink" title="5.5.6. Advisors"></a>5.5.6. Advisors</h4><p>The concept of “advisors” comes from the AOP support defined in Spring and does not have a direct equivalent in AspectJ. An advisor is like a small self-contained aspect that has a single piece of advice. The advice itself is represented by a bean and must implement one of the advice interfaces described in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-api-advice-types">Advice Types in Spring</a>. Advisors can take advantage of AspectJ pointcut expressions.</p>
<p>Spring supports the advisor concept with the <code>&lt;aop:advisor&gt;</code> element. You most commonly see it used in conjunction with transactional advice, which also has its own namespace support in Spring. The following example shows an advisor:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;businessService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">advice-ref</span>=<span class="string">&quot;tx-advice&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;tx-advice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>As well as the <code>pointcut-ref</code> attribute used in the preceding example, you can also use the <code>pointcut</code> attribute to define a pointcut expression inline.</p>
<p>To define the precedence of an advisor so that the advice can participate in ordering, use the <code>order</code> attribute to define the <code>Ordered</code> value of the advisor.</p>
<h4 id="5-5-7-An-AOP-Schema-Example"><a href="#5-5-7-An-AOP-Schema-Example" class="headerlink" title="5.5.7. An AOP Schema Example"></a>5.5.7. An AOP Schema Example</h4><p>This section shows how the concurrent locking failure retry example from <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-example">An AOP Example</a> looks when rewritten with the schema support.</p>
<p>The execution of business services can sometimes fail due to concurrency issues (for example, a deadlock loser). If the operation is retried, it is likely to succeed on the next try. For business services where it is appropriate to retry in such conditions (idempotent operations that do not need to go back to the user for conflict resolution), we want to transparently retry the operation to avoid the client seeing a <code>PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across multiple services in the service layer and, hence, is ideal for implementing through an aspect.</p>
<p>Because we want to retry the operation, we need to use around advice so that we can call <code>proceed</code> multiple times. The following listing shows the basic aspect implementation (which is a regular Java class that uses the schema support):</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentOperationExecutor</span> <span class="keyword">implements</span> <span class="title class_">Ordered</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_RETRIES</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxRetries</span> <span class="operator">=</span> DEFAULT_MAX_RETRIES;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">order</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMaxRetries</span><span class="params">(<span class="type">int</span> maxRetries)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxRetries = maxRetries;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrder</span><span class="params">(<span class="type">int</span> order)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doConcurrentOperation</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numAttempts</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        PessimisticLockingFailureException lockFailureException;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            numAttempts++;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(PessimisticLockingFailureException ex) &#123;</span><br><span class="line">                lockFailureException = ex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span>(numAttempts &lt;= <span class="built_in">this</span>.maxRetries);</span><br><span class="line">        <span class="keyword">throw</span> lockFailureException;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that the aspect implements the <code>Ordered</code> interface so that we can set the precedence of the aspect higher than the transaction advice (we want a fresh transaction each time we retry). The <code>maxRetries</code> and <code>order</code> properties are both configured by Spring. The main action happens in the <code>doConcurrentOperation</code> around advice method. We try to proceed. If we fail with a <code>PessimisticLockingFailureException</code>, we try again, unless we have exhausted all of our retry attempts.</p>
<table>
<thead>
<tr>
<th></th>
<th>This class is identical to the one used in the @AspectJ example, but with the annotations removed.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The corresponding Spring configuration is as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;concurrentOperationRetry&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;concurrentOperationExecutor&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;idempotentOperation&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span></span></span><br><span class="line"><span class="tag">            <span class="attr">pointcut-ref</span>=<span class="string">&quot;idempotentOperation&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">method</span>=<span class="string">&quot;doConcurrentOperation&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;concurrentOperationExecutor&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxRetries&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Notice that, for the time being, we assume that all business services are idempotent. If this is not the case, we can refine the aspect so that it retries only genuinely idempotent operations, by introducing an <code>Idempotent</code> annotation and using the annotation to annotate the implementation of service operations, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Idempotent &#123;</span><br><span class="line">    <span class="comment">// marker annotation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The change to the aspect to retry only idempotent operations involves refining the pointcut expression so that only <code>@Idempotent</code> operations match, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;idempotentOperation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xyz.myapp.service.*.*(..)) and</span></span></span><br><span class="line"><span class="string"><span class="tag">        @annotation(com.xyz.myapp.service.Idempotent)&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-6-Choosing-which-AOP-Declaration-Style-to-Use"><a href="#5-6-Choosing-which-AOP-Declaration-Style-to-Use" class="headerlink" title="5.6. Choosing which AOP Declaration Style to Use"></a>5.6. Choosing which AOP Declaration Style to Use</h3><p>Once you have decided that an aspect is the best approach for implementing a given requirement, how do you decide between using Spring AOP or AspectJ and between the Aspect language (code) style, the @AspectJ annotation style, or the Spring XML style? These decisions are influenced by a number of factors including application requirements, development tools, and team familiarity with AOP.</p>
<h4 id="5-6-1-Spring-AOP-or-Full-AspectJ"><a href="#5-6-1-Spring-AOP-or-Full-AspectJ" class="headerlink" title="5.6.1. Spring AOP or Full AspectJ?"></a>5.6.1. Spring AOP or Full AspectJ?</h4><p>Use the simplest thing that can work. Spring AOP is simpler than using full AspectJ, as there is no requirement to introduce the AspectJ compiler &#x2F; weaver into your development and build processes. If you only need to advise the execution of operations on Spring beans, Spring AOP is the right choice. If you need to advise objects not managed by the Spring container (such as domain objects, typically), you need to use AspectJ. You also need to use AspectJ if you wish to advise join points other than simple method executions (for example, field get or set join points and so on).</p>
<p>When you use AspectJ, you have the choice of the AspectJ language syntax (also known as the “code style”) or the @AspectJ annotation style. Clearly, if you do not use Java 5+, the choice has been made for you: Use the code style. If aspects play a large role in your design, and you are able to use the <a target="_blank" rel="noopener" href="https://www.eclipse.org/ajdt/">AspectJ Development Tools (AJDT)</a> plugin for Eclipse, the AspectJ language syntax is the preferred option. It is cleaner and simpler because the language was purposefully designed for writing aspects. If you do not use Eclipse or have only a few aspects that do not play a major role in your application, you may want to consider using the @AspectJ style, sticking with regular Java compilation in your IDE, and adding an aspect weaving phase to your build script.</p>
<h4 id="5-6-2-AspectJ-or-XML-for-Spring-AOP"><a href="#5-6-2-AspectJ-or-XML-for-Spring-AOP" class="headerlink" title="5.6.2. @AspectJ or XML for Spring AOP?"></a>5.6.2. @AspectJ or XML for Spring AOP?</h4><p>If you have chosen to use Spring AOP, you have a choice of @AspectJ or XML style. There are various tradeoffs to consider.</p>
<p>The XML style may be most familiar to existing Spring users, and it is backed by genuine POJOs. When using AOP as a tool to configure enterprise services, XML can be a good choice (a good test is whether you consider the pointcut expression to be a part of your configuration that you might want to change independently). With the XML style, it is arguably clearer from your configuration which aspects are present in the system.</p>
<p>The XML style has two disadvantages. First, it does not fully encapsulate the implementation of the requirement it addresses in a single place. The DRY principle says that there should be a single, unambiguous, authoritative representation of any piece of knowledge within a system. When using the XML style, the knowledge of how a requirement is implemented is split across the declaration of the backing bean class and the XML in the configuration file. When you use the @AspectJ style, this information is encapsulated in a single module: the aspect. Secondly, the XML style is slightly more limited in what it can express than the @AspectJ style: Only the “singleton” aspect instantiation model is supported, and it is not possible to combine named pointcuts declared in XML. For example, in the @AspectJ style you can write something like the following:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* get*())&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">propertyAccess</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(org.xyz.Account+ *(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationReturningAnAccount</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;propertyAccess() &amp;&amp; operationReturningAnAccount()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accountPropertyAccess</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>In the XML style you can declare the first two pointcuts:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;propertyAccess&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(* get*())&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;operationReturningAnAccount&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(org.xyz.Account+ *(..))&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The downside of the XML approach is that you cannot define the <code>accountPropertyAccess</code> pointcut by combining these definitions.</p>
<p>The @AspectJ style supports additional instantiation models and richer pointcut composition. It has the advantage of keeping the aspect as a modular unit. It also has the advantage that the @AspectJ aspects can be understood (and thus consumed) both by Spring AOP and by AspectJ. So, if you later decide you need the capabilities of AspectJ to implement additional requirements, you can easily migrate to a classic AspectJ setup. On balance, the Spring team prefers the @AspectJ style for custom aspects beyond simple configuration of enterprise services.</p>
<h3 id="5-7-Mixing-Aspect-Types"><a href="#5-7-Mixing-Aspect-Types" class="headerlink" title="5.7. Mixing Aspect Types"></a>5.7. Mixing Aspect Types</h3><p>It is perfectly possible to mix @AspectJ style aspects by using the auto-proxying support, schema-defined <code>&lt;aop:aspect&gt;</code> aspects, <code>&lt;aop:advisor&gt;</code> declared advisors, and even proxies and interceptors in other styles in the same configuration. All of these are implemented by using the same underlying support mechanism and can co-exist without any difficulty.</p>
<h3 id="5-8-Proxying-Mechanisms"><a href="#5-8-Proxying-Mechanisms" class="headerlink" title="5.8. Proxying Mechanisms"></a>5.8. Proxying Mechanisms</h3><p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given target object. JDK dynamic proxies are built into the JDK, whereas CGLIB is a common open-source class definition library (repackaged into <code>spring-core</code>).</p>
<p>If the target object to be proxied implements at least one interface, a JDK dynamic proxy is used. All of the interfaces implemented by the target type are proxied. If the target object does not implement any interfaces, a CGLIB proxy is created.</p>
<p>If you want to force the use of CGLIB proxying (for example, to proxy every method defined for the target object, not only those implemented by its interfaces), you can do so. However, you should consider the following issues:</p>
<ul>
<li>With CGLIB, <code>final</code> methods cannot be advised, as they cannot be overridden in runtime-generated subclasses.</li>
<li>As of Spring 4.0, the constructor of your proxied object is NOT called twice anymore, since the CGLIB proxy instance is created through Objenesis. Only if your JVM does not allow for constructor bypassing, you might see double invocations and corresponding debug log entries from Spring’s AOP support.</li>
</ul>
<p>To force the use of CGLIB proxies, set the value of the <code>proxy-target-class</code> attribute of the <code>&lt;aop:config&gt;</code> element to true, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- other beans defined here... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>To force CGLIB proxying when you use the @AspectJ auto-proxy support, set the <code>proxy-target-class</code> attribute of the <code>&lt;aop:aspectj-autoproxy&gt;</code> element to <code>true</code>, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Multiple <code>&lt;aop:config/&gt;</code> sections are collapsed into a single unified auto-proxy creator at runtime, which applies the <em>strongest</em> proxy settings that any of the <code>&lt;aop:config/&gt;</code> sections (typically from different XML bean definition files) specified. This also applies to the <code>&lt;tx:annotation-driven/&gt;</code> and <code>&lt;aop:aspectj-autoproxy/&gt;</code> elements.To be clear, using <code>proxy-target-class=&quot;true&quot;</code> on <code>&lt;tx:annotation-driven/&gt;</code>, <code>&lt;aop:aspectj-autoproxy/&gt;</code>, or <code>&lt;aop:config/&gt;</code> elements forces the use of CGLIB proxies <em>for all three of them</em>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-8-1-Understanding-AOP-Proxies"><a href="#5-8-1-Understanding-AOP-Proxies" class="headerlink" title="5.8.1. Understanding AOP Proxies"></a>5.8.1. Understanding AOP Proxies</h4><p>Spring AOP is proxy-based. It is vitally important that you grasp the semantics of what that last statement actually means before you write your own aspects or use any of the Spring AOP-based aspects supplied with the Spring Framework.</p>
<p>Consider first the scenario where you have a plain-vanilla, un-proxied, nothing-special-about-it, straight object reference, as the following code snippet shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimplePojo</span> <span class="keyword">implements</span> <span class="title class_">Pojo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// this next method invocation is a direct call on the &#x27;this&#x27; reference</span></span><br><span class="line">        <span class="built_in">this</span>.bar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// some logic...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you invoke a method on an object reference, the method is invoked directly on that object reference, as the following image and listing show:</p>
<p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/aop-proxy-plain-pojo-call.png" alt="aop proxy plain pojo call"></p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Pojo</span> <span class="variable">pojo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimplePojo</span>();</span><br><span class="line">        <span class="comment">// this is a direct method call on the &#x27;pojo&#x27; reference</span></span><br><span class="line">        pojo.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Things change slightly when the reference that client code has is a proxy. Consider the following diagram and code snippet:</p>
<p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/aop-proxy-call.png" alt="aop proxy call"></p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ProxyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyFactory</span>(<span class="keyword">new</span> <span class="title class_">SimplePojo</span>());</span><br><span class="line">        factory.addInterface(Pojo.class);</span><br><span class="line">        factory.addAdvice(<span class="keyword">new</span> <span class="title class_">RetryAdvice</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">Pojo</span> <span class="variable">pojo</span> <span class="operator">=</span> (Pojo) factory.getProxy();</span><br><span class="line">        <span class="comment">// this is a method call on the proxy!</span></span><br><span class="line">        pojo.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The key thing to understand here is that the client code inside the <code>main(..)</code> method of the <code>Main</code> class has a reference to the proxy. This means that method calls on that object reference are calls on the proxy. As a result, the proxy can delegate to all of the interceptors (advice) that are relevant to that particular method call. However, once the call has finally reached the target object (the <code>SimplePojo</code> reference in this case), any method calls that it may make on itself, such as <code>this.bar()</code> or <code>this.foo()</code>, are going to be invoked against the <code>this</code> reference, and not the proxy. This has important implications. It means that self-invocation is not going to result in the advice associated with a method invocation getting a chance to run.</p>
<p>Okay, so what is to be done about this? The best approach (the term “best” is used loosely here) is to refactor your code such that the self-invocation does not happen. This does entail some work on your part, but it is the best, least-invasive approach. The next approach is absolutely horrendous, and we hesitate to point it out, precisely because it is so horrendous. You can (painful as it is to us) totally tie the logic within your class to Spring AOP, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimplePojo</span> <span class="keyword">implements</span> <span class="title class_">Pojo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// this works, but... gah!</span></span><br><span class="line">        ((Pojo) AopContext.currentProxy()).bar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// some logic...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This totally couples your code to Spring AOP, and it makes the class itself aware of the fact that it is being used in an AOP context, which flies in the face of AOP. It also requires some additional configuration when the proxy is being created, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ProxyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyFactory</span>(<span class="keyword">new</span> <span class="title class_">SimplePojo</span>());</span><br><span class="line">        factory.addInterface(Pojo.class);</span><br><span class="line">        factory.addAdvice(<span class="keyword">new</span> <span class="title class_">RetryAdvice</span>());</span><br><span class="line">        factory.setExposeProxy(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Pojo</span> <span class="variable">pojo</span> <span class="operator">=</span> (Pojo) factory.getProxy();</span><br><span class="line">        <span class="comment">// this is a method call on the proxy!</span></span><br><span class="line">        pojo.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, it must be noted that AspectJ does not have this self-invocation issue because it is not a proxy-based AOP framework.</p>
<h3 id="5-9-Programmatic-Creation-of-AspectJ-Proxies"><a href="#5-9-Programmatic-Creation-of-AspectJ-Proxies" class="headerlink" title="5.9. Programmatic Creation of @AspectJ Proxies"></a>5.9. Programmatic Creation of @AspectJ Proxies</h3><p>In addition to declaring aspects in your configuration by using either <code>&lt;aop:config&gt;</code> or <code>&lt;aop:aspectj-autoproxy&gt;</code>, it is also possible to programmatically create proxies that advise target objects. For the full details of Spring’s AOP API, see the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-api">next chapter</a>. Here, we want to focus on the ability to automatically create proxies by using @AspectJ aspects.</p>
<p>You can use the <code>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code> class to create a proxy for a target object that is advised by one or more @AspectJ aspects. The basic usage for this class is very simple, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a factory that can generate a proxy for the given target object</span></span><br><span class="line"><span class="type">AspectJProxyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AspectJProxyFactory</span>(targetObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// add an aspect, the class must be an @AspectJ aspect</span></span><br><span class="line"><span class="comment">// you can call this as many times as you need with different aspects</span></span><br><span class="line">factory.addAspect(SecurityManager.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span></span><br><span class="line">factory.addAspect(usageTracker);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now get the proxy object...</span></span><br><span class="line"><span class="type">MyInterfaceType</span> <span class="variable">proxy</span> <span class="operator">=</span> factory.getProxy();</span><br></pre></td></tr></table></figure>

<p>See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/aop/aspectj/annotation/AspectJProxyFactory.html">javadoc</a> for more information.</p>
<h3 id="5-10-Using-AspectJ-with-Spring-Applications"><a href="#5-10-Using-AspectJ-with-Spring-Applications" class="headerlink" title="5.10. Using AspectJ with Spring Applications"></a>5.10. Using AspectJ with Spring Applications</h3><p>Everything we have covered so far in this chapter is pure Spring AOP. In this section, we look at how you can use the AspectJ compiler or weaver instead of or in addition to Spring AOP if your needs go beyond the facilities offered by Spring AOP alone.</p>
<p>Spring ships with a small AspectJ aspect library, which is available stand-alone in your distribution as <code>spring-aspects.jar</code>. You need to add this to your classpath in order to use the aspects in it. <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-atconfigurable">Using AspectJ to Dependency Inject Domain Objects with Spring</a> and <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ajlib-other">Other Spring aspects for AspectJ</a> discuss the content of this library and how you can use it. <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-configure">Configuring AspectJ Aspects by Using Spring IoC</a> discusses how to dependency inject AspectJ aspects that are woven using the AspectJ compiler. Finally, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw">Load-time Weaving with AspectJ in the Spring Framework</a> provides an introduction to load-time weaving for Spring applications that use AspectJ.</p>
<h4 id="5-10-1-Using-AspectJ-to-Dependency-Inject-Domain-Objects-with-Spring"><a href="#5-10-1-Using-AspectJ-to-Dependency-Inject-Domain-Objects-with-Spring" class="headerlink" title="5.10.1. Using AspectJ to Dependency Inject Domain Objects with Spring"></a>5.10.1. Using AspectJ to Dependency Inject Domain Objects with Spring</h4><p>The Spring container instantiates and configures beans defined in your application context. It is also possible to ask a bean factory to configure a pre-existing object, given the name of a bean definition that contains the configuration to be applied. <code>spring-aspects.jar</code> contains an annotation-driven aspect that exploits this capability to allow dependency injection of any object. The support is intended to be used for objects created outside of the control of any container. Domain objects often fall into this category because they are often created programmatically with the <code>new</code> operator or by an ORM tool as a result of a database query.</p>
<p>The <code>@Configurable</code> annotation marks a class as being eligible for Spring-driven configuration. In the simplest case, you can use purely it as a marker annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyz.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Configurable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When used as a marker interface in this way, Spring configures new instances of the annotated type (<code>Account</code>, in this case) by using a bean definition (typically prototype-scoped) with the same name as the fully-qualified type name (<code>com.xyz.myapp.domain.Account</code>). Since the default name for a bean is the fully-qualified name of its type, a convenient way to declare the prototype definition is to omit the <code>id</code> attribute, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.xyz.myapp.domain.Account&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fundsTransferService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;fundsTransferService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>If you want to explicitly specify the name of the prototype bean definition to use, you can do so directly in the annotation, as the following example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyz.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Configurable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configurable(&quot;account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring now looks for a bean definition named <code>account</code> and uses that as the definition to configure new <code>Account</code> instances.</p>
<p>You can also use autowiring to avoid having to specify a dedicated bean definition at all. To have Spring apply autowiring, use the <code>autowire</code> property of the <code>@Configurable</code> annotation. You can specify either <code>@Configurable(autowire=Autowire.BY_TYPE)</code> or <code>@Configurable(autowire=Autowire.BY_NAME)</code> for autowiring by type or by name, respectively. As an alternative, it is preferable to specify explicit, annotation-driven dependency injection for your <code>@Configurable</code> beans through <code>@Autowired</code> or <code>@Inject</code> at the field or method level (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config">Annotation-based Container Configuration</a> for further details).</p>
<p>Finally, you can enable Spring dependency checking for the object references in the newly created and configured object by using the <code>dependencyCheck</code> attribute (for example, <code>@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code>). If this attribute is set to <code>true</code>, Spring validates after configuration that all properties (which are not primitives or collections) have been set.</p>
<p>Note that using the annotation on its own does nothing. It is the <code>AnnotationBeanConfigurerAspect</code> in <code>spring-aspects.jar</code> that acts on the presence of the annotation. In essence, the aspect says, “after returning from the initialization of a new object of a type annotated with <code>@Configurable</code>, configure the newly created object using Spring in accordance with the properties of the annotation”. In this context, “initialization” refers to newly instantiated objects (for example, objects instantiated with the <code>new</code> operator) as well as to <code>Serializable</code> objects that are undergoing deserialization (for example, through <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html">readResolve()</a>).</p>
<table>
<thead>
<tr>
<th></th>
<th>One of the key phrases in the above paragraph is “in essence”. For most cases, the exact semantics of “after returning from the initialization of a new object” are fine. In this context, “after initialization” means that the dependencies are injected after the object has been constructed. This means that the dependencies are not available for use in the constructor bodies of the class. If you want the dependencies to be injected before the constructor bodies run and thus be available for use in the body of the constructors, you need to define this on the <code>@Configurable</code> declaration, as follows:JavaKotlin<code>@Configurable(preConstruction = true)</code>You can find more information about the language semantics of the various pointcut types in AspectJ <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/next/progguide/semantics-joinPoints.html">in this appendix</a> of the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/next/progguide/index.html">AspectJ Programming Guide</a>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>For this to work, the annotated types must be woven with the AspectJ weaver. You can either use a build-time Ant or Maven task to do this (see, for example, the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html">AspectJ Development Environment Guide</a>) or load-time weaving (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw">Load-time Weaving with AspectJ in the Spring Framework</a>). The <code>AnnotationBeanConfigurerAspect</code> itself needs to be configured by Spring (in order to obtain a reference to the bean factory that is to be used to configure new objects). If you use Java-based configuration, you can add <code>@EnableSpringConfigured</code> to any <code>@Configuration</code> class, as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSpringConfigured</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you prefer XML based configuration, the Spring <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas-context"><code>context</code> namespace</a> defines a convenient <code>context:spring-configured</code> element, which you can use as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:spring-configured</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Instances of <code>@Configurable</code> objects created before the aspect has been configured result in a message being issued to the debug log and no configuration of the object taking place. An example might be a bean in the Spring configuration that creates domain objects when it is initialized by Spring. In this case, you can use the <code>depends-on</code> bean attribute to manually specify that the bean depends on the configuration aspect. The following example shows how to use the <code>depends-on</code> attribute:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;com.xzy.myapp.service.MyService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">depends-on</span>=<span class="string">&quot;org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Do not activate <code>@Configurable</code> processing through the bean configurer aspect unless you really mean to rely on its semantics at runtime. In particular, make sure that you do not use <code>@Configurable</code> on bean classes that are registered as regular Spring beans with the container. Doing so results in double initialization, once through the container and once through the aspect.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Unit-Testing-Configurable-Objects"><a href="#Unit-Testing-Configurable-Objects" class="headerlink" title="Unit Testing @Configurable Objects"></a>Unit Testing <code>@Configurable</code> Objects</h5><p>One of the goals of the <code>@Configurable</code> support is to enable independent unit testing of domain objects without the difficulties associated with hard-coded lookups. If <code>@Configurable</code> types have not been woven by AspectJ, the annotation has no affect during unit testing. You can set mock or stub property references in the object under test and proceed as normal. If <code>@Configurable</code> types have been woven by AspectJ, you can still unit test outside of the container as normal, but you see a warning message each time that you construct a <code>@Configurable</code> object indicating that it has not been configured by Spring.</p>
<h5 id="Working-with-Multiple-Application-Contexts"><a href="#Working-with-Multiple-Application-Contexts" class="headerlink" title="Working with Multiple Application Contexts"></a>Working with Multiple Application Contexts</h5><p>The <code>AnnotationBeanConfigurerAspect</code> that is used to implement the <code>@Configurable</code> support is an AspectJ singleton aspect. The scope of a singleton aspect is the same as the scope of <code>static</code> members: There is one aspect instance per classloader that defines the type. This means that, if you define multiple application contexts within the same classloader hierarchy, you need to consider where to define the <code>@EnableSpringConfigured</code> bean and where to place <code>spring-aspects.jar</code> on the classpath.</p>
<p>Consider a typical Spring web application configuration that has a shared parent application context that defines common business services, everything needed to support those services, and one child application context for each servlet (which contains definitions particular to that servlet). All of these contexts co-exist within the same classloader hierarchy, and so the <code>AnnotationBeanConfigurerAspect</code> can hold a reference to only one of them. In this case, we recommend defining the <code>@EnableSpringConfigured</code> bean in the shared (parent) application context. This defines the services that you are likely to want to inject into domain objects. A consequence is that you cannot configure domain objects with references to beans defined in the child (servlet-specific) contexts by using the @Configurable mechanism (which is probably not something you want to do anyway).</p>
<p>When deploying multiple web applications within the same container, ensure that each web application loads the types in <code>spring-aspects.jar</code> by using its own classloader (for example, by placing <code>spring-aspects.jar</code> in <code>WEB-INF/lib</code>). If <code>spring-aspects.jar</code> is added only to the container-wide classpath (and hence loaded by the shared parent classloader), all web applications share the same aspect instance (which is probably not what you want).</p>
<h4 id="5-10-2-Other-Spring-aspects-for-AspectJ"><a href="#5-10-2-Other-Spring-aspects-for-AspectJ" class="headerlink" title="5.10.2. Other Spring aspects for AspectJ"></a>5.10.2. Other Spring aspects for AspectJ</h4><p>In addition to the <code>@Configurable</code> aspect, <code>spring-aspects.jar</code> contains an AspectJ aspect that you can use to drive Spring’s transaction management for types and methods annotated with the <code>@Transactional</code> annotation. This is primarily intended for users who want to use the Spring Framework’s transaction support outside of the Spring container.</p>
<p>The aspect that interprets <code>@Transactional</code> annotations is the <code>AnnotationTransactionAspect</code>. When you use this aspect, you must annotate the implementation class (or methods within that class or both), not the interface (if any) that the class implements. AspectJ follows Java’s rule that annotations on interfaces are not inherited.</p>
<p>A <code>@Transactional</code> annotation on a class specifies the default transaction semantics for the execution of any public operation in the class.</p>
<p>A <code>@Transactional</code> annotation on a method within the class overrides the default transaction semantics given by the class annotation (if present). Methods of any visibility may be annotated, including private methods. Annotating non-public methods directly is the only way to get transaction demarcation for the execution of such methods.</p>
<table>
<thead>
<tr>
<th></th>
<th>Since Spring Framework 4.2, <code>spring-aspects</code> provides a similar aspect that offers the exact same features for the standard <code>javax.transaction.Transactional</code> annotation. Check <code>JtaAnnotationTransactionAspect</code> for more details.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>For AspectJ programmers who want to use the Spring configuration and transaction management support but do not want to (or cannot) use annotations, <code>spring-aspects.jar</code> also contains <code>abstract</code> aspects you can extend to provide your own pointcut definitions. See the sources for the <code>AbstractBeanConfigurerAspect</code> and <code>AbstractTransactionAspect</code> aspects for more information. As an example, the following excerpt shows how you could write an aspect to configure all instances of objects defined in the domain model by using prototype bean definitions that match the fully qualified class names:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> aspect DomainObjectConfiguration <span class="keyword">extends</span> <span class="title class_">AbstractBeanConfigurerAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DomainObjectConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        setBeanWiringInfoResolver(<span class="keyword">new</span> <span class="title class_">ClassNameBeanWiringInfoResolver</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the creation of a new bean (any object in the domain model)</span></span><br><span class="line">    <span class="keyword">protected</span> pointcut <span class="title function_">beanCreation</span><span class="params">(Object beanInstance)</span> :</span><br><span class="line">        initialization(<span class="keyword">new</span>(..)) &amp;&amp;</span><br><span class="line">        CommonPointcuts.inDomainModel() &amp;&amp;</span><br><span class="line">        <span class="built_in">this</span>(beanInstance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-10-3-Configuring-AspectJ-Aspects-by-Using-Spring-IoC"><a href="#5-10-3-Configuring-AspectJ-Aspects-by-Using-Spring-IoC" class="headerlink" title="5.10.3. Configuring AspectJ Aspects by Using Spring IoC"></a>5.10.3. Configuring AspectJ Aspects by Using Spring IoC</h4><p>When you use AspectJ aspects with Spring applications, it is natural to both want and expect to be able to configure such aspects with Spring. The AspectJ runtime itself is responsible for aspect creation, and the means of configuring the AspectJ-created aspects through Spring depends on the AspectJ instantiation model (the <code>per-xxx</code> clause) used by the aspect.</p>
<p>The majority of AspectJ aspects are singleton aspects. Configuration of these aspects is easy. You can create a bean definition that references the aspect type as normal and include the <code>factory-method=&quot;aspectOf&quot;</code> bean attribute. This ensures that Spring obtains the aspect instance by asking AspectJ for it rather than trying to create an instance itself. The following example shows how to use the <code>factory-method=&quot;aspectOf&quot;</code> attribute:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;profiler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xyz.profiler.Profiler&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">factory-method</span>=<span class="string">&quot;aspectOf&quot;</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;profilingStrategy&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jamonProfilingStrategy&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Note the <code>factory-method=&quot;aspectOf&quot;</code> attribute</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Non-singleton aspects are harder to configure. However, it is possible to do so by creating prototype bean definitions and using the <code>@Configurable</code> support from <code>spring-aspects.jar</code> to configure the aspect instances once they have bean created by the AspectJ runtime.</p>
<p>If you have some @AspectJ aspects that you want to weave with AspectJ (for example, using load-time weaving for domain model types) and other @AspectJ aspects that you want to use with Spring AOP, and these aspects are all configured in Spring, you need to tell the Spring AOP @AspectJ auto-proxying support which exact subset of the @AspectJ aspects defined in the configuration should be used for auto-proxying. You can do this by using one or more <code>&lt;include/&gt;</code> elements inside the <code>&lt;aop:aspectj-autoproxy/&gt;</code> declaration. Each <code>&lt;include/&gt;</code> element specifies a name pattern, and only beans with names matched by at least one of the patterns are used for Spring AOP auto-proxy configuration. The following example shows how to use <code>&lt;include/&gt;</code> elements:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:include</span> <span class="attr">name</span>=<span class="string">&quot;thisBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:include</span> <span class="attr">name</span>=<span class="string">&quot;thatBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Do not be misled by the name of the <code>&lt;aop:aspectj-autoproxy/&gt;</code> element. Using it results in the creation of Spring AOP proxies. The @AspectJ style of aspect declaration is being used here, but the AspectJ runtime is not involved.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="5-10-4-Load-time-Weaving-with-AspectJ-in-the-Spring-Framework"><a href="#5-10-4-Load-time-Weaving-with-AspectJ-in-the-Spring-Framework" class="headerlink" title="5.10.4. Load-time Weaving with AspectJ in the Spring Framework"></a>5.10.4. Load-time Weaving with AspectJ in the Spring Framework</h4><p>Load-time weaving (LTW) refers to the process of weaving AspectJ aspects into an application’s class files as they are being loaded into the Java virtual machine (JVM). The focus of this section is on configuring and using LTW in the specific context of the Spring Framework. This section is not a general introduction to LTW. For full details on the specifics of LTW and configuring LTW with only AspectJ (with Spring not being involved at all), see the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw.html">LTW section of the AspectJ Development Environment Guide</a>.</p>
<p>The value that the Spring Framework brings to AspectJ LTW is in enabling much finer-grained control over the weaving process. ‘Vanilla’ AspectJ LTW is effected by using a Java (5+) agent, which is switched on by specifying a VM argument when starting up a JVM. It is, thus, a JVM-wide setting, which may be fine in some situations but is often a little too coarse. Spring-enabled LTW lets you switch on LTW on a per-<code>ClassLoader</code> basis, which is more fine-grained and which can make more sense in a ‘single-JVM-multiple-application’ environment (such as is found in a typical application server environment).</p>
<p>Further, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw-environments">in certain environments</a>, this support enables load-time weaving without making any modifications to the application server’s launch script that is needed to add <code>-javaagent:path/to/aspectjweaver.jar</code> or (as we describe later in this section) <code>-javaagent:path/to/spring-instrument.jar</code>. Developers configure the application context to enable load-time weaving instead of relying on administrators who typically are in charge of the deployment configuration, such as the launch script.</p>
<p>Now that the sales pitch is over, let us first walk through a quick example of AspectJ LTW that uses Spring, followed by detailed specifics about elements introduced in the example. For a complete example, see the <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-petclinic">Petclinic sample application</a>.</p>
<h5 id="A-First-Example"><a href="#A-First-Example" class="headerlink" title="A First Example"></a>A First Example</h5><p>Assume that you are an application developer who has been tasked with diagnosing the cause of some performance problems in a system. Rather than break out a profiling tool, we are going to switch on a simple profiling aspect that lets us quickly get some performance metrics. We can then apply a finer-grained profiling tool to that specific area immediately afterwards.</p>
<table>
<thead>
<tr>
<th></th>
<th>The example presented here uses XML configuration. You can also configure and use @AspectJ with <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java">Java configuration</a>. Specifically, you can use the <code>@EnableLoadTimeWeaving</code> annotation as an alternative to <code>&lt;context:load-time-weaver/&gt;</code> (see <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw-spring">below</a> for details).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following example shows the profiling aspect, which is not fancy. It is a time-based profiler that uses the @AspectJ-style of aspect declaration:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProfilingAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;methodsToBeProfiled()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">profile</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>(getClass().getSimpleName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sw.start(pjp.getSignature().getName());</span><br><span class="line">            <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            sw.stop();</span><br><span class="line">            System.out.println(sw.prettyPrint());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * foo..*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodsToBeProfiled</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We also need to create an <code>META-INF/aop.xml</code> file, to inform the AspectJ weaver that we want to weave our <code>ProfilingAspect</code> into our classes. This file convention, namely the presence of a file (or files) on the Java classpath called <code>META-INF/aop.xml</code> is standard AspectJ. The following example shows the <code>aop.xml</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">aspectj</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//AspectJ//DTD//EN&quot;</span> <span class="string">&quot;https://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aspectj</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">weaver</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- only weave classes in our application-specific packages --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">within</span>=<span class="string">&quot;foo.*&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">weaver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aspects</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- weave in just this aspect --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aspect</span> <span class="attr">name</span>=<span class="string">&quot;foo.ProfilingAspect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aspects</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aspectj</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now we can move on to the Spring-specific portion of the configuration. We need to configure a <code>LoadTimeWeaver</code> (explained later). This load-time weaver is the essential component responsible for weaving the aspect configuration in one or more <code>META-INF/aop.xml</code> files into the classes in your application. The good thing is that it does not require a lot of configuration (there are some more options that you can specify, but these are detailed later), as can be seen in the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- a service object; we will be profiling its methods --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;entitlementCalculationService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;foo.StubEntitlementCalculationService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- this switches on the load-time weaving --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:load-time-weaver</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now that all the required artifacts (the aspect, the <code>META-INF/aop.xml</code> file, and the Spring configuration) are in place, we can create the following driver class with a <code>main(..)</code> method to demonstrate the LTW in action:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>, Main.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">EntitlementCalculationService</span> <span class="variable">entitlementCalculationService</span> <span class="operator">=</span></span><br><span class="line">                (EntitlementCalculationService) ctx.getBean(<span class="string">&quot;entitlementCalculationService&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the profiling aspect is &#x27;woven&#x27; around this method execution</span></span><br><span class="line">        entitlementCalculationService.calculateEntitlement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We have one last thing to do. The introduction to this section did say that one could switch on LTW selectively on a per-<code>ClassLoader</code> basis with Spring, and this is true. However, for this example, we use a Java agent (supplied with Spring) to switch on LTW. We use the following command to run the <code>Main</code> class shown earlier:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:C:/projects/foo/lib/global/spring-instrument.jar foo.Main</span><br></pre></td></tr></table></figure>

<p>The <code>-javaagent</code> is a flag for specifying and enabling <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/instrument/package-summary.html">agents to instrument programs that run on the JVM</a>. The Spring Framework ships with such an agent, the <code>InstrumentationSavingAgent</code>, which is packaged in the <code>spring-instrument.jar</code> that was supplied as the value of the <code>-javaagent</code> argument in the preceding example.</p>
<p>The output from the execution of the <code>Main</code> program looks something like the next example. (I have introduced a <code>Thread.sleep(..)</code> statement into the <code>calculateEntitlement()</code> implementation so that the profiler actually captures something other than 0 milliseconds (the <code>01234</code> milliseconds is not an overhead introduced by the AOP). The following listing shows the output we got when we ran our profiler:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Calculating entitlement</span><br><span class="line"></span><br><span class="line">StopWatch &#x27;ProfilingAspect&#x27;: running time (millis) = 1234</span><br><span class="line">------ ----- ----------------------------</span><br><span class="line">ms     %     Task name</span><br><span class="line">------ ----- ----------------------------</span><br><span class="line">01234  100%  calculateEntitlement</span><br></pre></td></tr></table></figure>

<p>Since this LTW is effected by using full-blown AspectJ, we are not limited only to advising Spring beans. The following slight variation on the <code>Main</code> program yields the same result:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>, Main.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">EntitlementCalculationService</span> <span class="variable">entitlementCalculationService</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StubEntitlementCalculationService</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the profiling aspect will be &#x27;woven&#x27; around this method execution</span></span><br><span class="line">        entitlementCalculationService.calculateEntitlement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice how, in the preceding program, we bootstrap the Spring container and then create a new instance of the <code>StubEntitlementCalculationService</code> totally outside the context of Spring. The profiling advice still gets woven in.</p>
<p>Admittedly, the example is simplistic. However, the basics of the LTW support in Spring have all been introduced in the earlier example, and the rest of this section explains the “why” behind each bit of configuration and usage in detail.</p>
<table>
<thead>
<tr>
<th></th>
<th>The <code>ProfilingAspect</code> used in this example may be basic, but it is quite useful. It is a nice example of a development-time aspect that developers can use during development and then easily exclude from builds of the application being deployed into UAT or production.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Aspects"><a href="#Aspects" class="headerlink" title="Aspects"></a>Aspects</h5><p>The aspects that you use in LTW have to be AspectJ aspects. You can write them in either the AspectJ language itself, or you can write your aspects in the @AspectJ-style. Your aspects are then both valid AspectJ and Spring AOP aspects. Furthermore, the compiled aspect classes need to be available on the classpath.</p>
<h5 id="‘META-INF-aop-xml’"><a href="#‘META-INF-aop-xml’" class="headerlink" title="‘META-INF&#x2F;aop.xml’"></a>‘META-INF&#x2F;aop.xml’</h5><p>The AspectJ LTW infrastructure is configured by using one or more <code>META-INF/aop.xml</code> files that are on the Java classpath (either directly or, more typically, in jar files).</p>
<p>The structure and contents of this file is detailed in the LTW part of the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw-configuration.html">AspectJ reference documentation</a>. Because the <code>aop.xml</code> file is 100% AspectJ, we do not describe it further here.</p>
<h5 id="Required-libraries-JARS"><a href="#Required-libraries-JARS" class="headerlink" title="Required libraries (JARS)"></a>Required libraries (JARS)</h5><p>At minimum, you need the following libraries to use the Spring Framework’s support for AspectJ LTW:</p>
<ul>
<li><code>spring-aop.jar</code></li>
<li><code>aspectjweaver.jar</code></li>
</ul>
<p>If you use the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw-environments-generic">Spring-provided agent to enable instrumentation</a>, you also need:</p>
<ul>
<li><code>spring-instrument.jar</code></li>
</ul>
<h5 id="Spring-Configuration"><a href="#Spring-Configuration" class="headerlink" title="Spring Configuration"></a>Spring Configuration</h5><p>The key component in Spring’s LTW support is the <code>LoadTimeWeaver</code> interface (in the <code>org.springframework.instrument.classloading</code> package), and the numerous implementations of it that ship with the Spring distribution. A <code>LoadTimeWeaver</code> is responsible for adding one or more <code>java.lang.instrument.ClassFileTransformers</code> to a <code>ClassLoader</code> at runtime, which opens the door to all manner of interesting applications, one of which happens to be the LTW of aspects.</p>
<table>
<thead>
<tr>
<th></th>
<th>If you are unfamiliar with the idea of runtime class file transformation, see the javadoc API documentation for the <code>java.lang.instrument</code> package before continuing. While that documentation is not comprehensive, at least you can see the key interfaces and classes (for reference as you read through this section).</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Configuring a <code>LoadTimeWeaver</code> for a particular <code>ApplicationContext</code> can be as easy as adding one line. (Note that you almost certainly need to use an <code>ApplicationContext</code> as your Spring container — typically, a <code>BeanFactory</code> is not enough because the LTW support uses <code>BeanFactoryPostProcessors</code>.)</p>
<p>To enable the Spring Framework’s LTW support, you need to configure a <code>LoadTimeWeaver</code>, which typically is done by using the <code>@EnableLoadTimeWeaving</code> annotation, as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableLoadTimeWeaving</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Alternatively, if you prefer XML-based configuration, use the <code>&lt;context:load-time-weaver/&gt;</code> element. Note that the element is defined in the <code>context</code> namespace. The following example shows how to use <code>&lt;context:load-time-weaver/&gt;</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:load-time-weaver</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration automatically defines and registers a number of LTW-specific infrastructure beans, such as a <code>LoadTimeWeaver</code> and an <code>AspectJWeavingEnabler</code>, for you. The default <code>LoadTimeWeaver</code> is the <code>DefaultContextLoadTimeWeaver</code> class, which attempts to decorate an automatically detected <code>LoadTimeWeaver</code>. The exact type of <code>LoadTimeWeaver</code> that is “automatically detected” is dependent upon your runtime environment. The following table summarizes various <code>LoadTimeWeaver</code> implementations:</p>
<table>
<thead>
<tr>
<th align="left">Runtime Environment</th>
<th align="left"><code>LoadTimeWeaver</code> implementation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Running in <a target="_blank" rel="noopener" href="https://tomcat.apache.org/">Apache Tomcat</a></td>
<td align="left"><code>TomcatLoadTimeWeaver</code></td>
</tr>
<tr>
<td align="left">Running in <a target="_blank" rel="noopener" href="https://eclipse-ee4j.github.io/glassfish/">GlassFish</a> (limited to EAR deployments)</td>
<td align="left"><code>GlassFishLoadTimeWeaver</code></td>
</tr>
<tr>
<td align="left">Running in Red Hat’s <a target="_blank" rel="noopener" href="https://www.jboss.org/jbossas/">JBoss AS</a> or <a target="_blank" rel="noopener" href="https://www.wildfly.org/">WildFly</a></td>
<td align="left"><code>JBossLoadTimeWeaver</code></td>
</tr>
<tr>
<td align="left">Running in IBM’s <a target="_blank" rel="noopener" href="https://www-01.ibm.com/software/webservers/appserv/was/">WebSphere</a></td>
<td align="left"><code>WebSphereLoadTimeWeaver</code></td>
</tr>
<tr>
<td align="left">Running in Oracle’s <a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/middleware/weblogic/overview/index-085209.html">WebLogic</a></td>
<td align="left"><code>WebLogicLoadTimeWeaver</code></td>
</tr>
<tr>
<td align="left">JVM started with Spring <code>InstrumentationSavingAgent</code> (<code>java -javaagent:path/to/spring-instrument.jar</code>)</td>
<td align="left"><code>InstrumentationLoadTimeWeaver</code></td>
</tr>
<tr>
<td align="left">Fallback, expecting the underlying ClassLoader to follow common conventions (namely <code>addTransformer</code> and optionally a <code>getThrowawayClassLoader</code> method)</td>
<td align="left"><code>ReflectiveLoadTimeWeaver</code></td>
</tr>
</tbody></table>
<p>Note that the table lists only the <code>LoadTimeWeavers</code> that are autodetected when you use the <code>DefaultContextLoadTimeWeaver</code>. You can specify exactly which <code>LoadTimeWeaver</code> implementation to use.</p>
<p>To specify a specific <code>LoadTimeWeaver</code> with Java configuration, implement the <code>LoadTimeWeavingConfigurer</code> interface and override the <code>getLoadTimeWeaver()</code> method. The following example specifies a <code>ReflectiveLoadTimeWeaver</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableLoadTimeWeaving</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> <span class="keyword">implements</span> <span class="title class_">LoadTimeWeavingConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LoadTimeWeaver <span class="title function_">getLoadTimeWeaver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReflectiveLoadTimeWeaver</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you use XML-based configuration, you can specify the fully qualified classname as the value of the <code>weaver-class</code> attribute on the <code>&lt;context:load-time-weaver/&gt;</code> element. Again, the following example specifies a <code>ReflectiveLoadTimeWeaver</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:load-time-weaver</span></span></span><br><span class="line"><span class="tag">            <span class="attr">weaver-class</span>=<span class="string">&quot;org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>LoadTimeWeaver</code> that is defined and registered by the configuration can be later retrieved from the Spring container by using the well known name, <code>loadTimeWeaver</code>. Remember that the <code>LoadTimeWeaver</code> exists only as a mechanism for Spring’s LTW infrastructure to add one or more <code>ClassFileTransformers</code>. The actual <code>ClassFileTransformer</code> that does the LTW is the <code>ClassPreProcessorAgentAdapter</code> (from the <code>org.aspectj.weaver.loadtime</code> package) class. See the class-level javadoc of the <code>ClassPreProcessorAgentAdapter</code> class for further details, because the specifics of how the weaving is actually effected is beyond the scope of this document.</p>
<p>There is one final attribute of the configuration left to discuss: the <code>aspectjWeaving</code> attribute (or <code>aspectj-weaving</code> if you use XML). This attribute controls whether LTW is enabled or not. It accepts one of three possible values, with the default value being <code>autodetect</code> if the attribute is not present. The following table summarizes the three possible values:</p>
<table>
<thead>
<tr>
<th align="left">Annotation Value</th>
<th align="left">XML Value</th>
<th align="left">Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ENABLED</code></td>
<td align="left"><code>on</code></td>
<td align="left">AspectJ weaving is on, and aspects are woven at load-time as appropriate.</td>
</tr>
<tr>
<td align="left"><code>DISABLED</code></td>
<td align="left"><code>off</code></td>
<td align="left">LTW is off. No aspect is woven at load-time.</td>
</tr>
<tr>
<td align="left"><code>AUTODETECT</code></td>
<td align="left"><code>autodetect</code></td>
<td align="left">If the Spring LTW infrastructure can find at least one <code>META-INF/aop.xml</code> file, then AspectJ weaving is on. Otherwise, it is off. This is the default value.</td>
</tr>
</tbody></table>
<h5 id="Environment-specific-Configuration"><a href="#Environment-specific-Configuration" class="headerlink" title="Environment-specific Configuration"></a>Environment-specific Configuration</h5><p>This last section contains any additional settings and configuration that you need when you use Spring’s LTW support in environments such as application servers and web containers.</p>
<h6 id="Tomcat-JBoss-WebSphere-WebLogic"><a href="#Tomcat-JBoss-WebSphere-WebLogic" class="headerlink" title="Tomcat, JBoss, WebSphere, WebLogic"></a>Tomcat, JBoss, WebSphere, WebLogic</h6><p>Tomcat, JBoss&#x2F;WildFly, IBM WebSphere Application Server and Oracle WebLogic Server all provide a general app <code>ClassLoader</code> that is capable of local instrumentation. Spring’s native LTW may leverage those ClassLoader implementations to provide AspectJ weaving. You can simply enable load-time weaving, as <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-using-aspectj">described earlier</a>. Specifically, you do not need to modify the JVM launch script to add <code>-javaagent:path/to/spring-instrument.jar</code>.</p>
<p>Note that on JBoss, you may need to disable the app server scanning to prevent it from loading the classes before the application actually starts. A quick workaround is to add to your artifact a file named <code>WEB-INF/jboss-scanning.xml</code> with the following content:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scanning</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:jboss:scanning:1.0&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="Generic-Java-Applications"><a href="#Generic-Java-Applications" class="headerlink" title="Generic Java Applications"></a>Generic Java Applications</h6><p>When class instrumentation is required in environments that are not supported by specific <code>LoadTimeWeaver</code> implementations, a JVM agent is the general solution. For such cases, Spring provides <code>InstrumentationLoadTimeWeaver</code> which requires a Spring-specific (but very general) JVM agent, <code>spring-instrument.jar</code>, autodetected by common <code>@EnableLoadTimeWeaving</code> and <code>&lt;context:load-time-weaver/&gt;</code> setups.</p>
<p>To use it, you must start the virtual machine with the Spring agent by supplying the following JVM options:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-javaagent:/path/to/spring-instrument.jar</span><br></pre></td></tr></table></figure>

<p>Note that this requires modification of the JVM launch script, which may prevent you from using this in application server environments (depending on your server and your operation policies). That said, for one-app-per-JVM deployments such as standalone Spring Boot applications, you typically control the entire JVM setup in any case.</p>
<h3 id="5-11-Further-Resources"><a href="#5-11-Further-Resources" class="headerlink" title="5.11. Further Resources"></a>5.11. Further Resources</h3><p>More information on AspectJ can be found on the <a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj">AspectJ website</a>.</p>
<p><em>Eclipse AspectJ</em> by Adrian Colyer et. al. (Addison-Wesley, 2005) provides a comprehensive introduction and reference for the AspectJ language.</p>
<p><em>AspectJ in Action</em>, Second Edition by Ramnivas Laddad (Manning, 2009) comes highly recommended. The focus of the book is on AspectJ, but a lot of general AOP themes are explored (in some depth).</p>
<h2 id="6-Spring-AOP-APIs"><a href="#6-Spring-AOP-APIs" class="headerlink" title="6. Spring AOP APIs"></a>6. Spring AOP APIs</h2><p>The previous chapter described the Spring’s support for AOP with @AspectJ and schema-based aspect definitions. In this chapter, we discuss the lower-level Spring AOP APIs. For common applications, we recommend the use of Spring AOP with AspectJ pointcuts as described in the previous chapter.</p>
<h3 id="6-1-Pointcut-API-in-Spring"><a href="#6-1-Pointcut-API-in-Spring" class="headerlink" title="6.1. Pointcut API in Spring"></a>6.1. Pointcut API in Spring</h3><p>This section describes how Spring handles the crucial pointcut concept.</p>
<h4 id="6-1-1-Concepts"><a href="#6-1-1-Concepts" class="headerlink" title="6.1.1. Concepts"></a>6.1.1. Concepts</h4><p>Spring’s pointcut model enables pointcut reuse independent of advice types. You can target different advice with the same pointcut.</p>
<p>The <code>org.springframework.aop.Pointcut</code> interface is the central interface, used to target advices to particular classes and methods. The complete interface follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Pointcut</span> &#123;</span><br><span class="line"></span><br><span class="line">    ClassFilter <span class="title function_">getClassFilter</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    MethodMatcher <span class="title function_">getMethodMatcher</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Splitting the <code>Pointcut</code> interface into two parts allows reuse of class and method matching parts and fine-grained composition operations (such as performing a “union” with another method matcher).</p>
<p>The <code>ClassFilter</code> interface is used to restrict the pointcut to a given set of target classes. If the <code>matches()</code> method always returns true, all target classes are matched. The following listing shows the <code>ClassFilter</code> interface definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClassFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(Class clazz)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>MethodMatcher</code> interface is normally more important. The complete interface follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MethodMatcher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(Method m, Class&lt;?&gt; targetClass)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isRuntime</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(Method m, Class&lt;?&gt; targetClass, Object... args)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>matches(Method, Class)</code> method is used to test whether this pointcut ever matches a given method on a target class. This evaluation can be performed when an AOP proxy is created to avoid the need for a test on every method invocation. If the two-argument <code>matches</code> method returns <code>true</code> for a given method, and the <code>isRuntime()</code> method for the MethodMatcher returns <code>true</code>, the three-argument matches method is invoked on every method invocation. This lets a pointcut look at the arguments passed to the method invocation immediately before the target advice starts.</p>
<p>Most <code>MethodMatcher</code> implementations are static, meaning that their <code>isRuntime()</code> method returns <code>false</code>. In this case, the three-argument <code>matches</code> method is never invoked.</p>
<table>
<thead>
<tr>
<th></th>
<th>If possible, try to make pointcuts static, allowing the AOP framework to cache the results of pointcut evaluation when an AOP proxy is created.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="6-1-2-Operations-on-Pointcuts"><a href="#6-1-2-Operations-on-Pointcuts" class="headerlink" title="6.1.2. Operations on Pointcuts"></a>6.1.2. Operations on Pointcuts</h4><p>Spring supports operations (notably, union and intersection) on pointcuts.</p>
<p>Union means the methods that either pointcut matches. Intersection means the methods that both pointcuts match. Union is usually more useful. You can compose pointcuts by using the static methods in the <code>org.springframework.aop.support.Pointcuts</code> class or by using the <code>ComposablePointcut</code> class in the same package. However, using AspectJ pointcut expressions is usually a simpler approach.</p>
<h4 id="6-1-3-AspectJ-Expression-Pointcuts"><a href="#6-1-3-AspectJ-Expression-Pointcuts" class="headerlink" title="6.1.3. AspectJ Expression Pointcuts"></a>6.1.3. AspectJ Expression Pointcuts</h4><p>Since 2.0, the most important type of pointcut used by Spring is <code>org.springframework.aop.aspectj.AspectJExpressionPointcut</code>. This is a pointcut that uses an AspectJ-supplied library to parse an AspectJ pointcut expression string.</p>
<p>See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">previous chapter</a> for a discussion of supported AspectJ pointcut primitives.</p>
<h4 id="6-1-4-Convenience-Pointcut-Implementations"><a href="#6-1-4-Convenience-Pointcut-Implementations" class="headerlink" title="6.1.4. Convenience Pointcut Implementations"></a>6.1.4. Convenience Pointcut Implementations</h4><p>Spring provides several convenient pointcut implementations. You can use some of them directly; others are intended to be subclassed in application-specific pointcuts.</p>
<h5 id="Static-Pointcuts"><a href="#Static-Pointcuts" class="headerlink" title="Static Pointcuts"></a>Static Pointcuts</h5><p>Static pointcuts are based on the method and the target class and cannot take into account the method’s arguments. Static pointcuts suffice — and are best — for most usages. Spring can evaluate a static pointcut only once, when a method is first invoked. After that, there is no need to evaluate the pointcut again with each method invocation.</p>
<p>The rest of this section describes some of the static pointcut implementations that are included with Spring.</p>
<h6 id="Regular-Expression-Pointcuts"><a href="#Regular-Expression-Pointcuts" class="headerlink" title="Regular Expression Pointcuts"></a>Regular Expression Pointcuts</h6><p>One obvious way to specify static pointcuts is regular expressions. Several AOP frameworks besides Spring make this possible. <code>org.springframework.aop.support.JdkRegexpMethodPointcut</code> is a generic regular expression pointcut that uses the regular expression support in the JDK.</p>
<p>With the <code>JdkRegexpMethodPointcut</code> class, you can provide a list of pattern strings. If any of these is a match, the pointcut evaluates to <code>true</code>. (As a consequence, the resulting pointcut is effectively the union of the specified patterns.)</p>
<p>The following example shows how to use <code>JdkRegexpMethodPointcut</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;settersAndAbsquatulatePointcut&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.support.JdkRegexpMethodPointcut&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;patterns&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>.*set.*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>.*absquatulate<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring provides a convenience class named <code>RegexpMethodPointcutAdvisor</code>, which lets us also reference an <code>Advice</code> (remember that an <code>Advice</code> can be an interceptor, before advice, throws advice, and others). Behind the scenes, Spring uses a <code>JdkRegexpMethodPointcut</code>. Using <code>RegexpMethodPointcutAdvisor</code> simplifies wiring, as the one bean encapsulates both pointcut and advice, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;settersAndAbsquatulateAdvisor&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.support.RegexpMethodPointcutAdvisor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;advice&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;beanNameOfAopAllianceInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;patterns&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>.*set.*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>.*absquatulate<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can use <code>RegexpMethodPointcutAdvisor</code> with any <code>Advice</code> type.</p>
<h6 id="Attribute-driven-Pointcuts"><a href="#Attribute-driven-Pointcuts" class="headerlink" title="Attribute-driven Pointcuts"></a>Attribute-driven Pointcuts</h6><p>An important type of static pointcut is a metadata-driven pointcut. This uses the values of metadata attributes (typically, source-level metadata).</p>
<h5 id="Dynamic-pointcuts"><a href="#Dynamic-pointcuts" class="headerlink" title="Dynamic pointcuts"></a>Dynamic pointcuts</h5><p>Dynamic pointcuts are costlier to evaluate than static pointcuts. They take into account method arguments as well as static information. This means that they must be evaluated with every method invocation and that the result cannot be cached, as arguments will vary.</p>
<p>The main example is the <code>control flow</code> pointcut.</p>
<h6 id="Control-Flow-Pointcuts"><a href="#Control-Flow-Pointcuts" class="headerlink" title="Control Flow Pointcuts"></a>Control Flow Pointcuts</h6><p>Spring control flow pointcuts are conceptually similar to AspectJ <code>cflow</code> pointcuts, although less powerful. (There is currently no way to specify that a pointcut runs below a join point matched by another pointcut.) A control flow pointcut matches the current call stack. For example, it might fire if the join point was invoked by a method in the <code>com.mycompany.web</code> package or by the <code>SomeCaller</code> class. Control flow pointcuts are specified by using the <code>org.springframework.aop.support.ControlFlowPointcut</code> class.</p>
<table>
<thead>
<tr>
<th></th>
<th>Control flow pointcuts are significantly more expensive to evaluate at runtime than even other dynamic pointcuts. In Java 1.4, the cost is about five times that of other dynamic pointcuts.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="6-1-5-Pointcut-Superclasses"><a href="#6-1-5-Pointcut-Superclasses" class="headerlink" title="6.1.5. Pointcut Superclasses"></a>6.1.5. Pointcut Superclasses</h4><p>Spring provides useful pointcut superclasses to help you to implement your own pointcuts.</p>
<p>Because static pointcuts are most useful, you should probably subclass <code>StaticMethodMatcherPointcut</code>. This requires implementing only one abstract method (although you can override other methods to customize behavior). The following example shows how to subclass <code>StaticMethodMatcherPointcut</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestStaticPointcut</span> <span class="keyword">extends</span> <span class="title class_">StaticMethodMatcherPointcut</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(Method m, Class targetClass)</span> &#123;</span><br><span class="line">        <span class="comment">// return true if custom criteria match</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There are also superclasses for dynamic pointcuts. You can use custom pointcuts with any advice type.</p>
<h4 id="6-1-6-Custom-Pointcuts"><a href="#6-1-6-Custom-Pointcuts" class="headerlink" title="6.1.6. Custom Pointcuts"></a>6.1.6. Custom Pointcuts</h4><p>Because pointcuts in Spring AOP are Java classes rather than language features (as in AspectJ), you can declare custom pointcuts, whether static or dynamic. Custom pointcuts in Spring can be arbitrarily complex. However, we recommend using the AspectJ pointcut expression language, if you can.</p>
<table>
<thead>
<tr>
<th></th>
<th>Later versions of Spring may offer support for “semantic pointcuts” as offered by JAC — for example, “all methods that change instance variables in the target object.”</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="6-2-Advice-API-in-Spring"><a href="#6-2-Advice-API-in-Spring" class="headerlink" title="6.2. Advice API in Spring"></a>6.2. Advice API in Spring</h3><p>Now we can examine how Spring AOP handles advice.</p>
<h4 id="6-2-1-Advice-Lifecycles"><a href="#6-2-1-Advice-Lifecycles" class="headerlink" title="6.2.1. Advice Lifecycles"></a>6.2.1. Advice Lifecycles</h4><p>Each advice is a Spring bean. An advice instance can be shared across all advised objects or be unique to each advised object. This corresponds to per-class or per-instance advice.</p>
<p>Per-class advice is used most often. It is appropriate for generic advice, such as transaction advisors. These do not depend on the state of the proxied object or add new state. They merely act on the method and arguments.</p>
<p>Per-instance advice is appropriate for introductions, to support mixins. In this case, the advice adds state to the proxied object.</p>
<p>You can use a mix of shared and per-instance advice in the same AOP proxy.</p>
<h4 id="6-2-2-Advice-Types-in-Spring"><a href="#6-2-2-Advice-Types-in-Spring" class="headerlink" title="6.2.2. Advice Types in Spring"></a>6.2.2. Advice Types in Spring</h4><p>Spring provides several advice types and is extensible to support arbitrary advice types. This section describes the basic concepts and standard advice types.</p>
<h5 id="Interception-Around-Advice"><a href="#Interception-Around-Advice" class="headerlink" title="Interception Around Advice"></a>Interception Around Advice</h5><p>The most fundamental advice type in Spring is interception around advice.</p>
<p>Spring is compliant with the AOP <code>Alliance</code> interface for around advice that uses method interception. Classes that implement <code>MethodInterceptor</code> and that implement around advice should also implement the following interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MethodInterceptor</span> <span class="keyword">extends</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>MethodInvocation</code> argument to the <code>invoke()</code> method exposes the method being invoked, the target join point, the AOP proxy, and the arguments to the method. The <code>invoke()</code> method should return the invocation’s result: the return value of the join point.</p>
<p>The following example shows a simple <code>MethodInterceptor</code> implementation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before: invocation=[&quot;</span> + invocation + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">rval</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;Invocation returned&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> rval;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note the call to the <code>proceed()</code> method of <code>MethodInvocation</code>. This proceeds down the interceptor chain towards the join point. Most interceptors invoke this method and return its return value. However, a <code>MethodInterceptor</code>, like any around advice, can return a different value or throw an exception rather than invoke the proceed method. However, you do not want to do this without good reason.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>MethodInterceptor</code> implementations offer interoperability with other AOP Alliance-compliant AOP implementations. The other advice types discussed in the remainder of this section implement common AOP concepts but in a Spring-specific way. While there is an advantage in using the most specific advice type, stick with <code>MethodInterceptor</code> around advice if you are likely to want to run the aspect in another AOP framework. Note that pointcuts are not currently interoperable between frameworks, and the AOP Alliance does not currently define pointcut interfaces.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Before-Advice-2"><a href="#Before-Advice-2" class="headerlink" title="Before Advice"></a>Before Advice</h5><p>A simpler advice type is a before advice. This does not need a <code>MethodInvocation</code> object, since it is called only before entering the method.</p>
<p>The main advantage of a before advice is that there is no need to invoke the <code>proceed()</code> method and, therefore, no possibility of inadvertently failing to proceed down the interceptor chain.</p>
<p>The following listing shows the <code>MethodBeforeAdvice</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MethodBeforeAdvice</span> <span class="keyword">extends</span> <span class="title class_">BeforeAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method m, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(Spring’s API design would allow for field before advice, although the usual objects apply to field interception and it is unlikely for Spring to ever implement it.)</p>
<p>Note that the return type is <code>void</code>. Before advice can insert custom behavior before the join point runs but cannot change the return value. If a before advice throws an exception, it stops further execution of the interceptor chain. The exception propagates back up the interceptor chain. If it is unchecked or on the signature of the invoked method, it is passed directly to the client. Otherwise, it is wrapped in an unchecked exception by the AOP proxy.</p>
<p>The following example shows a before advice in Spring, which counts all method invocations:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountingBeforeAdvice</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method m, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        ++count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Before advice can be used with any pointcut.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Throws-Advice"><a href="#Throws-Advice" class="headerlink" title="Throws Advice"></a>Throws Advice</h5><p>Throws advice is invoked after the return of the join point if the join point threw an exception. Spring offers typed throws advice. Note that this means that the <code>org.springframework.aop.ThrowsAdvice</code> interface does not contain any methods. It is a tag interface identifying that the given object implements one or more typed throws advice methods. These should be in the following form:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afterThrowing([Method, args, target], subclassOfThrowable)</span><br></pre></td></tr></table></figure>

<p>Only the last argument is required. The method signatures may have either one or four arguments, depending on whether the advice method is interested in the method and arguments. The next two listing show classes that are examples of throws advice.</p>
<p>The following advice is invoked if a <code>RemoteException</code> is thrown (including from subclasses):</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteThrowsAdvice</span> <span class="keyword">implements</span> <span class="title class_">ThrowsAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(RemoteException ex)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// Do something with remote exception</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Unlike the preceding advice, the next example declares four arguments, so that it has access to the invoked method, method arguments, and target object. The following advice is invoked if a <code>ServletException</code> is thrown:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletThrowsAdviceWithArguments</span> <span class="keyword">implements</span> <span class="title class_">ThrowsAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Method m, Object[] args, Object target, ServletException ex)</span> &#123;</span><br><span class="line">        <span class="comment">// Do something with all arguments</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The final example illustrates how these two methods could be used in a single class that handles both <code>RemoteException</code> and <code>ServletException</code>. Any number of throws advice methods can be combined in a single class. The following listing shows the final example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CombinedThrowsAdvice</span> <span class="keyword">implements</span> <span class="title class_">ThrowsAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(RemoteException ex)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// Do something with remote exception</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Method m, Object[] args, Object target, ServletException ex)</span> &#123;</span><br><span class="line">        <span class="comment">// Do something with all arguments</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>If a throws-advice method throws an exception itself, it overrides the original exception (that is, it changes the exception thrown to the user). The overriding exception is typically a RuntimeException, which is compatible with any method signature. However, if a throws-advice method throws a checked exception, it must match the declared exceptions of the target method and is, hence, to some degree coupled to specific target method signatures. <em>Do not throw an undeclared checked exception that is incompatible with the target method’s signature!</em></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>Throws advice can be used with any pointcut.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="After-Returning-Advice-2"><a href="#After-Returning-Advice-2" class="headerlink" title="After Returning Advice"></a>After Returning Advice</h5><p>An after returning advice in Spring must implement the <code>org.springframework.aop.AfterReturningAdvice</code> interface, which the following listing shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AfterReturningAdvice</span> <span class="keyword">extends</span> <span class="title class_">Advice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object returnValue, Method m, Object[] args, Object target)</span></span><br><span class="line">            <span class="keyword">throws</span> Throwable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>An after returning advice has access to the return value (which it cannot modify), the invoked method, the method’s arguments, and the target.</p>
<p>The following after returning advice counts all successful method invocations that have not thrown exceptions:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountingAfterReturningAdvice</span> <span class="keyword">implements</span> <span class="title class_">AfterReturningAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object returnValue, Method m, Object[] args, Object target)</span></span><br><span class="line">            <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        ++count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This advice does not change the execution path. If it throws an exception, it is thrown up the interceptor chain instead of the return value.</p>
<table>
<thead>
<tr>
<th></th>
<th>After returning advice can be used with any pointcut.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Introduction-Advice"><a href="#Introduction-Advice" class="headerlink" title="Introduction Advice"></a>Introduction Advice</h5><p>Spring treats introduction advice as a special kind of interception advice.</p>
<p>Introduction requires an <code>IntroductionAdvisor</code> and an <code>IntroductionInterceptor</code> that implement the following interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IntroductionInterceptor</span> <span class="keyword">extends</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">implementsInterface</span><span class="params">(Class intf)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>invoke()</code> method inherited from the AOP Alliance <code>MethodInterceptor</code> interface must implement the introduction. That is, if the invoked method is on an introduced interface, the introduction interceptor is responsible for handling the method call — it cannot invoke <code>proceed()</code>.</p>
<p>Introduction advice cannot be used with any pointcut, as it applies only at the class, rather than the method, level. You can only use introduction advice with the <code>IntroductionAdvisor</code>, which has the following methods:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IntroductionAdvisor</span> <span class="keyword">extends</span> <span class="title class_">Advisor</span>, IntroductionInfo &#123;</span><br><span class="line"></span><br><span class="line">    ClassFilter <span class="title function_">getClassFilter</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">validateInterfaces</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IntroductionInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] getInterfaces();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There is no <code>MethodMatcher</code> and, hence, no <code>Pointcut</code> associated with introduction advice. Only class filtering is logical.</p>
<p>The <code>getInterfaces()</code> method returns the interfaces introduced by this advisor.</p>
<p>The <code>validateInterfaces()</code> method is used internally to see whether or not the introduced interfaces can be implemented by the configured <code>IntroductionInterceptor</code>.</p>
<p>Consider an example from the Spring test suite and suppose we want to introduce the following interface to one or more objects:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Lockable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">locked</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This illustrates a mixin. We want to be able to cast advised objects to <code>Lockable</code>, whatever their type and call lock and unlock methods. If we call the <code>lock()</code> method, we want all setter methods to throw a <code>LockedException</code>. Thus, we can add an aspect that provides the ability to make objects immutable without them having any knowledge of it: a good example of AOP.</p>
<p>First, we need an <code>IntroductionInterceptor</code> that does the heavy lifting. In this case, we extend the <code>org.springframework.aop.support.DelegatingIntroductionInterceptor</code> convenience class. We could implement <code>IntroductionInterceptor</code> directly, but using <code>DelegatingIntroductionInterceptor</code> is best for most cases.</p>
<p>The <code>DelegatingIntroductionInterceptor</code> is designed to delegate an introduction to an actual implementation of the introduced interfaces, concealing the use of interception to do so. You can set the delegate to any object using a constructor argument. The default delegate (when the no-argument constructor is used) is <code>this</code>. Thus, in the next example, the delegate is the <code>LockMixin</code> subclass of <code>DelegatingIntroductionInterceptor</code>. Given a delegate (by default, itself), a <code>DelegatingIntroductionInterceptor</code> instance looks for all interfaces implemented by the delegate (other than <code>IntroductionInterceptor</code>) and supports introductions against any of them. Subclasses such as <code>LockMixin</code> can call the <code>suppressInterface(Class intf)</code> method to suppress interfaces that should not be exposed. However, no matter how many interfaces an <code>IntroductionInterceptor</code> is prepared to support, the <code>IntroductionAdvisor</code> used controls which interfaces are actually exposed. An introduced interface conceals any implementation of the same interface by the target.</p>
<p>Thus, <code>LockMixin</code> extends <code>DelegatingIntroductionInterceptor</code> and implements <code>Lockable</code> itself. The superclass automatically picks up that <code>Lockable</code> can be supported for introduction, so we do not need to specify that. We could introduce any number of interfaces in this way.</p>
<p>Note the use of the <code>locked</code> instance variable. This effectively adds additional state to that held in the target object.</p>
<p>The following example shows the example <code>LockMixin</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockMixin</span> <span class="keyword">extends</span> <span class="title class_">DelegatingIntroductionInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Lockable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> locked;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.locked = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.locked = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">locked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.locked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="string">&quot;set&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LockedException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.invoke(invocation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Often, you need not override the <code>invoke()</code> method. The <code>DelegatingIntroductionInterceptor</code> implementation (which calls the <code>delegate</code> method if the method is introduced, otherwise proceeds towards the join point) usually suffices. In the present case, we need to add a check: no setter method can be invoked if in locked mode.</p>
<p>The required introduction only needs to hold a distinct <code>LockMixin</code> instance and specify the introduced interfaces (in this case, only <code>Lockable</code>). A more complex example might take a reference to the introduction interceptor (which would be defined as a prototype). In this case, there is no configuration relevant for a <code>LockMixin</code>, so we create it by using <code>new</code>. The following example shows our <code>LockMixinAdvisor</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockMixinAdvisor</span> <span class="keyword">extends</span> <span class="title class_">DefaultIntroductionAdvisor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LockMixinAdvisor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">LockMixin</span>(), Lockable.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can apply this advisor very simply, because it requires no configuration. (However, it is impossible to use an <code>IntroductionInterceptor</code> without an <code>IntroductionAdvisor</code>.) As usual with introductions, the advisor must be per-instance, as it is stateful. We need a different instance of <code>LockMixinAdvisor</code>, and hence <code>LockMixin</code>, for each advised object. The advisor comprises part of the advised object’s state.</p>
<p>We can apply this advisor programmatically by using the <code>Advised.addAdvisor()</code> method or (the recommended way) in XML configuration, as any other advisor. All proxy creation choices discussed below, including “auto proxy creators,” correctly handle introductions and stateful mixins.</p>
<h3 id="6-3-The-Advisor-API-in-Spring"><a href="#6-3-The-Advisor-API-in-Spring" class="headerlink" title="6.3. The Advisor API in Spring"></a>6.3. The Advisor API in Spring</h3><p>In Spring, an Advisor is an aspect that contains only a single advice object associated with a pointcut expression.</p>
<p>Apart from the special case of introductions, any advisor can be used with any advice. <code>org.springframework.aop.support.DefaultPointcutAdvisor</code> is the most commonly used advisor class. It can be used with a <code>MethodInterceptor</code>, <code>BeforeAdvice</code>, or <code>ThrowsAdvice</code>.</p>
<p>It is possible to mix advisor and advice types in Spring in the same AOP proxy. For example, you could use an interception around advice, throws advice, and before advice in one proxy configuration. Spring automatically creates the necessary interceptor chain.</p>
<h3 id="6-4-Using-the-ProxyFactoryBean-to-Create-AOP-Proxies"><a href="#6-4-Using-the-ProxyFactoryBean-to-Create-AOP-Proxies" class="headerlink" title="6.4. Using the ProxyFactoryBean to Create AOP Proxies"></a>6.4. Using the <code>ProxyFactoryBean</code> to Create AOP Proxies</h3><p>If you use the Spring IoC container (an <code>ApplicationContext</code> or <code>BeanFactory</code>) for your business objects (and you should be!), you want to use one of Spring’s AOP <code>FactoryBean</code> implementations. (Remember that a factory bean introduces a layer of indirection, letting it create objects of a different type.)</p>
<table>
<thead>
<tr>
<th></th>
<th>The Spring AOP support also uses factory beans under the covers.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The basic way to create an AOP proxy in Spring is to use the <code>org.springframework.aop.framework.ProxyFactoryBean</code>. This gives complete control over the pointcuts, any advice that applies, and their ordering. However, there are simpler options that are preferable if you do not need such control.</p>
<h4 id="6-4-1-Basics"><a href="#6-4-1-Basics" class="headerlink" title="6.4.1. Basics"></a>6.4.1. Basics</h4><p>The <code>ProxyFactoryBean</code>, like other Spring <code>FactoryBean</code> implementations, introduces a level of indirection. If you define a <code>ProxyFactoryBean</code> named <code>foo</code>, objects that reference <code>foo</code> do not see the <code>ProxyFactoryBean</code> instance itself but an object created by the implementation of the <code>getObject()</code> method in the <code>ProxyFactoryBean</code> . This method creates an AOP proxy that wraps a target object.</p>
<p>One of the most important benefits of using a <code>ProxyFactoryBean</code> or another IoC-aware class to create AOP proxies is that advices and pointcuts can also be managed by IoC. This is a powerful feature, enabling certain approaches that are hard to achieve with other AOP frameworks. For example, an advice may itself reference application objects (besides the target, which should be available in any AOP framework), benefiting from all the pluggability provided by Dependency Injection.</p>
<h4 id="6-4-2-JavaBean-Properties"><a href="#6-4-2-JavaBean-Properties" class="headerlink" title="6.4.2. JavaBean Properties"></a>6.4.2. JavaBean Properties</h4><p>In common with most <code>FactoryBean</code> implementations provided with Spring, the <code>ProxyFactoryBean</code> class is itself a JavaBean. Its properties are used to:</p>
<ul>
<li>Specify the target you want to proxy.</li>
<li>Specify whether to use CGLIB (described later and see also <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-pfb-proxy-types">JDK- and CGLIB-based proxies</a>).</li>
</ul>
<p>Some key properties are inherited from <code>org.springframework.aop.framework.ProxyConfig</code> (the superclass for all AOP proxy factories in Spring). These key properties include the following:</p>
<ul>
<li><code>proxyTargetClass</code>: <code>true</code> if the target class is to be proxied, rather than the target class’s interfaces. If this property value is set to <code>true</code>, then CGLIB proxies are created (but see also <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-pfb-proxy-types">JDK- and CGLIB-based proxies</a>).</li>
<li><code>optimize</code>: Controls whether or not aggressive optimizations are applied to proxies created through CGLIB. You should not blithely use this setting unless you fully understand how the relevant AOP proxy handles optimization. This is currently used only for CGLIB proxies. It has no effect with JDK dynamic proxies.</li>
<li><code>frozen</code>: If a proxy configuration is <code>frozen</code>, changes to the configuration are no longer allowed. This is useful both as a slight optimization and for those cases when you do not want callers to be able to manipulate the proxy (through the <code>Advised</code> interface) after the proxy has been created. The default value of this property is <code>false</code>, so changes (such as adding additional advice) are allowed.</li>
<li><code>exposeProxy</code>: Determines whether or not the current proxy should be exposed in a <code>ThreadLocal</code> so that it can be accessed by the target. If a target needs to obtain the proxy and the <code>exposeProxy</code> property is set to <code>true</code>, the target can use the <code>AopContext.currentProxy()</code> method.</li>
</ul>
<p>Other properties specific to <code>ProxyFactoryBean</code> include the following:</p>
<ul>
<li><p><code>proxyInterfaces</code>: An array of <code>String</code> interface names. If this is not supplied, a CGLIB proxy for the target class is used (but see also <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-pfb-proxy-types">JDK- and CGLIB-based proxies</a>).</p>
</li>
<li><p><code>interceptorNames</code>: A <code>String</code> array of <code>Advisor</code>, interceptor, or other advice names to apply. Ordering is significant, on a first come-first served basis. That is to say that the first interceptor in the list is the first to be able to intercept the invocation.</p>
<p>The names are bean names in the current factory, including bean names from ancestor factories. You cannot mention bean references here, since doing so results in the <code>ProxyFactoryBean</code> ignoring the singleton setting of the advice.</p>
<p>You can append an interceptor name with an asterisk (<code>*</code>). Doing so results in the application of all advisor beans with names that start with the part before the asterisk to be applied. You can find an example of using this feature in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-global-advisors">Using “Global” Advisors</a>.</p>
</li>
<li><p>singleton: Whether or not the factory should return a single object, no matter how often the <code>getObject()</code> method is called. Several <code>FactoryBean</code> implementations offer such a method. The default value is <code>true</code>. If you want to use stateful advice - for example, for stateful mixins - use prototype advices along with a singleton value of <code>false</code>.</p>
</li>
</ul>
<h4 id="6-4-3-JDK-and-CGLIB-based-proxies"><a href="#6-4-3-JDK-and-CGLIB-based-proxies" class="headerlink" title="6.4.3. JDK- and CGLIB-based proxies"></a>6.4.3. JDK- and CGLIB-based proxies</h4><p>This section serves as the definitive documentation on how the <code>ProxyFactoryBean</code> chooses to create either a JDK-based proxy or a CGLIB-based proxy for a particular target object (which is to be proxied).</p>
<table>
<thead>
<tr>
<th></th>
<th>The behavior of the <code>ProxyFactoryBean</code> with regard to creating JDK- or CGLIB-based proxies changed between versions 1.2.x and 2.0 of Spring. The <code>ProxyFactoryBean</code> now exhibits similar semantics with regard to auto-detecting interfaces as those of the <code>TransactionProxyFactoryBean</code> class.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>If the class of a target object that is to be proxied (hereafter simply referred to as the target class) does not implement any interfaces, a CGLIB-based proxy is created. This is the easiest scenario, because JDK proxies are interface-based, and no interfaces means JDK proxying is not even possible. You can plug in the target bean and specify the list of interceptors by setting the <code>interceptorNames</code> property. Note that a CGLIB-based proxy is created even if the <code>proxyTargetClass</code> property of the <code>ProxyFactoryBean</code> has been set to <code>false</code>. (Doing so makes no sense and is best removed from the bean definition, because it is, at best, redundant, and, at worst confusing.)</p>
<p>If the target class implements one (or more) interfaces, the type of proxy that is created depends on the configuration of the <code>ProxyFactoryBean</code>.</p>
<p>If the <code>proxyTargetClass</code> property of the <code>ProxyFactoryBean</code> has been set to <code>true</code>, a CGLIB-based proxy is created. This makes sense and is in keeping with the principle of least surprise. Even if the <code>proxyInterfaces</code> property of the <code>ProxyFactoryBean</code> has been set to one or more fully qualified interface names, the fact that the <code>proxyTargetClass</code> property is set to <code>true</code> causes CGLIB-based proxying to be in effect.</p>
<p>If the <code>proxyInterfaces</code> property of the <code>ProxyFactoryBean</code> has been set to one or more fully qualified interface names, a JDK-based proxy is created. The created proxy implements all of the interfaces that were specified in the <code>proxyInterfaces</code> property. If the target class happens to implement a whole lot more interfaces than those specified in the <code>proxyInterfaces</code> property, that is all well and good, but those additional interfaces are not implemented by the returned proxy.</p>
<p>If the <code>proxyInterfaces</code> property of the <code>ProxyFactoryBean</code> has not been set, but the target class does implement one (or more) interfaces, the <code>ProxyFactoryBean</code> auto-detects the fact that the target class does actually implement at least one interface, and a JDK-based proxy is created. The interfaces that are actually proxied are all of the interfaces that the target class implements. In effect, this is the same as supplying a list of each and every interface that the target class implements to the <code>proxyInterfaces</code> property. However, it is significantly less work and less prone to typographical errors.</p>
<h4 id="6-4-4-Proxying-Interfaces"><a href="#6-4-4-Proxying-Interfaces" class="headerlink" title="6.4.4. Proxying Interfaces"></a>6.4.4. Proxying Interfaces</h4><p>Consider a simple example of <code>ProxyFactoryBean</code> in action. This example involves:</p>
<ul>
<li>A target bean that is proxied. This is the <code>personTarget</code> bean definition in the example.</li>
<li>An <code>Advisor</code> and an <code>Interceptor</code> used to provide advice.</li>
<li>An AOP proxy bean definition to specify the target object (the <code>personTarget</code> bean), the interfaces to proxy, and the advices to apply.</li>
</ul>
<p>The following listing shows the example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;personTarget&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.PersonImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Tony&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;51&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAdvisor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.MyAdvisor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;someProperty&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Custom string property value&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;debugInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;proxyInterfaces&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mycompany.Person&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;personTarget&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptorNames&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>myAdvisor<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>debugInterceptor<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that the <code>interceptorNames</code> property takes a list of <code>String</code>, which holds the bean names of the interceptors or advisors in the current factory. You can use advisors, interceptors, before, after returning, and throws advice objects. The ordering of advisors is significant.</p>
<table>
<thead>
<tr>
<th></th>
<th>You might be wondering why the list does not hold bean references. The reason for this is that, if the singleton property of the <code>ProxyFactoryBean</code> is set to <code>false</code>, it must be able to return independent proxy instances. If any of the advisors is itself a prototype, an independent instance would need to be returned, so it is necessary to be able to obtain an instance of the prototype from the factory. Holding a reference is not sufficient.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The <code>person</code> bean definition shown earlier can be used in place of a <code>Person</code> implementation, as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) factory.getBean(<span class="string">&quot;person&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Other beans in the same IoC context can express a strongly typed dependency on it, as with an ordinary Java object. The following example shows how to do so:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;personUser&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.PersonUser&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;person&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;person&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>PersonUser</code> class in this example exposes a property of type <code>Person</code>. As far as it is concerned, the AOP proxy can be used transparently in place of a “real” person implementation. However, its class would be a dynamic proxy class. It would be possible to cast it to the <code>Advised</code> interface (discussed later).</p>
<p>You can conceal the distinction between target and proxy by using an anonymous inner bean. Only the <code>ProxyFactoryBean</code> definition is different. The advice is included only for completeness. The following example shows how to use an anonymous inner bean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAdvisor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.MyAdvisor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;someProperty&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Custom string property value&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;debugInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;proxyInterfaces&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mycompany.Person&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Use inner bean, not local reference to target --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.PersonImpl&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Tony&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;51&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptorNames&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>myAdvisor<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>debugInterceptor<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Using an anonymous inner bean has the advantage that there is only one object of type <code>Person</code>. This is useful if we want to prevent users of the application context from obtaining a reference to the un-advised object or need to avoid any ambiguity with Spring IoC autowiring. There is also, arguably, an advantage in that the <code>ProxyFactoryBean</code> definition is self-contained. However, there are times when being able to obtain the un-advised target from the factory might actually be an advantage (for example, in certain test scenarios).</p>
<h4 id="6-4-5-Proxying-Classes"><a href="#6-4-5-Proxying-Classes" class="headerlink" title="6.4.5. Proxying Classes"></a>6.4.5. Proxying Classes</h4><p>What if you need to proxy a class, rather than one or more interfaces?</p>
<p>Imagine that in our earlier example, there was no <code>Person</code> interface. We needed to advise a class called <code>Person</code> that did not implement any business interface. In this case, you can configure Spring to use CGLIB proxying rather than dynamic proxies. To do so, set the <code>proxyTargetClass</code> property on the <code>ProxyFactoryBean</code> shown earlier to <code>true</code>. While it is best to program to interfaces rather than classes, the ability to advise classes that do not implement interfaces can be useful when working with legacy code. (In general, Spring is not prescriptive. While it makes it easy to apply good practices, it avoids forcing a particular approach.)</p>
<p>If you want to, you can force the use of CGLIB in any case, even if you do have interfaces.</p>
<p>CGLIB proxying works by generating a subclass of the target class at runtime. Spring configures this generated subclass to delegate method calls to the original target. The subclass is used to implement the Decorator pattern, weaving in the advice.</p>
<p>CGLIB proxying should generally be transparent to users. However, there are some issues to consider:</p>
<ul>
<li><code>Final</code> methods cannot be advised, as they cannot be overridden.</li>
<li>There is no need to add CGLIB to your classpath. As of Spring 3.2, CGLIB is repackaged and included in the spring-core JAR. In other words, CGLIB-based AOP works “out of the box”, as do JDK dynamic proxies.</li>
</ul>
<p>There is little performance difference between CGLIB proxying and dynamic proxies. Performance should not be a decisive consideration in this case.</p>
<h4 id="6-4-6-Using-“Global”-Advisors"><a href="#6-4-6-Using-“Global”-Advisors" class="headerlink" title="6.4.6. Using “Global” Advisors"></a>6.4.6. Using “Global” Advisors</h4><p>By appending an asterisk to an interceptor name, all advisors with bean names that match the part before the asterisk are added to the advisor chain. This can come in handy if you need to add a standard set of “global” advisors. The following example defines two global advisors:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;proxy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;service&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptorNames&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>global*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;global_debug&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;global_performance&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.interceptor.PerformanceMonitorInterceptor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-Concise-Proxy-Definitions"><a href="#6-5-Concise-Proxy-Definitions" class="headerlink" title="6.5. Concise Proxy Definitions"></a>6.5. Concise Proxy Definitions</h3><p>Especially when defining transactional proxies, you may end up with many similar proxy definitions. The use of parent and child bean definitions, along with inner bean definitions, can result in much cleaner and more concise proxy definitions.</p>
<p>First, we create a parent, template, bean definition for the proxy, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txProxyTemplate&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionAttributes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;*&quot;</span>&gt;</span>PROPAGATION_REQUIRED<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This is never instantiated itself, so it can actually be incomplete. Then, each proxy that needs to be created is a child bean definition, which wraps the target of the proxy as an inner bean definition, since the target is never used on its own anyway. The following example shows such a child bean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myService&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;txProxyTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.samples.MyServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can override properties from the parent template. In the following example, we override the transaction propagation settings:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mySpecialService&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;txProxyTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.samples.MySpecialServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionAttributes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;get*&quot;</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;find*&quot;</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;load*&quot;</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;store*&quot;</span>&gt;</span>PROPAGATION_REQUIRED<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that in the parent bean example, we explicitly marked the parent bean definition as being abstract by setting the <code>abstract</code> attribute to <code>true</code>, as described <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-child-bean-definitions">previously</a>, so that it may not actually ever be instantiated. Application contexts (but not simple bean factories), by default, pre-instantiate all singletons. Therefore, it is important (at least for singleton beans) that, if you have a (parent) bean definition that you intend to use only as a template, and this definition specifies a class, you must make sure to set the <code>abstract</code> attribute to <code>true</code>. Otherwise, the application context actually tries to pre-instantiate it.</p>
<h3 id="6-6-Creating-AOP-Proxies-Programmatically-with-the-ProxyFactory"><a href="#6-6-Creating-AOP-Proxies-Programmatically-with-the-ProxyFactory" class="headerlink" title="6.6. Creating AOP Proxies Programmatically with the ProxyFactory"></a>6.6. Creating AOP Proxies Programmatically with the <code>ProxyFactory</code></h3><p>It is easy to create AOP proxies programmatically with Spring. This lets you use Spring AOP without dependency on Spring IoC.</p>
<p>The interfaces implemented by the target object are automatically proxied. The following listing shows creation of a proxy for a target object, with one interceptor and one advisor:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProxyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyFactory</span>(myBusinessInterfaceImpl);</span><br><span class="line">factory.addAdvice(myMethodInterceptor);</span><br><span class="line">factory.addAdvisor(myAdvisor);</span><br><span class="line"><span class="type">MyBusinessInterface</span> <span class="variable">tb</span> <span class="operator">=</span> (MyBusinessInterface) factory.getProxy();</span><br></pre></td></tr></table></figure>

<p>The first step is to construct an object of type <code>org.springframework.aop.framework.ProxyFactory</code>. You can create this with a target object, as in the preceding example, or specify the interfaces to be proxied in an alternate constructor.</p>
<p>You can add advices (with interceptors as a specialized kind of advice), advisors, or both and manipulate them for the life of the <code>ProxyFactory</code>. If you add an <code>IntroductionInterceptionAroundAdvisor</code>, you can cause the proxy to implement additional interfaces.</p>
<p>There are also convenience methods on <code>ProxyFactory</code> (inherited from <code>AdvisedSupport</code>) that let you add other advice types, such as before and throws advice. <code>AdvisedSupport</code> is the superclass of both <code>ProxyFactory</code> and <code>ProxyFactoryBean</code>.</p>
<table>
<thead>
<tr>
<th></th>
<th>Integrating AOP proxy creation with the IoC framework is best practice in most applications. We recommend that you externalize configuration from Java code with AOP, as you should in general.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="6-7-Manipulating-Advised-Objects"><a href="#6-7-Manipulating-Advised-Objects" class="headerlink" title="6.7. Manipulating Advised Objects"></a>6.7. Manipulating Advised Objects</h3><p>However you create AOP proxies, you can manipulate them BY using the <code>org.springframework.aop.framework.Advised</code> interface. Any AOP proxy can be cast to this interface, no matter which other interfaces it implements. This interface includes the following methods:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Advisor[] getAdvisors();</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addAdvice</span><span class="params">(Advice advice)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addAdvice</span><span class="params">(<span class="type">int</span> pos, Advice advice)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addAdvisor</span><span class="params">(Advisor advisor)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addAdvisor</span><span class="params">(<span class="type">int</span> pos, Advisor advisor)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Advisor advisor)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeAdvisor</span><span class="params">(Advisor advisor)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeAdvisor</span><span class="params">(<span class="type">int</span> index)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">replaceAdvisor</span><span class="params">(Advisor a, Advisor b)</span> <span class="keyword">throws</span> AopConfigException;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isFrozen</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>The <code>getAdvisors()</code> method returns an <code>Advisor</code> for every advisor, interceptor, or other advice type that has been added to the factory. If you added an <code>Advisor</code>, the returned advisor at this index is the object that you added. If you added an interceptor or other advice type, Spring wrapped this in an advisor with a pointcut that always returns <code>true</code>. Thus, if you added a <code>MethodInterceptor</code>, the advisor returned for this index is a <code>DefaultPointcutAdvisor</code> that returns your <code>MethodInterceptor</code> and a pointcut that matches all classes and methods.</p>
<p>The <code>addAdvisor()</code> methods can be used to add any <code>Advisor</code>. Usually, the advisor holding pointcut and advice is the generic <code>DefaultPointcutAdvisor</code>, which you can use with any advice or pointcut (but not for introductions).</p>
<p>By default, it is possible to add or remove advisors or interceptors even once a proxy has been created. The only restriction is that it is impossible to add or remove an introduction advisor, as existing proxies from the factory do not show the interface change. (You can obtain a new proxy from the factory to avoid this problem.)</p>
<p>The following example shows casting an AOP proxy to the <code>Advised</code> interface and examining and manipulating its advice:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Advised</span> <span class="variable">advised</span> <span class="operator">=</span> (Advised) myObject;</span><br><span class="line">Advisor[] advisors = advised.getAdvisors();</span><br><span class="line"><span class="type">int</span> <span class="variable">oldAdvisorCount</span> <span class="operator">=</span> advisors.length;</span><br><span class="line">System.out.println(oldAdvisorCount + <span class="string">&quot; advisors&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add an advice like an interceptor without a pointcut</span></span><br><span class="line"><span class="comment">// Will match all proxied methods</span></span><br><span class="line"><span class="comment">// Can use for interceptors, before, after returning or throws advice</span></span><br><span class="line">advised.addAdvice(<span class="keyword">new</span> <span class="title class_">DebugInterceptor</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add selective advice using a pointcut</span></span><br><span class="line">advised.addAdvisor(<span class="keyword">new</span> <span class="title class_">DefaultPointcutAdvisor</span>(mySpecialPointcut, myAdvice));</span><br><span class="line"></span><br><span class="line">assertEquals(<span class="string">&quot;Added two advisors&quot;</span>, oldAdvisorCount + <span class="number">2</span>, advised.getAdvisors().length);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>It is questionable whether it is advisable (no pun intended) to modify advice on a business object in production, although there are, no doubt, legitimate usage cases. However, it can be very useful in development (for example, in tests). We have sometimes found it very useful to be able to add test code in the form of an interceptor or other advice, getting inside a method invocation that we want to test. (For example, the advice can get inside a transaction created for that method, perhaps to run SQL to check that a database was correctly updated, before marking the transaction for roll back.)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Depending on how you created the proxy, you can usually set a <code>frozen</code> flag. In that case, the <code>Advised</code> <code>isFrozen()</code> method returns <code>true</code>, and any attempts to modify advice through addition or removal results in an <code>AopConfigException</code>. The ability to freeze the state of an advised object is useful in some cases (for example, to prevent calling code removing a security interceptor).</p>
<h3 id="6-8-Using-the-“auto-proxy”-facility"><a href="#6-8-Using-the-“auto-proxy”-facility" class="headerlink" title="6.8. Using the “auto-proxy” facility"></a>6.8. Using the “auto-proxy” facility</h3><p>So far, we have considered explicit creation of AOP proxies by using a <code>ProxyFactoryBean</code> or similar factory bean.</p>
<p>Spring also lets us use “auto-proxy” bean definitions, which can automatically proxy selected bean definitions. This is built on Spring’s “bean post processor” infrastructure, which enables modification of any bean definition as the container loads.</p>
<p>In this model, you set up some special bean definitions in your XML bean definition file to configure the auto-proxy infrastructure. This lets you declare the targets eligible for auto-proxying. You need not use <code>ProxyFactoryBean</code>.</p>
<p>There are two ways to do this:</p>
<ul>
<li>By using an auto-proxy creator that refers to specific beans in the current context.</li>
<li>A special case of auto-proxy creation that deserves to be considered separately: auto-proxy creation driven by source-level metadata attributes.</li>
</ul>
<h4 id="6-8-1-Auto-proxy-Bean-Definitions"><a href="#6-8-1-Auto-proxy-Bean-Definitions" class="headerlink" title="6.8.1. Auto-proxy Bean Definitions"></a>6.8.1. Auto-proxy Bean Definitions</h4><p>This section covers the auto-proxy creators provided by the <code>org.springframework.aop.framework.autoproxy</code> package.</p>
<h5 id="BeanNameAutoProxyCreator"><a href="#BeanNameAutoProxyCreator" class="headerlink" title="BeanNameAutoProxyCreator"></a><code>BeanNameAutoProxyCreator</code></h5><p>The <code>BeanNameAutoProxyCreator</code> class is a <code>BeanPostProcessor</code> that automatically creates AOP proxies for beans with names that match literal values or wildcards. The following example shows how to create a <code>BeanNameAutoProxyCreator</code> bean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;beanNames&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdk*,onlyJdk&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptorNames&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>myInterceptor<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>As with <code>ProxyFactoryBean</code>, there is an <code>interceptorNames</code> property rather than a list of interceptors, to allow correct behavior for prototype advisors. Named “interceptors” can be advisors or any advice type.</p>
<p>As with auto-proxying in general, the main point of using <code>BeanNameAutoProxyCreator</code> is to apply the same configuration consistently to multiple objects, with minimal volume of configuration. It is a popular choice for applying declarative transactions to multiple objects.</p>
<p>Bean definitions whose names match, such as <code>jdkMyBean</code> and <code>onlyJdk</code> in the preceding example, are plain old bean definitions with the target class. An AOP proxy is automatically created by the <code>BeanNameAutoProxyCreator</code>. The same advice is applied to all matching beans. Note that, if advisors are used (rather than the interceptor in the preceding example), the pointcuts may apply differently to different beans.</p>
<h5 id="DefaultAdvisorAutoProxyCreator"><a href="#DefaultAdvisorAutoProxyCreator" class="headerlink" title="DefaultAdvisorAutoProxyCreator"></a><code>DefaultAdvisorAutoProxyCreator</code></h5><p>A more general and extremely powerful auto-proxy creator is <code>DefaultAdvisorAutoProxyCreator</code>. This automagically applies eligible advisors in the current context, without the need to include specific bean names in the auto-proxy advisor’s bean definition. It offers the same merit of consistent configuration and avoidance of duplication as <code>BeanNameAutoProxyCreator</code>.</p>
<p>Using this mechanism involves:</p>
<ul>
<li>Specifying a <code>DefaultAdvisorAutoProxyCreator</code> bean definition.</li>
<li>Specifying any number of advisors in the same or related contexts. Note that these must be advisors, not interceptors or other advices. This is necessary, because there must be a pointcut to evaluate, to check the eligibility of each advice to candidate bean definitions.</li>
</ul>
<p>The <code>DefaultAdvisorAutoProxyCreator</code> automatically evaluates the pointcut contained in each advisor, to see what (if any) advice it should apply to each business object (such as <code>businessObject1</code> and <code>businessObject2</code> in the example).</p>
<p>This means that any number of advisors can be applied automatically to each business object. If no pointcut in any of the advisors matches any method in a business object, the object is not proxied. As bean definitions are added for new business objects, they are automatically proxied if necessary.</p>
<p>Auto-proxying in general has the advantage of making it impossible for callers or dependencies to obtain an un-advised object. Calling <code>getBean(&quot;businessObject1&quot;)</code> on this <code>ApplicationContext</code> returns an AOP proxy, not the target business object. (The “inner bean” idiom shown earlier also offers this benefit.)</p>
<p>The following example creates a <code>DefaultAdvisorAutoProxyCreator</code> bean and the other elements discussed in this section:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionInterceptor&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;transactionInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;customAdvisor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.MyAdvisor&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;businessObject1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.BusinessObject1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Properties omitted --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;businessObject2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.BusinessObject2&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The <code>DefaultAdvisorAutoProxyCreator</code> is very useful if you want to apply the same advice consistently to many business objects. Once the infrastructure definitions are in place, you can add new business objects without including specific proxy configuration. You can also easily drop in additional aspects (for example, tracing or performance monitoring aspects) with minimal change to configuration.</p>
<p>The <code>DefaultAdvisorAutoProxyCreator</code> offers support for filtering (by using a naming convention so that only certain advisors are evaluated, which allows the use of multiple, differently configured, AdvisorAutoProxyCreators in the same factory) and ordering. Advisors can implement the <code>org.springframework.core.Ordered</code> interface to ensure correct ordering if this is an issue. The <code>TransactionAttributeSourceAdvisor</code> used in the preceding example has a configurable order value. The default setting is unordered.</p>
<h3 id="6-9-Using-TargetSource-Implementations"><a href="#6-9-Using-TargetSource-Implementations" class="headerlink" title="6.9. Using TargetSource Implementations"></a>6.9. Using <code>TargetSource</code> Implementations</h3><p>Spring offers the concept of a <code>TargetSource</code>, expressed in the <code>org.springframework.aop.TargetSource</code> interface. This interface is responsible for returning the “target object” that implements the join point. The <code>TargetSource</code> implementation is asked for a target instance each time the AOP proxy handles a method invocation.</p>
<p>Developers who use Spring AOP do not normally need to work directly with <code>TargetSource</code> implementations, but this provides a powerful means of supporting pooling, hot swappable, and other sophisticated targets. For example, a pooling <code>TargetSource</code> can return a different target instance for each invocation, by using a pool to manage instances.</p>
<p>If you do not specify a <code>TargetSource</code>, a default implementation is used to wrap a local object. The same target is returned for each invocation (as you would expect).</p>
<p>The rest of this section describes the standard target sources provided with Spring and how you can use them.</p>
<table>
<thead>
<tr>
<th></th>
<th>When using a custom target source, your target will usually need to be a prototype rather than a singleton bean definition. This allows Spring to create a new target instance when required.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="6-9-1-Hot-swappable-Target-Sources"><a href="#6-9-1-Hot-swappable-Target-Sources" class="headerlink" title="6.9.1. Hot-swappable Target Sources"></a>6.9.1. Hot-swappable Target Sources</h4><p>The <code>org.springframework.aop.target.HotSwappableTargetSource</code> exists to let the target of an AOP proxy be switched while letting callers keep their references to it.</p>
<p>Changing the target source’s target takes effect immediately. The <code>HotSwappableTargetSource</code> is thread-safe.</p>
<p>You can change the target by using the <code>swap()</code> method on HotSwappableTargetSource, as the follow example shows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HotSwappableTargetSource</span> <span class="variable">swapper</span> <span class="operator">=</span> (HotSwappableTargetSource) beanFactory.getBean(<span class="string">&quot;swapper&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">oldTarget</span> <span class="operator">=</span> swapper.swap(newTarget);</span><br></pre></td></tr></table></figure>

<p>The following example shows the required XML definitions:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;initialTarget&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mycompany.OldTarget&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;swapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.target.HotSwappableTargetSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;initialTarget&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;swappable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;swapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding <code>swap()</code> call changes the target of the swappable bean. Clients that hold a reference to that bean are unaware of the change but immediately start hitting the new target.</p>
<p>Although this example does not add any advice (it is not necessary to add advice to use a <code>TargetSource</code>), any <code>TargetSource</code> can be used in conjunction with arbitrary advice.</p>
<h4 id="6-9-2-Pooling-Target-Sources"><a href="#6-9-2-Pooling-Target-Sources" class="headerlink" title="6.9.2. Pooling Target Sources"></a>6.9.2. Pooling Target Sources</h4><p>Using a pooling target source provides a similar programming model to stateless session EJBs, in which a pool of identical instances is maintained, with method invocations going to free objects in the pool.</p>
<p>A crucial difference between Spring pooling and SLSB pooling is that Spring pooling can be applied to any POJO. As with Spring in general, this service can be applied in a non-invasive way.</p>
<p>Spring provides support for Commons Pool 2.2, which provides a fairly efficient pooling implementation. You need the <code>commons-pool</code> Jar on your application’s classpath to use this feature. You can also subclass <code>org.springframework.aop.target.AbstractPoolingTargetSource</code> to support any other pooling API.</p>
<table>
<thead>
<tr>
<th></th>
<th>Commons Pool 1.5+ is also supported but is deprecated as of Spring Framework 4.2.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The following listing shows an example configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;businessObjectTarget&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mycompany.MyBusinessObject&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    ... properties omitted</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;poolTargetSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.target.CommonsPool2TargetSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;businessObjectTarget&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;businessObject&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;poolTargetSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptorNames&quot;</span> <span class="attr">value</span>=<span class="string">&quot;myInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that the target object (<code>businessObjectTarget</code> in the preceding example) must be a prototype. This lets the <code>PoolingTargetSource</code> implementation create new instances of the target to grow the pool as necessary. See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/aop/target/AbstractPoolingTargetSource.html">javadoc of <code>AbstractPoolingTargetSource</code></a> and the concrete subclass you wish to use for information about its properties. <code>maxSize</code> is the most basic and is always guaranteed to be present.</p>
<p>In this case, <code>myInterceptor</code> is the name of an interceptor that would need to be defined in the same IoC context. However, you need not specify interceptors to use pooling. If you want only pooling and no other advice, do not set the <code>interceptorNames</code> property at all.</p>
<p>You can configure Spring to be able to cast any pooled object to the <code>org.springframework.aop.target.PoolingConfig</code> interface, which exposes information about the configuration and current size of the pool through an introduction. You need to define an advisor similar to the following:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;poolConfigAdvisor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetObject&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;poolTargetSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetMethod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;getPoolingConfigMixin&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This advisor is obtained by calling a convenience method on the <code>AbstractPoolingTargetSource</code> class, hence the use of <code>MethodInvokingFactoryBean</code>. This advisor’s name (<code>poolConfigAdvisor</code>, here) must be in the list of interceptors names in the <code>ProxyFactoryBean</code> that exposes the pooled object.</p>
<p>The cast is defined as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PoolingConfig</span> <span class="variable">conf</span> <span class="operator">=</span> (PoolingConfig) beanFactory.getBean(<span class="string">&quot;businessObject&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Max pool size is &quot;</span> + conf.getMaxSize());</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Pooling stateless service objects is not usually necessary. We do not believe it should be the default choice, as most stateless objects are naturally thread safe, and instance pooling is problematic if resources are cached.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Simpler pooling is available by using auto-proxying. You can set the <code>TargetSource</code> implementations used by any auto-proxy creator.</p>
<h4 id="6-9-3-Prototype-Target-Sources"><a href="#6-9-3-Prototype-Target-Sources" class="headerlink" title="6.9.3. Prototype Target Sources"></a>6.9.3. Prototype Target Sources</h4><p>Setting up a “prototype” target source is similar to setting up a pooling <code>TargetSource</code>. In this case, a new instance of the target is created on every method invocation. Although the cost of creating a new object is not high in a modern JVM, the cost of wiring up the new object (satisfying its IoC dependencies) may be more expensive. Thus, you should not use this approach without very good reason.</p>
<p>To do this, you could modify the <code>poolTargetSource</code> definition shown earlier as follows (we also changed the name, for clarity):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;prototypeTargetSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.target.PrototypeTargetSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetBeanName&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;businessObjectTarget&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The only property is the name of the target bean. Inheritance is used in the <code>TargetSource</code> implementations to ensure consistent naming. As with the pooling target source, the target bean must be a prototype bean definition.</p>
<h4 id="6-9-4-ThreadLocal-Target-Sources"><a href="#6-9-4-ThreadLocal-Target-Sources" class="headerlink" title="6.9.4. ThreadLocal Target Sources"></a>6.9.4. <code>ThreadLocal</code> Target Sources</h4><p><code>ThreadLocal</code> target sources are useful if you need an object to be created for each incoming request (per thread that is). The concept of a <code>ThreadLocal</code> provides a JDK-wide facility to transparently store a resource alongside a thread. Setting up a <code>ThreadLocalTargetSource</code> is pretty much the same as was explained for the other types of target source, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;threadlocalTargetSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.target.ThreadLocalTargetSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;businessObjectTarget&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>ThreadLocal</code> instances come with serious issues (potentially resulting in memory leaks) when incorrectly using them in multi-threaded and multi-classloader environments. You should always consider wrapping a threadlocal in some other class and never directly use the <code>ThreadLocal</code> itself (except in the wrapper class). Also, you should always remember to correctly set and unset (where the latter simply involves a call to <code>ThreadLocal.set(null)</code>) the resource local to the thread. Unsetting should be done in any case, since not unsetting it might result in problematic behavior. Spring’s <code>ThreadLocal</code> support does this for you and should always be considered in favor of using <code>ThreadLocal</code> instances without other proper handling code.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="6-10-Defining-New-Advice-Types"><a href="#6-10-Defining-New-Advice-Types" class="headerlink" title="6.10. Defining New Advice Types"></a>6.10. Defining New Advice Types</h3><p>Spring AOP is designed to be extensible. While the interception implementation strategy is presently used internally, it is possible to support arbitrary advice types in addition to the interception around advice, before, throws advice, and after returning advice.</p>
<p>The <code>org.springframework.aop.framework.adapter</code> package is an SPI package that lets support for new custom advice types be added without changing the core framework. The only constraint on a custom <code>Advice</code> type is that it must implement the <code>org.aopalliance.aop.Advice</code> marker interface.</p>
<p>See the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/aop/framework/adapter/package-frame.html"><code>org.springframework.aop.framework.adapter</code></a> javadoc for further information.</p>
<h2 id="7-Null-safety"><a href="#7-Null-safety" class="headerlink" title="7. Null-safety"></a>7. Null-safety</h2><p>Although Java does not let you express null-safety with its type system, the Spring Framework now provides the following annotations in the <code>org.springframework.lang</code> package to let you declare nullability of APIs and fields:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/lang/Nullable.html"><code>@Nullable</code></a>: Annotation to indicate that a specific parameter, return value, or field can be <code>null</code>.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/lang/NonNull.html"><code>@NonNull</code></a>: Annotation to indicate that a specific parameter, return value, or field cannot be <code>null</code> (not needed on parameters &#x2F; return values and fields where <code>@NonNullApi</code> and <code>@NonNullFields</code> apply, respectively).</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/lang/NonNullApi.html"><code>@NonNullApi</code></a>: Annotation at the package level that declares non-null as the default semantics for parameters and return values.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/lang/NonNullFields.html"><code>@NonNullFields</code></a>: Annotation at the package level that declares non-null as the default semantics for fields.</li>
</ul>
<p>The Spring Framework itself leverages these annotations, but they can also be used in any Spring-based Java project to declare null-safe APIs and optionally null-safe fields. Generic type arguments, varargs and array elements nullability are not supported yet but should be in an upcoming release, see <a target="_blank" rel="noopener" href="https://jira.spring.io/browse/SPR-15942">SPR-15942</a> for up-to-date information. Nullability declarations are expected to be fine-tuned between Spring Framework releases, including minor ones. Nullability of types used inside method bodies is outside of the scope of this feature.</p>
<table>
<thead>
<tr>
<th></th>
<th>Other common libraries such as Reactor and Spring Data provide null-safe APIs that use a similar nullability arrangement, delivering a consistent overall experience for Spring application developers.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="7-1-Use-cases"><a href="#7-1-Use-cases" class="headerlink" title="7.1. Use cases"></a>7.1. Use cases</h3><p>In addition to providing an explicit declaration for Spring Framework API nullability, these annotations can be used by an IDE (such as IDEA or Eclipse) to provide useful warnings related to null-safety in order to avoid <code>NullPointerException</code> at runtime.</p>
<p>They are also used to make Spring API null-safe in Kotlin projects, since Kotlin natively supports <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/null-safety.html">null-safety</a>. More details are available in the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#kotlin-null-safety">Kotlin support documentation</a>.</p>
<h3 id="7-2-JSR-305-meta-annotations"><a href="#7-2-JSR-305-meta-annotations" class="headerlink" title="7.2. JSR-305 meta-annotations"></a>7.2. JSR-305 meta-annotations</h3><p>Spring annotations are meta-annotated with <a target="_blank" rel="noopener" href="https://jcp.org/en/jsr/detail?id=305">JSR 305</a> annotations (a dormant but wide-spread JSR). JSR-305 meta-annotations let tooling vendors like IDEA or Kotlin provide null-safety support in a generic way, without having to hard-code support for Spring annotations.</p>
<p>It is not necessary nor recommended to add a JSR-305 dependency to the project classpath to take advantage of Spring null-safe API. Only projects such as Spring-based libraries that use null-safety annotations in their codebase should add <code>com.google.code.findbugs:jsr305:3.0.2</code> with <code>compileOnly</code> Gradle configuration or Maven <code>provided</code> scope to avoid compile warnings.</p>
<h2 id="8-Data-Buffers-and-Codecs"><a href="#8-Data-Buffers-and-Codecs" class="headerlink" title="8. Data Buffers and Codecs"></a>8. Data Buffers and Codecs</h2><p>Java NIO provides <code>ByteBuffer</code> but many libraries build their own byte buffer API on top, especially for network operations where reusing buffers and&#x2F;or using direct buffers is beneficial for performance. For example Netty has the <code>ByteBuf</code> hierarchy, Undertow uses XNIO, Jetty uses pooled byte buffers with a callback to be released, and so on. The <code>spring-core</code> module provides a set of abstractions to work with various byte buffer APIs as follows:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#databuffers-factory"><code>DataBufferFactory</code></a> abstracts the creation of a data buffer.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#databuffers-buffer"><code>DataBuffer</code></a> represents a byte buffer, which may be <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#databuffers-buffer-pooled">pooled</a>.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#databuffers-utils"><code>DataBufferUtils</code></a> offers utility methods for data buffers.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#codecs">Codecs</a> decode or encode data buffer streams into higher level objects.</li>
</ul>
<h3 id="8-1-DataBufferFactory"><a href="#8-1-DataBufferFactory" class="headerlink" title="8.1. DataBufferFactory"></a>8.1. <code>DataBufferFactory</code></h3><p><code>DataBufferFactory</code> is used to create data buffers in one of two ways:</p>
<ol>
<li>Allocate a new data buffer, optionally specifying capacity upfront, if known, which is more efficient even though implementations of <code>DataBuffer</code> can grow and shrink on demand.</li>
<li>Wrap an existing <code>byte[]</code> or <code>java.nio.ByteBuffer</code>, which decorates the given data with a <code>DataBuffer</code> implementation and that does not involve allocation.</li>
</ol>
<p>Note that WebFlux applications do not create a <code>DataBufferFactory</code> directly but instead access it through the <code>ServerHttpResponse</code> or the <code>ClientHttpRequest</code> on the client side. The type of factory depends on the underlying client or server, e.g. <code>NettyDataBufferFactory</code> for Reactor Netty, <code>DefaultDataBufferFactory</code> for others.</p>
<h3 id="8-2-DataBuffer"><a href="#8-2-DataBuffer" class="headerlink" title="8.2. DataBuffer"></a>8.2. <code>DataBuffer</code></h3><p>The <code>DataBuffer</code> interface offers similar operations as <code>java.nio.ByteBuffer</code> but also brings a few additional benefits some of which are inspired by the Netty <code>ByteBuf</code>. Below is a partial list of benefits:</p>
<ul>
<li>Read and write with independent positions, i.e. not requiring a call to <code>flip()</code> to alternate between read and write.</li>
<li>Capacity expanded on demand as with <code>java.lang.StringBuilder</code>.</li>
<li>Pooled buffers and reference counting via <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#databuffers-buffer-pooled"><code>PooledDataBuffer</code></a>.</li>
<li>View a buffer as <code>java.nio.ByteBuffer</code>, <code>InputStream</code>, or <code>OutputStream</code>.</li>
<li>Determine the index, or the last index, for a given byte.</li>
</ul>
<h3 id="8-3-PooledDataBuffer"><a href="#8-3-PooledDataBuffer" class="headerlink" title="8.3. PooledDataBuffer"></a>8.3. <code>PooledDataBuffer</code></h3><p>As explained in the Javadoc for <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html">ByteBuffer</a>, byte buffers can be direct or non-direct. Direct buffers may reside outside the Java heap which eliminates the need for copying for native I&#x2F;O operations. That makes direct buffers particularly useful for receiving and sending data over a socket, but they’re also more expensive to create and release, which leads to the idea of pooling buffers.</p>
<p><code>PooledDataBuffer</code> is an extension of <code>DataBuffer</code> that helps with reference counting which is essential for byte buffer pooling. How does it work? When a <code>PooledDataBuffer</code> is allocated the reference count is at 1. Calls to <code>retain()</code> increment the count, while calls to <code>release()</code> decrement it. As long as the count is above 0, the buffer is guaranteed not to be released. When the count is decreased to 0, the pooled buffer can be released, which in practice could mean the reserved memory for the buffer is returned to the memory pool.</p>
<p>Note that instead of operating on <code>PooledDataBuffer</code> directly, in most cases it’s better to use the convenience methods in <code>DataBufferUtils</code> that apply release or retain to a <code>DataBuffer</code> only if it is an instance of <code>PooledDataBuffer</code>.</p>
<h3 id="8-4-DataBufferUtils"><a href="#8-4-DataBufferUtils" class="headerlink" title="8.4. DataBufferUtils"></a>8.4. <code>DataBufferUtils</code></h3><p><code>DataBufferUtils</code> offers a number of utility methods to operate on data buffers:</p>
<ul>
<li>Join a stream of data buffers into a single buffer possibly with zero copy, e.g. via composite buffers, if that’s supported by the underlying byte buffer API.</li>
<li>Turn <code>InputStream</code> or NIO <code>Channel</code> into <code>Flux&lt;DataBuffer&gt;</code>, and vice versa a <code>Publisher&lt;DataBuffer&gt;</code> into <code>OutputStream</code> or NIO <code>Channel</code>.</li>
<li>Methods to release or retain a <code>DataBuffer</code> if the buffer is an instance of <code>PooledDataBuffer</code>.</li>
<li>Skip or take from a stream of bytes until a specific byte count.</li>
</ul>
<h3 id="8-5-Codecs"><a href="#8-5-Codecs" class="headerlink" title="8.5. Codecs"></a>8.5. Codecs</h3><p>The <code>org.springframework.core.codec</code> package provides the following strategy interfaces:</p>
<ul>
<li><code>Encoder</code> to encode <code>Publisher&lt;T&gt;</code> into a stream of data buffers.</li>
<li><code>Decoder</code> to decode <code>Publisher&lt;DataBuffer&gt;</code> into a stream of higher level objects.</li>
</ul>
<p>The <code>spring-core</code> module provides <code>byte[]</code>, <code>ByteBuffer</code>, <code>DataBuffer</code>, <code>Resource</code>, and <code>String</code> encoder and decoder implementations. The <code>spring-web</code> module adds Jackson JSON, Jackson Smile, JAXB2, Protocol Buffers and other encoders and decoders. See <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-codecs">Codecs</a> in the WebFlux section.</p>
<h3 id="8-6-Using-DataBuffer"><a href="#8-6-Using-DataBuffer" class="headerlink" title="8.6. Using DataBuffer"></a>8.6. Using <code>DataBuffer</code></h3><p>When working with data buffers, special care must be taken to ensure buffers are released since they may be <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#databuffers-buffer-pooled">pooled</a>. We’ll use codecs to illustrate how that works but the concepts apply more generally. Let’s see what codecs must do internally to manage data buffers.</p>
<p>A <code>Decoder</code> is the last to read input data buffers, before creating higher level objects, and therefore it must release them as follows:</p>
<ol>
<li>If a <code>Decoder</code> simply reads each input buffer and is ready to release it immediately, it can do so via <code>DataBufferUtils.release(dataBuffer)</code>.</li>
<li>If a <code>Decoder</code> is using <code>Flux</code> or <code>Mono</code> operators such as <code>flatMap</code>, <code>reduce</code>, and others that prefetch and cache data items internally, or is using operators such as <code>filter</code>, <code>skip</code>, and others that leave out items, then <code>doOnDiscard(PooledDataBuffer.class, DataBufferUtils::release)</code> must be added to the composition chain to ensure such buffers are released prior to being discarded, possibly also as a result of an error or cancellation signal.</li>
<li>If a <code>Decoder</code> holds on to one or more data buffers in any other way, it must ensure they are released when fully read, or in case of an error or cancellation signals that take place before the cached data buffers have been read and released.</li>
</ol>
<p>Note that <code>DataBufferUtils#join</code> offers a safe and efficient way to aggregate a data buffer stream into a single data buffer. Likewise <code>skipUntilByteCount</code> and <code>takeUntilByteCount</code> are additional safe methods for decoders to use.</p>
<p>An <code>Encoder</code> allocates data buffers that others must read (and release). So an <code>Encoder</code> doesn’t have much to do. However an <code>Encoder</code> must take care to release a data buffer if a serialization error occurs while populating the buffer with data. For example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> factory.allocateBuffer();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">release</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// serialize and populate buffer..</span></span><br><span class="line">    release = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (release) &#123;</span><br><span class="line">        DataBufferUtils.release(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> buffer;</span><br></pre></td></tr></table></figure>

<p>The consumer of an <code>Encoder</code> is responsible for releasing the data buffers it receives. In a WebFlux application, the output of the <code>Encoder</code> is used to write to the HTTP server response, or to the client HTTP request, in which case releasing the data buffers is the responsibility of the code writing to the server response, or to the client request.</p>
<p>Note that when running on Netty, there are debugging options for <a target="_blank" rel="noopener" href="https://github.com/netty/netty/wiki/Reference-counted-objects#troubleshooting-buffer-leaks">troubleshooting buffer leaks</a>.</p>
<h2 id="9-Logging"><a href="#9-Logging" class="headerlink" title="9. Logging"></a>9. Logging</h2><p>Since Spring Framework 5.0, Spring comes with its own Commons Logging bridge implemented in the <code>spring-jcl</code> module. The implementation checks for the presence of the Log4j 2.x API and the SLF4J 1.7 API in the classpath and uses the first one of those found as the logging implementation, falling back to the Java platform’s core logging facilities (also known as <em>JUL</em> or <code>java.util.logging</code>) if neither Log4j 2.x nor SLF4J is available.</p>
<p>Put Log4j 2.x or Logback (or another SLF4J provider) in your classpath, without any extra bridges, and let the framework auto-adapt to your choice. For further information see the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-logging">Spring Boot Logging Reference Documentation</a>.</p>
<table>
<thead>
<tr>
<th></th>
<th>Spring’s Commons Logging variant is only meant to be used for infrastructure logging purposes in the core framework and in extensions.For logging needs within application code, prefer direct use of Log4j 2.x, SLF4J, or JUL.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>A <code>Log</code> implementation may be retrieved via <code>org.apache.commons.logging.LogFactory</code> as in the following example.</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(getClass());</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-Appendix"><a href="#10-Appendix" class="headerlink" title="10. Appendix"></a>10. Appendix</h2><h3 id="10-1-XML-Schemas"><a href="#10-1-XML-Schemas" class="headerlink" title="10.1. XML Schemas"></a>10.1. XML Schemas</h3><p>This part of the appendix lists XML schemas related to the core container.</p>
<h4 id="10-1-1-The-util-Schema"><a href="#10-1-1-The-util-Schema" class="headerlink" title="10.1.1. The util Schema"></a>10.1.1. The <code>util</code> Schema</h4><p>As the name implies, the <code>util</code> tags deal with common, utility configuration issues, such as configuring collections, referencing constants, and so forth. To use the tags in the <code>util</code> schema, you need to have the following preamble at the top of your Spring XML configuration file (the text in the snippet references the correct schema so that the tags in the <code>util</code> namespace are available to you):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util https://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- bean definitions here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Using"><a href="#Using" class="headerlink" title="Using &lt;util:constant/&gt;"></a>Using <code>&lt;util:constant/&gt;</code></h5><p>Consider the following bean definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;isolation&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;java.sql.Connection.TRANSACTION_SERIALIZABLE&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.FieldRetrievingFactoryBean&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration uses a Spring <code>FactoryBean</code> implementation (the <code>FieldRetrievingFactoryBean</code>) to set the value of the <code>isolation</code> property on a bean to the value of the <code>java.sql.Connection.TRANSACTION_SERIALIZABLE</code> constant. This is all well and good, but it is verbose and (unnecessarily) exposes Spring’s internal plumbing to the end user.</p>
<p>The following XML Schema-based version is more concise, clearly expresses the developer’s intent (“inject this constant value”), and it reads better:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;isolation&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">&quot;java.sql.Connection.TRANSACTION_SERIALIZABLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="Setting-a-Bean-Property-or-Constructor-Argument-from-a-Field-Value"><a href="#Setting-a-Bean-Property-or-Constructor-Argument-from-a-Field-Value" class="headerlink" title="Setting a Bean Property or Constructor Argument from a Field Value"></a>Setting a Bean Property or Constructor Argument from a Field Value</h6><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html"><code>FieldRetrievingFactoryBean</code></a> is a <code>FactoryBean</code> that retrieves a <code>static</code> or non-static field value. It is typically used for retrieving <code>public</code> <code>static</code> <code>final</code> constants, which may then be used to set a property value or constructor argument for another bean.</p>
<p>The following example shows how a <code>static</code> field is exposed, by using the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html#setStaticField(java.lang.String)"><code>staticField</code></a> property:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myField&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.FieldRetrievingFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;staticField&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java.sql.Connection.TRANSACTION_SERIALIZABLE&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>There is also a convenience usage form where the <code>static</code> field is specified as the bean name, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;java.sql.Connection.TRANSACTION_SERIALIZABLE&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.FieldRetrievingFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>This does mean that there is no longer any choice in what the bean <code>id</code> is (so any other bean that refers to it also has to use this longer name), but this form is very concise to define and very convenient to use as an inner bean since the <code>id</code> does not have to be specified for the bean reference, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;isolation&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;java.sql.Connection.TRANSACTION_SERIALIZABLE&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.FieldRetrievingFactoryBean&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can also access a non-static (instance) field of another bean, as described in the API documentation for the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.22/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html"><code>FieldRetrievingFactoryBean</code></a> class.</p>
<p>Injecting enumeration values into beans as either property or constructor arguments is easy to do in Spring. You do not actually have to do anything or know anything about the Spring internals (or even about classes such as the <code>FieldRetrievingFactoryBean</code>). The following example enumeration shows how easy injecting an enum value is:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.persistence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">PersistenceContextType</span> &#123;</span><br><span class="line"></span><br><span class="line">    TRANSACTION,</span><br><span class="line">    EXTENDED</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now consider the following setter of type <code>PersistenceContextType</code> and the corresponding bean definition:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PersistenceContextType persistenceContextType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPersistenceContextType</span><span class="params">(PersistenceContextType type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.persistenceContextType = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;bean class=<span class="string">&quot;example.Client&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;persistenceContextType&quot;</span> value=<span class="string">&quot;TRANSACTION&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h5 id="Using-1"><a href="#Using-1" class="headerlink" title="Using &lt;util:property-path/&gt;"></a>Using <code>&lt;util:property-path/&gt;</code></h5><p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- target bean to be referenced by name --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spouse&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- results in 10, which is the value of property &#x27;age&#x27; of bean &#x27;testBean&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean.age&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPathFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration uses a Spring <code>FactoryBean</code> implementation (the <code>PropertyPathFactoryBean</code>) to create a bean (of type <code>int</code>) called <code>testBean.age</code> that has a value equal to the <code>age</code> property of the <code>testBean</code> bean.</p>
<p>Now consider the following example, which adds a <code>&lt;util:property-path/&gt;</code> element:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- target bean to be referenced by name --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spouse&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- results in 10, which is the value of property &#x27;age&#x27; of bean &#x27;testBean&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:property-path</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">path</span>=<span class="string">&quot;testBean.age&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>The value of the <code>path</code> attribute of the <code>&lt;property-path/&gt;</code> element follows the form of <code>beanName.beanProperty</code>. In this case, it picks up the <code>age</code> property of the bean named <code>testBean</code>. The value of that <code>age</code> property is <code>10</code>.</p>
<h6 id="Using-to-Set-a-Bean-Property-or-Constructor-Argument"><a href="#Using-to-Set-a-Bean-Property-or-Constructor-Argument" class="headerlink" title="Using &lt;util:property-path/&gt; to Set a Bean Property or Constructor Argument"></a>Using <code>&lt;util:property-path/&gt;</code> to Set a Bean Property or Constructor Argument</h6><p><code>PropertyPathFactoryBean</code> is a <code>FactoryBean</code> that evaluates a property path on a given target object. The target object can be specified directly or by a bean name. You can then use this value in another bean definition as a property value or constructor argument.</p>
<p>The following example shows a path being used against another bean, by name:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- target bean to be referenced by name --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spouse&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- results in 11, which is the value of property &#x27;spouse.age&#x27; of bean &#x27;person&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;theAge&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPathFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;person&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;propertyPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;spouse.age&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In the following example, a path is evaluated against an inner bean:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- results in 12, which is the value of property &#x27;age&#x27; of the inner bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;theAge&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPathFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetObject&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;12&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;propertyPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>There is also a shortcut form, where the bean name is the property path. The following example shows the shortcut form:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- results in 10, which is the value of property &#x27;age&#x27; of bean &#x27;person&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person.age&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPathFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>This form does mean that there is no choice in the name of the bean. Any reference to it also has to use the same <code>id</code>, which is the path. If used as an inner bean, there is no need to refer to it at all, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person.age&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPathFactoryBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can specifically set the result type in the actual definition. This is not necessary for most use cases, but it can sometimes be useful. See the javadoc for more info on this feature.</p>
<h5 id="Using-2"><a href="#Using-2" class="headerlink" title="Using &lt;util:properties/&gt;"></a>Using <code>&lt;util:properties/&gt;</code></h5><p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.Properties instance with values loaded from the supplied location --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcConfiguration&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertiesFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;location&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/foo/jdbc-production.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration uses a Spring <code>FactoryBean</code> implementation (the <code>PropertiesFactoryBean</code>) to instantiate a <code>java.util.Properties</code> instance with values loaded from the supplied <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources"><code>Resource</code></a> location).</p>
<p>The following example uses a <code>util:properties</code> element to make a more concise representation:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.Properties instance with values loaded from the supplied location --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">id</span>=<span class="string">&quot;jdbcConfiguration&quot;</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/foo/jdbc-production.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Using-3"><a href="#Using-3" class="headerlink" title="Using &lt;util:list/&gt;"></a>Using <code>&lt;util:list/&gt;</code></h5><p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.List instance with values loaded from the supplied &#x27;sourceList&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.ListFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sourceList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>pechorin@hero.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>raskolnikov@slums.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>stavrogin@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>porfiry@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration uses a Spring <code>FactoryBean</code> implementation (the <code>ListFactoryBean</code>) to create a <code>java.util.List</code> instance and initialize it with values taken from the supplied <code>sourceList</code>.</p>
<p>The following example uses a <code>&lt;util:list/&gt;</code> element to make a more concise representation:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.List instance with the supplied values --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>pechorin@hero.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>raskolnikov@slums.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>stavrogin@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>porfiry@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can also explicitly control the exact type of <code>List</code> that is instantiated and populated by using the <code>list-class</code> attribute on the <code>&lt;util:list/&gt;</code> element. For example, if we really need a <code>java.util.LinkedList</code> to be instantiated, we could use the following configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span> <span class="attr">list-class</span>=<span class="string">&quot;java.util.LinkedList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>jackshaftoe@vagabond.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>eliza@thinkingmanscrumpet.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>vanhoek@pirate.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>d&#x27;Arcachon@nemesis.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>If no <code>list-class</code> attribute is supplied, the container chooses a <code>List</code> implementation.</p>
<h5 id="Using-4"><a href="#Using-4" class="headerlink" title="Using &lt;util:map/&gt;"></a>Using <code>&lt;util:map/&gt;</code></h5><p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.Map instance with values loaded from the supplied &#x27;sourceMap&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.MapFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sourceMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;pechorin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pechorin@hero.org&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;raskolnikov&quot;</span> <span class="attr">value</span>=<span class="string">&quot;raskolnikov@slums.org&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;stavrogin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;stavrogin@gov.org&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;porfiry&quot;</span> <span class="attr">value</span>=<span class="string">&quot;porfiry@gov.org&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration uses a Spring <code>FactoryBean</code> implementation (the <code>MapFactoryBean</code>) to create a <code>java.util.Map</code> instance initialized with key-value pairs taken from the supplied <code>&#39;sourceMap&#39;</code>.</p>
<p>The following example uses a <code>&lt;util:map/&gt;</code> element to make a more concise representation:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.Map instance with the supplied key-value pairs --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;pechorin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pechorin@hero.org&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;raskolnikov&quot;</span> <span class="attr">value</span>=<span class="string">&quot;raskolnikov@slums.org&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;stavrogin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;stavrogin@gov.org&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;porfiry&quot;</span> <span class="attr">value</span>=<span class="string">&quot;porfiry@gov.org&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can also explicitly control the exact type of <code>Map</code> that is instantiated and populated by using the <code>&#39;map-class&#39;</code> attribute on the <code>&lt;util:map/&gt;</code> element. For example, if we really need a <code>java.util.TreeMap</code> to be instantiated, we could use the following configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span> <span class="attr">map-class</span>=<span class="string">&quot;java.util.TreeMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;pechorin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pechorin@hero.org&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;raskolnikov&quot;</span> <span class="attr">value</span>=<span class="string">&quot;raskolnikov@slums.org&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;stavrogin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;stavrogin@gov.org&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;porfiry&quot;</span> <span class="attr">value</span>=<span class="string">&quot;porfiry@gov.org&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>If no <code>&#39;map-class&#39;</code> attribute is supplied, the container chooses a <code>Map</code> implementation.</p>
<h5 id="Using-5"><a href="#Using-5" class="headerlink" title="Using &lt;util:set/&gt;"></a>Using <code>&lt;util:set/&gt;</code></h5><p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.Set instance with values loaded from the supplied &#x27;sourceSet&#x27; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.SetFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sourceSet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>pechorin@hero.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>raskolnikov@slums.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>stavrogin@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>porfiry@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration uses a Spring <code>FactoryBean</code> implementation (the <code>SetFactoryBean</code>) to create a <code>java.util.Set</code> instance initialized with values taken from the supplied <code>sourceSet</code>.</p>
<p>The following example uses a <code>&lt;util:set/&gt;</code> element to make a more concise representation:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- creates a java.util.Set instance with the supplied values --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:set</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>pechorin@hero.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>raskolnikov@slums.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>stavrogin@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>porfiry@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can also explicitly control the exact type of <code>Set</code> that is instantiated and populated by using the <code>set-class</code> attribute on the <code>&lt;util:set/&gt;</code> element. For example, if we really need a <code>java.util.TreeSet</code> to be instantiated, we could use the following configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:set</span> <span class="attr">id</span>=<span class="string">&quot;emails&quot;</span> <span class="attr">set-class</span>=<span class="string">&quot;java.util.TreeSet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>pechorin@hero.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>raskolnikov@slums.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>stavrogin@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>porfiry@gov.org<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>If no <code>set-class</code> attribute is supplied, the container chooses a <code>Set</code> implementation.</p>
<h4 id="10-1-2-The-aop-Schema"><a href="#10-1-2-The-aop-Schema" class="headerlink" title="10.1.2. The aop Schema"></a>10.1.2. The <code>aop</code> Schema</h4><p>The <code>aop</code> tags deal with configuring all things AOP in Spring, including Spring’s own proxy-based AOP framework and Spring’s integration with the AspectJ AOP framework. These tags are comprehensively covered in the chapter entitled <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Aspect Oriented Programming with Spring</a>.</p>
<p>In the interest of completeness, to use the tags in the <code>aop</code> schema, you need to have the following preamble at the top of your Spring XML configuration file (the text in the snippet references the correct schema so that the tags in the <code>aop</code> namespace are available to you):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- bean definitions here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="10-1-3-The-context-Schema"><a href="#10-1-3-The-context-Schema" class="headerlink" title="10.1.3. The context Schema"></a>10.1.3. The <code>context</code> Schema</h4><p>The <code>context</code> tags deal with <code>ApplicationContext</code> configuration that relates to plumbing — that is, not usually beans that are important to an end-user but rather beans that do a lot of the “grunt” work in Spring, such as <code>BeanfactoryPostProcessors</code>. The following snippet references the correct schema so that the elements in the <code>context</code> namespace are available to you:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- bean definitions here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Using-6"><a href="#Using-6" class="headerlink" title="Using &lt;property-placeholder/&gt;"></a>Using <code>&lt;property-placeholder/&gt;</code></h5><p>This element activates the replacement of <code>$&#123;…&#125;</code> placeholders, which are resolved against a specified properties file (as a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources">Spring resource location</a>). This element is a convenience mechanism that sets up a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-placeholderconfigurer"><code>PropertySourcesPlaceholderConfigurer</code></a> for you. If you need more control over the specific <code>PropertySourcesPlaceholderConfigurer</code> setup, you can explicitly define it as a bean yourself.</p>
<h5 id="Using-7"><a href="#Using-7" class="headerlink" title="Using &lt;annotation-config/&gt;"></a>Using <code>&lt;annotation-config/&gt;</code></h5><p>This element activates the Spring infrastructure to detect annotations in bean classes:</p>
<ul>
<li>Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-metadata"><code>@Configuration</code></a> model</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config"><code>@Autowired</code>&#x2F;<code>@Inject</code></a>, <code>@Value</code>, and <code>@Lookup</code></li>
<li>JSR-250’s <code>@Resource</code>, <code>@PostConstruct</code>, and <code>@PreDestroy</code> (if available)</li>
<li>JAX-WS’s <code>@WebServiceRef</code> and EJB 3’s <code>@EJB</code> (if available)</li>
<li>JPA’s <code>@PersistenceContext</code> and <code>@PersistenceUnit</code> (if available)</li>
<li>Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-events-annotation"><code>@EventListener</code></a></li>
</ul>
<p>Alternatively, you can choose to explicitly activate the individual <code>BeanPostProcessors</code> for those annotations.</p>
<table>
<thead>
<tr>
<th></th>
<th>This element does not activate processing of Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#transaction-declarative-annotations"><code>@Transactional</code></a> annotation; you can use the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-decl-explained">&#96;&#96;</a> element for that purpose. Similarly, Spring’s <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache-annotations">caching annotations</a> need to be explicitly <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache-annotation-enable">enabled</a> as well.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Using-8"><a href="#Using-8" class="headerlink" title="Using &lt;component-scan/&gt;"></a>Using <code>&lt;component-scan/&gt;</code></h5><p>This element is detailed in the section on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-annotation-config">annotation-based container configuration</a>.</p>
<h5 id="Using-9"><a href="#Using-9" class="headerlink" title="Using &lt;load-time-weaver/&gt;"></a>Using <code>&lt;load-time-weaver/&gt;</code></h5><p>This element is detailed in the section on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-aj-ltw">load-time weaving with AspectJ in the Spring Framework</a>.</p>
<h5 id="Using-10"><a href="#Using-10" class="headerlink" title="Using &lt;spring-configured/&gt;"></a>Using <code>&lt;spring-configured/&gt;</code></h5><p>This element is detailed in the section on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-atconfigurable">using AspectJ to dependency inject domain objects with Spring</a>.</p>
<h5 id="Using-11"><a href="#Using-11" class="headerlink" title="Using &lt;mbean-export/&gt;"></a>Using <code>&lt;mbean-export/&gt;</code></h5><p>This element is detailed in the section on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#jmx-context-mbeanexport">configuring annotation-based MBean export</a>.</p>
<h4 id="10-1-4-The-Beans-Schema"><a href="#10-1-4-The-Beans-Schema" class="headerlink" title="10.1.4. The Beans Schema"></a>10.1.4. The Beans Schema</h4><p>Last but not least, we have the elements in the <code>beans</code> schema. These elements have been in Spring since the very dawn of the framework. Examples of the various elements in the <code>beans</code> schema are not shown here because they are quite comprehensively covered in <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-properties-detailed">dependencies and configuration in detail</a> (and, indeed, in that entire <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans">chapter</a>).</p>
<p>Note that you can add zero or more key-value pairs to <code>&lt;bean/&gt;</code> XML definitions. What, if anything, is done with this extra metadata is totally up to your own custom logic (and so is typically only of use if you write your own custom elements as described in the appendix entitled <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xml-custom">XML Schema Authoring</a>).</p>
<p>The following example shows the <code>&lt;meta/&gt;</code> element in the context of a surrounding <code>&lt;bean/&gt;</code> (note that, without any logic to interpret it, the metadata is effectively useless as it stands).</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;foo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.Foo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">&quot;cacheName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;foo&quot;</span>/&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Rick&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>This is the example <code>meta</code> element</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In the case of the preceding example, you could assume that there is some logic that consumes the bean definition and sets up some caching infrastructure that uses the supplied metadata.</p>
<h3 id="10-2-XML-Schema-Authoring"><a href="#10-2-XML-Schema-Authoring" class="headerlink" title="10.2. XML Schema Authoring"></a>10.2. XML Schema Authoring</h3><p>Since version 2.0, Spring has featured a mechanism for adding schema-based extensions to the basic Spring XML format for defining and configuring beans. This section covers how to write your own custom XML bean definition parsers and integrate such parsers into the Spring IoC container.</p>
<p>To facilitate authoring configuration files that use a schema-aware XML editor, Spring’s extensible XML configuration mechanism is based on XML Schema. If you are not familiar with Spring’s current XML configuration extensions that come with the standard Spring distribution, you should first read the previous section on <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas">XML Schemas</a>.</p>
<p>To create new XML configuration extensions:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-custom-schema">Author</a> an XML schema to describe your custom element(s).</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-custom-namespacehandler">Code</a> a custom <code>NamespaceHandler</code> implementation.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-custom-parser">Code</a> one or more <code>BeanDefinitionParser</code> implementations (this is where the real work is done).</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-custom-registration">Register</a> your new artifacts with Spring.</li>
</ol>
<p>For a unified example, we create an XML extension (a custom XML element) that lets us configure objects of the type <code>SimpleDateFormat</code> (from the <code>java.text</code> package). When we are done, we will be able to define bean definitions of type <code>SimpleDateFormat</code> as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">myns:dateformat</span> <span class="attr">id</span>=<span class="string">&quot;dateFormat&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pattern</span>=<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">lenient</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>(We include much more detailed examples follow later in this appendix. The intent of this first simple example is to walk you through the basic steps of making a custom extension.)</p>
<h4 id="10-2-1-Authoring-the-Schema"><a href="#10-2-1-Authoring-the-Schema" class="headerlink" title="10.2.1. Authoring the Schema"></a>10.2.1. Authoring the Schema</h4><p>Creating an XML configuration extension for use with Spring’s IoC container starts with authoring an XML Schema to describe the extension. For our example, we use the following schema to configure <code>SimpleDateFormat</code> objects:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- myns.xsd (inside package org/springframework/samples/xml) --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.mycompany.example/schema/myns&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:beans</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.mycompany.example/schema/myns&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">elementFormDefault</span>=<span class="string">&quot;qualified&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">attributeFormDefault</span>=<span class="string">&quot;unqualified&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">&quot;dateformat&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:complexContent</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:extension</span> <span class="attr">base</span>=<span class="string">&quot;beans:identifiedType&quot;</span>&gt;</span> </span><br><span class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">&quot;lenient&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xsd:boolean&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xsd:string&quot;</span> <span class="attr">use</span>=<span class="string">&quot;required&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">xsd:extension</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsd:complexContent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>The indicated line contains an extension base for all identifiable tags (meaning they have an <code>id</code> attribute that we can use as the bean identifier in the container). We can use this attribute because we imported the Spring-provided <code>beans</code> namespace.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>The preceding schema lets us configure <code>SimpleDateFormat</code> objects directly in an XML application context file by using the <code>&lt;myns:dateformat/&gt;</code> element, as the following example shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">myns:dateformat</span> <span class="attr">id</span>=<span class="string">&quot;dateFormat&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pattern</span>=<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">lenient</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note that, after we have created the infrastructure classes, the preceding snippet of XML is essentially the same as the following XML snippet:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dateFormat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lenient&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The second of the two preceding snippets creates a bean in the container (identified by the name <code>dateFormat</code> of type <code>SimpleDateFormat</code>) with a couple of properties set.</p>
<table>
<thead>
<tr>
<th></th>
<th>The schema-based approach to creating configuration format allows for tight integration with an IDE that has a schema-aware XML editor. By using a properly authored schema, you can use autocompletion to let a user choose between several configuration options defined in the enumeration.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="10-2-2-Coding-a-NamespaceHandler"><a href="#10-2-2-Coding-a-NamespaceHandler" class="headerlink" title="10.2.2. Coding a NamespaceHandler"></a>10.2.2. Coding a <code>NamespaceHandler</code></h4><p>In addition to the schema, we need a <code>NamespaceHandler</code> to parse all elements of this specific namespace that Spring encounters while parsing configuration files. For this example, the <code>NamespaceHandler</code> should take care of the parsing of the <code>myns:dateformat</code> element.</p>
<p>The <code>NamespaceHandler</code> interface features three methods:</p>
<ul>
<li><code>init()</code>: Allows for initialization of the <code>NamespaceHandler</code> and is called by Spring before the handler is used.</li>
<li><code>BeanDefinition parse(Element, ParserContext)</code>: Called when Spring encounters a top-level element (not nested inside a bean definition or a different namespace). This method can itself register bean definitions, return a bean definition, or both.</li>
<li><code>BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code>: Called when Spring encounters an attribute or nested element of a different namespace. The decoration of one or more bean definitions is used (for example) with the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes">scopes that Spring supports</a>. We start by highlighting a simple example, without using decoration, after which we show decoration in a somewhat more advanced example.</li>
</ul>
<p>Although you can code your own <code>NamespaceHandler</code> for the entire namespace (and hence provide code that parses each and every element in the namespace), it is often the case that each top-level XML element in a Spring XML configuration file results in a single bean definition (as in our case, where a single <code>&lt;myns:dateformat/&gt;</code> element results in a single <code>SimpleDateFormat</code> bean definition). Spring features a number of convenience classes that support this scenario. In the following example, we use the <code>NamespaceHandlerSupport</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.samples.xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">&quot;dateformat&quot;</span>, <span class="keyword">new</span> <span class="title class_">SimpleDateFormatBeanDefinitionParser</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You may notice that there is not actually a whole lot of parsing logic in this class. Indeed, the <code>NamespaceHandlerSupport</code> class has a built-in notion of delegation. It supports the registration of any number of <code>BeanDefinitionParser</code> instances, to which it delegates to when it needs to parse an element in its namespace. This clean separation of concerns lets a <code>NamespaceHandler</code> handle the orchestration of the parsing of all of the custom elements in its namespace while delegating to <code>BeanDefinitionParsers</code> to do the grunt work of the XML parsing. This means that each <code>BeanDefinitionParser</code> contains only the logic for parsing a single custom element, as we can see in the next step.</p>
<h4 id="10-2-3-Using-BeanDefinitionParser"><a href="#10-2-3-Using-BeanDefinitionParser" class="headerlink" title="10.2.3. Using BeanDefinitionParser"></a>10.2.3. Using <code>BeanDefinitionParser</code></h4><p>A <code>BeanDefinitionParser</code> is used if the <code>NamespaceHandler</code> encounters an XML element of the type that has been mapped to the specific bean definition parser (<code>dateformat</code> in this case). In other words, the <code>BeanDefinitionParser</code> is responsible for parsing one distinct top-level XML element defined in the schema. In the parser, we’ have access to the XML element (and thus to its subelements, too) so that we can parse our custom XML content, as you can see in the following example:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.samples.xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleDateFormatBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title class_">AbstractSingleBeanDefinitionParser</span> &#123; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Class <span class="title function_">getBeanClass</span><span class="params">(Element element)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SimpleDateFormat.class; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doParse</span><span class="params">(Element element, BeanDefinitionBuilder bean)</span> &#123;</span><br><span class="line">        <span class="comment">// this will never be null since the schema explicitly requires that a value be supplied</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">pattern</span> <span class="operator">=</span> element.getAttribute(<span class="string">&quot;pattern&quot;</span>);</span><br><span class="line">        bean.addConstructorArgValue(pattern);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// this however is an optional property</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lenient</span> <span class="operator">=</span> element.getAttribute(<span class="string">&quot;lenient&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(lenient)) &#123;</span><br><span class="line">            bean.addPropertyValue(<span class="string">&quot;lenient&quot;</span>, Boolean.valueOf(lenient));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>We use the Spring-provided <code>AbstractSingleBeanDefinitionParser</code> to handle a lot of the basic grunt work of creating a single <code>BeanDefinition</code>.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>We supply the <code>AbstractSingleBeanDefinitionParser</code> superclass with the type that our single <code>BeanDefinition</code> represents.</td>
</tr>
</tbody></table>
<p>In this simple case, this is all that we need to do. The creation of our single <code>BeanDefinition</code> is handled by the <code>AbstractSingleBeanDefinitionParser</code> superclass, as is the extraction and setting of the bean definition’s unique identifier.</p>
<h4 id="10-2-4-Registering-the-Handler-and-the-Schema"><a href="#10-2-4-Registering-the-Handler-and-the-Schema" class="headerlink" title="10.2.4. Registering the Handler and the Schema"></a>10.2.4. Registering the Handler and the Schema</h4><p>The coding is finished. All that remains to be done is to make the Spring XML parsing infrastructure aware of our custom element. We do so by registering our custom <code>namespaceHandler</code> and custom XSD file in two special-purpose properties files. These properties files are both placed in a <code>META-INF</code> directory in your application and can, for example, be distributed alongside your binary classes in a JAR file. The Spring XML parsing infrastructure automatically picks up your new extension by consuming these special properties files, the formats of which are detailed in the next two sections.</p>
<h5 id="Writing-META-INF-spring-handlers"><a href="#Writing-META-INF-spring-handlers" class="headerlink" title="Writing META-INF/spring.handlers"></a>Writing <code>META-INF/spring.handlers</code></h5><p>The properties file called <code>spring.handlers</code> contains a mapping of XML Schema URIs to namespace handler classes. For our example, we need to write the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http\://www.mycompany.example/schema/myns=org.springframework.samples.xml.MyNamespaceHandler</span><br></pre></td></tr></table></figure>

<p>(The <code>:</code> character is a valid delimiter in the Java properties format, so <code>:</code> character in the URI needs to be escaped with a backslash.)</p>
<p>The first part (the key) of the key-value pair is the URI associated with your custom namespace extension and needs to exactly match exactly the value of the <code>targetNamespace</code> attribute, as specified in your custom XSD schema.</p>
<h5 id="Writing-‘META-INF-spring-schemas’"><a href="#Writing-‘META-INF-spring-schemas’" class="headerlink" title="Writing ‘META-INF&#x2F;spring.schemas’"></a>Writing ‘META-INF&#x2F;spring.schemas’</h5><p>The properties file called <code>spring.schemas</code> contains a mapping of XML Schema locations (referred to, along with the schema declaration, in XML files that use the schema as part of the <code>xsi:schemaLocation</code> attribute) to classpath resources. This file is needed to prevent Spring from absolutely having to use a default <code>EntityResolver</code> that requires Internet access to retrieve the schema file. If you specify the mapping in this properties file, Spring searches for the schema (in this case, <code>myns.xsd</code> in the <code>org.springframework.samples.xml</code> package) on the classpath. The following snippet shows the line we need to add for our custom schema:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http\://www.mycompany.example/schema/myns/myns.xsd=org/springframework/samples/xml/myns.xsd</span><br></pre></td></tr></table></figure>

<p>(Remember that the <code>:</code> character must be escaped.)</p>
<p>You are encouraged to deploy your XSD file (or files) right alongside the <code>NamespaceHandler</code> and <code>BeanDefinitionParser</code> classes on the classpath.</p>
<h4 id="10-2-5-Using-a-Custom-Extension-in-Your-Spring-XML-Configuration"><a href="#10-2-5-Using-a-Custom-Extension-in-Your-Spring-XML-Configuration" class="headerlink" title="10.2.5. Using a Custom Extension in Your Spring XML Configuration"></a>10.2.5. Using a Custom Extension in Your Spring XML Configuration</h4><p>Using a custom extension that you yourself have implemented is no different from using one of the “custom” extensions that Spring provides. The following example uses the custom <code>&lt;dateformat/&gt;</code> element developed in the previous steps in a Spring XML configuration file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:myns</span>=<span class="string">&quot;http://www.mycompany.example/schema/myns&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.mycompany.example/schema/myns http://www.mycompany.com/schema/myns/myns.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- as a top-level bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">myns:dateformat</span> <span class="attr">id</span>=<span class="string">&quot;defaultDateFormat&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span> <span class="attr">lenient</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jobDetailTemplate&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dateFormat&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- as an inner bean --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">myns:dateformat</span> <span class="attr">pattern</span>=<span class="string">&quot;HH:mm MM-dd-yyyy&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>Our custom bean.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="10-2-6-More-Detailed-Examples"><a href="#10-2-6-More-Detailed-Examples" class="headerlink" title="10.2.6. More Detailed Examples"></a>10.2.6. More Detailed Examples</h4><p>This section presents some more detailed examples of custom XML extensions.</p>
<h5 id="Nesting-Custom-Elements-within-Custom-Elements"><a href="#Nesting-Custom-Elements-within-Custom-Elements" class="headerlink" title="Nesting Custom Elements within Custom Elements"></a>Nesting Custom Elements within Custom Elements</h5><p>The example presented in this section shows how you to write the various artifacts required to satisfy a target of the following configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:foo</span>=<span class="string">&quot;http://www.foo.example/schema/component&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.foo.example/schema/component http://www.foo.example/schema/component/component.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">foo:component</span> <span class="attr">id</span>=<span class="string">&quot;bionic-family&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Bionic-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foo:component</span> <span class="attr">name</span>=<span class="string">&quot;Mother-1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foo:component</span> <span class="attr">name</span>=<span class="string">&quot;Karate-1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foo:component</span> <span class="attr">name</span>=<span class="string">&quot;Sport-1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">foo:component</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foo:component</span> <span class="attr">name</span>=<span class="string">&quot;Rock-1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">foo:component</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The preceding configuration nests custom extensions within each other. The class that is actually configured by the <code>&lt;foo:component/&gt;</code> element is the <code>Component</code> class (shown in the next example). Notice how the <code>Component</code> class does not expose a setter method for the <code>components</code> property. This makes it hard (or rather impossible) to configure a bean definition for the <code>Component</code> class by using setter injection. The following listing shows the <code>Component</code> class:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; components = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Component&gt; ();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mmm, there is no setter method for the &#x27;components&#x27;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addComponent</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.components.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Component&gt; <span class="title function_">getComponents</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> components;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The typical solution to this issue is to create a custom <code>FactoryBean</code> that exposes a setter property for the <code>components</code> property. The following listing shows such a custom <code>FactoryBean</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComponentFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Component&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Component parent;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; children;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParent</span><span class="params">(Component parent)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChildren</span><span class="params">(List&lt;Component&gt; children)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.children = children;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Component <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.children != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.children.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Component child : children) &#123;</span><br><span class="line">                <span class="built_in">this</span>.parent.addComponent(child);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class&lt;Component&gt; <span class="title function_">getObjectType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Component.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This works nicely, but it exposes a lot of Spring plumbing to the end user. What we are going to do is write a custom extension that hides away all of this Spring plumbing. If we stick to <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-custom-introduction">the steps described previously</a>, we start off by creating the XSD schema to define the structure of our custom tag, as the following listing shows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;no&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.foo.example/schema/component&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.foo.example/schema/component&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">elementFormDefault</span>=<span class="string">&quot;qualified&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">attributeFormDefault</span>=<span class="string">&quot;unqualified&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">&quot;component&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:choice</span> <span class="attr">minOccurs</span>=<span class="string">&quot;0&quot;</span> <span class="attr">maxOccurs</span>=<span class="string">&quot;unbounded&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">ref</span>=<span class="string">&quot;component&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsd:choice</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xsd:ID&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">use</span>=<span class="string">&quot;required&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xsd:string&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Again following <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-custom-introduction">the process described earlier</a>, we then create a custom <code>NamespaceHandler</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComponentNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">&quot;component&quot;</span>, <span class="keyword">new</span> <span class="title class_">ComponentBeanDefinitionParser</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next up is the custom <code>BeanDefinitionParser</code>. Remember that we are creating a <code>BeanDefinition</code> that describes a <code>ComponentFactoryBean</code>. The following listing shows our custom <code>BeanDefinitionParser</code> implementation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.AbstractBeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.ManagedList;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.AbstractBeanDefinitionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.ParserContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.xml.DomUtils;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComponentBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title class_">AbstractBeanDefinitionParser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> AbstractBeanDefinition <span class="title function_">parseInternal</span><span class="params">(Element element, ParserContext parserContext)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> parseComponentElement(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AbstractBeanDefinition <span class="title function_">parseComponentElement</span><span class="params">(Element element)</span> &#123;</span><br><span class="line">        <span class="type">BeanDefinitionBuilder</span> <span class="variable">factory</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(ComponentFactoryBean.class);</span><br><span class="line">        factory.addPropertyValue(<span class="string">&quot;parent&quot;</span>, parseComponent(element));</span><br><span class="line"></span><br><span class="line">        List&lt;Element&gt; childElements = DomUtils.getChildElementsByTagName(element, <span class="string">&quot;component&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (childElements != <span class="literal">null</span> &amp;&amp; childElements.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            parseChildComponents(childElements, factory);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> factory.getBeanDefinition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BeanDefinition <span class="title function_">parseComponent</span><span class="params">(Element element)</span> &#123;</span><br><span class="line">        <span class="type">BeanDefinitionBuilder</span> <span class="variable">component</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(Component.class);</span><br><span class="line">        component.addPropertyValue(<span class="string">&quot;name&quot;</span>, element.getAttribute(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> component.getBeanDefinition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">parseChildComponents</span><span class="params">(List&lt;Element&gt; childElements, BeanDefinitionBuilder factory)</span> &#123;</span><br><span class="line">        ManagedList&lt;BeanDefinition&gt; children = <span class="keyword">new</span> <span class="title class_">ManagedList</span>&lt;BeanDefinition&gt;(childElements.size());</span><br><span class="line">        <span class="keyword">for</span> (Element element : childElements) &#123;</span><br><span class="line">            children.add(parseComponentElement(element));</span><br><span class="line">        &#125;</span><br><span class="line">        factory.addPropertyValue(<span class="string">&quot;children&quot;</span>, children);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the various artifacts need to be registered with the Spring XML infrastructure, by modifying the <code>META-INF/spring.handlers</code> and <code>META-INF/spring.schemas</code> files, as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># in &#x27;META-INF/spring.handlers&#x27;</span><br><span class="line">http\://www.foo.example/schema/component=com.foo.ComponentNamespaceHandler</span><br><span class="line"># in &#x27;META-INF/spring.schemas&#x27;</span><br><span class="line">http\://www.foo.example/schema/component/component.xsd=com/foo/component.xsd</span><br></pre></td></tr></table></figure>

<h5 id="Custom-Attributes-on-“Normal”-Elements"><a href="#Custom-Attributes-on-“Normal”-Elements" class="headerlink" title="Custom Attributes on “Normal” Elements"></a>Custom Attributes on “Normal” Elements</h5><p>Writing your own custom parser and the associated artifacts is not hard. However, it is sometimes not the right thing to do. Consider a scenario where you need to add metadata to already existing bean definitions. In this case, you certainly do not want to have to write your own entire custom extension. Rather, you merely want to add an additional attribute to the existing bean definition element.</p>
<p>By way of another example, suppose that you define a bean definition for a service object that (unknown to it) accesses a clustered <a target="_blank" rel="noopener" href="https://jcp.org/en/jsr/detail?id=107">JCache</a>, and you want to ensure that the named JCache instance is eagerly started within the surrounding cluster. The following listing shows such a definition:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;checkingAccountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.DefaultCheckingAccountService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">jcache:cache-name</span>=<span class="string">&quot;checking.account&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- other dependencies here... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>We can then create another <code>BeanDefinition</code> when the <code>&#39;jcache:cache-name&#39;</code> attribute is parsed. This <code>BeanDefinition</code> then initializes the named JCache for us. We can also modify the existing <code>BeanDefinition</code> for the <code>&#39;checkingAccountService&#39;</code> so that it has a dependency on this new JCache-initializing <code>BeanDefinition</code>. The following listing shows our <code>JCacheInitializer</code>:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JCacheInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JCacheInitializer</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// lots of JCache API calls to initialize the named cache...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we can move onto the custom extension. First, we need to author the XSD schema that describes the custom attribute, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;no&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.foo.example/schema/jcache&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.foo.example/schema/jcache&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">elementFormDefault</span>=<span class="string">&quot;qualified&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">&quot;cache-name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;xsd:string&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Next, we need to create the associated <code>NamespaceHandler</code>, as follows:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JCacheNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.registerBeanDefinitionDecoratorForAttribute(<span class="string">&quot;cache-name&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">JCacheInitializingBeanDefinitionDecorator</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we need to create the parser. Note that, in this case, because we are going to parse an XML attribute, we write a <code>BeanDefinitionDecorator</code> rather than a <code>BeanDefinitionParser</code>. The following listing shows our <code>BeanDefinitionDecorator</code> implementation:</p>
<p>Java</p>
<p>Kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinitionHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.AbstractBeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.BeanDefinitionDecorator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.ParserContext;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Attr;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JCacheInitializingBeanDefinitionDecorator</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionDecorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] EMPTY_STRING_ARRAY = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BeanDefinitionHolder <span class="title function_">decorate</span><span class="params">(Node source, BeanDefinitionHolder holder,</span></span><br><span class="line"><span class="params">            ParserContext ctx)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">initializerBeanName</span> <span class="operator">=</span> registerJCacheInitializer(source, ctx);</span><br><span class="line">        createDependencyOnJCacheInitializer(holder, initializerBeanName);</span><br><span class="line">        <span class="keyword">return</span> holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createDependencyOnJCacheInitializer</span><span class="params">(BeanDefinitionHolder holder,</span></span><br><span class="line"><span class="params">            String initializerBeanName)</span> &#123;</span><br><span class="line">        <span class="type">AbstractBeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> ((AbstractBeanDefinition) holder.getBeanDefinition());</span><br><span class="line">        String[] dependsOn = definition.getDependsOn();</span><br><span class="line">        <span class="keyword">if</span> (dependsOn == <span class="literal">null</span>) &#123;</span><br><span class="line">            dependsOn = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;initializerBeanName&#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">List</span> <span class="variable">dependencies</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(Arrays.asList(dependsOn));</span><br><span class="line">            dependencies.add(initializerBeanName);</span><br><span class="line">            dependsOn = (String[]) dependencies.toArray(EMPTY_STRING_ARRAY);</span><br><span class="line">        &#125;</span><br><span class="line">        definition.setDependsOn(dependsOn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">registerJCacheInitializer</span><span class="params">(Node source, ParserContext ctx)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheName</span> <span class="operator">=</span> ((Attr) source).getValue();</span><br><span class="line">        <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> cacheName + <span class="string">&quot;-initializer&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!ctx.getRegistry().containsBeanDefinition(beanName)) &#123;</span><br><span class="line">            <span class="type">BeanDefinitionBuilder</span> <span class="variable">initializer</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(JCacheInitializer.class);</span><br><span class="line">            initializer.addConstructorArg(cacheName);</span><br><span class="line">            ctx.getRegistry().registerBeanDefinition(beanName, initializer.getBeanDefinition());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> beanName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, we need to register the various artifacts with the Spring XML infrastructure by modifying the <code>META-INF/spring.handlers</code> and <code>META-INF/spring.schemas</code> files, as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># in &#x27;META-INF/spring.handlers&#x27;</span><br><span class="line">http\://www.foo.example/schema/jcache=com.foo.JCacheNamespaceHandler</span><br><span class="line"># in &#x27;META-INF/spring.schemas&#x27;</span><br><span class="line">http\://www.foo.example/schema/jcache/jcache.xsd=com/foo/jcache.xsd</span><br></pre></td></tr></table></figure>

<h3 id="10-3-Application-Startup-Steps"><a href="#10-3-Application-Startup-Steps" class="headerlink" title="10.3. Application Startup Steps"></a>10.3. Application Startup Steps</h3><p>This part of the appendix lists the existing <code>StartupSteps</code> that the core container is instrumented with.</p>
<table>
<thead>
<tr>
<th></th>
<th>The name and detailed information about each startup step is not part of the public contract and is subject to change; this is considered as an implementation detail of the core container and will follow its behavior changes.</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Tags</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>spring.beans.instantiate</code></td>
<td align="left">Instantiation of a bean and its dependencies.</td>
<td align="left"><code>beanName</code> the name of the bean, <code>beanType</code> the type required at the injection point.</td>
</tr>
<tr>
<td align="left"><code>spring.beans.smart-initialize</code></td>
<td align="left">Initialization of <code>SmartInitializingSingleton</code> beans.</td>
<td align="left"><code>beanName</code> the name of the bean.</td>
</tr>
<tr>
<td align="left"><code>spring.context.annotated-bean-reader.create</code></td>
<td align="left">Creation of the <code>AnnotatedBeanDefinitionReader</code>.</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>spring.context.base-packages.scan</code></td>
<td align="left">Scanning of base packages.</td>
<td align="left"><code>packages</code> array of base packages for scanning.</td>
</tr>
<tr>
<td align="left"><code>spring.context.beans.post-process</code></td>
<td align="left">Beans post-processing phase.</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>spring.context.bean-factory.post-process</code></td>
<td align="left">Invocation of the <code>BeanFactoryPostProcessor</code> beans.</td>
<td align="left"><code>postProcessor</code> the current post-processor.</td>
</tr>
<tr>
<td align="left"><code>spring.context.beandef-registry.post-process</code></td>
<td align="left">Invocation of the <code>BeanDefinitionRegistryPostProcessor</code> beans.</td>
<td align="left"><code>postProcessor</code> the current post-processor.</td>
</tr>
<tr>
<td align="left"><code>spring.context.component-classes.register</code></td>
<td align="left">Registration of component classes through <code>AnnotationConfigApplicationContext#register</code>.</td>
<td align="left"><code>classes</code> array of given classes for registration.</td>
</tr>
<tr>
<td align="left"><code>spring.context.config-classes.enhance</code></td>
<td align="left">Enhancement of configuration classes with CGLIB proxies.</td>
<td align="left"><code>classCount</code> count of enhanced classes.</td>
</tr>
<tr>
<td align="left"><code>spring.context.config-classes.parse</code></td>
<td align="left">Configuration classes parsing phase with the <code>ConfigurationClassPostProcessor</code>.</td>
<td align="left"><code>classCount</code> count of processed classes.</td>
</tr>
<tr>
<td align="left"><code>spring.context.refresh</code></td>
<td align="left">Application context refresh phase.</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>Version 5.3.22<br>Last updated 2022-07-14 08:39:32 UTC</p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://stress1110.github.io/title/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'https://stress1110.github.io/title/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
